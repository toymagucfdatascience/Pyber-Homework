var PanoptoTS;!function(n){var i,e;i=n.Controls||(n.Controls={}),e=function(){function t(e,t,o,i,a,s){this.blocked=e,this.userId=t,this.ownerId=o,this.learnMoreUrl=i,this.signupUrl=a,this.resources=s,this.eventNamespace="quota-playback-modal",this._onToggle=new n.Models.TypedCallback}return Object.defineProperty(t.prototype,"onToggle",{get:function(){return this._onToggle},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;this.wrapper=$(t.template(this)),this.modal=this.wrapper.find(".quota-playback-modal"),this.wrapper.click(function(){e.blocked||e.hide()}),this.modal.click(function(e){e.stopPropagation()}),this.wrapper.hide(),$(window).resize(function(){e.modal.is(":visible")&&e.resize()})},t.prototype.show=function(){var e,t=this;if(this.userId)e=this.userId===this.ownerId?new i.QuotaPlaybackModalDialogs.OwnerDialog(this.resources):new i.QuotaPlaybackModalDialogs.ViewerDialog(this.resources);else{var o=new i.QuotaPlaybackModalDialogs.AnonymousUserDialog(this.blocked,this.learnMoreUrl,this.signupUrl,this.resources);o.onDismiss.add(function(){t.hide()}),e=o}e.render(),this.modal.contents().replaceWith(e.getElement()),this.wrapper.show(),this.resize(),$(window).on("resize."+this.eventNamespace,function(){t.resize()}),this._onToggle.fire(!0)},t.prototype.hide=function(){this.wrapper.hide(),$(window).off("resize."+this.eventNamespace),this._onToggle.fire(!1)},t.prototype.fadeIn=function(){this.show(),this.wrapper.hide(),this.wrapper.fadeIn()},t.prototype.getElement=function(){return this.wrapper},t.prototype.resize=function(){this.modal.height(this.modal.find(".quota-dialog").height())},t.template=_.template("\n            <div class='quota-playback-modal-wrapper'>\n                <div class='quota-playback-modal'>\n                </div>\n            </div>\n        "),t}(),i.QuotaPlaybackModal=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(r){var t,o;t=r.Controls||(r.Controls={}),o=function(){function d(o,e,t,i,s,n,a,l){this.cookieService=o,this.container=e,this.resources=t,this.deliveryId=i,this.ownerId=s,this.userId=n,this.signupUrl=a,this.learnMoreUrl=l,this.secondsListened=0,this._onToggle=new r.Models.TypedCallback,this.quotaBlockedCookieName=d.quotaBlockedCookiePrefix+this.deliveryId}return Object.defineProperty(d.prototype,"onToggle",{get:function(){return this._onToggle},enumerable:!0,configurable:!0}),d.prototype.initialize=function(o){var e=this;o||this.setBlockedCookie(!1),this.blocked=this.getBlockedCookie(),o&&(this.availableSeconds=this.blocked?0:d.playbackTeaseDuration),this.modal=new t.QuotaPlaybackModal(this.blocked,this.userId,this.ownerId,this.learnMoreUrl,this.signupUrl,this.resources),this.modal.onToggle.add(function(o){e._onToggle.fire(o)}),this.modal.render(),this.container.append(this.modal.getElement()),window.setTimeout(function(){window.location.reload()},864e5),this.blocked?this.modal.show():this.userId||o||this.modal.show()},d.prototype.update=function(o){this.secondsListened+=o,this.blocked=void 0!==this.availableSeconds&&this.secondsListened>=this.availableSeconds,this.blocked&&(this.modal.blocked=this.blocked,this.modal.show(),this.setBlockedCookie(!0))},d.prototype.fadeInModalForAnonymous=function(){this.userId||this.modal.fadeIn()},d.prototype.setBlockedCookie=function(o){o?this.cookieService.setCookie(this.quotaBlockedCookieName,o):this.cookieService.deleteCookie(this.quotaBlockedCookieName)},d.prototype.getBlockedCookie=function(){return"true"===this.cookieService.getCookie(this.quotaBlockedCookieName)},d.playbackTeaseDuration=30,d.quotaBlockedCookiePrefix="quotaBlocked",d}(),t.QuotaPlaybackTracker=o}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,o,s;t=e.Viewer||(e.Viewer={}),o=t.Controls||(t.Controls={}),s=function(){function e(e,t,s,r){this.target=e,this.overlayUploader=t,this.onCloseClick=s,this.resources=r,this.errorMessageDuration=3e3,this.errorFiles=[],this.renderElement(),this.target.append(this.element),this.closeButton=this.element.find(".close-button"),Panopto.Core.UI.Handlers.button(this.closeButton,this.onCloseClick),this.processingStatus=this.element.find(".processing-status"),this.fileProcessingRegion=new o.FileProcessingRegion(this.processingStatus,this.resources),this.hide()}return e.prototype.show=function(e){this.element.show(),this.closeButton.toggle(e)},e.prototype.hide=function(){this.element.hide()},e.prototype.toggleProcessingStatus=function(e){var t=this;if(e.length){if(this.fileProcessingRegion.render(e),this.processingStatus.show(),_.some(e.filter(function(e){return-1==t.errorFiles.indexOf(e.uploadId)}),function(e){return 1!==e.state&&2!==e.state})){var s=Panopto.cacheRoot+"/Images/upload_error.svg",r=_.find(e.reverse(),function(e){return 1!==e.state&&2!==e.state});if(this.errorFiles.push(r.uploadId),1===r.streamType){var o=this.element.find(".primary-stream-text"),i=this.element.find(".primary-stream-graphic");o.text(Panopto.GlobalResources.ViewerPlus_Overlay_InvalidFiletype.format(r.filename)),i.attr("src",s),setTimeout(function(){o.text(Panopto.GlobalResources.ViewerPlus_PrimaryOverlay_Subtitle),i.attr("src",Panopto.cacheRoot+"/Images/upload_primary_stream_large.svg")},this.errorMessageDuration)}else{var n=this.element.find(".secondary-stream-text"),a=this.element.find(".secondary-stream-graphic");n.text(Panopto.GlobalResources.ViewerPlus_Overlay_InvalidFiletype.format(r.filename)),a.attr("src",s),setTimeout(function(){n.text(Panopto.GlobalResources.ViewerPlus_SecondaryOverlay_Subtitle),a.attr("src",Panopto.cacheRoot+"/Images/upload_secondary_stream.svg")},this.errorMessageDuration)}}}else this.processingStatus.hide()},e}(),o.AddStreamOverlay=s}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=function(h){return h.Actions={Navigate:"navigate",PrimaryResize:"primary-resize",SecondaryResize:"secondary-resize",Transport:"transport",HideThumbnails:"hide-thumbnails",ShowThumbnails:"show-thumbnails",VolumeUp:"volume-up",VolumeDown:"volume-down",Mute:"mute",Unmute:"unmute",Play:"play",Pause:"pause",Rewind:"rewind",SkipToStart:"skip-to-start",Forward:"forward",SkipToEnd:"skip-to-end",Seek:"seek",Prereq:"prereq",Exit:"exit",Add:{Success:"add-event",Error:"add-error",Retry:"add-retry",Cancel:"add-cancel"},Edit:{Success:"edit-event",Error:"edit-error",Retry:"edit-retry",Cancel:"edit-cancel"},Delete:{Success:"delete-event",Error:"delete-error",Retry:"delete-retry",Cancel:"delete-cancel"},Speed:"speed",Bitrate:"bitrate",SecondaryTab:"secondary-tab",Quality:"quality",Desync:"multi-stream-desync"},h.Labels={Thumbnail:"thumbnail",Transcript:"caption",Content:"chapter",Search:"search",Normal:"normal",Fullscreen:"fullscreen",Hotkey:"hotkey",Login:"login",Folder:"folder",DoubleClick:"double-click",Forward:"forward",Note:"note",Bookmark:"bookmark",Comment:"comment",Question:"question",Access:"access",SessionList:"session-list",Settings:"settings",Share:"share",Editor:"editor",EditContents:"edit-contents",EditTranscript:"edit-transcript",EditSlides:"edit-slides",EditCut:"edit-cut",EditStream:"edit-stream",EditQuestionList:"edit-question-list",PrimaryAhead:"primary-ahead",SecondaryAhead:"secondary-ahead",OndemandAutoLevel:"onedmand-auto",OndemandManualLevel:"ondemand-manual",BroadcastAutoLevel:"broadcast-auto",BroadcastManualLevel:"broadcast-manual"},h.sendEvent=function(e){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.behavior,source:"player",action:e.action,label:e.label})},h.sendFullScreenEvent=function(e,t){h.sendEvent({action:e?h.Actions.PrimaryResize:h.Actions.SecondaryResize,label:t?h.Labels.DoubleClick:h.Labels.Normal})},h.sendDesyncEvent=function(e){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.sync,source:"player",action:h.Actions.Desync,label:0<e.diff?h.Labels.PrimaryAhead:h.Labels.SecondaryAhead,value:Math.round(1e3*Math.abs(e.diff)),customFields:{dimension1:Panopto.webServerFQDN,dimension2:e.deliveryId,dimension3:e.invocationId}})},h.QualityReporter=function(s){var d,l,c,u,m,p,e,t,y=!1,v=0,b=!s.isAudioOnly;return(e=(s.isBroadcast?new RegExp("Sessions/(?:(?:_hlsbc)|(?:_rtmp))/([a-z0-9-]{36})/master.m3u8\\??(.*)","i"):new RegExp("Sessions/[a-z0-9-]{36}/([a-z0-9-]{36}(?:-[a-z0-9-]{36})?)..*hls/master.m3u8\\??(.*)","i")).exec(s.streamUrl))&&e.length?(2<=e.length&&(d=e[1]),3<=e.length&&(t=new RegExp("InvocationID=([a-z0-9-]{36})","i").exec(e[2]),l=t&&2===t.length?t[1]:"")):b=!1,{flushQualityReport:function(e,t,a,n,o,r){var i=t-v;b&&y&&i>=s.minDuration&&Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.quality,source:"player",action:h.Actions.Quality,label:s.isBroadcast?p?h.Labels.BroadcastAutoLevel:h.Labels.BroadcastManualLevel:p?h.Labels.OndemandAutoLevel:h.Labels.OndemandManualLevel,customFields:{dimension1:Panopto.webServerFQDN,dimension2:d,dimension3:l,metric1:Math.round((c+1)/u*100*i),metric2:Math.round(m/1024*i),metric3:Math.round(i)}}),y=e,v=t,c=a,u=n,m=o,p=r}}},h}(Panopto.Viewer.Analytics||{});
var PanoptoTS;!function(A){var e,t;e=A.Viewer||(A.Viewer={}),t=function(){function n(A){var e=void 0===A?{}:A,t=e.muted,o=void 0!==t&&t,a=e.playsInline,i=void 0!==a&&a,n=e.autoPlayRequested,s=void 0===n||n;this.muted=o,this.playsInline=i,this.autoPlayRequested=s}return n.prototype.detect=function(){var e=$.Deferred(),A=new RegExp(Panopto.viewer.autoPlayWhitelistRegex).test(navigator.userAgent),t=new RegExp(Panopto.viewer.autoPlayBlacklistRegex).test(navigator.userAgent);if(!this.autoPlayRequested||t)e.resolve(!1);else if(A)e.resolve(!0);else{var o=$('<video class="'+n.videoElementClass+'">').prependTo("body"),a=o[0];a.src=n.dummyMp4WithAudio,a.muted=this.muted,a.playsInline=this.playsInline;var i=a.play();"Promise"in window&&i instanceof Promise?i.then(function(){return e.resolve(!0)}).catch(function(A){return e.resolve(!1)}):e.resolve(!$.browser.mobile),e.then(function(){a.src="",a.load(),o.remove()})}return e.promise()},n.videoElementClass="auto-play-detector",n.dummyMp4WithAudio="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAC721kYXQhEAUgpBv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3pwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcCEQBSCkG//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADengAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAsJtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAB7HRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAALwAAAAAAAAAAAAAAAQEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAC8AAAAAAAEAAAAAAWRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAKxEAAAIAFXEAAAAAAAtaGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kSGFuZGxlcgAAAAEPbWluZgAAABBzbWhkAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAADTc3RibAAAAGdzdHNkAAAAAAAAAAEAAABXbXA0YQAAAAAAAAABAAAAAAAAAAAAAgAQAAAAAKxEAAAAAAAzZXNkcwAAAAADgICAIgACAASAgIAUQBUAAAAAAfQAAAHz+QWAgIACEhAGgICAAQIAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAIAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAFzAAABdAAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ni40MC4xMDE=",n}(),e.AutoPlayDetector=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,Panopto=Panopto||{};Panopto.Core=Panopto.Core||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.GlobalResources=Panopto.GlobalResources||{},function(i){!function(e){var o,t,a=function(){function e(){}return e.TimedSyncRate=30,e.ControlSyncRate=1e3,e.SecondarySyncThreshold=1,e.SecondarySyncTargetSeconds=.4,e.SecondarySynchronizingUpdateRateMillis=50,e.InitialSecondaryThreshold=5,e.SecondaryStreamOffset=1.5,e.MinSegmentGap=1,e.ContiguousSegmentThreshold=.2,e.EndPositionThreshold=.1,e.DeliveryRefreshInterval=6e4,e.BroadcastEndedIncrement=5e3,e.ReopenedBroadcastInterval=3e4,e.QualityReportThreshold=2,e.BroadcastStreamRetryTimeout=5e3,e.BroadcastInitialSyncThreshold=5,e.LivePositionTolerance=1,e.BroadcastEndThreshold=1,e.MaxPositionInterpolation=500,e.BufferingTimeoutThreshold=1e3,e.BadSeekThreshold=.1,e.SecondaryPlayerClass="secondaryPlayer",e.SlideDeckId="slideDeck",e.ScreenCaptureClass="screen-capture",e.ObjectVideoTabClass="object-video",e.UrlTabClass="url",e.YouTubeIconClass="youtube",e.SlideDeckTabClass="slide-deck",e.PrimaryTabHeaderClass="primary-header",e.SecondaryTabHeaderClass="secondary-header",e.RecentBroadcastThreshold=144e5,e.UrlEventDuration=.5,e.PlayKeyCode=32,e.RewindKeyCode=37,e.ForwardKeyCode=39,e.VolumeUpKeyCode=38,e.VolumeDownKeyCode=40,e.MuteKeyCode=77,e.VolumeIncrement=10,e.PositionIncrement=5,e.MinVolume=0,e.MaxVolume=100,e.InitialVolume=100,e.SilverlightVersion="4.0.50401.0",e.PlaySpeedSilverlightVersion="5.0",e.QuickRewindSeconds=10,e.QuickForwardSeconds=30,e.FullScreenControlInterval=3,e.EditJumpSeconds=5,e.DisplayTimeMillisecondPrecision=2,e.CaptionMaxLength=256,e.EditorTimelineEndOffsetSeconds=.01,e.DisplayTimePrecisionMultiplier=Math.pow(10,e.DisplayTimeMillisecondPrecision),e.UrlEventClosenessTolerance=.1,e.BoundaryCutTolerance=.1,e.LeftPaneRatio=.35,e.LeftPaneMinWidth=460,e.RightPaneMinWidth=480,e.HeaderBuffer=60,e.MaxDesktopTitleCharacters=120,e.MaxMobileTitleCharacters=60,e.EventRegionMinHeight=300,e.PlayerMinHeight=50,e.LeftPlayerDefaultHeight=260,e.LiveNotesClass="live-notes",e.MaxInlineSecondaryTabs=3,e.CollapseSecondaryTabsWidth=1200,e.SliderDragThreshold=2,e.InputMargin=14,e.InputOptionsMargin=4,e.ScrollBarWidth=20,e.AudioOnlyMinimumWidth=2,e.ThumbnailScrollTimeout=5e3,e.EventScrollTimeout=5e3,e.FlyoutTimeout=2e3,e.BaseUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.appRoot,e.SessionListUrl=e.BaseUrl+"/Pages/Sessions/List.aspx",e.SilverlightEditorUrlTemplate=e.BaseUrl+"/Pages/Editor/Default.aspx#{0}",e.SlideImageUrl=e.BaseUrl+"/Pages/Viewer/Image.aspx",e.ThumbUrl=e.BaseUrl+"/Pages/Viewer/Thumb.aspx",e.DummyPDFUrl=e.BaseUrl+"/Scripts/PluginDetect/empty.pdf",e.FlashPlayerUrl="http://get.adobe.com/flashplayer",e.SinglePageAppUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.relativeSinglePageAppUrl,e.QuizEditUrlTemplate=e.SinglePageAppUrl+"quiz-configure/{0}",e.YouTubeEditUrlTemplate=e.SinglePageAppUrl+"youtubeEmbed/configure/{0}",e.YouTubeEmbedBaseUrl="www.youtube.com/embed/",e.HlsLevelFileNames=["index.m3u8","index2.m3u8"],e.JoinChannelOptionValue="joinChannel",e.SearchExpandDuration=400,e.FadeInterval=150,e.PlaySpeedResourceString="ViewerPlus_Speeds_{0}",e.BitrateResourceString=(e.BitrateResourcePrefixString="ViewerPlus_Bitrates_")+"{0}",e.SearchTypeResourceString="ViewerPlus_Search_{0}",e.BitrateCookie="defaultBitrate",e.MBRBitrateCookie="defaultBitrateMBR",e.VolumeCookie="defaultVolume",e.CaptionsCookie="defaultCaptions",e.CaptionPlacementCookie="defaultCaptionPlacement",e.CaptionSizeCookie="defaultCaptionSize",e.CaptionColorCookie="defaultCaptionColor",e.BitrateLevels=[Panopto.GlobalResources[e.BitrateResourcePrefixString+"Low"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"High"]],e.MaxScormSegments=100,e.ScormCompleteThreshold=.9,e.ScormOffsetMultiplier=5,e.ScormTimeKey="cmi.core.session_time",e.PluginDetectPDFReader="PDFReader",e.SortRelevanceValue="relevance",e.SortTimeValue="time",e.SearchSortOrders=[{value:e.SortRelevanceValue,name:Panopto.GlobalResources.ViewerPlus_SortByRelevance},{value:e.SortTimeValue,name:Panopto.GlobalResources.ViewerPlus_SortByTime}],e.MP4MimeType="video/mp4",e.HLSMimeType="application/x-mpegurl",e.Hive="Hive",e.Kollective="Kollective",e.KollectiveLongPollUrlBase="/api/v1/longpoll?ts={0}&ktoken=",e.LTIPage="/Panopto/LTI/LTI.aspx",e.OutcomeFormat="resultScore={0}&lis_result_sourcedid={1}&oauth_consumer_key={2}&lti_message_type=panopto_outcome_pox_response&lti_version=LTI-1p0",e}();e.Constants=a,(o=e.MBRBitrate||(e.MBRBitrate={}))[o.High=2]="High",o[o.Medium=1]="Medium",o[o.Auto=0]="Auto",(t=e.ViewMode||(e.ViewMode={}))[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.LiveNotes=3]="LiveNotes";var r=function(){function e(){}return e.getValues=function(o){return Object.keys(o).map(function(e){return o[e]}).filter(function(e){return!isNaN(e)})},e.getNames=function(o){return Object.keys(o).map(function(e){return o[e]}).filter(function(e){return isNaN(e)}).map(function(e){return e.toString()})},e.getNameValuePairs=function(o){return Object.keys(o).map(function(e){return new i.Models.KeyValue(e,o[e])}).filter(function(e){return!isNaN(e.value)})},e}();e.EnumHelpers=r,(a=e.Constants||(e.Constants={})).HttpHeaders={Date:"date",LastModified:"last-modified"}}(i.Viewer||(i.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Viewer.Constants=PanoptoTS.Viewer.Constants,Panopto.Viewer.MBRBitrate=PanoptoTS.Viewer.MBRBitrate,Panopto.Viewer.ViewMode=PanoptoTS.Viewer.ViewMode,Panopto.Core.ViewerPlayState=Panopto.Core.ViewerPlayState||{},Panopto.Viewer.PlayState=function(e){return e.Playing=Panopto.Core.ViewerPlayState.Playing,e.Paused=Panopto.Core.ViewerPlayState.Paused,e.Stopped=Panopto.Core.ViewerPlayState.Stopped,e.Buffering=Panopto.Core.ViewerPlayState.Buffering,e}(Panopto.Viewer.PlayState||{}),Panopto.Viewer.PlaySpeed=function(e){return e.Slowest=.5,e.Slow=.75,e.Normal=1,e.Fast=1.25,e.Faster=1.5,e.FasterYet=1.75,e.Fastest=2,e}(Panopto.Viewer.PlaySpeed||{});
var PanoptoTS;!function(e){!function(e){Panopto.Core.StringHelpers.parseQueryString(window.location.hash.slice(1)).debug&&(window.fireDebugEvent=function(e){var n=new CustomEvent(e.typeArg(),{detail:e});document.dispatchEvent(n)});var n=function(){};e.DebugEventModel=n}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var i,t;i=o.Viewer||(o.Viewer={}),t=function(){function o(o,i,t,e,r,s){this.showHtmlEditorCallback=o,this.showPurgedDeliveryCallback=i,this.showSilverlightEditorCallback=t,this.showUnsupportedBrowserCallback=e,this.showSessionNotReadyCallback=r,this.showPendingTranscriptionCallback=s}return o.prototype.routeDelivery=function(o){o.isReadyForEditing?Panopto.Core.Browser.isIE8||Panopto.Core.Browser.isIE9?this.showUnsupportedBrowserCallback():!Panopto.viewer.editingEnabled||o.requiresAdvancedEditor?this.showSilverlightEditorCallback():o.isPurgedLegacyEncode?this.showPurgedDeliveryCallback():Panopto.viewer.hasEditedTranscriptionRequest?this.showPendingTranscriptionCallback():this.showHtmlEditorCallback():this.showSessionNotReadyCallback()},o}(),i.EditorRouter=t}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{};var PanoptoLegacy=Panopto;PanoptoLegacy.Viewer.Layout=function(C,b,M,S,d,L,I,H,e,T){var z,a,n,R=Panopto.Viewer.ViewMode,W=Panopto.Viewer.Constants,V=$("#viewer"),E=$("#viewerContent"),A=$("#searchRegion"),D=$("#eventTabs"),r=$("#eventTabControl"),o=$("#hideEventsButton"),F=$("#playControls"),k=$("#thumbnailList"),O=$("#timelineContainer"),s=$("#inlineMessageLetterbox"),h=$("#inlineMessage"),N=$("#dockedCaption"),l=$("#dockedCaptionText"),g=$("#overlayCaption"),B=$("#playlistOverlay"),c="",y=!1,w=!($.browser.msie&&parseFloat($.browser.version)<10||e||T),U=!1,j=r.outerWidth(),P=W.LeftPaneMinWidth,f="collapsed",p=function(e,t){var i=M.getLeftPane();i.stop(),e?(t?(i.width(P).css("max-width",P),U=!1):i.animate({width:P,"max-width":P},{duration:2*W.FadeInterval,progress:function(){C.resize()},complete:function(){U=!1}}),o.show(),A.removeClass(f)):(o.hide(),A.addClass(f),U=!0,t?i.width(j).css("max-width",j+"px"):i.animate({width:j,"max-width":j},{step:function(){C.resize()}})),b.viewer.setState({eventPaneIsExpanded:e})},q=function(e,t){var i=s.is(":visible");s.width(e).height(t).show(),h.css("margin-top",(t-h.height())/2),i||s.hide()},G=function(){var e=$(M.getSecondaryPlayers()[S.getPrimaryPlayerIndex()]),t=M.getRightPlayerContainer().offset();M.getPrimaryPlayer().css("left",t.left+"px").css("top",t.top+"px");var i=M.getLeftPlayerContainer().offset();e.css("left",i.left+"px").css("top",i.top+"px")},t=function(e){var t=S.getPrimaryPlayerIndex();if(t!==S.PrimaryDefaultIndex&&e===PanoptoTS.Viewer.ViewMode.Secondary){var i=M.getPrimaryPlayer(),a=$(M.getSecondaryPlayers()[t]);G(),i.addClass("roaming"),a.addClass("roaming")}else M.getPrimaryPlayer().add(M.getSecondaryPlayers()[t]).removeClass("roaming").css("left","").css("top",""),M.getSecondaryPlayers().removeClass("roaming").css("left","").css("top","")};$("#wrapper").css("min-width","0px"),$("body").css("overflow","hidden"),$("#logoutWarningMessage").addClass("bottom"),$.browser.msie&&8===parseFloat($.browser.version)&&(F.find("#transportControls").css("table-layout","fixed"),F.find("#positionControl").css("width","100%")),$(window).resize(function(){C.resize()});var i="clicked";$(document).on("mousedown","a",function(e){$(e.currentTarget).addClass(i)}).on("blur","a",function(e){$(e.currentTarget).removeClass(i)}),w&&Panopto.Core.UI.Handlers.button(o.find("div"),function(){p(!1,void 0)}),C.resize=function(){var e,t,i,a,n,r=M.getLeftPane(),o=(S.getLeftPlayerElement(),S.getLeftPlayer()),s=M.getLeftPlayerContainer(),d=M.getRightPlayerContainer(),h=O.is(":visible")&&O.hasClass(Panopto.Core.Constants.ExpandedClass),l=$(window).height()-H.height()-(h?O.outerHeight():0),g=$(window).width(),c=r.outerWidth()-r.width(),y=A.is(":visible")?A.outerHeight(!0):0,w=(O.is(":visible")&&!h?O.outerHeight():0)+(N.is(":visible")?N.outerHeight():0)+(k.is(":visible")?k.outerHeight():0),P=Math.max(l-F.outerHeight()-w,W.PlayerMinHeight),f=d.outerWidth()-d.width(),p=d.outerHeight()-d.height();switch(E.height(l),O.css("top",h?$(window).height()-O.outerHeight()+"px":""),z){case R.Primary:t=W.LeftPaneMinWidth,e=U?parseInt(r.css("max-width").slice(0,-2)):t,a=Math.max(g-e-c,W.RightPaneMinWidth),r.width(e),n=Math.max(l,W.EventRegionMinHeight)-y,D.height(n),b.viewer.setState({eventPaneSize:{width:e-j,height:n}}),B.width(t),B.height(l),H.setLeftPaneWidth(t),o.resize(a,P),d.width(a),d.height(P),s.height(0),q(a,P),$("#copyrightNoticeContainer").height(l),V.css("min-width",e+c+W.RightPaneMinWidth),T&&T.resize(h?e+c+a:a),k.width(a),C.toggleInlineSecondaries(),C.resizeCaption();break;case R.Secondary:t=I.isPrimaryAudioOnly||T?W.LeftPaneMinWidth:Math.max(g*W.LeftPaneRatio,W.LeftPaneMinWidth),e=U?parseInt(r.css("max-width").slice(0,-2)):t,a=Math.max(g-e-c,W.RightPaneMinWidth),r.width(e),o&&(l-(i=0===o.height()||0===o.width()||I.isPrimaryAudioOnly?C.forceLeftPlayerHeight?W.LeftPlayerDefaultHeight:0:e*o.height()/o.width())>=W.EventRegionMinHeight?(o.resize(e,i),s.width(e),s.height(i),n=l-i-y):(o.resize(e,Math.max(l-W.EventRegionMinHeight,W.PlayerMinHeight)),s.width(e),s.height(Math.max(l-W.EventRegionMinHeight,W.PlayerMinHeight)),n=W.EventRegionMinHeight-y)),D.height(n),b.viewer.setState({eventPaneSize:{width:e-j,height:n}}),B.width(t),B.height(l),H.setLeftPaneWidth(e);var m,u,v=a-f,x=P-p;1===L.length?(m=v,u=x):4===L.length?(m=v/2,u=x/2):P<a?(m=v/L.length,u=x):(m=v,u=x/L.length),d.width(v),d.height(x),_.each(S.getRightPlayers(),function(e,t){if(e){var i=0,a=0;if(t!==S.getPrimaryPlayerIndex()){var n=M.getSecondaryPlayers()[t].children[0];$(n).css("border-left-width")&&(i+=parseFloat($(n).css("border-left-width"))),$(n).css("border-right-width")&&(i+=parseFloat($(n).css("border-right-width"))),$(n).css("border-top-width")&&(a+=parseFloat($(n).css("border-top-width"))),$(n).css("border-bottom-width")&&(a+=parseFloat($(n).css("border-bottom-width")))}e.resize(m-i/2,u-a/2)}}),S.getPrimaryPlayerIndex()!=S.PrimaryDefaultIndex&&G(),q(a,P),T&&T.resize(h?e+c+a:a),$("#copyrightNoticeContainer").height(u),k.width(a),C.toggleInlineSecondaries(),C.resizeCaption();break;case R.LiveNotes:e=W.LeftPaneMinWidth,r.width(e),b.viewer.setState({eventPaneSize:{width:e-j,height:l}}),B.width(0)}C.positionAutoplayMessage()};var m=function(e){S.swapLeftAndRight(e),t(z),C.resize()},u=function(e){var t=S.getLeftPlayerElement(),i=S.getRightPlayerElements();switch(e){case R.Primary:i.css("max-height",0),t.css("max-height",""),t.hasClass("primary-only")||t.addClass("primary-only"),w&&(o.css("visibility","visible"),!z||I.isPrimaryAudioOnly&&U||p(!0,!0));break;case R.Secondary:t.css("max-height",""),i.css("max-height",""),I.isPrimaryAudioOnly||(U&&p(!0,!0),M.getLeftPane().css("max-width",""),o.css("visibility","hidden")),t.removeClass("primary-only"),t.css("height",""),t.css("width",""),N.add(F).css("margin-top",""),V.css("min-width","");break;case R.LiveNotes:H.toggleLiveNotes(!0),t.hide(),F.hide(),r.hide(),M.getRightPane().hide()}};C.swapLeftToRight=function(e){(C.isSecondarySwapAllowed()||S.getPrimaryPlayerIndex()!==S.PrimaryDefaultIndex&&e===S.PrimaryDefaultIndex)&&m(e)},C.swapPrimaryAndFirstSecondary=function(){C.swapLeftToRight(S.getPrimaryPlayerIndex()==S.PrimaryDefaultIndex?0:S.PrimaryDefaultIndex)},C.interruptLayoutChanges=function(e){1<L.length&&((e||C.viewMode())===R.Secondary&&(n=L.length,C.setSecondaryCount(1)));var t=S.getPrimaryPlayerIndex();t!=S.PrimaryDefaultIndex&&(void 0!==e&&S.setViewMode(e),a=t,m(S.PrimaryDefaultIndex))},C.restoreLayoutChanges=function(){if(void 0!==n){var e=n;n=void 0,C.setSecondaryCount(e)}var t=void 0!==a;if(t){var i=a;a=void 0,m(i)}return t},C.isSecondarySwapAllowed=function(){return C.viewMode()===R.Secondary&&!I.isPrimaryAudioOnly&&I.flowPlayerEnabled&&!C.isFullscreen()&&!T&&void 0===a&&1===L.length&&!_.any(L,function(e){return e.getTabControl()&&e.getTabControl().selectedTab()&&e.getTabControl().selectedTab().content().isSecondaryPaneOnly})},C.viewMode=function(e){if(void 0===e)return z;e!==z&&(u(e),z||!w||I.contents.length||(e!==R.Primary&&!I.isPrimaryAudioOnly||b.viewer&&b.viewer.props&&b.viewer.props.initialSearchTerm?p(!0,!0):p(!1,!0)),(z=e)===R.Primary&&S.getPrimaryPlayerIndex()!==S.PrimaryDefaultIndex?(C.interruptLayoutChanges(e),u(e)):(S.setViewMode(e),e===R.Secondary&&void 0!==a?(C.restoreLayoutChanges(),u(e)):t(e)),C.resize())},C.toggleInlineSecondaries=function(){var e,t=$(window).width()<W.CollapseSecondaryTabsWidth,i=$("#transportControls > ."+W.SecondaryTabHeaderClass),a=$("#selectedSecondary");Panopto.viewer.allowMultipleSecondaryDisplay?(a.hide(),i.hide()):1===L.length&&(e=_.filter(L[0].getTabs(),function(e){return!e.hiddenTab()}),t?(a.toggle(1<e.length),i.css("display","none")):(a.toggle(e.length>W.MaxInlineSecondaryTabs),i.css("display",1<e.length&&e.length<=W.MaxInlineSecondaryTabs?"":"none")))},C.expandLeftPane=function(){w&&U&&p(!0,void 0)},C.expandTimeline=function(e){O.toggleClass(Panopto.Core.Constants.ExpandedClass,e),C.resize()},C.resizeCaption=function(e,t){var i=S.getLeftPlayerElement(),a=S.getRightPlayerElements().first(),n=C.fullscreenPlayer(),r=n?n===d?i:a:z===R.Primary?i:a,o=r.find(".screen:visible"),s=0;n?(r=r.find("video"),s=$(".fullscreen-controls").outerHeight(!0)+10):o.length&&o.width()&&(r=o),"string"==typeof e&&(c=Panopto.Core.TextHelpers.displayLineBreaks(Panopto.Core.TextHelpers.cleanTextWithoutHighlighting(e))),void 0!==t&&(y=t),n||!y?(g.html(c),g.toggle(!!c).css({"max-height":r.height(),"max-width":r.width(),top:0,left:0}),r.offset()&&g.css({left:r.offset().left+(r.width()-g.outerWidth())/2,top:r.offset().top+r.height()-g.outerHeight()-s})):(l.html(c),g.hide())}};

var Panopto=Panopto||{},PanoptoLegacy=Panopto;

var PanoptoTS;!function(o){var r,t;r=o.Viewer||(o.Viewer={}),t=function(){function n(t,e){var c=this;this.quizzes=t,this.ltiConfig=e,this.completedCallback=new o.Models.TypedCallback,this.closedCallback=new o.Models.TypedCallback,this.results={},this.onQuizCompleted=function(t){c.completedCallback.add(t)},this.onQuizClosed=function(t){c.closedCallback.add(t)},this.completeQuiz=function(e,t,n){var o=_.find(c.quizzes,function(t){return t.id===e});o&&(o.isSessionPlaybackBlocking=!1,c.ltiConfig&&c.recordResult(e,t,n),c.completedCallback.fire(o))},this.closeQuiz=function(e){var t=_.find(c.quizzes,function(t){return t.id===e});c.closedCallback.fire(t)},this.recordResult=function(t,e,n){if(_.isNumber(e)&&_.isNumber(n)){c.results[t]={correct:e,questions:n};var o=_.values(c.results);if(!_.contains(o,null)){var i=_.reduce(o,function(t,e){return{correct:t.correct+e.correct,questions:t.questions+e.questions}}),s=Panopto.Core.StringHelpers.format(r.Constants.OutcomeFormat,i.correct/i.questions,c.ltiConfig.outcomeId,c.ltiConfig.oauthConsumerKey);$.ajax({type:"GET",url:r.Constants.LTIPage,data:s,error:function(t){window.console&&console.log(t)}})}}},n.instance=this,_.each(t,function(t){c.results[t.id]=null})}return n.getInstance=function(){return n.instance},n}(),r.QuizResultsController=t}(PanoptoTS||(PanoptoTS={}));

var PanoptoTS;!function(o){var e,a;e=o.Viewer||(o.Viewer={}),(a=e.SecondaryLayoutType||(e.SecondaryLayoutType={}))[a.Single=0]="Single",a[a.Double=1]="Double",a[a.Quad=2]="Quad"}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(a){var n,e;n=a.Viewer||(a.Viewer={}),e=function(){function e(e,r,t){this.PrimaryDefaultIndex=-1,this._onSecondaryLayoutChanged=new a.Models.TypedCallback,this.primaryPlayerIndex=this.PrimaryDefaultIndex,this.playerSwapHandlers=[],this.secondaryLayout=n.SecondaryLayoutType.Single,this.pageStructureElements=e,this.primaryPlayer=r,this.secondaryContentContainers=t}return Object.defineProperty(e.prototype,"onSecondaryLayoutChanged",{get:function(){return this._onSecondaryLayoutChanged},enumerable:!0,configurable:!0}),e.prototype.getPrimaryPlayerIndex=function(){return this.viewMode!==a.Viewer.ViewMode.Secondary?this.PrimaryDefaultIndex:this.primaryPlayerIndex},e.prototype.getLeftPlayer=function(){return this.primaryPlayerIndex===this.PrimaryDefaultIndex||this.viewMode!==a.Viewer.ViewMode.Secondary?this.primaryPlayer:this.secondaryContentContainers[this.primaryPlayerIndex].getCurrentPlayer()},e.prototype.getLeftPlayerElement=function(){return this.primaryPlayerIndex===this.PrimaryDefaultIndex||this.viewMode!==a.Viewer.ViewMode.Secondary?this.pageStructureElements.getPrimaryPlayer():$(this.pageStructureElements.getSecondaryPlayers()[this.primaryPlayerIndex])},e.prototype.getRightPlayers=function(){var e=_.map(this.secondaryContentContainers,function(e){return e.getCurrentPlayer()});return this.primaryPlayerIndex!==this.PrimaryDefaultIndex&&this.viewMode===a.Viewer.ViewMode.Secondary&&(e[this.primaryPlayerIndex]=this.primaryPlayer),e},e.prototype.getRightPlayerElements=function(){var e=this.pageStructureElements.getSecondaryPlayers();return this.primaryPlayerIndex!==this.PrimaryDefaultIndex&&this.viewMode===a.Viewer.ViewMode.Secondary&&(e[this.primaryPlayerIndex]=this.pageStructureElements.getPrimaryPlayer()[0]),e},e.prototype.getPlayerFromElement=function(e){var r,t=this.pageStructureElements.getPlayerFromElement(e);if(1===t.length)if(t[0]===this.pageStructureElements.getPrimaryPlayer()[0])r=this.primaryPlayer;else{var a=this.pageStructureElements.getSecondaryPlayers().toArray().indexOf(t[0]);0<=a&&(r=this.secondaryContentContainers[a].getCurrentPlayer())}return r},e.prototype.setViewMode=function(e){this.viewMode=e},e.prototype.swapLeftAndRight=function(e){var r=this,t=this.primaryPlayerIndex;this.primaryPlayerIndex=e,_.each(this.playerSwapHandlers,function(e){return e(t,r.primaryPlayerIndex)})},e.prototype.onPlayerSwap=function(e){_.contains(this.playerSwapHandlers,e)||this.playerSwapHandlers.push(e)},e.prototype.offPlayerSwap=function(e){var r=this.playerSwapHandlers.indexOf(e);0<=r&&(this.playerSwapHandlers=this.playerSwapHandlers.splice(r,1))},e.prototype.getSecondaryLayout=function(){return this.secondaryLayout},e.prototype.getAllowedSecondaryLayouts=function(){return[n.SecondaryLayoutType.Single,n.SecondaryLayoutType.Double,n.SecondaryLayoutType.Quad]},e.prototype.setSecondaryLayout=function(e){e!==this.secondaryLayout&&(this.secondaryLayout=e,this._onSecondaryLayoutChanged.fire(this.secondaryLayout))},e}(),n.StandardPlayerLayout=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var r,t,n;r=e.Viewer||(e.Viewer={}),t=r.Viewer||(r.Viewer={}),n=function(){function r(){}return r.prototype.getPrimaryPlayer=function(){return $(r.primaryPlayerSelector)},r.prototype.getSecondaryPlayers=function(){return $(r.secondaryPlayerSelector)},r.prototype.getLeftPane=function(){return $("#leftPane")},r.prototype.getLeftPlayerContainer=function(){return $("#leftPlayerContainer")},r.prototype.getRightPane=function(){return $("#rightPane")},r.prototype.getRightPlayerContainer=function(){return $("#rightPlayersContainer")},r.prototype.getPlayerFromElement=function(e){return e.closest(r.primaryPlayerSelector+", "+r.secondaryPlayerSelector)},r.primaryPlayerSelector="#primaryPlayer",r.secondaryPlayerSelector="."+e.Viewer.Constants.SecondaryPlayerClass,r}(),t.PageElements=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(t){var e,n,o;e=t.Viewer||(t.Viewer={}),n=e.Viewer||(e.Viewer={}),o=function(){function t(t,e,n,o){this.tabElements=[],this.contentContainer=t,this.tabContainer=e,this.selected=n,this.expander=o}return t.prototype.getTabs=function(){return $(this.tabElements)},t.prototype.getSelected=function(){return this.selected},t.prototype.getExpander=function(){return this.expander},t.prototype.getContentContainer=function(){return this.contentContainer},t.prototype.getContent=function(){return this.contentContainer.children().first()},t.prototype.addTab=function(t,e){this.tabElements.push(t),this.selected.before(t),this.tabElements.push(e),this.expander.find(".flyout-close").before(e)},t.prototype.setContentClass=function(t){this.getContent().attr("class",Panopto.Viewer.Constants.SecondaryContentClass+" "+t)},t.prototype.setSelectedText=function(t){this.selected.find("#selectedSecondaryText").text(t)},t.prototype.setSelectedIcon=function(t,e){t?this.selected.find("#selectedSecondaryIcon").html(t).attr("class","material-icons"):this.selected.find("#selectedSecondaryIcon").html("").attr("class",e)},t}(),n.TabElements=o}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.API=Panopto.API||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Discussion=Panopto.Viewer.Tabs.Discussion||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.KollectiveFP=Panopto.Viewer.KollectiveFP||{},Panopto.Core=Panopto.Core||{},Panopto.Core.PlayResumption=Panopto.Core.PlayResumption||{};var Silverlight=Silverlight;Panopto.Viewer.Viewer=function(v,s,r,e,l,w,f){var c,S,h,m,u,d,b,C,V,T,E,L,i,R,P,M,p,o,g,I,y,k,D,x,G,U,n,B,A,F,H,z,N,O=PanoptoTS.Viewer.Constants,W=PanoptoTS.Viewer.Data,K=Panopto.Core.ErrorCode,a=$.Deferred(),Q=[],q=new PanoptoTS.Viewer.Controls.ManualFullScreenStateControlGroup,J=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),t="true"===J.edit,j=J.tid,X=!!J.notes,Y=Panopto.Viewer.PlayState.Paused,Z=0,ee=0,oe=0,te=!1,ne=!0,ae=!1,ie=!1,re=!0,se=new PanoptoTS.Viewer.Viewer.PageElements,le=Panopto.Core.CookieHelpers.getUserCookieField(Panopto.user.userKey,O.VolumeCookie),ce="7.0.4"===Panopto.viewer.flowplayerExactVersion,ue=!1,de=new PanoptoTS.Viewer.Logic.DefaultPlayerSelectionLogic({forceUseStateMachine:void 0!==J.useStateMachine?"true"===J.useStateMachine.toLowerCase():void 0,useStateMachineBroadcast:Panopto.viewer.flowplayerStateMachineEnabledBroadcast,useStateMachineOnDemand:Panopto.viewer.flowplayerStateMachineEnabledOnDemand,playerHelpers:v}),Pe='<div class="'+O.SecondaryPlayerClass+' player"><div class="secondaryContent" /></div>',pe=Panopto.Viewer.KollectiveFP,ge=!1,ye="true"===J.startMuted;J.outcome_did&&(N={outcomeId:J.outcome_did,oauthConsumerKey:J.oauth_consumer_key});var ve,we,fe=Panopto.Core.StringHelpers.parseQueryString(window.location.hash.slice(1)),Se=fe.debug?new PanoptoTS.Viewer.Controls.MockSessions(Panopto.Core.ServiceInterface.Rest.Sessions):Panopto.Core.ServiceInterface.Rest.Sessions,he=new PanoptoTS.Viewer.EditorRouter(function(){R.isViewable=R.isReadyForEditing,R.isRecentBroadcast=!1,R.multiBitrateEnabled=!1,L&&L.deregisterCallbacks(),L=Panopto.Viewer.Controls.Timeline.TimelineEditor(fe,v,P,R,Se,function(){v.resize=void 0,Me(),L.overlayController.ready.then(function(){D.show(),v.resize()})})},function(){var e=Panopto.Core.StringHelpers.format("<a href='#'>{0}</a>",Panopto.GlobalResources.ViewerPlus_Edit_ForceReprocess);Ie(e);var o=$("#messageText a");Panopto.Core.UI.Handlers.button(o,function(){v.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionManage",modalHeader:Panopto.Core.TextHelpers.innerText(R.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:R.id})})})},function(){window.location.href=Panopto.Core.StringHelpers.format(O.SilverlightEditorUrlTemplate,R.id)},function(){Ie(Panopto.GlobalResources.ViewerPlus_Edit_UnsupportedBrowser)},function(){Ie(Panopto.GlobalResources.ViewerPlus_Edit_SessionNotReady)},function(){Ie(Panopto.GlobalResources.ViewerPlus_Edit_PendingEditedTranscriptionRequest)}),me=function(e){var o=S&&S.visible()||be();ve===e&&we===o||(e&&o||($(".plugin-screen").css({"max-height":e?"":0,border:e?"":0,overflow:e?"":"hidden"}),v.resize&&v.resize()),ve=e,we=o)},be=function(){return Panopto.Core.StringHelpers.parseQueryString(window.location.hash).modalPage},Ce=function(e,o){ee=o="number"==typeof o?o:Math.max(Z,v.position());var t,n,a,i,r,s,l,c,u,d,P,p=Date.now(),g=b.streamLength(),y=L?L.timelinePosition(o):o;y!==o?(y===L.timelineEndPosition()&&(v.setPlayState(f.Paused,void 0,void 0),y-=Panopto.Viewer.Constants.EditorTimelineEndOffsetSeconds),v.setPosition(y)):(0<g&&B!==g&&(B=g,_.each(Q,function(e){_.each(e.getTabs(),function(e){e.adjustTimeline(B)})})),o=Panopto.Core.Math.clamp(o,0,B),t=Math.round(o),n=Math.max(0,Math.round(B-o)),E.synchronize(o,oe,e,!!L)&&(M.state.playerState.position!=o&&M.setState({playerState:{position:o}}),T&&T.position(o),(e||!A||p-A>O.ControlSyncRate)&&(A=p,a=Panopto.Core.TimeHelpers.formatDuration(t,Panopto.GlobalResources.TimeSeparator),i=(n?"-":"")+Panopto.Core.TimeHelpers.formatDuration(n,Panopto.GlobalResources.TimeSeparator),r=Panopto.Core.TimeHelpers.formatDuration(Math.round(B),Panopto.GlobalResources.TimeSeparator),h.synchronize(o,B,a,i,r)),L&&L.synchronize(o,Y===f.Playing),q.syncTimes(a,r),R.multiBitrateEnabled&&h.synchronizeBitrate(),m&&m.updateProgress(o),b.isEndedBy(o)&&(d=R.isBroadcast&&!ne,P=function(){Panopto.viewer.data.playlist?S.queueNextItem():!R.nextDelivery&&!d||L?L||v.setPosition(0):(d?(ae=!0,G.text(I)):(v.setPosition(0),R.nextDelivery.folderName=R.folder.name,Panopto.Core.UI.Components.nextDelivery(G,R.nextDelivery,Panopto.GlobalResources.NextDelivery_NextVideo,Panopto.GlobalResources.NextDelivery_PlayAgain,function(){v.setPlayState(f.Playing,void 0,void 0)},Panopto.GlobalResources.NextDelivery_RecordingNow)),x.show(),me(!1))},v.setPlayState(f.Paused,!0,!0),R.requiresSilverlight?setTimeout(P,100):P()),h.synchronizeCaption(),s=o,u=v.fullscreenPlayer(),R.captions&&h.captionsSelected()&&(l=R.captions[_.findLastIndex(R.captions,function(e){return e.time<s})]),c=l?l.text:"",u?u.getCaptionControl()&&u.getCaptionControl().setCaptionText(c):h.captionsDocked()?(C&&C.setCaptionText(""),V&&V.setCaptionText("")):v.viewMode()===w.Secondary?(C&&C.setCaptionText(""),V&&V.setCaptionText(c)):C&&C.setCaptionText(c),v.resizeCaption(c,h.captionsDocked())));oe=ee},Ve=function(){var e=v.userSeekEnabled()?J.start:"",o=parseInt(e,10);isNaN(o)&&void 0===Panopto.viewer.data.playlist&&void 0===L&&(o=Panopto.Core.PlayResumption.calculateStartTime(R.lastViewingPosition,R.duration)),L||D.show(),function(e){if(!b){var o=$("#primaryScreen"),t=de.getPlayerFactory(R),n=new PanoptoTS.Viewer.Players.AudioOnlyOverlay;n.getElement().insertAfter(o),n.onClick.add(function(){v.togglePlaying(l.Labels.Normal)}),n.onShowOverlay.add(function(){L.streamTab().showUploadOverlay({secondaryOnly:!1})}),b=L?PanoptoLegacy.Viewer.Players.PrimarySegmentPlayer(se.getPrimaryPlayer(),o,t,v,L,n):PanoptoLegacy.Viewer.Players.PrimaryPlayer(se.getPrimaryPlayer(),o,t,v,R,n),R.primaryStreams.length&&v.reloadPrimaryContent(!0,e),C=b.getCaptionControl(),b.getFullscreenStateControl()&&q.add(b.getFullscreenStateControl())}}(o),M.setState({eventTabLogic:Ee()}),(F=new PanoptoTS.Viewer.StandardPlayerLayout(se,b,Q)).onSecondaryLayoutChanged.add(function(e){var o;switch(e){case PanoptoTS.Viewer.SecondaryLayoutType.Single:o=1;break;case PanoptoTS.Viewer.SecondaryLayoutType.Double:o=2;break;case PanoptoTS.Viewer.SecondaryLayoutType.Quad:o=4}v.setSecondaryCount(o)});var t=new PanoptoTS.Viewer.Controls.PlayerLayoutControls(L);if(t.onShowOverlay.add(function(){L.streamTab().showUploadOverlay({secondaryOnly:!1})}),h=Panopto.Viewer.PlayControls(v,R,b,le,se,F,Q,t,!!L),function(){v.setSecondaryCount(1),T||L||(T=r.ThumbnailPlayer(R.thumbnails,v));var e=_.filter(R.documents,function(e){return e.isQuiz});new PanoptoTS.Viewer.QuizResultsController(e,N).onQuizCompleted(function(){return v.togglePlaying()})}(),PanoptoLegacy.Viewer.Layout(v,P,se,F,b,Q,R,c,!1,L),B=R.isBroadcast?0:R.duration,!Panopto.viewer.allowMultipleSecondaryDisplay)for(var n=0,a=Q;n<a.length;n++){a[n].getTabControl().attachTabHandlers()}Panopto.Viewer.BroadcastTimer(v,R,J,ge),J.isScorm&&(m=Panopto.Viewer.ScormControl(v,R.duration)),ye&&!b.isMuted()&&v.toggleMuted();var i=y&&!Panopto.viewer.data.playlist?f.Playing:f.Paused;v.setPlayState(i,void 0,void 0),!o||m||L?m||Ce(!0,null):v.setPosition(o),(Panopto.Core.Browser.isIE||Panopto.Core.Browser.isIE11)&&$(document).on("contextmenu",function(){v.setPlayState(f.Paused,void 0,void 0)}),v.toggleScreens(!be()),k&&!y&&(h.toggleAutoplayMessage(!0),S&&setTimeout(function(){S.hide()},S.autoHideDelay)),te=!0},Te=function(e){if(ie=!0,e&&e.ErrorCode)switch(e.ErrorCode){case K.SiteDisabled:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_SiteDisabled);break;case K.LoginRequired:l.sendEvent({action:l.Actions.Prereq,label:l.Labels.Login}),window.location.href=Panopto.viewer.unauthorizedViewerTransferUrl;break;case K.AccessRequired:l.sendEvent({action:l.Actions.Prereq,label:l.Labels.Access}),window.location.href=e.RedirectUrl;break;case K.InvalidUrl:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidUrl,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.InvalidDelivery:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidDelivery,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.NotInAvailabilityWindow:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_NotInAvailabilityWindow,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.InvalidFormatForSSL:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidFormatForSSL,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.UnknownError:default:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))}else Panopto.uriScheme!==window.location.protocol.replace(":","")&&Panopto.Core.Browser.isIE?v.toggleMessage(Panopto.GlobalResources.ViewerPlus_IESSLWarning,Panopto.GlobalResources.ViewerPlus_IESSLLink,Panopto.viewer.secureBrowserHelpUrl):v.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))},Ee=function(){return t?new PanoptoTS.Viewer.Logic.EditorEventTabLogic(R,v,L,Se,fe):X?new PanoptoTS.Viewer.Logic.LiveNotesEventTabLogic(R,v):new PanoptoTS.Viewer.Logic.ViewerEventTabLogic(R,v,j)},Le=function(e){ie=!1;var o,t=Panopto.Core.Browser.flashEnabled()&&!Panopto.viewer.htmlPlaybackOnly,n=e.flowPlayerEnabled||!R.isBroadcast&&Panopto.Core.Browser.supportsVideo(O.MP4MimeType);if(R=e,M.setState({delivery:R}),re=R.flowPlayerEnabled,J.isScorm&&(R.nextDelivery=null),J.notes)R.user.key?(c=Panopto.Viewer.Header(v,R),M.setState({eventTabLogic:Ee()}),F=new PanoptoTS.Viewer.StandardPlayerLayout(se,null,Q),PanoptoLegacy.Viewer.Layout(v,P,se,F,null,Q,R,c,!0,L),v.viewMode(w.LiveNotes),D.show(),Panopto.authCookieTimeoutMinutes&&setInterval(s.Delivery.refreshAuthCookie,60*Panopto.authCookieTimeoutMinutes*1e3/2)):window.location.href=Panopto.loginUrl+"?ReturnUrl="+encodeURIComponent(window.location.href);else if(R.isViewable)v.toggleMessage(void 0),c=Panopto.Viewer.Header(v,R,y,L,Panopto.viewer.data.playlist),S=c.playlistOverlay(),R.requiresSilverlight?!(o=Silverlight.isInstalled(O.SilverlightVersion))||"wmv"===R.activePrimary.fileType&&Panopto.Core.Browser.isSafari?(o?v.toggleMessage(Panopto.GlobalResources.ViewerPlus_Webkit_WMV_Warning):Panopto.Core.Browser.isSilverlightSupported?$("#silverlightMessage").show():v.toggleMessage(Panopto.GlobalResources.Silverlight_DisabledChromeViewer,Panopto.GlobalResources.Silverlight_DisabledLink,"http://support.panopto.com/ChromeSilverlight"),(n||t)&&R.podcastCompleted&&($("#embedControl").show(),$("#embedControl").html(R.embedUrl))):Ve():n||t?Ve():Panopto.viewer.htmlPlaybackOnly?v.toggleMessage(Panopto.GlobalResources.ViewerPlus_NoInternetExplorer):v.toggleMessage(Panopto.GlobalResources.ViewerPlus_InstallOrEnable,Panopto.GlobalResources.ViewerPlus_AdobeFlashPlayer,O.FlashPlayerUrl,"adobe-download");else{if(c=Panopto.Viewer.Header(v,R,y,L,Panopto.viewer.data.playlist),R.isBroadcast){if(!R.activePrimary&&!H){var a=Panopto.viewer.data.hasCustomThumbnail?Panopto.viewer.data.thumbnailUrl:null;(H=new PanoptoTS.Viewer.Controls.WaitingRoom($("#waitingRoomContainer"),R,a)).render()}}else Re();setTimeout(function(){s.Delivery.getDelivery(R.id,J.tid,R.invocationId,{refreshAuthCookie:!0,isKollectiveAgentInstalled:ge},function(e){var o=new W.Delivery(e);Le(o)},Te)},R.isBroadcast?R.broadcastRefreshInterval:O.DeliveryRefreshInterval)}},Re=function(){var e,o;R.folder.id?(e=Panopto.GlobalResources.ViewerPlus_SessionNotReady_WatchSomethingElse.format(R.folder.name),o=Panopto.Application.getBookmarkURL(O.SessionListUrl,{folderID:R.folder.id})):(e=Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,o=O.SessionListUrl),v.toggleMessage(Panopto.GlobalResources.ViewerPlus_SessionNotReady+"<br>"+Panopto.GlobalResources.ViewerPlus_SessionNotReadyRefresh,e,o)},Me=function(){U.hide(),Le(R)},Ie=function(e){U.hide(),c=Panopto.Viewer.Header(v,R),v.toggleMessage(e,Panopto.GlobalResources.ViewerPlus_Edit_MoreInformation,Panopto.viewer.editorSupportUrl)};return $(document).ready(function(){P=Panopto.Viewer.createViewerBridge($("#viewerBridge")),(M=P.viewer).onEventTabFocused=function(){return v.expandLeftPane()},M.onEventTabSelected=function(){return v.expandLeftPane()},new PanoptoTS.Viewer.Controls.EventPane(P);var a="true"===J.edit,i=J.id;!i&&Panopto.viewer.data.playlist&&(i=Panopto.viewer.data.playlist.initialDeliveryId);var e=-1!==navigator.userAgent.indexOf("Mac OS X 10_13");if(a&&e&&Panopto.Core.Browser.isSafari){var o={};try{o=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(e){window.console&&console.log("Error parsing HlsJsConfig setting, ignored.")}Panopto.viewer.hlsJsConfig=JSON.stringify(_.extend(o,{safari:!1}))}D=$("#viewerContent"),x=$("#inlineMessageLetterbox"),G=$("#inlineMessage"),(U=$("#loadingMessage")).show(),u=Panopto.Viewer.ClientLogger(),d=Panopto.Core.UI.Components.CopyrightNotice($("#copyrightNoticeContainer"),Panopto.viewer.copyrightNoticeText,Panopto.viewer.copyrightNoticeAutoDismissDuration);var t=Panopto.Core.StringHelpers.parseBoolean(J.advance);k=(Panopto.features.autoPlayEnabled&&"false"!==J.autoplay||t)&&!a;var n=(0===le||ye)&&!ce,r=new PanoptoTS.Viewer.AutoPlayDetector({muted:n,playsInline:!0,autoPlayRequested:k}).detect();z=function(){r.then(function(e){var o,t,n;y=e,o=J.id||i,t=J.tid,n=a,s.Delivery.getDelivery(o,t,"",{isLiveNotes:X,refreshAuthCookie:!0,isEditing:n,isKollectiveAgentInstalled:ge},function(e){R=new W.Delivery(e),n?R.user.role<=Panopto.Data.AclRoleType.Viewer?window.location.href=Panopto.viewer.unauthorizedEditorTransferUrl:he.routeDelivery(R):Me()},function(e){U.hide(),Te(e)})})},Panopto.viewer.data.playlist&&Panopto.viewer.data.playlist.errorCode?function(e){switch(e){case K.InvalidPlaylist:case K.InvalidPlaylistUrl:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidPlaylist,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.InvalidPlaylistNoSessions:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_PlaylistHasNoViewableSessions,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,O.SessionListUrl);break;case K.UnknownError:default:v.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))}}(Panopto.viewer.data.playlist.errorCode):Panopto.viewer.isKollectiveEnabled?pe.detectAgent(function(e){ge=e,z()}):z(),a&&($(document).on("dragstart",function(e){e.target.classList.contains("ui-draggable")||e.preventDefault()}),D.on("dragenter",function(){L.streamTab().showUploadOverlay({secondaryOnly:!1})}))}),v.isDeliveryError=function(){return ie},v.positionAutoplayMessage=function(){h&&h.positionAutoplayMessage()},v.isLive=function(){return b&&b.isLive()},v.position=function(e){if(void 0===e)return b?b.position():0;v.isDVRDisabled()||(R.isBroadcast&&b.setIsLive(e===1/0,null),b.setPosition(e,null),Ce(!0,Z=e),x.hide(),me(!0),ae=!1)},v.getPosition=function(){return new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(v.position()*Panopto.Core.Constants.TimelineChunkMultiplier)},v.setPosition=v.position,v.playState=function(e,o,t){if(void 0===e)return Y;v.isDVRDisabled()&&e!=f.Playing||(h.togglePlayState(e===f.Paused),!Panopto.viewer.showCopyrightNotice||L?a.resolve():"pending"!==a.state()||d.isShowingNotice()||e!==f.Playing||b.onReady.then(function(){F.getLeftPlayerElement().hide(),F.getRightPlayerElements().hide(),d.showNotice(function(){F.getLeftPlayerElement().show(),F.getRightPlayerElements().show(),y||(e=f.Paused,h.togglePlayState(e===f.Paused)),a.resolve()})}),a.then(function(){e!==Y&&(R.isBroadcast&&e===f.Paused&&!o&&b.setIsLive(!1,null),e===f.Playing&&(ae?v.setPosition(0):R.isBroadcast&&b.isLive()&&(b.setIsLive(!1,null),v.setPlayState(f.Playing,void 0,void 0),b.setIsLive(!0,function(){v.synchronize(!0)}))),b.setPlayStateWithLogging(e,!t),n&&R.isBroadcast||(e===f.Paused?clearInterval(n):n=setInterval(function(){Ce(!1,null)},O.TimedSyncRate)),e===f.Playing&&h.toggleAutoplayMessage(!1),Y=e,E.clearSyncTimeout(),_.each(Q,function(e){var o=e.getCurrentPlayer();o&&o.playState(Y)}),q.syncPlayState(Y),x.hide(),me(!0),L&&L.synchronize(v.position(),Y===f.Playing))}))},v.setPlayState=v.playState,v.reloadPrimaryContent=function(e,o){o&&b.setStartPosition(o),b.setPrimaryContent(R.primaryStreams,R.activePrimary,e,function(){v.synchronize(!0)}),o&&b.setStartPosition(void 0)},v.setPrimarySegments=function(e,o,t,n){L&&b&&o.length&&(i=_.filter(e,function(e){return!e.element.containsPrimary()}),b.setSegments(e,o,t,n))},v.activePrimary=function(){return b.activePrimary()},v.activeSecondary=function(){var e=0<Q.length&&Q[0].getTabControl().selectedTab();return e&&e.content()},v.selectSecondaryTab=function(e,o){0<Q.length&&Q[0].getTabControl().selectTabById(e,o)},v.toggleMessage=function(e,o,t,n){var a=$("#viewerMessage"),i=a.find("#messageLink");e?(p=v.position(),te&&!g&&(g=v.playState(),v.setPlayState(f.Paused,void 0,void 0)),v.setFullscreenPlayer(void 0),D.hide(),U.hide(),a.find("#messageText").html(e),o?i.text(o).attr("href",t).show():i.hide(),a.find("#messageIcon").removeClass().addClass(n).attr("href",t),a.show()):a.is(":visible")&&(a.hide(),te&&(D.show(),v.reloadPrimaryContent(!0,v.position()),Q.forEach(function(e){var o=e.getStreamPlayer();o&&o.setContent(o.content(),!0,null)}),v.setPlayState(g,void 0,void 0),b.playState(g),R.isBroadcast||v.setPosition(p),g=void 0))},v.toggleScreens=function(e){v.viewMode&&v.viewMode()!==w.LiveNotes&&!x.is(":visible")&&(e&&o?(me(!0),v.setPlayState(o,void 0,void 0),o=void 0):e||o||(o=Y,v.setPlayState(f.Paused,void 0,void 0),me(!1))),ue||(Panopto.ModalPopup.defaultInstance.hide(function(){v.toggleScreens(!0)}),ue=!0)},v.playlistOverlayToggled=function(e){re||me(!e)},v.fullscreenPlayer=function(){var e;if(b&&b.isFullscreen())e=b;else{var o=_.find(Q,function(e){return e.getStreamPlayer()&&e.getStreamPlayer().isFullscreen()});o&&(e=o.getStreamPlayer())}return e},v.setFullscreenPlayer=function(e){b&&b.setIsFullscreen(e===b);for(var o=0,t=Q;o<t.length;o++){var n=t[o].getStreamPlayer();n&&n.setIsFullscreen(e===n)}},v.isFullscreen=function(){return!!v.fullscreenPlayer()},v.ensureSecondaryIsMinimized=function(){Q.forEach(function(e){var o=e.getStreamPlayer();o&&o.minimizeIfHidden()})},v.setCaptionStyles=function(e){C&&C.setCaptionStyles(e),V&&V.setCaptionStyles(e)},v.synchronize=Ce,v.refreshPlayers=function(){_.each(Q,function(e){e.reinitializeTabs(R,v),e.getTabControl().attachTabHandlers()})},v.updateDelivery=function(e){R=e,D.is(":visible")&&v.reloadPrimaryContent(!1,v.position()),Q.forEach(function(e){e.updateTabs(R,v,b.streamLength())}),v.toggleMessage(void 0),H&&H.remove()},v.endBroadcast=function(){var e;ne&&(ne=!1,I=R.broadcastInterrupted?Panopto.GlobalResources.ViewerPlus_BroadcastInterrupted:Panopto.GlobalResources.ViewerPlus_BroadcastEnded_Notification,e=R.activePrimary.relativeEnd-O.BroadcastEndThreshold,b.updateMaxPosition(e),v.position()>e&&v.setPosition(e),M.setState({viewerState:_.extend({},M.state,{isEnded:!0})}))},v.restartBroadcast=function(){ne||(ae=!(ne=!0),b.updateMaxPosition(null),b.isLive()&&(x.hide(),b.setIsLive(!1,null),v.setPlayState(f.Playing,void 0,void 0),b.setIsLive(!0,function(){v.synchronize(!0)})),M.setState({viewerState:_.extend({},M.state.viewerState,{isEnded:!0})}))},v.isActiveBroadcast=function(){return R.isBroadcast&&ne},v.logDesync=function(e){l.sendDesyncEvent({diff:e,deliveryId:R.id,invocationId:R.invocationId})},v.writeLineToClientLog=function(e,o){u.writeLine(e,ee,o)},v.submitClientLog=function(e,o){u.submit(R.serverModel,e,o)},v.togglePlaying=function(e){if(!be())switch(l.sendEvent({action:Y===f.Playing?l.Actions.Pause:l.Actions.Play,label:e||l.Labels.Fullscreen}),Y){case f.Playing:v.setPlayState(f.Paused,void 0,void 0);break;default:v.setPlayState(f.Playing,void 0,void 0)}},v.rewind=function(e,o){v.userSeekEnabled()&&(l.sendEvent({action:l.Actions.Rewind,label:e||l.Labels.Fullscreen}),o=o||O.QuickRewindSeconds,o=function(o,e){var t=e;if(i)for(var n=_.findLastIndex(i,function(e){return e.end<=o}),a=i[n];a&&a.end>o-t;)t+=a.end-a.start,a=i[--n];return t}(v.position(),o),v.setPosition(Math.max(0,v.position()-o)))},v.skipToStart=function(e){v.userSeekEnabled()&&(l.sendEvent({action:l.Actions.SkipToStart,label:e||l.Labels.Fullscreen}),v.setPosition(0))},v.forward=function(e,o){v.userSeekEnabled()&&(l.sendEvent({action:l.Actions.Forward,label:e||l.Labels.Fullscreen}),o=o||O.QuickForwardSeconds,R.isBroadcast&&b.isLive()||(o=function(o,e){var t=e;if(i)for(var n=_.findLastIndex(i,function(e){return e.start>=o}),a=i[n];a&&a.start<o+t;)t+=a.end-a.start,a=i[++n];return t}(v.position(),o),v.setPosition(Math.min(B,v.position()+o))))},v.skipToEnd=function(e){v.userSeekEnabled()&&(l.sendEvent({action:l.Actions.SkipToEnd,label:e||l.Labels.Fullscreen}),v.setPosition(B))},v.volumeUp=function(e,o){e=e||l.Labels.Fullscreen,o=o||O.VolumeIncrement,h.updateVolume(b.volume()+o,!0,e)},v.volumeDown=function(e,o){e=e||l.Labels.Fullscreen,o=o||O.VolumeIncrement,h.updateVolume(b.volume()-o,!0,e)},v.toggleMuted=function(e){l.sendEvent({action:b.isMuted()?l.Actions.Unmute:l.Actions.Mute,label:e||l.Labels.Fullscreen}),h.toggleMuted()},v.hotkey=function(e){switch(e){case O.PlayKeyCode:v.togglePlaying(l.Labels.Hotkey);break;case O.RewindKeyCode:v.rewind(l.Labels.Hotkey,O.PositionIncrement);break;case O.ForwardKeyCode:v.forward(l.Labels.Hotkey,O.PositionIncrement);break;case O.VolumeUpKeyCode:h.showVolumeControl(),v.volumeUp(l.Labels.Hotkey);break;case O.VolumeDownKeyCode:h.showVolumeControl(),v.volumeDown(l.Labels.Hotkey);break;case O.MuteKeyCode:v.toggleMuted(l.Labels.Hotkey)}},v.getQuestionList=function(e){return L?L.getQuestionList(e):void 0},v.updateQuestionList=function(e){return L?L.updateQuestionList(e):void 0},v.getSinglePageAppConfig=function(){return{quizFillInTheBlankEnabled:Panopto.viewer.quizFillInTheBlankEnabled}},v.getSessionLength=function(){return L?L.activeState().duration()/Panopto.Core.Constants.TimelineChunkToMillisMultiplier:void 0},v.getEvent=function(e){return L?L.getEvent(e):void 0},v.validateEventTime=function(e){return L?L.validateEventTime(e):void 0},v.updateEvent=function(e){return L?L.updateEvent(e):void 0},v.isDVRDisabled=function(){return R.isBroadcast&&b.optimizationProvider()===Panopto.Viewer.Constants.Kollective&&!Panopto.viewer.kollectiveVideoJSWebcastDVREnabled&&!R.flowPlayerEnabled},v.userSeekEnabled=function(){return!Panopto.viewer.disableSeekAndVsp||!!L},v.setSecondaryCount=function(e){if(e!==Q.length){for(1<e&&Q.length<=1&&(E=new PanoptoTS.Viewer.Logic.MultipleSecondarySynchronizationLogic(v,h,b,Q));Q.length<e;){var o,t=$.parseHTML(Pe);se.getRightPlayerContainer().append(t),o=Panopto.viewer.allowMultipleSecondaryDisplay?new PanoptoTS.Viewer.Controls.OverlayTabControlElements($(t)):new PanoptoTS.Viewer.Viewer.TabElements($(t),$("#transportControls"),$("#selectedSecondary"),$("#secondaryExpander"));var n=new PanoptoTS.Viewer.Controls.SecondaryContentContainer(o,R,v,Q.length);Q.push(n);var a=n.getStreamPlayer();a&&(V=a.getCaptionControl(),a.getFullscreenStateControl()&&q.add(a.getFullscreenStateControl()))}1===e&&(E=new PanoptoTS.Viewer.Logic.TwoPlayerSynchronizationLogic(v,h,b,Q[0].getTabControl()));for(var i=F.getRightPlayerElements();Q.length>e;){$(i[Q.length-1]).remove(),(n=Q[Q.length-1]).remove(),Q.length=Q.length-1}v.resize&&(v.isSecondarySwapAllowed()||F.getPrimaryPlayerIndex()===F.PrimaryDefaultIndex||v.swapLeftToRight(F.PrimaryDefaultIndex),v.resize(),v.synchronize())}},v.hasPendingSecondaryUploads=function(){return!!L&&L.streamTab().hasPendingSecondaryUploads()},v.toggleSecondaryPlaceholder=function(e){L&&L.overlayController.toggleSecondaryPlaceholder(e)},v.reinitializeDelivery=function(){L.overlayController.closeOverlays(),z()},v.forceLeftPlayerHeight=!1,v.pageStructureElements=function(){return se},v.playerSelection=de,v};
var PanoptoTS;!function(o){var a,i,e,t;a=o.Controls||(o.Controls={}),i=a.QuotaPlaybackModalDialogs||(a.QuotaPlaybackModalDialogs={}),e=o.Models.VoidCallback,t=function(){function a(o,a,i,t){this.blocked=o,this.learnMoreUrl=a,this.signupUrl=i,this.resources=t,this._onDismiss=new e}return Object.defineProperty(a.prototype,"onDismiss",{get:function(){return this._onDismiss},enumerable:!0,configurable:!0}),a.prototype.render=function(){var o=this;this.dialogTitle=this.blocked?this.resources.QuotaDialog_Title_Anonymous_OverQuota:this.resources.QuotaDialog_Title_Anonymous,this.dialogInstructions=this.blocked?this.resources.QuotaDialog_Instructions_Anonymous_OverQuota:this.resources.QuotaDialog_Instructions_Anonymous,this.element=$(a.template(this)),this.blocked||Panopto.Core.UI.Handlers.button(this.element.find(".quota-dialog-dismiss"),function(){o._onDismiss.fire()})},a.prototype.getElement=function(){return this.element},a.template=_.template("\n            <div class='quota-anonymous-dialog quota-dialog'>\n                <div class='quota-dialog-header'><@- dialogTitle @></div>\n                <div class='quota-dialog-instructions'><@- dialogInstructions @></div>\n                <div class='quota-dialog-marketing-header'><@- resources.QuotaDialog_Marketing_Header @></div>\n                <div class='quota-dialog-marketing-features'>\n                    <div class='quota-dialog-marketing-feature'>\n                        <div class='quota-dialog-marketing-icon marketing-record'></div>\n                        <div class='quota-dialog-marketing-text'><@- resources.QuotaDialog_Marketing_Record @></div>\n                    </div>\n                    <div class='quota-dialog-marketing-feature'>\n                        <div class='quota-dialog-marketing-icon marketing-share'></div>\n                        <div class='quota-dialog-marketing-text'><@- resources.QuotaDialog_Marketing_Share @></div>\n                    </div>\n                    <div class='quota-dialog-marketing-feature'>\n                        <div class='quota-dialog-marketing-icon marketing-search'></div>\n                        <div class='quota-dialog-marketing-text'><@- resources.QuotaDialog_Marketing_Search @></div>\n                    </div>\n                </div>\n                <div class='quota-dialog-buttons'>\n                    <a href='<@- learnMoreUrl @>' target='<@- blocked ? \"_self\" : \"_blank\" @>' class='quota-dialog-button'>\n                        <@= resources.QuotaDialog_LearnMore @>\n                    </a>\n                    <a href='<@- signupUrl @>' target='<@- blocked ? \"_self\" : \"_blank\" @>' class='quota-dialog-button safety-background'>\n                        <@- resources.QuotaDialog_SignUp @>\n                    </a>\n                </div>\n                <@ if (!blocked) { @>\n                    <div class='quota-dialog-links'>\n                        <a class='quota-dialog-dismiss' href='#'><@- resources.QuotaDialog_NotNow @></a>\n                    </div>\n                <@ } @>\n            </div>\n        "),a}(),i.AnonymousUserDialog=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var t,a,e;t=o.Controls||(o.Controls={}),a=t.QuotaPlaybackModalDialogs||(t.QuotaPlaybackModalDialogs={}),e=function(){function o(o){this.resources=o}return o.prototype.render=function(){this.element=$(o.template(this))},o.prototype.getElement=function(){return this.element},o.template=_.template("\n            <div class='quota-owner-dialog quota-dialog'>\n                <div class='quota-dialog-header'><@- resources.QuotaDialog_Title_Owner @></div>\n                <div><@- resources.QuotaDialog_Instructions_Owner @></div>\n                <div class='quota-dialog-buttons'>\n                    <a href='https://www.panopto.com/features/' class='quota-dialog-button safety-background'>\n                        <@- resources.QuotaDialog_Upgrade @>\n                    </a>\n                </div>\n            </div>\n        "),o}(),a.OwnerDialog=e}(PanoptoTS||(PanoptoTS={}));

var PanoptoTS;!function(o){var t,e,a;t=o.Controls||(o.Controls={}),e=t.QuotaPlaybackModalDialogs||(t.QuotaPlaybackModalDialogs={}),a=function(){function o(o){this.resources=o}return o.prototype.render=function(){this.element=$(o.template(this))},o.prototype.getElement=function(){return this.element},o.template=_.template("\n            <div class='quota-viewer-dialog quota-dialog'>\n                <div class='quota-dialog-header'><@- resources.QuotaDialog_Title_Viewer @></div>\n                <div><@- resources.QuotaDialog_Instructions_Viewer @></div>\n            </div>\n        "),o}(),e.ViewerDialog=a}(PanoptoTS||(PanoptoTS={}));

var PanoptoTS;!function(r){var t,e,n;t=r.Logic||(r.Logic={}),e=t.StateMachine||(t.StateMachine={}),n=function(){function c(t,e){this.queues={},this.name=t,this.currentState=e}return c.prototype.getCurrentState=function(){return this.currentState},c.prototype.getCurrentTransition=function(){return this.currentTransition},c.prototype.handleTrigger=function(t,e,r){var n=this.createTriggerRecord(t,e,r);null!=this.currentTriggerRecord||this.getInternalQueue(c.mainQueue).data.length?this.queueTrigger(c.mainQueue,n):this.runTrigger(n)},c.prototype.getInternalQueue=function(t){var e=this.queues[t.name];return e||(e=new r.Logic.StateMachine.Machine.TriggerRecordQueue(name),this.queues[t.name]=e),e},c.prototype.shouldQueueTrigger=function(t,e){var r=!0;if(!e.completeCallback){var n,i=this.getInternalQueue(t);i.data.length?n=i.data[i.data.length-1]:t===c.mainQueue&&(n=this.currentTriggerRecord),n&&n.trigger===e.trigger&&n.data===e.data&&(r=!1)}return r},c.prototype.logQueue=function(t){var e=_.reduce(t.data,function(t,e,r){return t+"["+r+"] "+e.trigger.name+" "},"");window.console&&console.log(Panopto.Core.StringHelpers.format("[{0}] {1} {2}: {3}",this.name,"Queue",t.name,e))},c.prototype.getTransition=function(t,e){return _.find(t.transitions,function(t){return t.trigger===e.trigger})},c.prototype.getExpectedState=function(t,e){var r;if(t){var n=this.getTransition(t,e);n?(r=n.toState)?r.triggerOnEnter&&(r=this.getExpectedState(r,this.createTriggerRecord(r.triggerOnEnter,void 0,void 0))):r=t:_.contains(t.ignoreTriggers,e.trigger)&&(r=t)}return r},c.prototype.queueTrigger=function(t,e){if(this.shouldQueueTrigger(t,e)){var r=this.getInternalQueue(t);t===c.mainQueue&&(r.expectedEndState||(r.expectedEndState=this.getExpectedState(this.currentState,this.currentTriggerRecord)),e.expectedStartState=r.expectedEndState,r.expectedEndState=this.getExpectedState(r.expectedEndState,e)),r.data.push(e),this.logTriggerRecord(e,t===c.mainQueue?"Queued":"Delay queued"),this.logQueue(r)}},c.prototype.createTriggerRecord=function(t,e,r){return{trigger:t,data:e,completeCallback:r}},c.prototype.logTriggerRecord=function(t,e){var r=new Date,n=Panopto.Core.StringHelpers.format("[{0}] {1}:{2}.{3} {4} trigger {5} from state {6}{7}{8}",this.name,r.getMinutes(),r.getSeconds(),r.getMilliseconds(),e,t.trigger.name,this.currentState.name,void 0!==t.data?" with data "+t.data:"",t.expectedStartState?" expectedState "+t.expectedStartState.name:"");window.console&&console.log(n)},c.prototype.runTrigger=function(t){var e=this,r=this.getTransition(this.currentState,t);if(r)if(r.delayToQueue)this.queueTrigger(r.delayToQueue,t);else{this.currentTriggerRecord=t,this.currentTransition=r;var n=this.getInternalQueue(c.mainQueue);if(this.currentTriggerRecord.expectedStartState!==this.currentState&&n.data.length){this.currentTriggerRecord.expectedStartState=this.currentState;var i=!1,a=this.currentState;_.each(n.data,function(t){i||t.expectedStartState===a?i=!0:(t.expectedStartState=a,a=e.getExpectedState(a,t))}),i||(n.expectedEndState=a)}this.logTriggerRecord(t,"Running");var o=function(){e.detachEvent&&e.detachEvent(void 0),t.completeCallback&&t.completeCallback(),e.exitTransition(e.currentTransition,t.data)};if(this.currentTransition.exitEvent&&this.attachEvent(void 0,this.currentTransition.exitEvent,o),r.releaseQueue){n=this.getInternalQueue(c.mainQueue);var u=this.getInternalQueue(r.releaseQueue);n.data=u.data.concat(n.data),u.data.length=0,u.expectedEndState=void 0}r.action?r.action(t.data,o):o()}else _.contains(this.currentState.ignoreTriggers,t.trigger)||this.logTriggerRecord(t,"No transition for"),this.exitTransition(void 0,void 0)},c.prototype.enterState=function(t){var e=this;_.any(this.currentState.transitions,function(t){return!!t.triggerEvent})&&this.detachEvent(this.currentState),this.currentState=t,_.each(this.currentState.transitions,function(t){t.triggerEvent&&e.attachEvent(e.currentState,t.triggerEvent,function(){return e.handleTrigger(t.trigger,void 0,void 0)})})},c.prototype.exitTransition=function(t,e){if(t&&t!==this.currentTransition)window.console&&console.log("Transition ended which is not the current transition");else{var r;this.currentTriggerRecord=void 0,this.currentTransition=void 0,t&&t.toState&&(this.enterState(t.toState),t.toState.triggerOnEnter&&(r=this.createTriggerRecord(t.toState.triggerOnEnter,e,void 0)));var n=this.getInternalQueue(c.mainQueue);!r&&n.data.length&&(r=n.data[0],n.data=n.data.slice(1),n.expectedEndState=void 0),r&&this.runTrigger(r)}},c.mainQueue={name:"main"},c}(),e.Machine=n}(PanoptoTS||(PanoptoTS={})),function(t){var e,r,n;e=t.Logic||(t.Logic={}),r=e.StateMachine||(e.StateMachine={}),n=function(t){this.name=t,this.data=[]},(r.Machine||(r.Machine={})).TriggerRecordQueue=n}(PanoptoTS||(PanoptoTS={}));









var PanoptoTS,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var r in e)e.hasOwnProperty(r)&&(a[r]=e[r])};return function(a,e){function r(){this.constructor=a}t(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();!function(a){var e,r,t;e=a.Viewer||(a.Viewer={}),r=e.Controls||(e.Controls={}),t=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return __extends(e,a),e.prototype.renderElement=function(){var a={primaryImage:Panopto.cacheRoot+"/Images/upload_primary_stream_large.svg",secondaryImage:Panopto.cacheRoot+"/Images/upload_secondary_stream.svg",resx:this.resources};this.element=$(e.template(a)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".primary-stream .graphic-container")),this.overlayUploader.attachSecondaryOrSlidesTargetHandler(this.element.find(".secondary-stream .graphic-container"))},e.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell" colspan="2">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_PrimaryOrSecondaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td class="primary-stream side-by-side-cell">\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- primaryImage @>" class="standard-graphic-image primary-stream-graphic">\n                                    <div>\n                                        <span class="primary-stream-text"><@- resx.ViewerPlus_PrimaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                        <td class="secondary-stream side-by-side-cell">\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- secondaryImage @>" class="standard-graphic-image secondary-stream-graphic">\n                                    <div>\n                                        <span class="secondary-stream-text"><@- resx.ViewerPlus_SecondaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e}(r.AddStreamOverlay),r.AddPrimaryOrSecondaryOverlay=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(t){var e,n,r;e=t.Viewer||(t.Viewer={}),n=e.Controls||(e.Controls={}),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.renderElement=function(){var t={sessionImage:Panopto.cacheRoot+"/Images/upload_primary_stream_small.svg",resx:this.resources};this.element=$(e.template(t)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".graphic-container"))},e.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_PrimaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image primary-stream-graphic" />\n                                    <div>\n                                        <span class="primary-stream-text"><@- resx.ViewerPlus_PrimaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),e}(n.AddStreamOverlay),n.AddPrimaryOverlay=r}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])};return function(e,n){function t(){this.constructor=e}a(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}}();!function(e){var n,t,a;n=e.Viewer||(e.Viewer={}),t=n.Controls||(n.Controls={}),a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.renderElement=function(){var e={sessionImage:Panopto.cacheRoot+"/Images/upload_secondary_stream.svg",resx:this.resources};this.element=$(n.template(e)),this.overlayUploader.attachSecondaryOrSlidesTargetHandler(this.element.find(".graphic-container"))},n.template=_.template('\n            <div class="session-overlay">\n                <a\n                    href="#"\n                    class="close-button"\n                    role="button"\n                    aria-label="<@- resx.Viewer_ClosePopup @>">\n                    <i class="material-icons">&#xE5CD;</i>\n                </a>\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <div class="overlay-title">\n                                <@- resx.ViewerPlus_SecondaryOverlay_Title @>\n                            </div>\n                            <div class="processing-status" style="display:none;"></div>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image secondary-stream-graphic" />\n                                    <div>\n                                        <span class="secondary-stream-text"><@- resx.ViewerPlus_SecondaryOverlay_Subtitle @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),n}(t.AddStreamOverlay),t.AddSecondaryOverlay=a}(PanoptoTS||(PanoptoTS={}));

var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.BroadcastTimer=function(t,o,a,n){var i=Panopto.API,r=Panopto.Viewer.Constants,s=(Panopto.Viewer.Tabs,o.broadcastRefreshInterval),c=function(e){o=e,t.updateDelivery(o),o.activePrimary?o.broadcastEnded?(t.endBroadcast(),o.broadcastInterrupted||(s+=r.BroadcastEndedIncrement)):(t.restartBroadcast(),s=o.broadcastRefreshInterval):window.location.reload(),d(s)},d=function(e){setTimeout(function(){i.Delivery.getDelivery(o.id,a.tid,o.invocationId,{isActiveBroadcast:!0,isKollectiveAgentInstalled:n},function(e){c(new PanoptoTS.Viewer.Data.Delivery(e))},function(){d(e)})},e)};o.isBroadcast?c(o):o.isRecentBroadcast&&setInterval(function(){i.Delivery.getDelivery(o.id,a.tid,o.invocationId,{isKollectiveAgentInstalled:n},function(e){new PanoptoTS.Viewer.Data.Delivery(e).isBroadcast&&location.reload()},function(){})},r.ReopenedBroadcastInterval)};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ClientLogger=function(){var e=Panopto.Core.ViewerLogEntryType,o=Panopto.Core.ServiceInterface.Objects,n=[e.StreamSync],r=[];r[e.UserInitiatedSync]="User-initiated sync of primary {0}",r[e.StreamDesync]="Desync of {0} detected, pausing to correct",r[e.StreamChange]="{0} player started playing stream {1}",r[e.PlayStateChange]="{0} player changed play state to {1}",r[e.PositionSet]="{0} player set position to {1}",r[e.PlaybackSpeedChange]="{0} player changed playback speed to {1}",r[e.QualityChange]="{0} player started playing segment at quality level {1} of {2} ({3})",r[e.FullscreenChange]="{0} player changed fullscreen to {1}",r[e.StreamSync]="Desync of {0} detected, which is within the tolerance";var i=o.ViewerClientLog({}),p=!1;return{writeLine:function(e,t,a){(p||-1===n.indexOf(e))&&(i.entries.push(o.ViewerClientLogEntry({type:e,position:t,detail:PanoptoTS.StringHelpers.format(r[e],a),timestamp:PanoptoTS.DateHelpers.toWCFString(new Date)})),Panopto.Core.Logger.log(PanoptoTS.StringHelpers.format("{0} {1} {2}",e,t,PanoptoTS.StringHelpers.format(r[e],a)),Panopto.Core.LogMode.Playback))},submit:function(e,t,a){i.deliveryParams=e,Panopto.Core.ServiceInterface.WCFRest.DataCS.submitViewerClientLog(i,t,a)},toggleVerbose:function(e){p=e}}};
var PanoptoTS;!function(d){var e,t,n;e=d.Viewer||(d.Viewer={}),t=e.Controls||(e.Controls={}),n=function(){function s(e,t,n,o){var a=this;this._editCallbacks=new d.Models.TypedCallback,this._deleteCallbacks=new d.Models.TypedCallback;var i=$(s.template());i.appendTo(e),t.click(function(e){e.stopPropagation()}),o&&o.toggleAppearsOnHover&&Panopto.Core.UI.Handlers.hoverableParent(e,t);var l="edit-menu-open";Panopto.Core.UI.Components.popup(i,t,function(){i.show(),i.css({left:t.offset().left+t.outerWidth()-i.outerWidth(),top:t.offset().top+t.outerHeight()}),e.addClass(l)},function(){i.hide(),e.removeClass(l)}),this.editButton=$(s.editButtonTemplate({resources:n})),this.editButton.appendTo(i),Panopto.Core.UI.Handlers.button(this.editButton,function(){a._editCallbacks.fire(a.event)}),this.deleteButton=$(s.deleteButtonTemplate({resources:n})),this.deleteButton.appendTo(i),Panopto.Core.UI.Handlers.button(this.deleteButton,function(){a._deleteCallbacks.fire(a.event)})}return Object.defineProperty(s.prototype,"editCallbacks",{get:function(){return this._editCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"deleteCallbacks",{get:function(){return this._deleteCallbacks},enumerable:!0,configurable:!0}),s.prototype.setEvent=function(e,t){this.event=e,this.editButton.toggle(!!t.canEdit),this.deleteButton.toggle(!!t.canDelete)},s.template=_.template("\n            <div class='edit-event-menu' style='display:none;'></div>\n        "),s.editButtonTemplate=_.template("\n            <div class='edit-event-menu-button menu-edit-button' tabindex='0' style='display:none;'>\n                <i class='material-icons'>&#xE150;</i>\n                <span><@= resources.ViewerPlus_EventEdit @></span>\n            </div>\n        "),s.deleteButtonTemplate=_.template("\n            <div class='edit-event-menu-button menu-delete-button' tabindex='0' style='display:none;'>\n                <i class='material-icons'>&#xE872;</i>\n                <span><@= resources.ViewerPlus_EventDelete @></span>\n            </div>\n        "),s}(),t.EditEventMenu=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n,r;t=e.Viewer||(e.Viewer={}),n=t.Controls||(t.Controls={}),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.renderElement=function(){var e={sessionImage:Panopto.cacheRoot+"/Images/video_player.svg",resources:this.resources};this.element=$(t.template(e)),this.overlayUploader.attachPrimaryTargetHandler(this.element.find(".graphic-container"))},t.prototype.show=function(){e.prototype.show.call(this,!1)},t.template=_.template('\n            <div class="session-overlay empty-session-overlay">\n                <table class="overlay-table">\n                    <tr>\n                        <td class="title-cell">\n                            <p class="overlay-title">\n                                <@- resources.ViewerPlus_EmptySessionOverlay_Title @>\n                            </p>\n                            <p>\n                                <@- resources.ViewerPlus_EmptySessionOverlay_Subtitle @>\n                            </p>\n                        </td>\n                    </tr>\n                    <tr class="expanded-row">\n                        <td>\n                            <div class="graphic-container" tabindex="0">\n                                <div class="graphic standard-graphic">\n                                    <img src="<@- sessionImage @>" class="standard-graphic-image primary-stream-graphic" />\n                                    <div>\n                                        <span class="primary-stream-text"><@- resources.ViewerPlus_EmptySessionOverlay_Target @></span>\n                                    </div>\n                                </div>\n                                <i class="material-icons graphic drop-target-graphic">&#xE2C6;</i>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>'),t}(n.AddStreamOverlay),n.EmptySessionOverlay=r}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,n,i;t=e.Viewer||(e.Viewer={}),n=t.Controls||(t.Controls={}),i=function(){function e(e){this.eventTabPanes=$("#eventTabPanes"),this.onResize=this.onResize.bind(this),this.eventPaneBridge=e.eventPane,this.eventPaneBridge.onResize=this.onResize}return e.prototype.onResize=function(t){t&&0<t.width&&0<t.height&&(this.eventTabPanes.width(t.width),_.each(this.eventPaneBridge.state.tabSet.tabs,function(e){e.resize(t.width,t.height)}))},e}(),n.EventPane=i}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var s,n,i;s=e.Viewer||(e.Viewer={}),n=s.Controls||(s.Controls={}),i=function(){function n(e,s){this.resources=s,e.html(n.template()),this.element=e.find(".file-processing-region")}return n.prototype.render=function(e){var s=this.element.find(".file-processing-text"),n=this.element.find(".file-processing-percentage"),i=this.element.find(".upload-spinner"),t="error";if(_.some(e,function(e){return 1!==e.state&&2!==e.state}))s.addClass(t).text(this.resources.FileProcessingRegion_Error),n.hide(),i.hide();else if(1===e.length){var o=e[0];switch(s.removeClass(t),o.state){case 1:s.text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_Uploading,o.filename)),n.show().text(Math.round(o.bytesUploaded/o.fileSize*100)+"%"),i.hide();break;case 2:default:s.text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_Processing,o.filename)),n.hide(),i.show()}}else s.removeClass(t).text(Panopto.Core.StringHelpers.format(this.resources.FileProcessingRegion_ProcessingMultiple,e.length)),n.hide(),i.show()},n.template=_.template('\n            <div class="file-processing-region">\n                <span class="file-processing-text"></span>\n                <span class="file-processing-percentage"></span>\n                <span class="upload-spinner"></span>\n            </div>'),n}(),n.FileProcessingRegion=i}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Header=function(n,o,e,a,r){var i,l,s,d,p,t,u=Panopto.Viewer.Constants,c=Panopto.Data.AclRoleType,f=Panopto.API,P=$("#viewerHeader"),g=P.find("#logoContainer"),m=P.find("#deliveryTitle"),v=P.find("#editDeliveryTitle"),C=v.find("input"),w=P.find("#parentContext"),h=P.find("#starRating"),S=P.find("#podcastDownload"),b=P.find("#settingsButton"),y=P.find("#shareButton"),T=P.find("#editButton"),I=P.find("#viewerHelpLink"),H=P.find("#signUpButton"),B=P.find("#signInButton"),U=P.find(".login-status"),x=P.find("#saveMessage"),R=P.find("#undoButton"),V=P.find("#redoButton"),L=P.find("#commitButton"),M=P.find("#revertButton"),D=P.find("#closeButton"),k=!Panopto.Core.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe,E=PanoptoTS.StringHelpers.format("{0}/Pages/Sessions/List.aspx",u.BaseUrl);!function(){var e;if(r)e={icon:"&#xE05F;",name:r.name};else if(o.folder.name)e={icon:"&#xE2C7;",name:o.folder.name};else{var t=$("<div />");d=s=l=t}e&&(w.html(_.template($("#parentContextTemplate").html(),e)),i=w.find("#parentClickTarget"),l=w.find(".parent-icon"),s=w.find("#parentName"),d=w.find(".chevron"),r?(i.attr("aria-label",Panopto.GlobalResources.Viewer_PlaylistButton),l.addClass("playlist-icon"),s.addClass("ellipsis")):o.folder.name&&o.folder.id&&k?(i.attr("role","link"),i.attr("aria-label",Panopto.GlobalResources.Folder),Panopto.Core.UI.Handlers.button(i,function(){return window.open(PanoptoTS.StringHelpers.format("{0}?folderID={1}",E,o.folder.id))})):i.removeAttr("tabindex").addClass(Panopto.Core.Constants.DisabledClass))}();var O=[g,l,s,d,m,v,h,S,x,R,V,L,M,b,y,T,D,I,B],A=a?[{elements:[g,l,s,d,v,x,R,V,L,M,b,D,I]},{elements:[g,l,d,v,x,R,V,L,M,b,D,I]},{elements:[g,l,d,v,x,R,V,L,M,D,I]},{elements:[g,l,d,v,x,R,V,L,M,I]},{elements:[g,l,d,v,x,R,V,L,M]},{elements:[g,l,x,R,V,L,M]},{elements:[g,l,R,V,L,M]},{elements:[g,l]}]:[{elements:[g,l,s,d,m,h,S,b,y,T,I,B]},{elements:[g,l,d,m,h,S,b,y,T,I,B]},{elements:[g,l,d,m,S,b,y,T,I,B]},{elements:[g,l,d,m,I,B]},{elements:[g,l,d,m,I]},{elements:[g,l,I]},{elements:[g,l]}],G=!1,Q=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),W=u.LeftPaneMinWidth,z=function(){var e=1400<$(window).width();e&&o.title.length<=u.MaxDesktopTitleCharacters||!e&&o.title.length<=u.MaxMobileTitleCharacters?m.text(o.title):(q=e?Math.floor((u.MaxDesktopTitleCharacters-Panopto.GlobalResources.ViewerPlus_TitleEllipsis.length)/2):Math.floor((u.MaxMobileTitleCharacters-Panopto.GlobalResources.ViewerPlus_TitleEllipsis.length)/2),X=o.title.slice(0,q)+Panopto.GlobalResources.ViewerPlus_TitleEllipsis+o.title.slice(-q),m.text(X),m.attr("title",o.title))},F=function(){if(!G){N(O).show(),r&&s.css("max-width",W-s[0].offsetLeft),z(),C.width(Math.min(parseInt(C.css("max-width"),10),Panopto.Core.ElementHelpers.measureText(C,C.val()))),_.each(A,function(e){e.width=_.reduce(e.elements,function(e,t){return e+t.outerWidth(!0)},0)});var t=$(window).width(),e=_.find(A,function(e){return e.width<t-u.HeaderBuffer});N(O).hide(),e&&N(e.elements).show()}},N=function(e){return _.reduce(e,function(e,t){return e.add(t)},$())};Panopto.Core.TimeHelpers.utcDateToFormattedString(o.date,"LL");var j,X,q,J=P.find("#viewerSupportDropdown"),K=J.find(".send-client-log"),Y=function(e){e.width(0),e.css({visibility:"hidden"})};if(Panopto.Branding.createLogo(g,Panopto.branding.smallLogo,k),$(document).attr("title",o.title),a?(C.attr(Panopto.Core.Constants.InitAttribute,o.title),p=Panopto.Core.UI.Components.editableLabel(C,function(e){var t=a.session();t.name=e,Panopto.Core.ServiceInterface.Rest.Sessions.update(t,function(){p.save(),$(document).attr("title",C.val()),F()},function(){p.revert(),t.name=C.val()})})):z(),o.downloadUrl?S.attr("href",o.downloadUrl):Y(S),o.user.role>c.Viewer&&k?(a&&((Panopto.ModalPopup.defaultInstance.opener=a).updateData=function(){window.location.reload()}),Panopto.Core.UI.Handlers.button($("#settingsButton"),function(){n.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(o.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:o.id})})}),Panopto.Core.UI.Handlers.button($("#shareButton"),function(){n.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionShare",modalHeader:Panopto.Core.TextHelpers.innerText(o.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:o.id})})}),o.isBroadcast||a?Y(T):Panopto.Core.UI.Handlers.button(T,function(){var e=Panopto.Core.StringHelpers.setQueryParameters(location.href,{id:o.id,edit:!0});location.href=e})):(Y(b),Y(y),Y(T)),r){var Z=!Panopto.Core.StringHelpers.parseBoolean(Q.advance);function ee(e){i.toggleClass("active",e),n.playlistOverlayToggled(e)}t=new PanoptoTS.Core.UI.Components.PlaylistOverlay($("#playlistOverlay"),i,r.id,Q.id,PanoptoTS.Core.UI.Components.PlaylistOverlaySkin.Interactive,{includeViewableOnly:!0},Z,e&&!n.isDeliveryError(),new PanoptoTS.Core.API.Rest.PlaylistWithSessionsService),ee(Z),t.onToggle(ee),t.onPlayItem(function(e){if(e===o.id)n.activePrimary()&&n.setPlayState(Panopto.Viewer.PlayState.Playing,void 0,void 0);else{var t=Panopto.Core.StringHelpers.setQueryParameters(location.href,{id:e,advance:!0});location.replace(t)}})}if(o.user.key&&Panopto.features.areRatingsEnabled&&!a&&(j=Panopto.Core.UI.Components.starRating(h,Panopto.GlobalResources.StarRating_OneStar,Panopto.GlobalResources.StarRating_MultipleStars,function(e){var t=j.value();j.value(e),f.Delivery.rateDelivery(o.id,e,$.noop,function(){j.value(t)})}),Panopto.Branding.brandImageBackgrounds(".star",".star-accent-background .star","#"+Panopto.branding.accentColor),j.value(o.user.rating||0)),k){var te=new PanoptoTS.Core.UI.Components.PopupMenuBehavior({menu:J,menuButton:I,itemSelector:"a, input"});te.onOpened.add(function(){n.toggleScreens(!1),J.css({right:$(window).width()-I.offset().left-I.outerWidth(),top:I.offset().top+I.outerHeight()})}),te.onClosed.add(function(){return n.toggleScreens(!0)}),K.show(),Panopto.Core.UI.Handlers.button(K,function(){n.submitClientLog(function(){alert(Panopto.GlobalResources.ViewerPlus_LogsSent)},function(){alert(Panopto.GlobalResources.ViewerPlus_LogsError)})})}else Y(I),Y(B);if(!o.user.key&&Panopto.features.minimizeInteractiveViewerHeaderUX&&(Y(I),Y(U)),Panopto.freeTrialSignUpUrl&&!o.user.key){var ne=Panopto.freeTrialSignUpUrl;Q.tid&&(ne+=Panopto.Core.Constants.SignUpUrlParams.format(Q.tid,o.user.email)),H.attr("href",ne)}else H.hide();return P.show(),F(),g.find("image").length||g.find("img").on("load error",F),{height:function(){return P.outerHeight()},setLeftPaneWidth:function(e){W=e,F()},playlistOverlay:function(){return t},toggleLiveNotes:function(e){G=e,P.toggleClass(u.LiveNotesClass,G),h.toggle(!G)}}};


var PanoptoTS;!function(t){var n,o,e;n=t.Viewer||(t.Viewer={}),o=n.Controls||(n.Controls={}),e=function(){function t(){this.items=new Array}return t.prototype.add=function(e){this.items.some(function(t,n,o){return t===e})||this.items.push(e)},t.prototype.syncTimes=function(e,r){this.items.forEach(function(t,n,o){return t.syncTimes(e,r)})},t.prototype.syncPlayState=function(e){this.items.forEach(function(t,n,o){return t.syncPlayState(e)})},t}(),o.ManualFullScreenStateControlGroup=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var o,t,n;o=e.Viewer||(e.Viewer={}),t=o.Controls||(o.Controls={}),n=function(){function e(){}return e.getStreamIconCode=function(e){var o;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:o=Panopto.Core.Constants.AudioIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:o=Panopto.Core.Constants.ScreenIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:o=Panopto.Core.Constants.ObjectVideoIconCode}return o},e}(),t.MaterialDesignIconHelpers=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t;(function(e){var t=function(){function e(){this.sortedChildren=[],this.element=$(e.template())}return e.prototype.contains=function(t){return _.some(this.sortedChildren,function(e){return e.childElement===t})},e.prototype.insert=function(e,t){this.contains(e)&&this.remove(e,!0);var n=new r(e,t),i=_.find(this.sortedChildren,function(e){return e.sortValue>n.sortValue});i?(this.sortedChildren.splice(this.sortedChildren.indexOf(i),0,n),i.childElement.before(n.childElement)):(this.sortedChildren.push(n),this.element.append(n.childElement))},e.prototype.remove=function(t,e){void 0===e&&(e=!1);var n=_.find(this.sortedChildren,function(e){return e.childElement===t});n&&(this.sortedChildren.splice(this.sortedChildren.indexOf(n),1),e?n.childElement.detach():n.childElement.remove())},e.prototype.rowCount=function(){return this.sortedChildren.length},e.template=_.template("<div></div>"),e}();e.OrderedContainer=t;var r=function(e,t){this.childElement=e,this.sortValue=t}})((t=e.Viewer||(e.Viewer={})).Controls||(t.Controls={}))}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(n){var e,r,t,o;e=n.Viewer||(n.Viewer={}),r=e.Controls||(e.Controls={}),t=n.Models.VoidCallback,o=function(){function a(e,r,o){var s=this;this.pageStructureElements=e,this.overlayUploader=r,this.resources=o,this.ready=$.Deferred(),this._onShowOverlays=new t,this._onCloseOverlays=new t,this.overlayShowingClickHandler=function(e){$(e.target).closest(a.sessionOverlaySelector).length||s.overlayShown&&s.closeOverlays()},document.addEventListener("click",this.overlayShowingClickHandler,!0)}return Object.defineProperty(a.prototype,"onShowOverlays",{get:function(){return this._onShowOverlays},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onCloseOverlays",{get:function(){return this._onCloseOverlays},enumerable:!0,configurable:!0}),a.prototype.setOverlaysStreamUploader=function(e){this.overlayUploader.setStreamUploader(e),this.overlayUploader.areUploadersSet()&&this.setupUploadOverlays(this.pageStructureElements)},a.prototype.setOverlaysSlideUploader=function(e){this.overlayUploader.setSlideUploader(e),this.overlayUploader.areUploadersSet()&&this.setupUploadOverlays(this.pageStructureElements)},a.prototype.setEditSlidesTabAddButton=function(e){this.editSlidesTabAddButton=e},a.prototype.setupUploadOverlays=function(e){var r=this,o=$("#primaryPlayer .letterbox"),s=e.getRightPlayerContainer();s.css("position","relative");var t=function(){r.closeOverlays()};$("#viewerContent").find(a.sessionOverlaySelector).remove(),o.find(a.sessionOverlaySelector).remove(),s.find(a.sessionOverlaySelector).remove(),this.emptySessionOverlay=new n.Viewer.Controls.EmptySessionOverlay($("#viewerContent"),this.overlayUploader,t,this.resources),this.primaryOrSecondaryOverlay=new n.Viewer.Controls.AddPrimaryOrSecondaryOverlay(o,this.overlayUploader,t,this.resources),this.primaryOverlay=new n.Viewer.Controls.AddPrimaryOverlay(o,this.overlayUploader,t,this.resources),this.secondaryPlaceholder=new n.Viewer.Controls.SecondaryPlaceholder(s,this.overlayUploader,t,this.resources),this.secondaryOverlay=new n.Viewer.Controls.AddSecondaryOverlay(s,this.overlayUploader,t,this.resources),this.overlayUploader.attachSlidesTargetHandler(this.editSlidesTabAddButton),this.ready.resolve()},a.prototype.filterPendingUploadsByType=function(e,r){return _.filter(e,function(e){return e.streamType===r})},a.prototype.showOverlays=function(e,r,o,s,t){var a=(void 0===t?{}:t).secondaryOnly,i=void 0!==a&&a,l=0<this.filterPendingUploadsByType(o,1).length,y=0<this.filterPendingUploadsByType(o,2).length;e||l?(this.emptySessionOverlay.hide(),s===n.Viewer.ViewMode.Primary?(this.primaryOverlayCloseable=e,this.primaryOrSecondaryOverlay.show(this.primaryOverlayCloseable),this.primaryOverlay.hide(),this.secondaryOverlay.hide(),this.secondaryPlaceholder.hide()):s===n.Viewer.ViewMode.Secondary&&(this.primaryOverlayCloseable=e,this.primaryOverlayCloseable&&i||this.primaryOverlay.show(this.primaryOverlayCloseable),this.secondaryOverlayCloseable=r||!y,this.secondaryOverlay.show(this.secondaryOverlayCloseable),this.primaryOrSecondaryOverlay.hide())):(this.primaryOverlayCloseable=!1,this.emptySessionOverlay.show()),this.updateOverlayProcessing(o),this.overlayShown=!0,this._onShowOverlays.fire()},a.prototype.closeOverlays=function(){this.primaryOverlayCloseable&&(this.emptySessionOverlay.hide(),this.primaryOrSecondaryOverlay.hide(),this.primaryOverlay.hide()),this.secondaryOverlayCloseable&&this.secondaryOverlay.hide(),this.overlayShown=!1,this._onCloseOverlays.fire()},a.prototype.forceCloseOverlays=function(){this.emptySessionOverlay.hide(),this.primaryOrSecondaryOverlay.hide(),this.primaryOverlay.hide(),this.secondaryOverlay.hide(),this.overlayShown=!1,this._onCloseOverlays.fire()},a.prototype.toggleSecondaryPlaceholder=function(e){this.secondaryPlaceholder&&(e?this.secondaryPlaceholder.show():this.secondaryPlaceholder.hide())},a.prototype.updateOverlayProcessing=function(e){this.primaryOrSecondaryOverlay.toggleProcessingStatus(e),this.primaryOverlay.toggleProcessingStatus(this.filterPendingUploadsByType(e,1)),this.secondaryOverlay.toggleProcessingStatus(this.filterPendingUploadsByType(e,2)),this.secondaryPlaceholder.toggleProcessingStatus(this.filterPendingUploadsByType(e,2))},a.sessionOverlaySelector=".session-overlay",a}(),r.OverlayController=o}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(t){var e,n,o;e=t.Viewer||(t.Viewer={}),n=e.Controls||(e.Controls={}),o=function(){function t(t){this.contentContainer=t,this.tabs=[]}return t.prototype.getTabs=function(){return this.attachedTabs?$(this.attachedTabs):$(this.tabs)},t.prototype.getSelected=function(){return this.selectedContainer},t.prototype.getExpander=function(){return this.expanderContainer},t.prototype.getContentContainer=function(){return this.contentContainer},t.prototype.getContent=function(){return this.contentContainer.children().first()},t.prototype.addTab=function(t,e){this.tabs.push(e)},t.prototype.setContentClass=function(t){this.getContent().attr("class",Panopto.Viewer.Constants.SecondaryContentClass+" "+t)},t.prototype.setSelectedText=function(t){this.selectedText=t,this.selectedContainer&&this.updateSelectedText()},t.prototype.setSelectedIcon=function(t,e){this.selectedIconCode=t,this.selectedIconClass=e,this.selectedContainer&&this.updateSelectedIcon()},t.prototype.attachTabs=function(t,e){this.selectedContainer=t,this.expanderContainer=e,this.updateSelectedText(),this.updateSelectedIcon(),this.attachedTabs=this.tabs,this.expanderContainer.empty(),this.expanderContainer.append(this.attachedTabs)},t.prototype.detachTabs=function(){this.selectedContainer=void 0,this.expanderContainer=void 0,$(this.attachedTabs).remove(),this.attachedTabs=void 0},t.prototype.updateSelectedText=function(){this.selectedContainer.find("#selectedSecondaryText").text(this.selectedText)},t.prototype.updateSelectedIcon=function(){this.selectedIconCode?this.selectedContainer.find("#selectedSecondaryIcon").html(this.selectedIconCode).attr("class","material-icons"):this.selectedContainer.find("#selectedSecondaryIcon").html("").attr("class",this.selectedIconClass)},t}(),n.OverlayTabControlElements=o}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(t){var e,r,o,a;e=t.Viewer||(t.Viewer={}),r=e.Controls||(e.Controls={}),o=t.Core.Logic.Time.UneditedFirstPrimaryRelative,a=function(){function t(t,e){this.viewer=t,this.timeConverter=e,this.pptExtensions=[".ppt",".pptx"],this.fileProcessingRegionAnimation=$.Deferred().resolve()}return t.prototype.getStreamStartTime=function(){var t;if(this.timelineState.absoluteStart()===1/0||0===this.timelineState.duration())t=this.absoluteSessionStart;else{var e=this.timelineState.findNextTimeNotInSessionReference(this.viewer.position()),r=this.timeConverter.toWin32EpochRelative(new o(e));t=new Date(r.milliseconds()+Panopto.Core.Constants.Win32EpochDate)}return t},t.prototype.parseEventForFirstFile=function(t){var e=t.originalEvent.target.files||t.originalEvent.dataTransfer.files;if(e.length&&e[0].size)return e[0]},t.prototype.parseEventForPrimaryStream=function(t){var e=this.parseEventForFirstFile(t);if(e)return{streamUploader:this.streamUploader,file:e,streamType:Panopto.Core.StreamType.PrimaryVideo,startTime:this.getStreamStartTime()}},t.prototype.parseEventForSecondary=function(t){var e=this.parseEventForFirstFile(t);if(e){var r=Panopto.Core.StringHelpers.parseExtension(e.name);return _.contains(this.pptExtensions,"."+r)?{streamUploader:this.slideUploader,file:e,streamType:Panopto.Core.StreamType.SecondaryPresentation,startTime:null}:{streamUploader:this.streamUploader,file:e,streamType:Panopto.Core.StreamType.SecondaryVideo,startTime:this.getStreamStartTime()}}},t.prototype.parseEventForSlides=function(t){var e=this.parseEventForFirstFile(t);if(e)return{streamUploader:this.slideUploader,file:e,streamType:Panopto.Core.StreamType.SecondaryPresentation,startTime:null}},t.prototype.applyState=function(t){this.timelineState=t},t.prototype.setAbsoluteSessionStart=function(t){this.absoluteSessionStart=t},t.prototype.setStreamUploader=function(t){this.streamUploader=t},t.prototype.setSlideUploader=function(t){this.slideUploader=t},t.prototype.areUploadersSet=function(){return!!this.streamUploader&&!!this.slideUploader},t.prototype.attachPrimaryTargetHandler=function(t){var e=this;this.attachTargetHandler(t,Panopto.BatchUpload.fileExtensions,function(t){return e.parseEventForPrimaryStream(t)})},t.prototype.attachSecondaryOrSlidesTargetHandler=function(t){var e=this,r=Panopto.BatchUpload.fileExtensions.concat(this.pptExtensions);this.attachTargetHandler(t,r,function(t){return e.parseEventForSecondary(t)})},t.prototype.attachSlidesTargetHandler=function(t){var e=this;this.attachTargetHandler(t,this.pptExtensions,function(t){return e.parseEventForSlides(t)})},t.prototype.attachTargetHandler=function(e,t,r){if(!this.streamUploader||!this.slideUploader)throw Error("streamUploader or slideUploader has not been set.");var o=function(t){var e=r(t);e&&e.streamUploader.startUpload(e.file,e.streamType,e.startTime)},a=function(t){t.stopPropagation(),t.preventDefault()},n=function(t){a(t),e.toggleClass("drop-target-drag")},i=$("<input />",{type:"file",multiple:!1,accept:t.join(",")});i.on("change",function(t){return o(t)}).hide().insertAfter(e),Panopto.Core.UI.Handlers.button(e,function(){i.click()},{keyEvent:"keypress"}),_.each(["mouseover","mouseleave","dragover"],function(t){e.on(t,a)}),_.each(["dragenter","dragleave"],function(t){e.on(t,n)}),e.on("drop",function(t){n(t),o(t)})},t}(),r.OverlayUploader=a}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlaySpeed=Panopto.Viewer.PlaySpeed||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.PlayControls=function(r,i,l,e,a,s,d,u,t){var c,p=Panopto.Viewer.ViewMode,f=Panopto.Viewer.Constants,o=Panopto.Viewer.PlaySpeed,m=Panopto.Viewer.Analytics,n=PanoptoTS.Viewer.MBRBitrate,P=Panopto.Viewer.PlayState,v=Panopto.GlobalResources,C=$("#playControlsWrapper"),y=$("#playControls"),g=$("#skipToStartButton"),h=$("#rewindButton"),S=$("#playButton"),w=$("#forwardButton"),b=$("#skipToEndButton"),k=$("#timeElapsed"),V=$("#timeRemaining"),B=$("#positionSlider"),E=$("#elapsedBar"),T=$("#volumeControl"),x=$("#volumeFlyout"),I=$("#volumeSlider"),H=$("#muteButton"),L=$("#volumeAlert"),M=$("#captionsButton"),z=$("#captionStyleOptions"),F=$("#dockedCaption"),O=$("#dockedCaptionText"),U=$("#overlayCaption"),R=$("#qualityButton"),A=R.find("#qualityBarWrapper"),D=$("#quickRewindButton"),K=$("#playSpeedButton"),N=$("#playSpeedExpander"),q=$("#playSpeedMultiplier"),W=B.find("#positionHandle"),X=B.find("#hoverTimestamp"),J=B.find("#hoverTick"),Q=$("#seekToLiveButton"),Y=$("#liveButton"),G=$("#qualityExpander"),j=$("#captionsExpander"),Z=j.find("#captionPlacementOptions"),ee=j.find("#captionColorOptions"),te=j.find("#captionSizeOptions"),oe=j.find("#captionsToggle"),ne=$("#autoplayMessage"),ae="fullscreen-controls",ie=$("#viewer"),re=$("#absoluteControls");u.onMaximize.add(function(e){var t=e?e.getStreamPlayer():l;Re(t)}),u.onRestore.add(function(){Re(void 0)}),u.onSwap.add(function(){var e=s.getPrimaryPlayerIndex()===s.PrimaryDefaultIndex?0:s.PrimaryDefaultIndex;r.swapLeftToRight(e)});var le,se,de,ue=$("#primaryBuffering"),ce=$("#secondaryBuffering"),pe=$("#kollectiveLoadingIndicator"),fe=function(e){return Panopto.Core.CookieHelpers.getUserCookieField(i.user.key,e)},me=function(e,t){Panopto.Core.CookieHelpers.setUserCookieField(i.user.key,e,t)},Pe=fe(f.CaptionsCookie),ve="boolean"==typeof Pe?Pe:Panopto.viewer.captionsEnabledByDefault,Ce=fe(f.CaptionPlacementCookie),ye=fe(f.CaptionSizeCookie),ge=fe(f.CaptionColorCookie),he=null!==Ce&&null!==ye&&null!==ge?new PanoptoTS.Models.Settings.CaptionStyles(Ce,ye,ge):Panopto.Captions.selectedStyles,Se=!1,we=!1,be=o.Normal,$e=i.flowPlayerEnabled?"vertical":"horizontal",ke=0,Ve=i.duration,Be="video, .fp-ui, .slide-deck #slideDeck-image",Ee="#primaryPlayer, .secondaryPlayer",Te=function(){return he.placement===PanoptoTS.Models.Settings.CaptionPlacement.Docked},_e=function(){var e=_.find(Panopto.Captions.ColorOptions,function(e){return e.key===he.colorSchemeKey});F.add(U).css({"font-size":he.textSize+"px",color:e.color,"text-shadow":e.textShadow}),F.css({height:3*he.textSize,"border-color":e.dockedBorderColor,"background-color":e.dockedBackgroundColor}),O.css({"max-height":3*he.textSize}),U.css({opacity:e.overlayOpacity,"background-color":e.backgroundColor}),r.setCaptionStyles(he);var t=function(e,n){e.children().each(function(e,t){var o=$(t).data("value")===n;$(t).toggleClass(Panopto.Core.Constants.SelectedClass,o).attr("aria-checked",String(o))})};r.isFullscreen()?t(Z,PanoptoTS.Models.Settings.CaptionPlacement.Overlay):t(Z,he.placement),t(ee,he.colorSchemeKey),t(te,he.textSize)},xe=function(){me(f.CaptionPlacementCookie,he.placement),me(f.CaptionColorCookie,he.colorSchemeKey),me(f.CaptionSizeCookie,he.textSize),_e(),r.synchronize(),r.resize()},Ie=function(){return i.flowPlayerEnabled||be===o.Normal},He=function(){return Ie()&&Se||we},Le=function(o,e,t){l.bitrate(o),_.each(d,function(e){var t=e.getCurrentPlayer();t&&t.bitrate(o)}),_.each(PanoptoTS.Viewer.EnumHelpers.getNameValuePairs(PanoptoTS.Viewer.MBRBitrate),function(e){$("#"+e.key).toggleClass(Panopto.Core.Constants.SelectedClass,e.value===o).attr("aria-checked",(e.value===o).toString())}),e&&me(t,o)},Me=function(e){var t=l.isMuted();H.toggleClass("muted",t),H.attr("title",t?v.ViewerPlus_Unmute:v.ViewerPlus_Mute),e&&I.slider("value",l.volume())},ze=function(e,t,o){e=Panopto.Core.ElementHelpers.clampSliderValue(I,e),o&&m.sendEvent({action:l.volume()<e?m.Actions.VolumeUp:m.Actions.VolumeDown,label:o});var n="horizontal"===$e?"width":"height";$("#volumeLevel").css(n,e+"%"),l.setVolume(e),Me(!1),t&&I.slider("value",e),me(f.VolumeCookie,e)},Fe=function(e){E.css("width",100*e/B.slider("option","max")+"%")},Oe=function(e,t,o){var n;e="number"==typeof t?Ve*(t/B.width()):e,e=Math.round(Panopto.Core.ElementHelpers.clampSliderValue(B,e));try{n=Q.is(":hover")}catch(e){n=!1}var a=n||o?v.ViewerPlus_Live:Panopto.Core.TimeHelpers.formatDuration(e,v.TimeSeparator),i=W.offset().left-W.parent().offset().left,r=i+W.outerWidth();X.text(a),X.show(),void 0!==t?(t=Panopto.Core.Math.clamp(t,0,B.width()),X.css("left",i<=t&&t<=r?r:t-X.width()/2),J.show().css("left",t),J.toggleClass("accent-tick",J.offset().left<W.offset().left)):(X.css("left",e/Ve*B.width()+W.outerWidth(!0)),J.hide())},Ue=function(){M.add(oe).toggleClass("safety-text",ve);var e=ve?v.ViewerPlus_Captions_Hide:v.ViewerPlus_Captions_Show;M.attr({title:e,"aria-label":e,"aria-pressed":ve})},Re=function(e){r.setFullscreenPlayer(e),i.flowPlayerEnabled&&Panopto.Core.Browser.fullscreenEnabled&&(e?(0===re.find(y).length&&(y.addClass(ae),y.children().not("#transportControls").hide(),$("#fullscreenControlsWrapper").prepend(y),$("#fullscreenControlsWrapper").show()),e.container().find(Be).parent().append(re)):(0===C.find(y).length&&(y.removeClass(ae).show(),y.children().not("#transportControls").hide(),$("#fullscreenControlsWrapper").hide(),C.append(y)),ie.append(re)));var t=void 0!==e,o=e===l;u.updateFullscreenButtons({allowFullscreen:!0,isFullscreen:t}),t?(u.toggleSwap(!1),he.placement===PanoptoTS.Models.Settings.CaptionPlacement.Docked&&(Z.find(".Docked").removeClass("selected"),Z.find(".Overlay").addClass("selected"))):_e(),u.hide(),ue.css("z-index",o||!t?"":-1),ce.css("z-index",o&&t?-1:""),pe.css("z-index",o||!t?"":-1),r.synchronize()};if(Panopto.Core.UI.Handlers.button(S,function(){r.togglePlaying(m.Labels.Normal)}),Panopto.Core.UI.Handlers.button(g,function(){r.skipToStart(m.Labels.Normal)}),Panopto.Core.UI.Handlers.button(h,function(){r.rewind(m.Labels.Normal,f.EditJumpSeconds)}),h.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Rewind,f.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(w,function(){r.forward(m.Labels.Normal,f.EditJumpSeconds)}),w.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Forward,f.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(b,function(){r.skipToEnd(m.Labels.Normal)}),Panopto.Core.UI.Handlers.button(D,function(){r.rewind(m.Labels.Normal)}),D.attr("title",PanoptoTS.StringHelpers.format(v.ViewerPlus_Rewind,f.QuickRewindSeconds)),r.userSeekEnabled()||D.hide(),B.mousemove(function(e){!se&&r.userSeekEnabled()&&(ke=e.clientX-B.offset().left,Oe(0,ke,!1),de=!0)}).mouseleave(function(){se||(X.hide(),J.hide(),de=!1)}),W.mouseup(function(e){if(r.userSeekEnabled()){var t=e.clientX-B.offset().left;Math.abs(t-ke)<=f.SliderDragThreshold&&(c=e.clientX,r.setPosition(t/B.width()*Ve))}}),T.addClass($e),"vertical"===$e&&T.find(".ui-slider-handle").on("keydown keyup",function(e){e.keyCode===Panopto.Core.Key.Home?e.keyCode=Panopto.Core.Key.End:e.keyCode===Panopto.Core.Key.End&&(e.keyCode=Panopto.Core.Key.Home)}),Panopto.Core.UI.Handlers.hoverOrDrag(T,function(e){e?(T.toggleClass("active",!0),x.fadeIn(f.FadeInterval)):x.fadeOut(f.FadeInterval,function(){T.toggleClass("active",!1),x.show()})}),Panopto.Core.UI.Handlers.key(T,function(){T.toggleClass("active",!1)},[Panopto.Core.Key.Esc]),I.slider({max:100,min:0,value:f.InitialVolume,step:1,orientation:$e,change:function(e,t){var o=e;ze(t.value,!1,!!o.originalEvent&&m.Labels.Normal)},slide:function(e,t){ze(t.value,!1,void 0)}}),Panopto.Core.UI.Accessibility.slider(I,function(e){return PanoptoTS.StringHelpers.format(v.ViewerPlus_ARIA_PercentValue,e)},v.Viewer_Aria_VolumeSlider),Panopto.Core.UI.Handlers.button(H,function(){r.toggleMuted(m.Labels.Normal)}),H.on("keydown keyup",function(e){33<=e.keyCode&&e.keyCode<=40&&I.find(".ui-slider-handle").trigger(e)}),ze("number"==typeof e?e:f.InitialVolume,!0,void 0),B.slider({max:Ve,min:0,value:0,step:1,orientation:"horizontal",disabled:!r.userSeekEnabled(),change:function(e,t){var o,n=e,a=Panopto.Core.ElementHelpers.clampSliderValue(B,t.value);if(se=!1,Fe(a),n.originalEvent){if(W.hide(),(o=$(document.elementFromPoint(n.clientX||0,n.clientY||0))).is(".timeline-event"))o.click();else if(void 0!==n.clientX){if(n.clientX!==c){c=n.clientX;var i=n.clientX-B.offset().left;r.setPosition(i/B.width()*Ve)}}else r.setPosition(a);W.show(),l.setPlayStateWithLogging(r.playState(),!0),J.hide(),X.hide(),m.sendEvent({action:m.Actions.Seek,label:m.Labels.Normal})}else de&&Oe(0,ke,!1)},slide:function(e,t){var o=Panopto.Core.ElementHelpers.clampSliderValue(B,t.value);se=!0,l.playState(P.Paused),_.each(d,function(e){var t=e.getCurrentPlayer();t&&t.playState(P.Paused)}),Oe(o,void 0,!1),Fe(o)}}),Panopto.Core.UI.Accessibility.slider(B,function(e){return Panopto.Core.TimeHelpers.formatDuration(e,v.TimeSeparator)},v.Viewer_Aria_PositionSlider),r.userSeekEnabled()||(B.css("pointer-events","none"),W.attr("tabindex",-1)),i.isBroadcast&&(Q.show(),Y.show(),Panopto.Core.UI.Handlers.button(Q.add(Y),function(){l.isLive()||(r.setPlayState(P.Playing,void 0,void 0),l.setIsLive(!0,function(){r.synchronize(!0)}))}),Q.focus(function(){Oe(0,Q.position().left+Q.width()/2,!0)})),Panopto.viewer.userCaptionControlsEnabled){var Ae="optionsVisible";Panopto.Core.UI.Components.flyout({$element:j,$trigger:z,timeout:f.FlyoutTimeout,expandLeft:!0,expandUp:!0,fadeInterval:f.FadeInterval,showCallback:function(){z.hasClass(Ae)||(z.addClass(Ae),$("#captionStylesPartialBorder").css("width",z.innerWidth()),Panopto.Core.Browser.flashEnabled()&&r.toggleScreens(!1))},hideCallback:function(){z.hasClass(Ae)&&(z.removeClass(Ae),Panopto.Core.Browser.flashEnabled()&&r.toggleScreens(!0))}}),_.each(Panopto.Captions.PlacementOptions,function(e){Z.append(_.template($("#placementOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(Z.children(),function(e){he.placement=$(e).data("value"),xe()}),_.each(Panopto.Captions.ColorOptions,function(e){ee.append(_.template($("#colorOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(ee.children(),function(e){he.colorSchemeKey=$(e).data("value"),xe()}),_.each(Panopto.Captions.SizeOptions,function(e){te.append(_.template($("#sizeOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(te.children(),function(e){he.textSize=$(e).data("value"),xe()})}if(Panopto.Core.UI.Handlers.button(M,function(){ve=!ve,me(f.CaptionsCookie,ve),Ue(),r.synchronize()}),j.find("li").attr("tabindex",z.attr("tabindex")),(!i.requiresSilverlight||Silverlight.isInstalled(f.PlaySpeedSilverlightVersion))&&i.playSpeedEnabled&&r.userSeekEnabled()){Panopto.Core.UI.Components.flyout({$element:N,$trigger:K,timeout:f.FlyoutTimeout,expandLeft:!0,expandUp:!1,fadeInterval:f.FadeInterval}),N.find(".flyout-close").before(_.template($("#playSpeedTemplate").html())({playSpeeds:_.map(o,function(e,t){return{text:v[f.PlaySpeedResourceString.format(t)],id:t,speedClass:(e>o.Normal?"fast":"")+(e===o.Fastest?" fastest":"")}})}));var De=function(n){_.each(o,function(e,t){var o=e===n;$("#"+t).toggleClass(Panopto.Core.Constants.SelectedClass,o).attr("aria-checked",String(o)),o&&q.text(v[f.PlaySpeedResourceString.format(t)])}),K.toggleClass("fast",n>o.Normal)};De(be),Panopto.Core.UI.Handlers.button(N.find(".play-speed"),function(e){be=o[e.id],l.playSpeed(be),_.each(d,function(e){_.each(e.getTabs(),function(e){e.playSpeed(be)})}),De(be),N.hide(),K.focus(),R.toggleClass("disabled",!Ie()),Ie()||R.attr("title",v.ViewerPlus_QualityDisabled),m.sendEvent({action:m.Actions.Speed,label:be.toString()})})}else K.hide();if(i.multiBitrateEnabled){if(Panopto.Core.UI.Components.flyout({$element:G,$trigger:R,timeout:f.FlyoutTimeout,expandLeft:!0,expandUp:!1,fadeInterval:f.FadeInterval,condition:function(){return He()}}),!(l.optimizationProvider()===f.Kollective||Panopto.viewer.isKollectiveEnabled&&Panopto.viewer.useKollectiveFlashLongPoll)){$("#qualityOptionHeader").after(_.template($("#qualityOptionTemplate").html())({qualityOptions:_.map(PanoptoTS.Viewer.EnumHelpers.getNames(PanoptoTS.Viewer.MBRBitrate),function(e){return{text:v[f.BitrateResourceString.format(e)],id:e}})})),Panopto.Core.UI.Handlers.button(G.find(".quality-option"),function(e){var t=n[e.id];Le(t,!0,i.requiresSilverlight?f.BitrateCookie:f.MBRBitrateCookie),G.hide(),R.focus(),m.sendEvent({action:m.Actions.Bitrate,label:_.invert(n)[t].toLowerCase()})});var Ke=PanoptoTS.Viewer.Logic.InitialStateLogic.getBitrate(i.requiresSilverlight);Le(Ke,void 0,void 0)}}else R.hide();$(document).keydown(function(e){r.hotkey(e.keyCode)}),$(document).on("dblclick",Ee,function(e){var t=s.getPlayerFromElement($(e.currentTarget));t.setIsFullscreen&&Re(t)});var Ne,qe=function(e){e.css("cursor","default"),clearTimeout(Ne),Ne=window.setTimeout(function(){e.css("cursor","none"),$("."+ae).finish().fadeOut(f.FadeInterval)},1e3*f.FullScreenControlInterval);var t=s.getPlayerFromElement(e);if(Panopto.viewer.allowMultipleSecondaryDisplay){var o=_.chain(d).filter(function(e){return e.getCurrentPlayer()===t}).first().value();o?(o.getTabControl().updateAvailableTabs(r.position()),u.showTabsFor(o)):u.showTabsFor(void 0)}else d.length&&(d[0].getCurrentPlayer()===t?u.setSecondaryContentContainer(d[0]):u.setSecondaryContentContainer(void 0));var n=t&&t.container().is(".slide-deck");u.updateFullscreenButtons({allowFullscreen:!n,isFullscreen:r.isFullscreen()}),u.toggleSwap(r.isSecondarySwapAllowed()),u.show(e),r.isFullscreen()&&($("."+ae).fadeIn(f.FadeInterval),$("."+ae).on("mouseover",function(){clearTimeout(Ne)}))},We=function(){ne.css({left:S.offset().left+S.outerWidth()/2,top:S.offset().top-ne.outerHeight()-24})};return $(document).on("mousemove",Ee,function(e){qe($(e.currentTarget).find(Be).first())}),s.onPlayerSwap(function(e,t){var o=u.getCurrentTarget();if(o){var n=0!==o.closest("."+f.SecondaryPlayerClass).length?a.getPrimaryPlayer():$(a.getSecondaryPlayers().get(e));qe(n.find(Be))}}),$(document).on("click","video",function(){r.togglePlaying()}),$(document).on("contextmenu","video",function(){return!1}),Panopto.Core.Browser.fullscreenEvent(function(e){i.flowPlayerEnabled&&Panopto.Core.Browser.fullscreenEnabled&&!e?Re(void 0):e||(u.hide(),$("."+ae).fadeOut(f.FadeInterval))}),j.on("keydown",function(e){var t=j.find("li"),o=t.first()[0],n=t.last()[0];e.keyCode===Panopto.Core.Key.Tab&&(e.shiftKey?document.activeElement===o&&(n.focus(),e.preventDefault()):document.activeElement===n&&(o.focus(),e.preventDefault()))}),V.toggle(!i.isBroadcast),_e(),Ue(),Panopto.viewer.allowMultipleSecondaryDisplay&&!t&&(new PanoptoTS.Viewer.Controls.SecondaryLayoutSelector($("#selectedSecondaryLayout"),$("#secondaryLayoutExpander"),s,v),$("#selectedSecondary").hide()),{synchronize:function(e,t,o,n,a){0<t&&t!=Ve&&(Ve=t,B.slider("option","max",Ve),B.find(".ui-slider-handle").attr("aria-valuemax",Ve)),Math.abs(e-Ve)<.1&&(e=Ve),se||B.slider("value",e),k.text(o),V.text(n),i.isBroadcast&&(Y.toggleClass("live",l.isLive()),Y.attr("title",l.isLive()?"":v.ViewerPlus_Live_Tooltip),Y.css("cursor",l.isLive()?"":"pointer"),Q.toggleClass("accent-background",l.isLive()),Q.toggleClass("safety-accent-border-ifcustom",l.isLive()))},synchronizeCaption:function(){var e=F.is(":visible");M.toggle(!!i.hasCaptions),z.toggle(!!i.hasCaptions&&Panopto.viewer.userCaptionControlsEnabled),F.toggle(!!i.hasCaptions&&Te()&&ve),e!==F.is(":visible")&&r.resize(),s.getLeftPlayerElement().find(".letterbox").toggleClass("no-border-radius",F.is(":visible")&&r.viewMode()===p.Primary),s.getRightPlayerElements().toggleClass("no-border-radius",F.is(":visible")&&r.viewMode()===p.Secondary)},synchronizeBitrate:function(){var e,t,o=_.map(d,function(e){return e.getCurrentPlayer()}),n=_.filter(o,function(e){return e&&e.hasMBR()});switch(r.viewMode()){case p.Primary:e=l;break;case p.Secondary:default:e=n.length?_.min(n,function(e){return e.bitrateLevelOffset()}):l}Se=e.hasMBR(),t=Math.max(f.BitrateLevels.length+e.bitrateLevelOffset()-1,0),A.attr("class","bar-"+t),Ie()&&R.attr("title",Se?PanoptoTS.StringHelpers.format(v.ViewerPlus_YourConnection,f.BitrateLevels[t]):v.ViewerPlus_OnlyOneBitrate),l.optimizationProvider()&&!we?(we=!0,l.optimizationProvider()===f.Kollective?(!i.isBroadcast||i.flowPlayerEnabled||Panopto.viewer.kollectiveVideoJSWebcastDVREnabled||(D.hide(),S.hide()),$("#qualityOptionHeader").text(v.ViewerPlus_OptimizedStream_Kollective)):l.optimizationProvider()===f.Hive&&$("#qualityOptionHeader").text(v.ViewerPlus_OptimizedStream_Hive)):we&&!l.optimizationProvider()&&$("#qualityOptionHeader").text(v.ViewerPlus_Quality),R.toggleClass(Panopto.Core.Constants.DisabledClass,!He())},setBitrate:Le,toggleMuted:function(){var e=!l.isMuted();l.muted(e),Me(!0);var t=e?v.ViewerPlus_ARIA_Muted:v.ViewerPlus_ARIA_Unmuted;L.text(t)},updateVolume:ze,showVolumeControl:function(){T.mouseenter(),le&&clearTimeout(le),le=setTimeout(function(){T.mouseleave()},f.FlyoutTimeout)},togglePlayState:function(e){S.toggleClass("paused",e),S.attr("title",e?v.ViewerPlus_Play:v.ViewerPlus_Pause)},toggleAutoplayMessage:function(e){ne.toggle(e),e&&We()},positionAutoplayMessage:We,playSpeed:function(){return be},captionsSelected:function(){return ve},captionsDocked:Te}};
var PanoptoTS;!function(e){var o,t,n,r,a;o=e.Viewer||(e.Viewer={}),t=o.Controls||(o.Controls={}),n=e.Models.VoidCallback,r=e.Models.TypedCallback,a=function(){function e(e){var t=this;this._onMaximize=new r,this._onRestore=new n,this._onSwap=new n,this._onShowOverlay=new n,this.template=_.template('\n            <div class="player-layout-controls">\n                <div class="show-overlay-button"><i class="material-icons">&#xE145;</i></div>\n                <div class="full-screen-button"><i class="material-icons">&#xE5D0;</i></div>\n                <div class="restore-screen-button"><i class="material-icons">&#xE5D1;</i></div>\n                <div class="swap-streams-button"><i class="material-icons">&#xE8D4;</i></div>\n                <div id="secondaryContainer" class="select-secondary-container">\n                    <div class="selected-secondary" tabindex="0"\n                        role="button" aria-haspopup="true"\n                        aria-label="<%= Resources.GlobalResources.Viewer_SecondaryStreamMenu %>">\n                        <div id="selectedSecondaryWrapper" class="player-tab-wrapper">\n                            <i id="selectedSecondaryIcon" class="material-icons"></i>\n                            <div id="selectedSecondaryText" class="player-tab-title ellipsis"></div>\n                            <i class="material-icons">arrow_drop_down</i>\n                        </div>\n                    </div>\n                    <div class="select-secondary-flyout" role="menu" aria-orientation="vertical"\n                        aria-label="<%= Resources.GlobalResources.Viewer_SecondaryStreamMenu %>">\n                        \x3c!-- templated secondary tabs go here --\x3e\n                    </div>\n                </div>\n            </div>\n        '),this.isFullscreen=!1,this.allowShowOverlayButton=!1,this.element=$(this.template()),this.fullScreenButton=$(".full-screen-button",this.element).hide(),this.restoreScreenButton=$(".restore-screen-button",this.element).hide(),this.swapStreamsButton=$(".swap-streams-button",this.element).hide(),this.showOverlayButton=$(".show-overlay-button",this.element).hide(),this.selectSecondaryContainer=$(".select-secondary-container",this.element).hide(),this.selectedSecondary=$(".selected-secondary",this.element),this.selectSecondaryFlyout=$(".select-secondary-flyout",this.element).hide(),Panopto.Core.UI.Handlers.button(this.fullScreenButton,function(){t._onMaximize.fire(t.attachedSecondaryContentContainer)}),Panopto.Core.UI.Handlers.button(this.restoreScreenButton,function(){t._onRestore.fire()}),Panopto.Core.UI.Handlers.button(this.swapStreamsButton,function(){t._onSwap.fire()}),Panopto.Core.UI.Handlers.button(this.showOverlayButton,function(){t._onShowOverlay.fire()}),null!=e&&e.onAddContentRequirementChanged.add(function(e){t.allowShowOverlayButton=e.canAddContent})}return Object.defineProperty(e.prototype,"onMaximize",{get:function(){return this._onMaximize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRestore",{get:function(){return this._onRestore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSwap",{get:function(){return this._onSwap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onShowOverlay",{get:function(){return this._onShowOverlay},enumerable:!0,configurable:!0}),e.prototype.getCurrentTarget=function(){return this.currentTarget},e.prototype.updateFullscreenButtons=function(e){var t=e.allowFullscreen,n=e.isFullscreen;this.fullScreenButton.toggle(!n&&t),this.restoreScreenButton.toggle(n),this.showOverlayButton.toggle(this.allowShowOverlayButton&&!n),this.isFullscreen!==n&&(this.isFullscreen=n,this.currentTarget=void 0,this.element.detach())},e.prototype.toggleSwap=function(e){this.swapStreamsButton.toggle(e)},e.prototype.show=function(e){var t=$.Deferred();if(this.currentTarget&&this.currentTarget[0]===e[0])t.resolve();else{this.currentTarget=e;var n=void 0;n=this.isFullscreen?this.currentTarget.parent():this.currentTarget.closest(".player-layout-controls-container"),this.element.appendTo(n),this.element.finish().fadeIn(o.Constants.FadeInterval,function(){t.resolve()}),e.is("#slideDeck-image")&&this.fullScreenButton.hide()}return this.setAutoHideTimeout(),t.promise()},e.prototype.setSecondaryContentContainer=function(e){this.attachedSecondaryContentContainer=e},e.prototype.showTabsFor=function(e){e!==this.attachedSecondaryContentContainer&&(this.attachedSecondaryContentContainer&&this.attachedSecondaryContentContainer.getTabControlElements().detachTabs(),this.attachedSecondaryContentContainer=e,this.attachedSecondaryContentContainer?(this.attachedSecondaryContentContainer.getTabControlElements().attachTabs(this.selectedSecondary,this.selectSecondaryFlyout),this.attachedSecondaryContentContainer.getTabControl().attachTabHandlers(),this.selectSecondaryContainer.show()):this.selectSecondaryContainer.hide())},e.prototype.hide=function(){var e=this,t=$.Deferred();return this.currentTarget=void 0,this.element.finish().fadeOut(o.Constants.FadeInterval,function(){e.element.detach(),t.resolve()}),t.promise()},e.prototype.setAutoHideTimeout=function(){var e=this;clearTimeout(this.autoHideTimeout),this.autoHideTimeout=window.setTimeout(function(){e.element.is(":hover")||e.hide()},1e3*o.Constants.FullScreenControlInterval)},e}(),t.PlayerLayoutControls=a}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.ScormData=function(t,o){var e,n,r=Panopto.Viewer.Constants,a=[],i=0,s=0,c=function(){return i/t>r.ScormCompleteThreshold};if(window.console&&console.log(o),o&&(e=o.split("t"))[0].length===t){for(n=0;n<t;n++)a[n]=e[0].charAt(n),i+="x"===a[n]?1:0;s=parseFloat(e[1])||0}if(!a.length)for(n=0;n<t;n++)a[n]=" ";return{serialize:function(t){return a.join("")+"t"+t},markProgress:function(t){return t=Math.min(a.length,t),"x"!==a[t]&&(a[t]="x",i++,!0)},segmentsWatched:function(){return i},completed:c,shouldUpdateSegments:function(){return c()||i%10==0},shouldUpdatePosition:function(t,o,e,n){return Math.abs(t-o)>r.ScormOffsetMultiplier*e||t===n},lastPosition:function(){return s}}},Panopto.Viewer.ScormControl=function(t,e){var n,r=Panopto.Viewer.Constants,o=Math.min(Math.ceil(e),r.MaxScormSegments),a=e/o,i=0,s=0;try{return(n=Panopto.Viewer.ScormData(o,SD.GetBookmark())).lastPosition()&&(t.position(n.lastPosition()||0),s=n.lastPosition()),i=n.segmentsWatched()*a,{updateProgress:function(t){var o=n.markProgress(Math.floor(t/a));if(o&&n.shouldUpdateSegments()||n.shouldUpdatePosition(t,s,a,e))try{SD.SetBookmark(n.serialize(t)),SD.LMSSetValue(r.ScormTimeKey,Math.floor(1e3*(n.segmentsWatched()*a-i))),o&&n.completed()&&SD.SetReachedEnd(),SD.CommitData(),s=t}catch(t){}}}}catch(t){}};
var PanoptoTS;!function(s){var t,e,l,n;t=s.Viewer||(s.Viewer={}),e=t.Controls||(t.Controls={}),l=Panopto.Viewer.Tabs,n=function(){function t(t,e,n,r){this.viewer=n,this.index=r,this.tabs=new Array,this.tabControlElements=t,this.initializeTabs(e,n)}return t.prototype.getTabControlElements=function(){return this.tabControlElements},t.prototype.getStreamPlayer=function(){return this.streamPlayer},t.prototype.getCurrentPlayer=function(){var t=_.find(this.tabs,function(t){return t.selected()});return t?t.getPlayer():void 0},t.prototype.getTabControl=function(){return this.tabControl},t.prototype.getTabs=function(){return this.tabs},t.prototype.remove=function(){_.each(this.tabs,function(t){t.remove()})},t.prototype.updateTabs=function(r,a,o){var i=this;if(r.secondaryStreams.length&&!this.streamPlayer){var t=a.playerSelection.getPlayerFactory(r);this.streamPlayer=PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer(this.tabControlElements.getContent(),t,this.viewer)}_.each(r.secondaryStreams,function(e){var t=_.find(i.tabs,function(t){return t.id()===e.id}),n=1e3*Math.min(0,e.timeline[0]-o);t?t.setContent(e):n<r.broadcastRefreshInterval&&setTimeout(function(){var t=l.SecondaryTab(i.tabControlElements,i.streamPlayer,e,s.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(e));i.tabs.push(t),t.render(),i.tabControl.attachTabHandlers(),a.toggleInlineSecondaries(),a.synchronize(!0)},n)})},t.prototype.resize=function(t,e){var n=this.getCurrentPlayer();if(n)n.resize(t,e);else{var r=this.tabControlElements.getContentContainer();r.width(t),r.height(e)}},t.prototype.reinitializeTabs=function(t,e){this.remove(),this.tabs.length=0,this.initializeTabs(t,e)},t.prototype.initializeTabs=function(t,n){var r=this,a=this.tabControlElements.getContent();if(_.each(t.documents,function(t){t.isPdf&&r.addDocumentPlayer(a,t)}),_.each(t.slideDecks,function(t){var e=PanoptoLegacy.Viewer.Players.SlidePlayer(a,t,n);r.tabs.push(l.SecondaryTab(r.tabControlElements,e,t,Panopto.Core.Constants.SlideIconCode))}),t.secondaryStreams.length){if(!this.streamPlayer){var e=n.playerSelection.getPlayerFactory(t);this.streamPlayer=PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer(a,e,this.viewer)}var o=[];_.each(t.secondaryStreams,function(t){o.push(l.SecondaryTab(r.tabControlElements,r.streamPlayer,t,s.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(t)))}),this.tabs.sort(function(t,e){var n=t.relativeStartTime()-e.relativeStartTime();return 0===n&&(n=t.absoluteStartTime()-e.absoluteStartTime()),n}),_.each(o,function(t){r.tabs.push(t)})}_.each(t.documents,function(t){t.isPdf||r.addDocumentPlayer(a,t)}),_.each(this.tabs,function(t){t.render()}),this.tabControl=Panopto.Viewer.SecondaryTabControl(this.tabControlElements,n,this.tabs,this.index)},t.prototype.addDocumentPlayer=function(t,e){var n=PanoptoLegacy.Viewer.Players.DocumentPlayer(t,e,this.viewer);this.tabs.push(l.SecondaryTab(this.tabControlElements,n,e,e.iconCode))},t}(),e.SecondaryContentContainer=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var n,e,t;n=o.Viewer||(o.Viewer={}),e=n.Controls||(n.Controls={}),t=function(){function e(e,t,n,o){var a=this;this.selectedContainer=e,this.expanderContainer=t,this.model=n,this.resources=o,this.optionTemplate=_.template('\n<div class="player-tab-header transport-button accented-tab role="button" data-layout="<@= layout @>">\n    <div class="player-tab-wrapper">\n        <img src="<@= imagePath @>"/>\n        <div class="player-tab-title ellipsis"><@= text @></div>\n    </div>\n</div>'),this.model.onSecondaryLayoutChanged.add(function(e){return a.onSecondaryLayoutChanged(e)}),this.render()}return e.prototype.onSecondaryLayoutChanged=function(e){e!==this.selectedPlayerLayout&&this.renderNewSelection(e)},e.prototype.render=function(){var t=this;this.expanderContainer.hide(),this.renderNewSelection(this.model.getSecondaryLayout()),this.selectedContainer.show();var e=_.map(this.model.getAllowedSecondaryLayouts(),function(e){return t.getOptionTemplateModel(e)});_.each(e,function(e){return t.expanderContainer.append(t.optionTemplate(e))}),Panopto.Core.UI.Components.flyout({$element:this.expanderContainer,$trigger:this.selectedContainer,timeout:n.Constants.FlyoutTimeout,expandLeft:!0,expandUp:!0,fadeInterval:n.Constants.FadeInterval}),Panopto.Core.UI.Handlers.button(this.expanderContainer.find(".player-tab-header"),function(e){t.model.setSecondaryLayout($(e).data("layout")),t.expanderContainer.hide()})},e.prototype.renderNewSelection=function(e){this.selectedContainer.empty(),this.selectedContainer.append(this.optionTemplate(this.getOptionTemplateModel(e)))},e.prototype.getOptionTemplateModel=function(e){var t,n;switch(e){case o.Viewer.SecondaryLayoutType.Single:t=this.resources.ViewerPlus_SecondaryLayout_Single,n="Icon_Single";break;case o.Viewer.SecondaryLayoutType.Double:t=this.resources.ViewerPlus_SecondaryLayout_Split,n="Icon_Split";break;case o.Viewer.SecondaryLayoutType.Quad:t=this.resources.ViewerPlus_SecondaryLayout_Quad,n="Icon_Quad"}return{layout:e,text:t,imagePath:o.ImageHelpers.getImageUrl("Viewer/"+n+".svg")}},e}(),e.SecondaryLayoutSelector=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])};return function(t,o){function n(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){var o,n,r;o=t.Viewer||(t.Viewer={}),n=o.Controls||(o.Controls={}),r=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.show=function(){t.prototype.show.call(this,!1)},o}(n.AddSecondaryOverlay),n.SecondaryPlaceholder=r}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.SecondaryTabControl=function(a,r,d,e){Panopto.Viewer.ViewMode;var l=Panopto.Viewer.Constants,i=(Panopto.Viewer.PlayState,Panopto.Core.ViewerLogEntryType),s=function(t,n){var o;if(_.each(d,function(e){e!==t?e.setSelected(!1,n):(o=!e.selected(),r.writeLineToClientLog(i.StreamChange,["Secondary",e.id()]))}),t){var e=r.position();t.getPlayer().setStartPosition(e),t.setSelected(!0,n),t.getPlayer().setStartPosition(void 0),r.ensureSecondaryIsMinimized(),t.setPosition(e,!0,o,void 0),t.playState(r.playState()),t.content().isSecondaryPaneOnly?r.interruptLayoutChanges(void 0):r.restoreLayoutChanges(),r.resize()}else a.setSelectedText(Panopto.GlobalResources.ViewerPlus_SecondarySources),a.setSelectedIcon("","")},c=function(){return _.find(d,function(e){return e.selected()})};return{getTabs:function(){return d},getIndex:function(){return e},selectTabById:function(t,e){var n=c(),o=_.find(d,function(e){return e.id()===t});!o||!o.available(r.position())||e&&n.id()===l.SlideDeckId||s(o,!1)},attachTabHandlers:function(){var e=a.getExpander();if(e){var t=a.getTabs(),n=void 0,i=function(){return e.fadeOut(l.FadeInterval)};if(Panopto.viewer.allowMultipleSecondaryDisplay){var o=a.getSelected();n=function(){o.animate({borderBottomRightRadius:"0px",borderBottomLeftRadius:"0px"},l.FadeInterval/3)},i=function(){o.animate({borderBottomRightRadius:"5px",borderBottomLeftRadius:"5px"},l.FadeInterval)}}Panopto.Core.UI.Handlers.button(t,function(t){var e=_.find(d,function(e){return e.owns(t)}),n=!1;if(e&&e.enabled()){var o=e.available(r.position()),a=r.userSeekEnabled()&&!r.isFullscreen();(o||a)&&("number"==typeof e.seekTime()&&r.setPosition(e.seekTime()),s(e,!0),n=!0)}n&&i()}),Panopto.Core.UI.Components.flyout({$element:e,$trigger:a.getSelected(),timeout:l.FlyoutTimeout,expandLeft:!0,expandUp:!1,fadeInterval:l.FadeInterval,showCallback:n,hideCallback:i}),r.toggleInlineSecondaries()}},selectedTab:c,selectSecondaryTab:s,updateSecondaryTabEnabledState:function(n,o){_.each(d,function(e){var t=e.content().isBroadcast&&!e.available(o);e.setEnabled(n&&!t)})},updateAvailableTabs:function(t){_.each(d,function(e){e.available(t)})}}};
var PanoptoTS;!function(e){var t,o,r,a;t=e.Viewer||(e.Viewer={}),o=t.Controls||(t.Controls={}),r=e.Models.TypedCallback,a=function(){function e(e,t,o,a){var n=this;this.params=e,this.sessionsService=t,this.sessionUploadManagementService=o,this.multipartUploadManagerService=a,this.uploadStatusQueryIntervalMilliseconds=1e4,this.pendingUploads={},this.allPendingUploads=[],this._onReady=new r,this._onBeforeUpload=new r,this._onUploaded=new r,this._onUpdate=new r,this._onComplete=new r,this._onDelete=new r,this.sessionUploadManagementService.setHost(window.location.origin),$(window).on("beforeunload",function(){return n.multipartUploadManagerService.isRunning()?Panopto.GlobalResources.ViewerPlus_Edit_WaitForUpload:void 0})}return Object.defineProperty(e.prototype,"onReady",{get:function(){return this._onReady},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeUpload",{get:function(){return this._onBeforeUpload},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUploaded",{get:function(){return this._onUploaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUpdate",{get:function(){return this._onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDelete",{get:function(){return this._onDelete},enumerable:!0,configurable:!0}),e.prototype.getCurrentUploads=function(){var o=this;this.sessionUploadManagementService.getUploads(this.params.sessionId,function(e){_.each(e.ProcessingUploads,function(t){if(_.some(o.params.supportedStreamTypes,function(e){return t.StreamType===e})){if(!o.pendingUploads.hasOwnProperty(t.ID)){var e={state:1,filename:t.UserFilename,fileSize:void 0,bytesUploaded:void 0,request:new Panopto.Core.CancellableRequest,uploadId:t.ID,streamType:t.StreamType,errorMessage:void 0,startTime:o.params.showStartTime?Panopto.Util.dateFromJSON(t.StreamStartTime):null,iconCode:o.getIconCodeFromStreamType(t.StreamType),isComplete:!1};o.pendingUploads[t.ID]=e,o.allPendingUploads.push(e)}o.startProcessing(o.pendingUploads[t.ID])}}),o._onReady.fire(o.pendingUploads)},function(){return $.noop()})},e.prototype.startUpload=function(e,t,o){var a=this,n=new Panopto.Core.CancellableRequest,r=new Panopto.Core.CancellableRequest,s="."+Panopto.Core.StringHelpers.parseExtension(e.name),i={state:0,filename:e.name,fileSize:e.size,bytesUploaded:0,request:new Panopto.Core.CancellableRequest(function(){n.cancel(),r.cancel()}),uploadId:void 0,streamType:t,errorMessage:void 0,startTime:o,iconCode:this.getIconCodeFromStreamType(t),isComplete:!1};this.allPendingUploads.push(i);var p=function(e){i.state=1,i.bytesUploaded=e,a._onUpdate.fire(i)},c=function(){i.state=5,a._onUpdate.fire(i)};_.contains(this.params.supportedExtensions,s)?Panopto.features.uploadByteLimit&&e.size>Panopto.features.uploadByteLimit?(i.state=4,i.uploadId=_.uniqueId("file"),this._onUpdate.fire(i)):n=this.sessionUploadManagementService.openUpload({sessionId:this.params.sessionId,filename:e.name,startTime:o,streamType:t},function(t){i.state=1,i.uploadId=t.ID,a._onUpdate.fire(i),a._onBeforeUpload.fire(i),a.multipartUploadManagerService.queueUpload({file:e,fileId:i.uploadId,uploadUri:t.UploadTarget},p,function(){return e=t,void(r=a.sessionUploadManagementService.closeUpload(e,function(){a._onUploaded.fire(i),a.startProcessing(i)},c));var e},c),a.multipartUploadManagerService.upload()},c):(i.state=3,i.uploadId=_.uniqueId("file"),this._onUpdate.fire(i))},e.prototype.cancelUpload=function(e){var t=this;e.request.cancel(),this.multipartUploadManagerService.cancelUpload(e.uploadId),e.uploadId?this.sessionUploadManagementService.deleteUpload(e.uploadId,function(){t._onDelete.fire(e)},function(){e.state=7,t._onUpdate.fire(e)}):this._onDelete.fire(e)},e.prototype.hasActiveUploads=function(){return _.any(this.allPendingUploads,function(e){return!e.isComplete&&(0===e.state||1===e.state||2===e.state)})},e.prototype.startProcessing=function(t){var o=this;t.state=2,this._onUpdate.fire(t);var a=setInterval(function(){o.sessionUploadManagementService.getUpload(t.uploadId,function(e){e.State===Panopto.Core.UploadStatus.Complete?(clearInterval(a),t.isComplete=!0,o._onUpdate.fire(t),o._onComplete.fire(t)):e.State===Panopto.Core.UploadStatus.ProcessingError&&(clearInterval(a),o.getErrorMessage(t).then(function(e){t.state=6,t.errorMessage=e,o._onUpdate.fire(t)}))},function(){return $.noop()})},this.uploadStatusQueryIntervalMilliseconds)},e.prototype.getIconCodeFromStreamType=function(e){var t=Panopto.Core.Constants.ObjectVideoIconCode;switch(e){case 3:t=Panopto.Core.Constants.SlideIconCode}return t},e.prototype.getErrorMessage=function(a){var n=this,r=$.Deferred(),e=Panopto.Core.ServiceInterface.Objects.ServiceTaskQuery({filters:{deliveryIDs:[this.params.sessionId],includeDeliverySession:!0,serviceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.UnisonPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.UnisonEncode],mostRecentServiceTaskTypeIDs:[Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.SlidePackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.MediaPackaging,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.ViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.FastPathViewerEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.PodcastEncode,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.LegacyRecorderUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.TransferUpload,Panopto.Core.ServiceInterface.Objects.ServiceTaskTypes.CompleteUpload],taskStates:[Panopto.Core.ServiceInterface.Objects.TaskState.PermanentFailure]}});return Panopto.Util.callWebMethod({methodName:"GetMatchingTaskStatusWebUI",params:{query:e},loadingIndicator:null,onSuccess:function(e){var t,o=_.map(e.ServiceTaskStatuses.Results,function(e){return Panopto.Core.ServiceInterface.Objects.ServiceTaskStatus(e)});_.each(o,function(e){e.sourceFilename===a.filename&&(t=n.createMessage(e))}),r.resolve(t)},onFailure:function(){r.reject()}}),r.promise()},e.prototype.createMessage=function(e){var t=_.invert(Panopto.Core.ServiceInterface.Objects.TaskState)[e.state],o="SessionList_"+e.taskName+"_"+t+"_Status",a=(Panopto.GlobalResources[o]||Panopto.GlobalResources.SessionList_MissingStatusString).format(void 0,e.sourceFilename);if(e.subState){var n="SubStatus_"+Panopto.Core.ServiceInterface.Objects.ServiceTaskResourceMapping(e),r=Panopto.GlobalResources[n]||Panopto.GlobalResources.SubStatus_MissingStatusString;a+=Panopto.GlobalResources.SubStatus_SentenceSeparator+r}return a},e}(),o.StreamUploader=a}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();!function(e){var s;(function(e){var p="StreamUploader_StartUpload",t=function(i){function e(e,t,o,n){var s=this;console.log("Using debug StreamUploader.");var r=new u(t,o),a=new l;return(s=i.call(this,e,t,r,a)||this).mockSessionUploadManagement=r,document.addEventListener(p,function(e){if(e instanceof CustomEvent){var t=e.detail.streamType,o=new Date;s.startUpload({name:"FakeFile.wmv",size:1e7},t,o)}}),s}return __extends(e,i),e}(e.StreamUploader);e.StreamUploaderDebug=t;var o=function(){function e(e){this.sessionsService=e,this.streams=[]}return e.prototype.getAllStreams=function(e,t,o){var n=this;console.log("MockSessions.getAllStreams ("+this.streams.length+")"),0<this.streams.length?setTimeout(function(){t(n.streams)},0):this.sessionsService.getAllStreams(e,t,o)},e.prototype.addMockStream=function(e){console.log("MockSessions.addMockStream");var t=_.uniqueId("mockStream"),o=1e7*Panopto.Core.TimeHelpers.currentWin32EpochTime,n=Panopto.Core.ServiceInterface.Rest.Objects.Stream({AbsoluteStart:o,Duration:3e8,HttpUrl:"",Id:t,IsPrimary:1===e.StreamType,Name:e.UserFilename,ThumbnailInterval:3e8,ThumbnailUrlBase:"",Type:3,TypeName:"Stream",Url:"",VRType:0});this.streams.push(n)},e}();e.MockSessions=o;var u=function(){function e(e,t){this.sessionsService=e,this.sessionUploadManagementService=t,this.pendingUploads=[]}return e.prototype.setHost=function(e){this.sessionUploadManagementService.setHost(e)},e.prototype.getUploads=function(e,t,o){var n=this;0<this.pendingUploads.length?setTimeout(function(){t({ProcessingUploads:_.filter(n.pendingUploads,function(e){return e.State!==Panopto.Core.UploadStatus.Complete})})},0):this.sessionUploadManagementService.getUploads(e,t,o)},e.prototype.getUpload=function(t,o,e){var n=!1;_.each(this.pendingUploads,function(e){e.ID===t&&(n=!0,setTimeout(function(){o(e)},0))}),n||this.sessionUploadManagementService.getUpload(t,o,e)},e.prototype.openUpload=function(e,t,o){var n=this,s={ID:_.uniqueId("pendingUpload"),SessionID:e.sessionId,State:void 0,StreamStartTime:e.startTime,StreamType:e.streamType,UploadTarget:void 0,UserFilename:e.filename};return this.pendingUploads.push(s),setTimeout(function(){t(s)},0),setTimeout(function(){s.State=Panopto.Core.UploadStatus.Complete,n.sessionsService.addMockStream&&n.sessionsService.addMockStream(s)},2e3),new Panopto.Core.CancellableRequest},e.prototype.deleteUpload=function(e,t,o){setTimeout(function(){t()},0)},e.prototype.closeUpload=function(e,t,o){setTimeout(function(){t()},0)},e}(),l=function(){function e(){this.uploadQueue=0}return e.prototype.isRunning=function(){return 0<this.uploadQueue},e.prototype.queueUpload=function(e,t,o,n){var s=this,r=0,a=setInterval(function(){t(1e6*++r)},100);setTimeout(function(){clearInterval(a),o(e.fileId),s.uploadQueue--},1e3)},e.prototype.upload=function(){$.noop()},e.prototype.cancelUpload=function(e){$.noop()},e}(),n=function(n){function e(e,t){var o=n.call(this)||this;return o.streamType=e,o.neverFinish=t,o}return __extends(e,n),e.prototype.typeArg=function(){return p},e}(s.DebugEventModel);e.StreamUploaderStartUpload=n})((s=e.Viewer||(e.Viewer={})).Controls||(s.Controls={}))}(PanoptoTS||(PanoptoTS={}));

var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.ThumbnailStrip=function(s,p,d,h,m){var c,o,P=Panopto.Viewer.Constants,b=Panopto.Viewer.Analytics,f=Panopto.Core.UI.Components.scrollingHighlight(s,!1,P.ThumbnailScrollTimeout),n=function(t){var e,o=c,a=[],n=0,r=Panopto.cacheRoot+"/Images/no_thumbnail.svg",u=function(){n++,t&&n===a.length&&t()};c=_.map(p,function(t){var n=h?t.editorTime:t.time;return t.id=t.id||_.uniqueId(),{time:n,timestamp:Panopto.Core.TimeHelpers.formatDuration(n,Panopto.GlobalResources.TimeSeparator),id:"thumbnail"+t.id+s.attr("id"),thumbnailId:t.id,src:t.queryParams?Panopto.Core.StringHelpers.addQueryParameter(P.ThumbUrl,t.queryParams):t.thumbnailUrl||r,tabId:t.tabId||(t.type===Panopto.Core.EventTargetType.PowerPoint?Panopto.Viewer.Constants.SlideDeckId:t.streamId),isSlide:t.isSlide,editable:!!h}}),e=_.filter(o,function(n){return!_.find(c,function(t){return n.thumbnailId===t.thumbnailId})}),_.each(c,function(n){var t=_.find(o,function(t){return n.thumbnailId===t.thumbnailId});t?t.time!==n.time&&(a.push(n),e.push(t)):a.push(n)}),_.each(e,function(t){$("#"+t.id).remove()});var i=_.template($("#thumbnailTemplate").html());_.each(c,function(t,n){if(0<=a.indexOf(t)){var e=i({thumbnails:[t]});0===n?s.prepend(e):n===c.length-1?s.append(e):$("#"+c[n-1].id).after(e)}});var l=[];_.each(a,function(n){var e=$("#"+n.id),o=e.find(".thumbnail-buttons"),t=o.find(".thumbnail-edit"),a=o.find(".thumbnail-delete"),i=e.find("img");_.each(i,function(t){l.push(t)}),i.on("load",function(){e.show(),u()}).on("error",function(t){$(t.currentTarget).attr("src")!==r?$(t.currentTarget).attr("src",r):(e.width(e.height()),e.show(),u())}),Panopto.Core.UI.Handlers.button(e,function(t){d.userSeekEnabled()&&f.highlight(n,function(t){d.setPosition(t.time),t.tabId&&d.selectSecondaryTab(t.tabId,t.isSlide),b.sendEvent({action:b.Actions.Navigate,label:b.Labels.Thumbnail})})}),h&&(m?o.show():Panopto.Core.UI.Handlers.hoverableParent(e,o,function(t){o.toggle(t)}),Panopto.Core.UI.Handlers.button(t,function(){h.openEventDialog(n.thumbnailId)}),Panopto.Core.UI.Handlers.button(a,function(){h.removeEvent(n.thumbnailId)}))}),Panopto.Core.ImageHelpers.queueLoad($(l),8)};return{render:n,position:function(n,t){var e;n!==o&&(_.each(c,function(t){t.time<=n&&(e=t)}),f.highlight(e,!1,t),o=n)},toggle:function(t){s.toggle(t&&0<c.length)},thumbnails:function(t){if(!t)return p;p=t,n()}}};
var PanoptoTS;!function(t){var e,i,n;e=t.Viewer||(t.Viewer={}),i=e.Controls||(e.Controls={}),n=function(){function t(t,e,i){this.template=_.template('\n<div class="waiting-room-wrapper">\n    <p class="title"><@- title @></p>\n\n    <@ if (thumbnailUrl) { @>\n        <img class="thumbnail-img" src="<@- thumbnailUrl @>"/>\n    <@ } @>\n\n    <p class="description"><@= description @></p>\n    <p><@- Panopto.GlobalResources.ViewerPlus_BroadcastNotStarted @></p>\n</div>\n'),this.$element=t,this.delivery=e,this.thumbnailUrl=i}return t.prototype.render=function(){var t=Panopto.Core.TextHelpers.displayLineBreaks(_.escape(this.delivery.description)),e={title:this.delivery.title,description:t,thumbnailUrl:this.thumbnailUrl};this.$element.html(this.template(e))},t.prototype.remove=function(){this.$element.empty()},t}(),i.WaitingRoom=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;Panopto.Viewer.Players=Panopto.Viewer.Players||{},function(v){var u,e,t;u=v.Viewer||(v.Viewer={}),e=u.Data||(u.Data={}),t=function(){function e(e){var t=Panopto.Viewer.Data,r=Panopto.Viewer.Constants,i=e.Delivery.SessionName,n=Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(e.Delivery.SessionStartTime),a=e.Delivery.IsActiveBroadcast,s=e.Delivery.IsBroadcast&&e.Delivery.IsViewerEncodeComplete&&(new Date).getTime()-n.getTime()<=r.RecentBroadcastThreshold,o=this.parseStreams(e.Delivery.Streams,i,a),l=o.primaryStreams,c=o.secondaryStreams,u=o.activePrimary,d=o.screenCaptureStream,y=this.parsePlayerInfo(l,u,a),p=y.multiBitrateEnabled,v=y.playSpeedEnabled,h=y.flowPlayerEnabled,m=y.requiresSilverlight,D=this.parseEvents(e.Delivery.Timestamps,e.Delivery.EventTargets,e.Delivery.PublicNotesStreams,e.Delivery.Duration,d),f=D.slides,P=D.documents,w=D.thumbnails,b=D.contents,S=D.channels;this.title=i,this.id=e.Delivery.PublicID,this.date=n,this.duration=e.Delivery.Duration,this.description=e.Delivery.SessionAbstract,this.ownerId=e.Delivery.OwnerId,this.ownerIsOverQuota=e.Delivery.OwnerIsOverQuota,this.invocationId=e.InvocationId,this.embedUrl=e.EmbedUrl,this.downloadUrl=e.DownloadUrl,this.podcastCompleted=e.PodcastCompleted,this.broadcastRefreshInterval=1e3*e.BroadcastRefreshInterval,this.allowPublicNotes=e.AllowPublicNotes,this.hasCaptions=e.Delivery.HasCaptions,this.isBroadcast=a,this.isViewable=a&&u||e.Delivery.IsViewerEncodeComplete,this.isReadyForEditing=e.Delivery.IsReadyForEditing,this.isPurgedLegacyEncode=e.Delivery.IsPurgedLegacyEncode,this.requiresAdvancedEditor=e.Delivery.RequiresAdvancedEditor,this.broadcastEnded=e.Delivery.BroadcastEnded,this.broadcastInterrupted=e.Delivery.BroadcastInterrupted,this.isRecentBroadcast=s,this.isPrimaryAudioOnly=e.Delivery.IsPrimaryAudioOnly,this.requiresSilverlight=m,this.flowPlayerEnabled=h,this.multiBitrateEnabled=p,this.playSpeedEnabled=v,this.discussionEnabled=e.Delivery.DiscussionEnabled,this.discussionCacheSeconds=e.DiscussionCacheSeconds,this.lastViewingPosition=e.LastViewingPosition,this.activePrimary=u,this.primaryStreams=l,this.secondaryStreams=c,this.slideDecks=f.length?[t.SlideDeck(f)]:[],this.documents=P,this.thumbnails=w,this.captions=[],this.contents=b,this.channels=S,this.user={email:e.UserEmail,name:e.UserName,key:(e.UserKey||"").toLowerCase(),rating:e.UserRating,role:e.SessionRole,canCreateQuestionLists:e.UserCanCreateQuestionLists},this.folder={name:e.Delivery.SessionGroupLongName,description:e.Delivery.SessionGroupAbstract,id:e.Delivery.SessionGroupPublicID},this.nextDelivery=void 0,e.Delivery.NextDeliveryUrl&&(this.nextDelivery={id:e.Delivery.NextDeliveryId,url:e.Delivery.NextDeliveryUrl,title:e.Delivery.NextDeliveryTitle,description:e.Delivery.NextDeliveryDescription,duration:Panopto.Core.TimeHelpers.formatDuration(e.Delivery.NextDeliveryDuration,Panopto.GlobalResources.TimeSeparator),thumbUrl:e.Delivery.NextDeliveryThumbUrl,isLive:e.Delivery.NextDeliveryIsLive,folderName:void 0}),this.serverModel=e}return e.prototype.parseStreams=function(e,t,r){var i=_.map(_.filter(e,function(e){return"Archival"===e.StreamTypeName}),function(e){return Panopto.Viewer.Data.Stream(e,r,t)}),n=(i=_.sortBy(i,"relativeStart")).length?r?_.find(i,function(e){return!e.relativeEnd})||_.max(i,function(e){return e.relativeEnd}):i[0]:void 0,a=r?i:n?[n]:[],s=_.map(_.filter(e,function(e){return"Archival"!==e.StreamTypeName}),function(e){return Panopto.Viewer.Data.Stream(e,r,t)});return{primaryStreams:a,secondaryStreams:s,activePrimary:n,screenCaptureStream:_.find(s,function(e){return e.tabClass===u.Constants.ScreenCaptureClass})}},e.prototype.parsePlayerInfo=function(e,t,r){var i=!!t&&_.contains(["ism","wmv"],t.fileType),n=!new RegExp(Panopto.features.hlsFlashFallbackRegex).test(navigator.userAgent)&&!Panopto.Core.Browser.isWin7IE11&&_.any(flowplayer.engines,function(e){return"hlsjs"===e.engineName||"hlsjs-lite"===e.engineName}),a=Panopto.Core.Browser.supportsVideo(u.Constants.MP4MimeType),s=(!e.length||"hls"===t.fileType)&&n||(!e.length||"mp4"===t.fileType)&&a,o=Panopto.viewer.flowplayerEnabled&&!i&&s,l=!1;t&&(l="ism"===t.fileType||"hls"===t.fileType&&(o||Panopto.Core.Browser.flashEnabled()));var c=!1;return!r&&t&&(c=o||"mp4"===t.fileType&&a||"hls"===t.fileType&&t.httpUrl&&a||"wmv"===t.fileType&&!Panopto.Core.Browser.isWebkit),{multiBitrateEnabled:l,playSpeedEnabled:c,flowPlayerEnabled:o,requiresSilverlight:i}},e.prototype.parseEvents=function(e,t,r,i,n){var a=Panopto.Viewer.Data,s=_.filter(e,function(e){return(e.Time||0===e.Time)&&e.Time<=i&&e.ObjectIdentifier&&e.ObjectSequenceNumber}),o=_.filter(s,function(e){return"PowerPoint"===e.EventTargetType}),l=_.filter(s,function(e){return e.Url}),c=[];_.each(l,function(e){return c.push(new v.Viewer.Data.Document(e))}),_.each(t,function(e){return c.push(new v.Viewer.Data.Document(e))});var u=_.filter(s,function(e){return!e.Url&&_.contains(["ObjectVideo","Primary"],e.EventTargetType)}).concat(o);u.sort(function(e,t){return e.Time-t.Time});var d,y=_.map(u,function(e){return a.Thumbnail(e,n)}),p=_.chain(u.concat(l)).unique().map(function(e){return new v.Viewer.Data.Event(e)}).filter(function(e){return!!jQuery.trim(e.text)}).value();return r&&(d=_.map(r,function(e){return a.Channel(e,e,!0)})),{slides:o,documents:c,thumbnails:y,contents:p,channels:d}},e}(),e.Delivery=t}(PanoptoTS||(PanoptoTS={}));


var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Stream=function(e,n,t){var a,r=[],i=[],o=e.Name||("SCREEN"===e.Tag?Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle:Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle),l="SCREEN"===e.Tag?Panopto.Viewer.Constants.ScreenCaptureClass:Panopto.Viewer.Constants.ObjectVideoTabClass,s=function(e,t){var a=e-Panopto.Viewer.Constants.SecondaryStreamOffset;return n?e:t&&a<=t+Panopto.Viewer.Constants.MinSegmentGap?e:Math.max(0,a)};switch(e.RelativeSegments&&e.RelativeSegments.length?_.each(e.RelativeSegments,function(e,t){var a=new PanoptoTS.Viewer.Data.SecondarySegment(e),n=i[t-1];a.timelineStart=s(a.relativeStart,n?n.relativeEnd:0),i.push(a),r.push(a.timelineStart,a.relativeEnd)}):(r.push(s(e.RelativeStart,void 0)),e.RelativeEnd&&r.push(e.RelativeEnd)),(a=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(o,e.PublicID,l,r,e.AbsoluteStart,"","",!1,!1,!1,n,!1)).url=e.StreamUrl,a.httpUrl=e.StreamHttpUrl,a.fileType=e.ViewerMediaFileTypeName,a.relativeStart=e.RelativeStart,a.relativeEnd=e.RelativeEnd,a.length=e.RelativeEnd?e.RelativeEnd-e.RelativeStart:0,a.segments=i,a.interrupted=e.Interrupted,a.editFileType=e.EditMediaFileTypeName,a.deliveryTitle=t,a.broadcastSegmentDuration=e.BroadcastSegmentDuration,a.vrType=e.VRType,e.Tag){case"AUDIO":a.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,a.isAudioOnly=!0;break;case"SCREEN":a.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen,a.isAudioOnly=!1;break;default:a.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera,a.isAudioOnly=!1}return a.optimizationToken=e.OptimizationToken,a};
var PanoptoTS;!function(t){var a,e;a=t.Viewer||(t.Viewer={}),e=function(t){this.relativeStart=t.RelativeStart,this.relativeEnd=t.End?t.RelativeStart+(t.End-t.Start):1/0,this.streamOffset=t.Start},(a.Data||(a.Data={})).SecondarySegment=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,r,a;t=e.Viewer||(e.Viewer={}),r=t.Data||(t.Data={}),a=function(){function r(){}return r.prototype.getStreamFriendlyType=function(){var e;switch(this.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:e=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:e=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:e=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return e},r.prototype.getStreamName=function(){return this.name||this.getStreamFriendlyType()},r.convertFromApiModel=function(e){var t=new r;return t.id=e.id,t.url=e.url,t.httpUrl=e.httpUrl,t.absoluteStart=e.absoluteStart,t.duration=e.duration,t.thumbnailUrlBase=e.thumbnailUrlBase,t.thumbnailInterval=e.thumbnailInterval,t.type=e.type,t.vrType=e.vrType,t.name=e.name,t.iconCode=e.iconCode,t.absoluteEnd=e.absoluteEnd(),t.streamType=e.isPrimary?1:2,t},r}(),r.Stream=a}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(n){var t,i,e;t=n.Viewer||(n.Viewer={}),i=t.Logic||(t.Logic={}),e=function(){function n(){}return n.getBlockingContent=function(n,i){return _.find(n,function(n){var t=n.timeline[0];return n.isSessionPlaybackBlocking&&t<=i})},n.getPausingContent=function(n,i,e){return _.find(n,function(n){var t=n.timeline[0];return n.pauseWhenAvailable&&i<t&&t<=e})},n}(),i.ContentLogic=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(a){var e,r,t;e=a.Viewer||(a.Viewer={}),r=e.Logic||(e.Logic={}),t=function(){function e(e){var t=this;this.config=e,this.FlowplayerFactory={create:function(e,r){return PanoptoLegacy.Viewer.Players.FlowPlayer(e,r,t.config.playerHelpers)}},this.FlowplayerMachineFactory={create:function(e,r){return Panopto.viewer.isHiveEnabled?new a.Viewer.Players.HiveFlowplayerMachine(e,r,t.config.playerHelpers):new a.Viewer.Players.FlowplayerMachine(e,r,t.config.playerHelpers)}},this.SilverlightFactory={create:function(e,r){return Panopto.Viewer.Players.SilverlightPlayer(e,r)}},this.VideoJsFactory={create:function(e,r){return PanoptoLegacy.Viewer.Players.VideoJsPlayer(e,r,t.config.playerHelpers)}}}return e.prototype.getPlayerFactory=function(e){return e.requiresSilverlight?this.SilverlightFactory:e.flowPlayerEnabled?this.useStateMachinePlayer(e)?this.FlowplayerMachineFactory:this.FlowplayerFactory:this.VideoJsFactory},e.prototype.useStateMachinePlayer=function(e){return void 0!==this.config.forceUseStateMachine?this.config.forceUseStateMachine:e.isBroadcast&&this.config.useStateMachineBroadcast||!e.isBroadcast&&this.config.useStateMachineOnDemand},e}(),r.DefaultPlayerSelectionLogic=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(T){var e,t,i;e=T.Viewer||(T.Viewer={}),t=e.Logic||(e.Logic={}),i=function(){function e(e,t,i,a,s){this.delivery=e,this.viewer=t,this.editor=i,this.sessionsService=a,this.clientParams=s}return e.prototype.createTabs=function(e,t,i){var a,s,r,o=T.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,e,t,i),d=[];d.push(PanoptoLegacy.Viewer.Tabs.Editor.EditContentsTab($("#editContentsTabHeader"),$("#editContentsTabPane"),o,this.editor,this.delivery.user.canCreateQuestionLists,this.editor.eventService,this.editor.timeConverter)),d.push(PanoptoLegacy.Viewer.Tabs.Editor.EditTranscriptTab($("#editTranscriptTabHeader"),$("#editTranscriptTabPane"),o,this.editor,this.editor.timeConverter)),window.slidesTab?(window.slidesTab.setTimelineEditor(this.editor),window.slidesTab.setReadyStreamUploader()):window.slidesTab=PanoptoLegacy.Viewer.Tabs.Editor.EditSlidesTab($("#editSlidesTabHeader"),$("#editSlidesTabPane"),o,this.editor,this.clientParams,window.slideUploader,this.editor.timeConverter),d.push(window.slidesTab),s=PanoptoLegacy.Viewer.Tabs.Editor.EditCutTab($("#editCutTabHeader"),$("#editCutTabPane"),o,this.editor),window.streamTab?(window.streamTab.setTimelineEditor(this.editor),window.streamTab.setReadyStreamUploader()):(window.streamTab=PanoptoLegacy.Viewer.Tabs.Editor.EditStreamTab($("#editStreamTabHeader"),$("#editStreamTabPane"),o,this.editor,this.clientParams,window.streamUploader,this.sessionsService,this.editor.timeConverter),window.streamTab.setTimelineEditor(this.editor)),a=window.streamTab;var n=d.slice();return n.push(s),n.push(a),this.delivery.user.canCreateQuestionLists&&(r=PanoptoLegacy.Viewer.Tabs.Editor.EditQuestionListTab($("#editQuestionListTabHeader"),$("#editQuestionListTabPane"),o,this.editor,this.editor.timeConverter,this.editor.eventService),n.push(r)),{tabs:n,searchTab:void 0,commentsTab:void 0,editEventTabs:d,editStreamTab:a,editCutTab:s,editQuestionListTab:r}},e}(),t.EditorEventTabLogic=i}(PanoptoTS||(PanoptoTS={}));

var PanoptoTS;!function(s){var e,t,a;e=s.Viewer||(s.Viewer={}),t=e.Logic||(e.Logic={}),a=function(){function e(e,t){this.lastDuration=0,this.lastLevelAgeMillis=0,this.attach(e,t)}return e.prototype.getDuration=function(){var e=((this.lastLevelLoadTime?(new Date).getTime()-this.lastLevelLoadTime:0)+this.lastLevelAgeMillis)/1e3;return this.lastDuration+e},e.prototype.attach=function(e,t){var i=this;if(Panopto.viewer.isHiveEnabled||e.engine.hlsjs?e.on("hlsLevelLoaded",function(e,t,a){return i.updateDuration(a)}):e.engine.hls&&e.engine.hls.on("hlsLevelLoaded",function(e,t){return i.updateDuration(t)}),t){var a=e.engine.hlsjs||e.engine.hls;this.attachXhrSetup(e.conf.hlsjs),a&&this.attachXhrSetup(a.config)}},e.prototype.attachXhrSetup=function(e){var i=this,n=e.xhrSetup;e.xhrSetup=function(e,t){if(_.any(s.Viewer.Constants.HlsLevelFileNames,function(e){return 0<=t.indexOf(e)})){var a=i;e.addEventListener("load",function(e){a.updateLevelAge(this)}),n&&n(e,t)}}},e.prototype.updateLevelAge=function(e){var t=e.getResponseHeader(s.Viewer.Constants.HttpHeaders.Date),a=e.getResponseHeader(s.Viewer.Constants.HttpHeaders.LastModified);if(t&&a){var i=Date.parse(t),n=Date.parse(a);isNaN(i)||isNaN(n)||(this.lastLevelAgeMillis=i-n)}},e.prototype.updateDuration=function(e){this.lastLevelLoadTime=(new Date).getTime(),this.lastDuration=e.details.totalduration},e}(),t.HlsJsWebcastDurationEstimator=a}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var e,t,i;e=o.Viewer||(o.Viewer={}),t=e.Logic||(e.Logic={}),i=function(){function e(){}return e.getBitrate=function(e){var t=Panopto.Core.CookieHelpers.getUserCookieField(Panopto.user.userKey,e?o.Viewer.Constants.BitrateCookie:o.Viewer.Constants.MBRBitrateCookie);return null!==t?parseInt(t,10):e?Panopto.viewer.defaultSSFBitrate:Panopto.viewer.defaultMBRBitrate},e}(),t.InitialStateLogic=i}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var e,i,t;e=o.Viewer||(o.Viewer={}),i=e.Logic||(e.Logic={}),t=function(){function e(e,i){this.delivery=e,this.viewer=i}return e.prototype.createTabs=function(e,i,t){var a=o.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,e,i,t),r=[];return r.push(PanoptoLegacy.Viewer.Tabs.NotesTab($("#notesTabHeader"),$("#notesTabPane"),a,this.delivery.id,this.delivery.user,this.delivery.channels,this.delivery.allowPublicNotes,!0,this.delivery.isBroadcast)),{tabs:r,searchTab:void 0,commentsTab:void 0}},e}(),i.LiveNotesEventTabLogic=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(n){var r,o,a,t,i;r=n.Viewer||(n.Viewer={}),o=r.Logic||(r.Logic={}),a=Panopto.Viewer.PlayState,t=Panopto.Core.ViewerLogEntryType,i=function(){function n(n,o,i){this.viewer=n,this.playControls=o,this.primaryPlayer=i}return n.prototype.synchronizePlayPositions=function(n,o){if(void 0===this.synchronizingSecondaryTabControls){var i=this.getPositionDifferences(n,o),t=r.Constants.SecondarySyncThreshold*this.playControls.playSpeed();i.range>t&&this.beginSynchronization(o,i)}},n.prototype.stopSynchronization=function(){var n=!!this.synchronizingInterval;return this.synchronizingInterval&&(clearInterval(this.synchronizingInterval),this.synchronizingInterval=void 0,this.synchronizingSecondaryTabControls=void 0),n},n.prototype.getPositionDifferences=function(i,n){var t=0,e=0;return{list:_.map(n,function(n){var o=n.selectedTab()?n.selectedTab().setPosition(i,!1,void 0,$.noop):0;return t<o&&(t=o),o<e&&(e=o),o}),max:t,min:e,range:t-e}},n.prototype.beginSynchronization=function(n,o){var i=this;this.viewer.logDesync(o.range),this.viewer.writeLineToClientLog(t.StreamDesync,[o.range]),this.synchronizingSecondaryTabControls=n,this.runSynchronization(n,o),this.synchronizingInterval=setInterval(function(){i.synchronizingSecondaryTabControls?i.runSynchronization(i.synchronizingSecondaryTabControls,i.getPositionDifferences(i.viewer.position(),i.synchronizingSecondaryTabControls)):i.stopSynchronization()},r.Constants.SecondarySynchronizingUpdateRateMillis)},n.prototype.runSynchronization=function(n,i){var t,e=i.range>r.Constants.SecondarySyncTargetSeconds?r.Constants.SecondarySynchronizingUpdateRateMillis/1e3:r.Constants.SecondarySyncTargetSeconds;_.each(n,function(n,o){n.selectedTab()&&(t=i.max-i.list[o]>e?a.Paused:a.Playing,n.selectedTab().playState(t))}),t=i.max>e?a.Paused:a.Playing,this.primaryPlayer.playState(t),i.range<=r.Constants.SecondarySyncTargetSeconds&&this.stopSynchronization()},n}(),o.MultipleSecondaryPositionSynchronization=i}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var i,c,o,l,a,s,t;i=e.Viewer||(e.Viewer={}),c=i.Logic||(i.Logic={}),o=Panopto.Viewer.Constants,l=Panopto.Viewer.PlayState,a=Panopto.Viewer.ViewMode,s=Panopto.Core.ViewerLogEntryType,t=function(){function e(e,i,t,n){this.viewer=e,this.primaryPlayer=t,this.secondaryContentContainers=n,this.wasPrimaryFullscreen=!1,this.wasBackgrounded=!1,this.defaultTabMap={},this.positionSynchronization=new c.MultipleSecondaryPositionSynchronization(e,i,t)}return e.prototype.synchronize=function(i,e,t,n){this.logSynchronize(t),t&&this.clearSyncTimeout();var r,o=!1,a=_.map(this.secondaryContentContainers,function(e){return e.getTabControl()}),s=a[0].getTabs(),c=_.filter(s,function(e){return e.available(i)});return n||(r=this.getBlockingPosition(i,e,t,s)),_.isNumber(r)&&r!==i?(this.viewer.setPlayState(l.Paused,!1,!1),this.viewer.setPosition(r)):(this.checkAllSecondaryTabs(i,t,n,c,s,a),o=!0),this.wasPrimaryFullscreen=this.primaryPlayer.isFullscreen(),this.wasBackgrounded="hidden"===document.visibilityState,o},e.prototype.clearSyncTimeout=function(){this.positionSynchronization.stopSynchronization()},e.prototype.logSynchronize=function(e){var i=this.primaryPlayer.activePrimary();i&&(e&&this.viewer.writeLineToClientLog(s.UserInitiatedSync,[i.id]),this.previousPrimaryId!==i.id&&(this.previousPrimaryId=i.id,this.viewer.writeLineToClientLog(s.StreamChange,["Primary",i.id])),this.wasPrimaryFullscreen!==this.primaryPlayer.isFullscreen()&&this.viewer.writeLineToClientLog(s.FullscreenChange,["Primary",this.primaryPlayer.isFullscreen()]))},e.prototype.synchronizeSecondaryTabs=function(i,e,t){var n=this;e||this.wasPrimaryFullscreen&&!this.primaryPlayer.isFullscreen()||this.wasBackgrounded&&"hidden"!==document.visibilityState?(this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),e),_.each(t,function(e){e.selectedTab()&&e.selectedTab().setPosition(i,!0,void 0,function(){e.selectedTab()&&e.selectedTab().playState(n.viewer.playState())})})):this.primaryPlayer.isFullscreen()||"hidden"===document.visibilityState?this.positionSynchronization.stopSynchronization()&&this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),e):this.viewer.playState()===l.Playing&&this.positionSynchronization.synchronizePlayPositions(i,t)},e.prototype.getSecondaryTabControlPriorities=function(e,n,r){var o=this;return _.chain(e).map(function(e,i){var t=o.getSelectedTabPriority(e,n,r);return{selectedPriority:t,selectedPriorityCombined:void 0!==t?t:i-r.length,secondaryTabControl:e}}).sortBy(function(e){return e.selectedPriorityCombined}).value()},e.prototype.getUnusedAvailableTabs=function(e,i){var t=_.chain(i).filter(function(e){return!!e.selectedTab()}).map(function(e){return e.selectedTab().id()}).value();return _.reject(e,function(e){return 0<=t.indexOf(e.id())})},e.prototype.checkAllSecondaryTabs=function(s,c,l,d,e,i){var y=this,t=this.getSecondaryTabControlPriorities(i,s,d),h=this.getUnusedAvailableTabs(d,i),u=!1,p=h.pop();_.each(t,function(e){var i=e.secondaryTabControl,t=void 0!==e.selectedPriority;if(p){var n=y.getTabPriority(p,d),r=i.getIndex(),o=!!t&&i.selectedTab().id()===y.defaultTabMap[r];if(!t||o&&n>e.selectedPriority){var a=_.find(i.getTabs(),function(e){return e.id()===p.id()});y.setSecondaryTab(i,s,a),y.defaultTabMap[r]=p.id(),p=h.pop(),u=!0}else o||(y.defaultTabMap[r]=void 0)}else t||y.clearSecondaryTab(i,s,c,l)&&(u=!0)});var n=0!==d.length,r=n,o=this.viewer.hasPendingSecondaryUploads();r||(r=this.shouldShowInitialSecondaries(s,l,e)||o),r?(this.viewer.viewMode(a.Secondary),!n&&o&&this.viewer.toggleSecondaryPlaceholder(!0),this.synchronizeSecondaryTabs(s,c,i),u&&this.viewer.resize()):(this.viewer.ensureSecondaryIsMinimized(),this.viewer.viewMode(a.Primary))},e.prototype.setSecondaryTab=function(e,i,t){this.viewer.writeLineToClientLog(s.StreamChange,["Secondary_"+e.getIndex(),t.id()]),e.selectSecondaryTab(t,!1),t.pauseWhenAvailable()&&(this.viewer.setPlayState(l.Paused,!1,!1),this.viewer.setFullscreenPlayer(void 0)),e.updateSecondaryTabEnabledState(!t.hiddenTab(),i),this.viewer.toggleSecondaryPlaceholder(!1)},e.prototype.getSelectedTabPriority=function(e,i,t){var n,r=e.selectedTab();return r&&r.available(i)&&(n=this.getTabPriority(r,t)),n},e.prototype.getTabPriority=function(i,e){var t=_.findIndex(e,function(e){return e.id()===i.id()});return 0<=t?t:void 0},e.prototype.clearSecondaryTab=function(e,i,t,n){var r=void 0!==e.selectedTab();return e.selectSecondaryTab(void 0,t),e.updateSecondaryTabEnabledState(!0,i),r&&this.viewer.writeLineToClientLog(s.StreamChange,["Secondary_"+e.getIndex(),"null"]),r},e.prototype.getBlockingPosition=function(e,i,t,n){var r,o=_.map(n,function(e){return e.content()}),a=c.ContentLogic.getBlockingContent(o,e);if(a)r=a.timeline[0];else if(!t){var s=c.ContentLogic.getPausingContent(o,i,e);s&&(r=s.timeline[0])}return r},e.prototype.shouldShowInitialSecondaries=function(i,e,t){var n=[];_.each(t,function(e){n=n.concat(e.timeline())}),n.sort(function(e,i){return e-i});var r=_.find(n,function(e){return i<e});return!e&&r<o.InitialSecondaryThreshold&&n.length&&n[0]<o.InitialSecondaryThreshold},e}(),c.MultipleSecondarySynchronizationLogic=t}(PanoptoTS||(PanoptoTS={}));



var PanoptoTS;!function(n){var i,o,e;i=n.Viewer||(n.Viewer={}),o=i.Logic||(i.Logic={}),e=function(){function n(){}return n.isOnTimeline=function(n,i){var o=_.filter(n,function(n){return n<=i});return Boolean(o.length%2)},n}(),o.TimelineLogic=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var i,y,c,h,s,d,t;i=e.Viewer||(e.Viewer={}),y=i.Logic||(i.Logic={}),c=Panopto.Viewer.Constants,h=Panopto.Viewer.PlayState,s=Panopto.Viewer.ViewMode,d=Panopto.Core.ViewerLogEntryType,t=function(){function e(e,i,t,r){this.wasPrimaryFullscreen=!1,this.wasBackgrounded=!1,this.viewer=e,this.playControls=i,this.primaryPlayer=t,this.secondaryTabControl=r}return e.prototype.synchronize=function(i,e,t,r){this.logSynchronize(t),t&&this.clearSyncTimeout();var n,a=!1,o=this.secondaryTabControl.getTabs(),s=_.chain(o).filter(function(e){return e.available(i)}).last().value();return r||(n=this.getBlockingPosition(i,e,t,s,o)),_.isNumber(n)&&n!==i?(this.viewer.setPlayState(h.Paused,!1,!1),this.viewer.setPosition(n)):(s?(this.setSecondaryTab(i,s,o),this.synchronizeSecondaryTab(i,t,this.secondaryTabControl.selectedTab())):this.clearSecondaryTab(i,t,r,o),this.previousDefaultSecondary=s,a=!0),this.wasPrimaryFullscreen=this.primaryPlayer.isFullscreen(),this.wasBackgrounded="hidden"===document.visibilityState,a},e.prototype.clearSyncTimeout=function(){window.clearTimeout(this.synchronizeTimeout),this.synchronizeTimeout=void 0},e.prototype.logSynchronize=function(e){var i=this.primaryPlayer.activePrimary();i&&(e&&this.viewer.writeLineToClientLog(d.UserInitiatedSync,[i.id]),this.previousPrimaryId!==i.id&&(this.previousPrimaryId=i.id,this.viewer.writeLineToClientLog(d.StreamChange,["Primary",i.id])),this.wasPrimaryFullscreen!==this.primaryPlayer.isFullscreen()&&this.viewer.writeLineToClientLog(d.FullscreenChange,["Primary",this.primaryPlayer.isFullscreen()]))},e.prototype.synchronizeSecondaryTab=function(e,i,t){var r,n,a,o=this,s=0;if(i||this.wasPrimaryFullscreen&&!this.primaryPlayer.isFullscreen()||this.wasBackgrounded&&"hidden"!==document.visibilityState)this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),i),t.setPosition(e,!0,void 0,function(){return t.playState(o.viewer.playState())});else if(this.primaryPlayer.isFullscreen()||"hidden"===document.visibilityState){var l=!!this.synchronizeTimeout;this.clearSyncTimeout(),l&&this.primaryPlayer.setPlayStateWithLogging(this.viewer.playState(),i)}else this.viewer.playState()===h.Playing&&((r=(s=t.setPosition(e,!1,void 0,$.noop))?Math.abs(s):0)>c.SecondarySyncThreshold*this.playControls.playSpeed()?(n=0<s?this.primaryPlayer:t,a=0<s?t:this.primaryPlayer,this.synchronizeTimeout||(this.viewer.logDesync(s),this.viewer.writeLineToClientLog(d.StreamDesync,[s])),n.playState(h.Paused),a.playState(h.Playing),this.clearSyncTimeout(),this.synchronizeTimeout=setTimeout(function(){n.playState(h.Playing),o.clearSyncTimeout()},1e3*r/this.playControls.playSpeed())):this.viewer.writeLineToClientLog(d.StreamSync,[s]))},e.prototype.setSecondaryTab=function(e,i,t){var r=!1,n=this.secondaryTabControl.selectedTab();n&&!n.available(e)&&(n.setSelected(!1,!1),r=!0),this.viewer.viewMode(s.Secondary),(r=r||!this.previousDefaultSecondary||_.indexOf(t,i)>_.indexOf(t,this.previousDefaultSecondary))&&(this.secondaryTabControl.selectSecondaryTab(i,!1),this.viewer.resize()),r&&i.pauseWhenAvailable()&&(this.viewer.setPlayState(h.Paused,!1,!1),this.viewer.setFullscreenPlayer(void 0)),this.secondaryTabControl.updateSecondaryTabEnabledState(!i.hiddenTab(),e),this.viewer.toggleSecondaryPlaceholder(!1)},e.prototype.clearSecondaryTab=function(e,i,t,r){this.secondaryTabControl.selectSecondaryTab(void 0,!1),this.viewer.ensureSecondaryIsMinimized();var n=this.shouldShowInitialSecondaries(e,t,r),a=this.viewer.hasPendingSecondaryUploads(),o=n||a;this.viewer.viewMode(o?s.Secondary:s.Primary),a&&this.viewer.toggleSecondaryPlaceholder(!0),this.secondaryTabControl.selectSecondaryTab(void 0,i),this.secondaryTabControl.updateSecondaryTabEnabledState(!0,e),this.previousDefaultSecondary&&this.viewer.writeLineToClientLog(d.StreamChange,["Secondary","null"])},e.prototype.getBlockingPosition=function(e,i,t,r,n){var a,o=_.map(n,function(e){return e.content()}),s=y.ContentLogic.getBlockingContent(o,e);if(s)a=s.timeline[0];else if(!t){var l=y.ContentLogic.getPausingContent(o,i,e),c=r&&r.content();l&&l!==c&&(a=l.timeline[0])}return a},e.prototype.shouldShowInitialSecondaries=function(i,e,t){var r=[];_.each(t,function(e){r=r.concat(e.timeline())}),r.sort(function(e,i){return e-i});var n=_.find(r,function(e){return i<e});return!e&&n<c.InitialSecondaryThreshold&&r.length&&r[0]<c.InitialSecondaryThreshold},e}(),y.TwoPlayerSynchronizationLogic=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(n){var e,i,s;e=n.Viewer||(n.Viewer={}),i=e.Logic||(e.Logic={}),s=function(){function e(e,i,s){this.delivery=e,this.viewer=i,this.inviteTokenId=s}return e.prototype.createTabs=function(e,i,s){var a,t,r=n.Viewer.Tabs.ViewerEventTabHelpers.create(this.viewer,e,i,s),o=[];return this.delivery.isBroadcast||(a=PanoptoLegacy.Viewer.Tabs.SearchTab($("#searchTabHeader"),$("#searchTabPane"),r,this.delivery.id,this.delivery.user,this.inviteTokenId),o.push(a)),(this.delivery.contents.length||this.delivery.description)&&o.push(PanoptoLegacy.Viewer.Tabs.ContentsTab($("#contentsTabHeader"),$("#contentsTabPane"),r,this.delivery.id,this.delivery.contents,this.delivery.description)),this.delivery.hasCaptions&&o.push(PanoptoLegacy.Viewer.Tabs.TranscriptTab($("#transcriptTabHeader"),$("#transcriptTabPane"),r,this.delivery,this.inviteTokenId)),Panopto.features.areSocialFeaturesEnabled&&this.delivery.discussionEnabled&&(t=PanoptoLegacy.Viewer.Tabs.CommentsTab($("#commentsTabHeader"),$("#commentsTabPane"),r,this.delivery.id,this.delivery.user,this.delivery.isBroadcast,this.delivery.discussionCacheSeconds)),t&&Panopto.viewer.displayViewerDiscussionAboveNotes&&(o.push(t),$("#notesTabHeader").before($("#commentsTabHeader"))),this.delivery.user.key&&o.push(PanoptoLegacy.Viewer.Tabs.NotesTab($("#notesTabHeader"),$("#notesTabPane"),r,this.delivery.id,this.delivery.user,this.delivery.channels,this.delivery.allowPublicNotes,!1,this.delivery.isBroadcast)),this.delivery.user.key&&o.push(PanoptoLegacy.Viewer.Tabs.BookmarksTab($("#bookmarksTabHeader"),$("#bookmarksTabPane"),r,this.delivery.id,this.delivery.user,this.delivery.isBroadcast)),t&&!Panopto.viewer.displayViewerDiscussionAboveNotes&&o.push(t),{tabs:o,searchTab:a,commentsTab:t}},e}(),i.ViewerEventTabLogic=s}(PanoptoTS||(PanoptoTS={}));



var PanoptoTS;!function(e){var o,t,n,l;o=e.Viewer||(e.Viewer={}),t=o.Players||(o.Players={}),n=e.Models.VoidCallback,l=function(){function t(){var e=this;this._onClick=new n,this._onShowOverlay=new n,this.element=$(t.template),this.playerLayoutControlsElement=this.element.find(".player-layout-controls"),this.showOverlayElement=this.element.find(".show-overlay-button"),this.playerLayoutControlsElement.hide(),Panopto.Core.UI.Handlers.button(this.element,function(){e._onClick.fire()}),Panopto.Core.UI.Handlers.hoverable(this.element,function(){e.playerLayoutControlsElement.show(),e.setAutoHideTimeout()}),Panopto.Core.UI.Handlers.button(this.showOverlayElement,function(){e._onShowOverlay.fire()})}return Object.defineProperty(t.prototype,"onClick",{get:function(){return this._onClick},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onShowOverlay",{get:function(){return this._onShowOverlay},enumerable:!0,configurable:!0}),t.prototype.getElement=function(){return this.element},t.prototype.toggle=function(e){var t=e.showOrHide,o=e.allowShowOverlayButton;this.element.toggle(t),this.showOverlayElement.toggle(o)},t.prototype.setAutoHideTimeout=function(){var e=this;clearTimeout(this.autoHideTimeout),this.autoHideTimeout=window.setTimeout(function(){e.playerLayoutControlsElement.is(":hover")||e.playerLayoutControlsElement.hide()},1e3*o.Constants.FullScreenControlInterval)},t.template='\n        <div class="audio-only-primary-player-overlay">\n            <div class="player-layout-controls">\n                <div class="show-overlay-button"><i class="material-icons">&#xE145;</i></div>\n            </div>\n            <i class="audio-only-icon material-icons">volume_up</i>\n        </div>',t}(),t.AudioOnlyOverlay=l}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},PanoptoLegacy.Viewer.Players.DocumentPlayer=function(n,o,a){var r,i,e,t=function(){i.show(),o.isPdf&&i.addClass("plugin-screen")};return n.append(_.template($("#documentPlayerTemplate").html())(o)),r=n.find("#"+o.id),i=r.find(".document-frame"),o.isPdf?window.PluginDetect.onDetectionDone(Panopto.Viewer.Constants.PluginDetectPDFReader,function(e){e.isMinVersion(Panopto.Viewer.Constants.PluginDetectPDFReader,0)<0?r.find(".adobe-reader-install").show():(t(),i.attr("src",o.url))},Panopto.Viewer.Constants.DummyPDFUrl,!0):t(),(e=Panopto.Viewer.Players.PlayerBase(n,r)).resize=function(e,t){n.width(e),n.height(t),r.width(e-2),r.height(t-1)},e.remove=function(){r.remove()},e.toggle=function(e){var t=e?o.url:"";r.toggle(e),i.attr("src")!==t&&(i.attr("src",t),e&&-1!==o.url.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)&&new YT.Player(o.id+"frame",{events:{onStateChange:function(e){0===e.data&&a.togglePlaying()}}}))},e};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players.PlayerBase=function(u,s){var h=Panopto.Viewer.Constants;return{container:function(){return u},width:function(){return s.width()},height:function(){return s.height()},toggle:function(t){s.toggle(t)},resize:function(t,n,i,o){t=t-parseInt(u.css("border-left-width"),10)||t,n=n-parseInt(u.css("border-bottom-width"),10)||n,i=void 0!==i?i:s.width()/s.height();var e=t/n,a=t,r=n;s.add(u).css({left:"",position:""}),isNaN(i)?(a=t=Math.max(t,h.AudioOnlyMinimumWidth),o&&(0===n?u.css({left:-a+"px",position:"absolute"}):s.css({left:-a/2+"px"})),r=n=Math.max(n,h.AudioOnlyMinimumWidth)):e<=i?(a=Math.max(t,h.AudioOnlyMinimumWidth),r=Math.max(t/i,h.AudioOnlyMinimumWidth)):(r=Math.max(n,h.AudioOnlyMinimumWidth),a=Math.max(n*i,h.AudioOnlyMinimumWidth)),s.width(a),s.height(r),s.css({"margin-top":-r/2+"px","margin-left":-a/2+"px"}),u.width(t),u.height(n)},content:function(t){},setContent:function(t){},playState:function(t){},position:function(t){},setPosition:function(t){},setStartPosition:function(t){},bitrate:function(t){},playSpeed:function(t){},numericBitrate:function(){return 0},hasMBR:function(){return!1},bitrateLevelOffset:function(){return 0},remove:function(){}}};

var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.PrimaryPlayer=function(t,e,o,i,r,l){var a,d,n,s,p,c,u,P,f,S,v,y=PanoptoLegacy.Viewer.Players.StreamPlayer(t,e,o,!0,i),g=y,w=Panopto.Core.Extensions.base(y),h=0,C=!0,I=$("#kollectiveLoadingIndicator");y.onStartKollectiveLoadingIndicator.add(function(){(v=new PanoptoTS.Core.UI.Components.KollectiveRadialLoadIndicator(I,{size:50,fill:"transparent",stroke:"green",strokeWidth:5})).start()}),y.onUpdateKollectiveLoadingIndicator.add(function(t){null!=v&&v.updateStatus(t)}),y.onShowKollectiveLoadingIndicator.add(function(t,e){null!=v&&(e.hide(),I.show(),I.css({top:t.offset().top+(t.height()-I.height())/2,left:t.offset().left+(t.width()-I.width())/2}))}),y.onHideKollectiveLoadingIndicator.add(function(){null!=v&&I.hide()}),y.onStopKollectiveLoadingIndicator.add(function(){null!=v&&(v=null,I.hide())});var L=function(t,e,o){var n=Panopto.Core.StringHelpers.parseQueryString(t.url.slice(t.url.indexOf("?")+1));if(d=t,!f){if(Panopto.features.quotasEnabled){var a=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)).tid;(S=new PanoptoTS.Controls.QuotaPlaybackTracker(Panopto.Core.CookieHelpers,$("body"),Panopto.GlobalResources,r.id,r.ownerId,Panopto.user.userId,a?Panopto.Core.StringHelpers.format(Panopto.freeTrialSignUpUrl+Panopto.Core.Constants.SignUpUrlParams,a,r.user.email):Panopto.freeTrialSignUpUrl,Panopto.freeTrialSupportUrl)).onToggle.add(function(t){i.setPlayState(t?Panopto.Viewer.PlayState.Paused:Panopto.Viewer.PlayState.Playing,void 0,void 0)})}(f=Panopto.Core.Analytics.PlaybackLogger(y,n.InvocationID,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests,{onSpanUpdated:function(t){S&&S.update(t)}})).start()}t.isAudioOnly?l.toggle({showOrHide:!0,allowShowOverlayButton:!1}):l.toggle({showOrHide:!1,allowShowOverlayButton:!1}),w.content(d,e,function(){d.isBroadcast&&c&&c(),o&&o(),S&&S.initialize(r.ownerIsOverQuota)})},m=function(e){return _.find(a,function(t){return(e<t.relativeEnd||!t.relativeEnd)&&!t.interrupted})||_.max(a,function(t){return t.relativeEnd})};return g.setPrimaryContent=function(t,e,o,n){a=t,d&&(d=_.find(t,function(t){return t.id===d.id})),!d&&e.isBroadcast&&w.position(1/0),d&&!o||L(d||e,o,n)},g.content=g.setPrimaryContent,g.setPosition=function(t,e){var o,n,a,i=function(){c&&c()};if(void 0===t)return o=w.position(),n=d.relativeEnd,a=m(n),n&&d.relativeStart+o>=n&&a.id!==d.id&&(L(a,!1,null),w.position(n-a.relativeStart),g.setPlayStateWithLogging(Panopto.Viewer.PlayState.Playing,!0)),o+d.relativeStart;(a=m(t)).id!==d.id&&L(a,!1,null),d.isBroadcast&&!C&&t&&t!==p&&t!==1/0&&t>=h-Panopto.Viewer.Constants.LivePositionTolerance?g.setIsLive(!0,e):(t-=d.relativeStart,w.position(t,function(){i(),e&&e()}),i())},g.position=g.setPosition,g.setIsLive=function(t,e){if(void 0===t)return C;t&&!C?(s&&window.clearInterval(s),y.setPosition(p||1/0,e),y.playState(Panopto.Viewer.PlayState.Playing),C=!0):!t&&C&&(h=p||y.position(),s=window.setInterval(function(){p&&p<=h?window.clearInterval(s):h+=Panopto.Viewer.Constants.TimedSyncRate/1e3},Panopto.Viewer.Constants.TimedSyncRate),C=!1)},g.isLive=g.setIsLive,g.updateMaxPosition=function(t){t||C||(C=!0,g.setIsLive(!1)),(p=t)&&p<h&&(h=p)},y.streamLength=function(){return d.isBroadcast?C?y.position():h:w.streamLength()},y.ended=function(){var t=m(d.relativeEnd),e=w.ended();return e&&t.id!==d.id?(e=!1,y.setPosition(d.relativeEnd),y.playState(Panopto.Viewer.PlayState.Playing)):p&&y.position()>=p&&(e=!0),e&&d.isBroadcast&&(C=!0),e&&P&&P(void 0,Panopto.Viewer.PlayState.Stopped),e&&S&&S.fadeInModalForAnonymous(),e},g.isEndedBy=y.ended,g.activePrimary=function(){return d},g.onSeek=function(t){c=t},g.offSeek=function(){c=void 0},g.onSpeedChange=function(t){u=t},g.offSpeedChange=function(){u=void 0},g.onPlayStateChangeLog=function(t){P=t},g.offPlayStateChangeLog=function(){P=void 0},y.playSpeed=function(t){var e=w.playSpeed();if(void 0===t)return e;w.playSpeed(t),t!==e&&u&&u()},g.playState=function(t,e){w.playState(t),e&&t!==n&&P&&P(n,t),n=t},g.setPlayStateWithLogging=y.playState,g.streamId=function(){return d.id},g};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.PrimarySegmentPlayer=function(t,e,n,s,u,r){var l,d,m,f,p,c,P,y=PanoptoLegacy.Viewer.Players.StreamPlayer(t,e,n,!0,s),v=y,g=Panopto.Core.Extensions.base(y),a=!1,C=$("#primaryTabHeaders"),h=[],w=function(t){var e;return P&&(e=_.find(t.element.streams(),function(t){return t.stream.id===P})),e=e||_.find(t.element.streams(),function(t){return t.stream.isPrimary})},S=function(e,t){var n=_.find(l,function(t){return t.start<=e&&t.end>e});if(t&&n&&n.start<f.start&&(n=f),n&&n!==f){var o=w(n);if(o){var r=o.stream.url!==p.stream.url||o.stream.vrType!==p.stream.vrType||o.offset!==p.offset;p=o,f=n,_.each(h,function(t){t.available(e)}),r&&(b(_.find(h,function(t){return t.id()===p.stream.id})),v.setPrimaryContent(void 0,p.stream,void 0,void 0),y.setPosition(e),g.playState(c))}else(n=_.find(d,function(t){return t.start>e}))?y.setPosition(n.start):a=!0}},b=function(e){e&&(_.each(h,function(t){t!==e&&t.selected(!1)}),e.selected(!0),P=e.id())};return v.setPrimaryContent=function(t,e,n,o){e.isAudioOnly?r.toggle({showOrHide:!0,allowShowOverlayButton:!0}):r.toggle({showOrHide:!1,allowShowOverlayButton:!0}),g.content(e)},v.content=v.setPrimaryContent,v.setSegments=function(t,e,n,o){var r=[],a=l?y.position():0,i="primary";l=t,d=e,m=n,f?S(a,void 0):(f=d[0],p=w(f),v.setPrimaryContent(void 0,p.stream,void 0,void 0)),o&&(r=_.chain(d).map(function(t){return t.element.streams()}).flatten().map(function(t){return t.stream}).filter(function(t){return t.isPrimary}).map(function(t){return t.id}).uniq().value()),C.empty(),h.length=0,r.length<2?P=void 0:(_.each(r,function(e){if(u.getStream(e)){var n,o=[],r=!1;_.each(d,function(t){(n=t.element.getStreamById(e))?r||(o.push(t.start),r=!0):r&&(o.push(t.start),r=!1)}),C.append(_.template($("#playerTabHeaderTemplate").html())({content:{id:e,title:u.getStreamName(void 0,e),tabClass:u.getStreamIconClass(void 0,e)},type:i,tabindex:0})),h.push(Panopto.Viewer.Tabs.PlayerTabHeader(C.find("#"+i+e),e,o,!0,n&&n.stream?PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(n.stream):Panopto.Core.Constants.ObjectVideoIconCode))}}),Panopto.Core.UI.Handlers.button(C.find("."+Panopto.Viewer.Constants.PrimaryTabHeaderClass),function(e){var t=_.find(h,function(t){return t.owns(e)}),n=y.position();t&&("number"==typeof t.seekTime()&&(n=t.seekTime(),s.setPosition(n)),b(t),p=w(f),v.setPrimaryContent(void 0,p.stream,void 0,void 0),y.setPosition(n),g.playState(c))}),_.each(h,function(t){t.available(a)}),b(P?_.find(h,function(t){return t.id()===P}):_.find(h,function(t){return t.id()===p.stream.id})))},v.activePrimary=function(){return p?p.stream:void 0},y.playState=function(t){c=t,g.playState(t)},v.setPlayStateWithLogging=y.playState,y.position=function(e){if(f){void 0!==e?(a=!1,S(e,void 0),g.position(e-f.start+p.offset/Panopto.Core.Constants.TimelineChunkMultiplier)):(e=g.position()+f.start-p.offset/Panopto.Core.Constants.TimelineChunkMultiplier,S(e,!0));var t=_.filter(h,function(t){return t.available(e)});return C.toggle(1<t.length),e}return g.position(e)},y.setPosition=y.position,y.streamLength=function(){return d?m:g.streamLength()},y.ended=function(t){var e=g.ended();return e&&f!==_.last(d)?(e=!1,y.setPosition(f.end)):t===m&&(a=!0),a||g.ended()},v.isEndedBy=y.ended,v};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},PanoptoLegacy.Viewer.Players.SecondaryStreamPlayer=function(e,t,n){var m,d,o,P,l,r,c=Panopto.Viewer.Constants,a=!1;e.append(_.template($("#streamPlayerTemplate").html())),o=e.find("#secondaryScreen"),m=PanoptoLegacy.Viewer.Players.StreamPlayer(e,o,t,!1,n),d=Panopto.Core.Extensions.base(m);var g=function(e,t){return e-t.relativeStart+t.streamOffset},p=function(t){var e,n;return P.segments&&P.segments.length?(e=(e=_.find(P.segments,function(e){return t>=e.timelineStart&&t<e.relativeEnd}))||(t<P.segments[0].timelineStart?P.segments[0]:P.segments[P.segments.length-1]),n=g(t,e)):n=t-P.relativeStart,{segment:e,offset:n}};return m.content=function(e,t,n){if(void 0===e)return P;P=e;var o=void 0!==r;if(o){var a=p(r);d.setStartPosition(a.offset+c.SecondaryStreamOffset)}d.setContent(e,t,n),o&&(d.setStartPosition(void 0),r=void 0)},m.setContent=m.content,m.position=function(e,t,n,o){var a=t,r=p(e);if(r.segment){if(!t&&r.segment!==l){var s=g(e,l);n=a=r.offset-s>c.ContiguousSegmentThreshold}l=r.segment}if(!a)return m.ended(r.offset)?0:r.offset-d.position();var i=r.offset+(n?c.SecondaryStreamOffset:0),f=d.position();n||f!==r.offset+c.SecondaryStreamOffset||(i=f),d.setPosition(P.length?Panopto.Core.Math.clamp(i,0,P.length):Math.max(0,i),o)},m.setSecondaryPosition=m.position,m.setStartPosition=function(e){r=e},m.toggle=function(e){a=e,o.toggleClass("hidden-screen",!e)},m.minimizeIfHidden=function(){a||d.setIsFullscreen(!1)},m.ended=function(e){var t=d.streamLength();return d.ended()||!(!t||P.isBroadcast)&&e>=t-c.EndPositionThreshold},m};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},PanoptoLegacy.Viewer.Players.SlidePlayer=function(e,t,a){var s,l,p,o,n,P=Panopto.Viewer.Constants,d=1;return e.append(_.template($("#slidePlayerTemplate").html())({id:t.id})),s=e.find("#"+t.id+"-image"),l=e.find("#"+t.id+"-buffer"),o=Panopto.Viewer.Players.PlayerBase(e,s),n=Panopto.Core.Extensions.base(o),o.resize=function(e,o){n.resize(e,o,d)},o.position=function(e,o){var n,i,r;n=e,(r=(r=_.last(_.filter(t.slides,function(e){return e.time<=n})))||t.slides[0])&&r!==p&&(i=r.url||P.SlideImageUrl+"?"+Panopto.Core.StringHelpers.serializeObjectToQueryString(r.queryParams),Panopto.Core.ImageHelpers.bufferAndReplaceImageUrl(s,l,i,function(e){d=e.width/e.height||0}),s.unbind("load").on("load",function(){a.resize()}),p=r),o&&o()},o.setPosition=o.position,o.remove=function(){s.remove(),l.remove()},o};
var PanoptoTS,Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},function(e){var t;(t=e.Viewer||(e.Viewer={})).Players||(t.Players={}),e.Viewer.Controls}(PanoptoTS||(PanoptoTS={})),PanoptoLegacy.Viewer.Players.StreamPlayer=function(i,r,e,t,o){var n,a,l,c,s,d,u,p,P,y=Panopto.Viewer.Constants,f=Panopto.Viewer.PlayState,g=Panopto.Viewer.PlaySpeed,w=Panopto.Viewer.Players.PlayerBase(i,r),v=Panopto.Core.Extensions.base(w),h=e.create(t,r),S=Panopto.Viewer.Constants.InitialVolume,m=!1,C=t?"Primary":"Secondary",L=0,V=g.Normal;if(c=h.onReady?h.onReady:$.Deferred().resolve(),h.onStartKollectiveLoadingIndicator){var I=h;s=I.onStartKollectiveLoadingIndicator,d=I.onUpdateKollectiveLoadingIndicator,u=I.onShowKollectiveLoadingIndicator,p=I.onHideKollectiveLoadingIndicator,P=I.onStopKollectiveLoadingIndicator}else s=$.Callbacks(),d=$.Callbacks(),u=$.Callbacks(),p=$.Callbacks(),P=$.Callbacks();return w.resize=function(e,t){var o;try{o=h.width()/h.height()}catch(e){}var n=Panopto.Core.Browser.isIE11||Panopto.Core.Browser.isSafari||h.canMoveAudioPlayerOffscreen&&h.canMoveAudioPlayerOffscreen();v.resize(e,t,o,n),h.showShadow(i.height()===r.height())},w.content=function(e,t,o){e.isAudioOnly,h.content(e,t,o)},w.setContent=w.content,w.playState=function(e){h.playState(e),l!==e&&(L=h.position(),o.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PlayStateChange,[C,e])),l=e},w.position=function(e,t){if(void 0===e)return e=Math.max(h.position()||0,0),n&&e===n&&e!==L&&l===f.Playing?e+=Math.min(V*((new Date).getTime()-a),y.MaxPositionInterpolation)/1e3:(n=e,a=(new Date).getTime()),e;h.position(e,t),L=e,o.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PositionSet,[C,e])},w.setPosition=w.position,w.setStartPosition=function(e){h.setStartPosition&&h.setStartPosition(e)},w.bitrate=function(e){h.bitrate(e)},w.numericBitrate=function(){return h.numericBitrate()},w.hasMBR=function(){return 1<h.bitrateOptions().length},w.bitrateLevelOffset=function(){var e=h.bitrateOptions();return e.indexOf(h.numericBitrate())+1-e.length},w.playSpeed=function(e){if(void 0===e)return V;h.playSpeed(e),V!==e&&o.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PlaybackSpeedChange,[C,e]),V=e},w.getCaptionControl=function(){return h},w.getFullscreenStateControl=function(){return h},w.volume=function(e){if(void 0===e)return m?0:S;0!==e?(h.volume(e),S=e,w.muted(!1)):w.muted(!0)},w.setVolume=w.volume,w.muted=function(e){if(void 0===e)return m;h.muted(e),m=e},w.isMuted=w.muted,w.width=function(){try{return h.width()}catch(e){return r.width()}},w.height=function(){try{return h.height()}catch(e){return r.height()}},w.streamLength=function(){return h.streamLength()},w.ended=function(){return h.ended()},w.isFullscreen=function(e){return h.isFullscreen(e)},w.setIsFullscreen=w.isFullscreen,w.optimizationProvider=function(){return h.optimizationProvider?h.optimizationProvider():void 0},w.onReady=c,w.onStartKollectiveLoadingIndicator=s,w.onUpdateKollectiveLoadingIndicator=d,w.onShowKollectiveLoadingIndicator=u,w.onHideKollectiveLoadingIndicator=p,w.onStopKollectiveLoadingIndicator=P,w};
var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Players.ThumbnailPlayer=function(o,t,n){Panopto.Viewer.Constants;var e=Panopto.Viewer.Analytics,i=Panopto.Viewer.Players.PlayerBase(a),a=$("#thumbnailList"),r=$("#toggleThumbnailsButton"),s=$("#toggleThumbnailsButtonIcon"),l=Panopto.Viewer.Controls.ThumbnailStrip(a,o,t,n),p=!1;return Panopto.Core.UI.Handlers.button(r,function(){var o;(o=(o=void 0)===o?!a.is(":visible"):o)?(s.text("keyboard_arrow_down"),a.slideDown({step:function(){t.resize&&t.resize()},complete:function(){p=!1,i.position(t.position(),!0)}}),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!0).toString()),e.sendEvent({action:e.Actions.ShowThumbnails,label:e.Labels.Normal})):(p=!0,s.text("keyboard_arrow_up"),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!1).toString()),a.slideUp({step:function(){t.resize&&t.resize()}}),e.sendEvent({action:e.Actions.HideThumbnails,label:e.Labels.Normal}))}),r.add(a).toggle(0<o.length&&!n),l.render(),i.toggle=function(o){l.toggle(o)},i.resize=function(o,t){},i.position=function(o,t){p||l.position(o,t)},i.setPosition=i.position,i.thumbnails=function(o){if(!o)return l.thumbnails();l.thumbnails(n?_.filter(o,function(o){return!(o.isDefaultThumbnail||o.link||o.type!==Panopto.Core.EventType.Label&&o.type!==Panopto.Core.EventType.SlideChange)}):o)},i};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Hive=function(e){var o=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),i="disabled"!==o.P2POptimization,r="true"===o.hiveLoggingEnabled,a=function(e){return i&&Panopto.viewer.isHiveEnabled&&!Panopto.viewer.isKollectiveEnabled&&e},s=function(n,t){return{onError:function(e){var o,i=t.hiveTechOrder.indexOf(n);return-1!==i&&r&&(o=i<t.hiveTechOrder.length?PanoptoTS.StringHelpers.format("{0} failed with message: {1}. Falling through to next tech {2} ",n,e.message,t.hiveTechOrder[i+1]):PanoptoTS.StringHelpers.format("{0} failed with message: {1}. End of tech stack falling back to source",n,e.message),console.log(o)),!0},onActiveSession:function(e){r&&console.log(PanoptoTS.StringHelpers.format("Session activated with tech {0}, sessionDetails:",n)+e)}}};return e.isHiveOptimized=a,e.createFlowplayerPlugin=function(e,o){var i={};if(a(e.optimizationToken)){var n={};Panopto.viewer.hiveFlowpayerPluginIsDebugModeEnabled&&(n.debugLevel="debug"),n.hiveTechOrder=Panopto.viewer.hiveFlowplayerPluginTechOrder.split(",").map(function(e){return e.trim()});var t=n.hiveTechOrder.indexOf("HiveJava");o||-1===t||n.hiveTechOrder.splice(t,1),n.HiveJava=s("HiveJava",n),n.HiveJS=s("HiveJS",n),n.StatsJS=s("StatsJS",n),i={sources:[{type:"application/x-mpegurl",ticket:e.optimizationToken}],options:n}}return i},e.attachFlowplayerHlsJsConfig=function(e,o){a(e.optimizationToken)&&(o.xhrSetup||(o.xhrSetup=function(){}))},e.getHiveSourceForReload=function(e,o){return e.off("stop.hiveStop"),e.off("finish.hiveFinish"),[{type:"application/x-mpegurl",ticket:o.optimizationToken}]},e.loadHiveTicket=function(e,o,i,n,t){e.closeHiveSession(),e.load(o,i,function(e){r&&(console.log(PanoptoTS.StringHelpers.format("Hive to load ticket: {0} reasons: ",o[0].ticket)+e),console.log(PanoptoTS.StringHelpers.format("Falling back to source {0}",n.sources[0].src))),t(n,i)})},e.addCloseHiveSessionToStopAndFinish=function(e){e.one("stop.hiveStop",function(){e.off("finish.hiveFinish"),e.closeHiveSession()}),e.one("finish.hiveFinish",function(){e.off("stop.hiveStop"),e.closeHiveSession()})},e}(Panopto.Viewer.Hive||{});
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.FlashLongPoll=function(l){var t=Panopto.Viewer.Constants;l.callback,l.errorCount=0,l.flashStartTimer,l.ktoken,l.longPollUrlPattern,l.prefetchUrl,l.swfUrl,l.timestamp=0;var e=function(){var t={longpollUrl:l.longPollUrlPattern.format(l.timestamp),prefetchUrl:l.prefetchUrl};swfobject.embedSWF(l.swfUrl,"kontikiLongPoll","1","1","10.0.0","",t,{allowscriptaccess:"always"},"",function(o){o.success?(gKontikiAgentLogs+="Flash long-poll embedded, starting poll on URL "+t.longpollUrl+"\n",l.flashStartTimer=setTimeout(function(){var o="Flash long-poll start time-out";gKontikiAgentLogs+=o+"\n",l.callback({error:o},l.errorCount)},15e3)):(gKontikiAgentLogs+="Flash long-poll failed to embed\n",l.callback({error:"Long-poll .swf failed to embed"},l.errorCount))})};return l.ioError=function(o){gKontikiAgentLogs+="Flash long-poll I/O error: "+o+"\n",setTimeout(e,250)},l.longpollLoadError=function(o){gKontikiAgentLogs+=PanoptoTS.StringHelpers.format("Flash long-poll load error: {0}\n",o)},l.open=function(){},l.prefetchError=function(o){gKontikiAgentLogs+=PanoptoTS.StringHelpers.format("Flash prefetch load error: {0}\n",o)},l.prefetchOpen=function(){gKontikiAgentLogs+="Flash long-poll prefetch URL opened\n"},l.response=function(o){gKontikiAgentLogs+=PanoptoTS.StringHelpers.format("Flash long-poll message: {0}\n",JSON.stringify(o)),o&&o.ts&&(l.timestamp=o.ts),l.errorCount=l.callback(o,l.errorCount),l.prefetchUrl="",setTimeout(e,Panopto.viewer.kollectiveLongPollTimeout)},l.securityError=function(o){gKontikiAgentLogs+="Flash long-poll security error: "+o+"\n",l.callback({error:o},l.errorCount+=1)},l.started=function(o){clearTimeout(l.flashStartTimer),gKontikiAgentLogs+="Flash long-poll bridge has started\n"},l.start=function(o){l.longPollUrlPattern=PanoptoTS.StringHelpers.format("http://127.0.0.1:31013{0}{1}",t.KollectiveLongPollUrlBase,o.ktoken),l.prefetchUrl=o.optimizationToken,l.prefetchUrl.startsWith("https://client.kontiki.com:31015")&&(l.prefetchUrl=l.prefetchUrl.replace("https://client.kontiki.com:31015","http://127.0.0.1:31013")),l.callback=o.callback,l.ktoken=o.ktoken,l.swfUrl=Panopto.appRoot+"/Scripts/Kollective/flash/kontikiflashlongpoll-v2.swf",l.longPollUrlPattern=l.longPollUrlPattern.replace(/\&/g,"%26"),l.prefetchUrl=l.prefetchUrl.replace(/\&/g,"%26"),e()},l}(Panopto.Viewer.FlashLongPoll||{}),FlashLongPoll=Panopto.Viewer.FlashLongPoll;
var longpollTimeoutID,Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.FlashLongPoll=Panopto.Viewer.FlashLongPoll||{},Panopto.Viewer.KollectiveFP=function(o){var c,r,s=Panopto.Viewer.Constants,e="disabled"!==Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)).P2POptimization,u=function(o){return e&&Panopto.viewer.isKollectiveEnabled&&o},p=function(o){return o.split("ktoken=")[1].split("&")[0]},v=function(o){"Success"===o?c="Success":"Fallback"===o?c="Fallback":"Loading"!==o||"Success"!==c&&void 0!==c||(c="Loading")},P=function(o,e,t,n,l){if(Panopto.viewer.useKollectiveFlashLongPoll)l(!0,-1),FlashLongPoll.start({optimizationToken:o,ktoken:p(o),callback:function(o,e){return g(o,e,null,t,n,l)}});else{l(!0,-1),longpollTimeoutID&&(clearTimeout(longpollTimeoutID),longpollTimeoutID=null);var i=o.split("/"),a=p(o),c=i[0]+"//"+i[2]+s.KollectiveLongPollUrlBase+a;f(c,0,0,t,n,l)}},f=function(t,o,n,l,i,a){var e=longpollTimeoutID;$.ajax({url:t.format(o),method:"GET",datatype:"json",timeout:Panopto.viewer.kollectiveLongPollAjaxTimeout,success:function(o){try{var e=JSON.parse(o);g(e,t,n,l,i,a)}catch(o){console.log(o),i()}},error:function(){e===longpollTimeoutID&&m(t,o,n,l,i,a)}})},g=function(o,e,t,n,l,i){if(o){var a=void 0===o.ts;"manifestProgress"===o.cmd&&o.params?(t=0,"100"===o.params.percent?n():(v("Loading"),i(!0,parseInt(o.params.percent,10)))):"switchToCDN"===o.cmd?l():((t+=1)>=Panopto.viewer.kollectiveLongPollErrorThreshold&&(l(),a=Panopto.viewer.kollectiveFallbackToSourcePermanently),i(!0,-1)),a||Panopto.viewer.useKollectiveFlashLongPoll||m(e,o.ts,t,n,l,i)}else t+=1,i(!0,-1)},m=function(o,e,t,n,l,i){longpollTimeoutID=setTimeout(function(){f(o,e,t,n,l,i)},Panopto.viewer.kollectiveLongPollTimeout)};return o.isKollectiveOptimized=u,o.tryLoadOptimizedStream=function(e,t,n,o,l){if(u(e)){v("Loading");var i=function(o,e){l(o&="Success"!==c&&"Fallback"!==c,e)},a=function(){"Fallback"!==c&&(v("Fallback"),i(!1,-1),o())};P(e,t,function(){if("Success"!==c)if(v("Success"),Panopto.viewer.useKollectiveFlashLongPoll&&0!==Panopto.viewer.kollectiveOnSuccessRetryCount){var o=e.replace("http://127.0.0.1:31013","https://client.kontiki.com:31015");$.ajax({url:o,tryCount:0,success:function(){i(!1,-1),n()},error:function(o){var e,t;e=this,t=a,404===o.status&&e.tryCount<Panopto.viewer.kollectiveOnSuccessRetryCount?(e.tryCount+=1,$.ajax(e),console.log("Retrying because a 404 occured.")):t()}})}else Panopto.viewer.kollectiveStopStreamEnabled&&($(window).on("beforeunload.kollective",function(){r.stopStream(e,$.noop)}),t.on("stop.kollective",function(){r.stopStream(e,$.noop)}),t.on("finish.kollective",function(){r.stopStream(e,$.noop)})),i(!1,-1),n()},a,i)}},o.detectAgent=function(t){var o={callback:function(o){var e=!1;try{(e=o&&o.isInstalled()&&o.checkMinVersion(Panopto.viewer.kollectiveMinimumVersion))||console.log(o.getAgentDetectionLog())}catch(o){e=!1,console.log(o)}finally{t(e)}},flash_loader_url:Panopto.appRoot+"/Scripts/Kollective/flash/kontikiagentflashloader-3.swf",use_ajax:!0,use_jsonp:!0,use_ssl:!0,callback_timeout:Panopto.viewer.kollectiveClientDetectionTimeout};try{r=new KontikiAgent(o)}catch(o){console.log(o),t(!1)}},o}(Panopto.Viewer.KollectiveFP||{});
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.BookmarksTab=function(o,e,a,n,r,t){var P=!1,i=PanoptoLegacy.Viewer.Tabs.EditableEventTab(o,e,a,n,[],Panopto.API.EventType.Bookmark,!1,r,Panopto.GlobalResources.ViewerPlus_CreateBookmark,Panopto.GlobalResources.ViewerPlus_CreateBookmark_None,Panopto.GlobalResources.ViewerPlus_Bookmarks_SignIn,Panopto.Viewer.Analytics.Labels.Bookmark,void 0,t),s=Panopto.Core.Extensions.base(i),p=e.find(".event-input");return i.selected=function(o){return void 0!==o&&o&&!P&&(p.hide(),i.fetch(),P=!0),s.selected(o)},i.render=function(o,e,a,n,t){P&&r.key&&p.show(),s.render(o,e,a,n,t)},i};
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.CommentsTab=function(e,t,n,o,a,i,l){var r,s,c=[],d=t.find(".event-tab-list"),v=Panopto.GlobalResources.ViewerPlus_AddComment,p=PanoptoLegacy.Viewer.Tabs.EditableEventTab(e,t,n,o,c,Panopto.API.EventType.Comment,!1,a,v,v,Panopto.GlobalResources.ViewerPlus_Comments_SignIn,Panopto.Viewer.Analytics.Labels.Comment,void 0,i),u=p,P=Panopto.Core.Extensions.base(p),b=function(){e.find(".text").text(0===c.length?Panopto.GlobalResources.ViewerPlus_CommentsHeader:Panopto.GlobalResources.ViewerPlus_CommentHeader_Variable.format(c.length))},m=function(){i&&(clearInterval(s),s=setInterval(function(){p.fetch(void 0,void 0,void 0,void 0,!0)},1e3*l))};return p.render=function(e,t){a.key?_.each(e,function(e){e.editable=e.saved&&e.user===a.key,e.deletable=e.saved&&(e.editable||a.role>Panopto.Data.AclRoleType.Viewer),e.replyable=!0}):_.each(e,function(e){e.replyable=!1}),r?r.syncComments(e,t):(r=new PanoptoTS.Viewer.Tabs.Discussion.Discussion({target:d,events:e,panoptoGlobal:Panopto,eventClickedCallback:p.seekToEvent,editClickedCallback:p.editEventClicked,deleteClickedCallback:p.deleteEventClicked,submitNewEventCallback:function(e,t){return p.saveNewEvent(e,t,void 0)}})).render(),b()},p.remove=function(e){_.each(e,function(e){c.splice(c.indexOf(e),1),r.removeComment(e)}),p.updatePlaceholderText(),b()},p.addEvent=function(e,t){var n=$(".reply-to-flag").data("replyToTime"),o=n||t;clearInterval(s),P.addEvent(e,o,void 0,m)},p.editEvent=function(e,t){clearInterval(s),P.editEvent(e,t,m)},p.deleteEvent=function(e){clearInterval(s),P.deleteEvent(e,m)},p.position=function(e){P.position(e),i&&n.isActiveBroadcast()&&u.toggleBroadcastIsLiveOrEnded(n.isLive())},u.toggleBroadcastIsLiveOrEnded=function(e){p.isInputDisabled()&&e?p.inputDisabled(!1):p.isInputDisabled()||e||p.inputDisabled(Panopto.GlobalResources.ViewerPlus_Comments_SkipToLive)},p.getEventTime=function(){var e=$(".reply-to-flag").data("replyToTime");return e||P.getEventTime()},p.focusEvent=function(e){r.scrollCommentIntoView(e),P.focusEvent(e)},p.fetch(),m(),u};
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.ContentsTab=function(e,o,n,t,a,i){var r=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,o,n,t,[],Panopto.API.EventType.Slide,!0,Panopto.Viewer.Analytics.Labels.Content,void 0),p=o.find("#deliveryDescription");return jQuery.trim(i)&&(Panopto.Core.TextHelpers.addMultilineStringToElement(i,p[0]),p.show()),r.render(a,!0,void 0,void 0,void 0),r};

var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Core=Panopto.Core||{},Panopto.Core.Key=Panopto.Core.Key||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.EditableEventTab=function(e,d,n,i,t,a,o,r,l,s,v,c,p,u){var P,g,E=Panopto.API,f=Panopto.Viewer.Constants,b=Panopto.Viewer.Analytics,y=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,d,n,i,t,a,o,c,void 0),C=y,w=Panopto.Core.Extensions.base(y);d.append(_.template($("#eventTabInputTemplate").html(),{}));var h,I=d.find(".event-input"),T=d.find(".cancel-editing"),m="placeholder",A="editing",D=0,V=I.height();C.updatePlaceholderText=function(){Panopto.Core.UI.Components.placeholder(I,h||(t.length?l:s),m),I.attr("aria-label",l)};var k=function(e){e?(P=e,d.find("#"+e.id).toggleClass(A,!0),I.val(e.text).toggleClass(m,!1).focus().select(),U(void 0),T.show(),I.prop("disabled",!1).toggleClass(A,!0)):(P&&(d.find("#"+P.id).toggleClass(A,!1),T.hide(),I.toggleClass(A,!1)),P=void 0,I.val(""),U(V),C.updatePlaceholderText(),g=void 0,h&&I.prop("disabled",!0))},x=function(e,t,n,o){var i=d.find("#"+e.id),a=i.find(".event-error");a.find(".event-error-message").text(t),Panopto.Core.UI.Handlers.button(a.find(".event-error-retry"),n),Panopto.Core.UI.Handlers.button(a.find(".event-error-cancel"),o),i.toggleClass("errored",!0)};C.wireUpEditMenu=function(e){var t=d.find("#"+e.id),n=new PanoptoTS.Viewer.Controls.EditEventMenu(t,t.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});n.editCallbacks.add(function(e){C.editEventClicked(e)}),n.deleteCallbacks.add(function(e){C.deleteEventClicked(e)}),n.setEvent(e,{canEdit:e.editable,canDelete:e.deletable})},C.editEventClicked=function(e){k(!1),k(e)},C.deleteEventClicked=function(e){e.saved=!1,y.render([e],!1,void 0,void 0,void 0),C.deleteEvent(e)};var U=function(e){var t=I.innerHeight()-I.height();I.height(1);var n=I[0].scrollHeight,o=e||n-t;I.height(o)};if(r.key)I.keyup(function(){var e=jQuery.trim(I.val());e&&void 0===g?g=C.getEventTime():e||(g=void 0)}),I.on("paste input",function(){U(void 0)}),I.keydown(function(e){e.ctrlKey&&e.keyCode===Panopto.Core.Key.UpArrow||(e.stopPropagation(),e.keyCode!==Panopto.Core.Key.Enter||e.shiftKey?e.keyCode===Panopto.Core.Key.Esc&&C.resetInput():(e.preventDefault(),void 0===g&&I.keyup(),C.submitEvent(void 0)))}),Panopto.Core.UI.Handlers.button(T,function(){k(!1)}),l&&C.updatePlaceholderText();else{I.hide();var S=_.template($("#eventTabSignInTemplate").html());d.find(".event-signin").html(PanoptoTS.StringHelpers.format(v,S({url:PanoptoTS.StringHelpers.format("{0}?ReturnUrl={1}",Panopto.loginUrl,encodeURIComponent(window.location.href)),text:Panopto.GlobalResources.ViewerPlus_EventTab_SignIn}))).show()}return y.resize=function(e,t){var n=I.is(":visible")?I.outerHeight(!0):0;T.is(":visible")&&(n+=T.outerHeight(!0)),I.width(e-f.InputMargin),w.resize(e,t-n)},y.render=function(e,t){r.key&&_.each(e,function(e){e.editable=e.saved&&e.user===r.key,e.deletable=e.saved&&(e.editable||r.role>Panopto.Data.AclRoleType.Viewer)}),p&&_.each(e,function(e){delete e.time}),w.render(e,t),_.each(e,function(e){(e.editable||e.deletable)&&C.wireUpEditMenu(e)}),C.updatePlaceholderText(),n.resize()},y.remove=function(e){w.remove(e),C.updatePlaceholderText()},C.addEvent=function(t,e,n,o){E.Delivery.createEvent(i,a,t.text,e,!p,n,u,function(e){t.eventId=e.EventID,t.eventPublicId=e.PublicId,t.sessionId=e.SessionId,t.saved=!0,y.render([t],!1,void 0,void 0,void 0),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Add.Success,label:c}),o&&o()},function(){x(t,Panopto.GlobalResources.ViewerPlus_EventTab_AddError,function(){C.addEvent(t,e,n,o),b.sendEvent({action:b.Actions.Add.Retry,label:c})},function(){y.remove([t]),b.sendEvent({action:b.Actions.Add.Cancel,label:c})}),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Add.Error,label:c}),o&&o()})},C.editEvent=function(e,t,n){E.Delivery.editEvent(e.sessionId,e.type||a,e.eventPublicId,e.text,function(){e.saved=!0,y.render([e],!1,void 0,void 0,void 0),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Edit.Success,label:c}),n&&n()},function(){x(e,Panopto.GlobalResources.ViewerPlus_EventTab_EditError,function(){C.editEvent(e,t,n),b.sendEvent({action:b.Actions.Edit.Retry,label:c})},function(){e.text=t,e.saved=!0,y.render([e],!1,void 0,void 0,void 0),b.sendEvent({action:b.Actions.Edit.Cancel,label:c})}),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Edit.Error,label:c}),n&&n()})},C.deleteEvent=function(e,t){y.toggleLoading(!0),E.Delivery.deleteEvent(e.sessionId,e.type||a,e.eventPublicId,function(){e===P&&k(!1),y.remove([e]),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Delete.Success,label:c}),t&&t()},function(){x(e,Panopto.GlobalResources.ViewerPlus_EventTab_DeleteError,function(){C.deleteEvent(e,t),b.sendEvent({action:b.Actions.Delete.Retry,label:c})},function(){e.saved=!0,C.render([e],!1,void 0,void 0,void 0),b.sendEvent({action:b.Actions.Delete.Cancel,label:c})}),y.toggleLoading(!1),b.sendEvent({action:b.Actions.Delete.Error,label:c}),t&&t()})},C.submitEvent=function(e){var t,n,o=jQuery.trim(I.val());o&&(I.val(""),U(V),y.toggleLoading(!0),P?(t=P,k(!1),n=t.text,t.text=o,t.saved=!1,y.render([t],!1,void 0,void 0,void 0),C.editEvent(t,n)):C.saveNewEvent(o,g,e))},C.saveNewEvent=function(e,t,n){var o=p?t-(new Date).getTime()/1e3:t,i={id:a+D.toString(),text:e,time:t,creationTime:Panopto.Core.TimeHelpers.currentWin32EpochTime(),user:r.key,userDisplayName:Panopto.viewer.displayFullNamesInDiscussion?r.name:r.key};y.render([i],!1,void 0,void 0,void 0),g=void 0,D++,C.addEvent(i,o,n),C.focusEvent(i)},C.inputDisabled=function(e){if(void 0===e)return!!h;P&&k(!1),h=e,I.prop("disabled",!!h).val(""),C.updatePlaceholderText()},C.isInputDisabled=C.inputDisabled,C.getEventTime=function(){return p?(new Date).getTime()/1e3:n.position()},C.resetInput=function(){k(!1)},C.focusEvent=function(e){},C};
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.UI.Accessibility=Panopto.UI.Accessibility||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.EventTab=function(t,n,a,r,d,p,e,o,s){var l=Panopto.API,i=Panopto.Viewer.Constants,c=Panopto.Viewer.Analytics,u={};n.prepend(_.template($("#eventTabErrorTemplate").html(),{}));var f,m,P=$("#eventTemplate"),v=n.find(".event-tab-scroll-pane"),g=n.find(".event-tab-list"),h=n.find(".event-tab-spinner"),T=n.find(".event-tab-error"),b=n.find(".event-tab-help"),C=!1,y=Panopto.Core.UI.Components.scrollingHighlight(v,!0,i.EventScrollTimeout),I=function(t){y.highlight(_.find(d,function(e){return e.id===t.id}),function(e){u.seekToEvent(e)})};u.seekToEvent=function(e){a.userSeekEnabled()&&(a.setPosition(e.time),c.sendEvent({action:c.Actions.Navigate,label:o}))};var w=function(e,t){var n=p===Panopto.API.EventType.Comment?e.creationTime-t.creationTime:e.time-t.time;return n||e.id===t.id||(n=e.id>t.id?-1:1),n},E=Panopto.Core.UI.Accessibility.tab(t,n),V=!Panopto.Core.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe;return Panopto.Branding.animateLoadingIndicator(Panopto.branding.accentColor),u.isHeaderVisible=function(){return C},u.toggleHeader=function(e){C=e,t.toggle(e)},u.toggleHeader(!0),g.keydown(function(e){!e.ctrlKey&&_.contains([i.VolumeUpKeyCode,i.VolumeDownKeyCode],e.keyCode)&&e.stopPropagation()}),b.toggle(V),Panopto.Core.UI.Handlers.button(t,function(){return a.fireTabSelected(u)}),t.focus(function(){return a.fireTabSelected(u)}),u.isSameEventRendering=function(e,t){return e.id===t.id&&(void 0===e.displayTime||void 0===t.displayTime||e.displayTime===t.displayTime)&&e.inlineEditable===t.inlineEditable&&e.text===t.text&&e.showUser===t.showUser&&e.userDisplayName===t.userDisplayName&&e.time===t.time&&e.timeRange===t.timeRange&&e.editable===t.editable&&e.deletable===t.deletable},u.selected=function(e){if(void 0===e)return t.hasClass("selected");t.toggleClass("selected",e),e?n.delay(i.FadeInterval).fadeIn(i.FadeInterval,function(){a.resize()}):n.fadeOut(i.FadeInterval),E.selected(e)},u.headerId=function(){return t.attr("id")},u.resize=function(e,t){e===f&&t===m||(f=e,m=t,v.css("max-height",t+"px"),n.width(e))},u.position=function(t){var n;e&&(_.each(d,function(e){e.time<=t&&(n=e)}),y.highlight(n))},u.render=function(e,t,n,o,s){if(n||e.sort(w),o){var i=function(e){for(var t=[],n=[],o=0,i=0;o<d.length&&i<e.length;){var a=d[o],r=e[i],s=w(a,r);0===s?(u.isSameEventRendering(a,r)||(t.push(r),n.push(a)),o++,i++):s<0?(n.push(a),o++):(t.push(r),i++)}for(;o<d.length;)n.push(d[o]),o++;for(;i<e.length;)t.push(e[i]),i++;return{eventsToAdd:t,eventsToRemove:n}}(e);e=i.eventsToAdd,_.each(i.eventsToRemove,function(e){d.splice(d.indexOf(e),1),g.find("#"+e.id).remove()})}_.each(e,function(e){var t,n=Panopto.Core.TextHelpers.cleanTextWithHighlighting(e.text);"number"!=typeof e.time||e.displayTime||(e.displayTime=Panopto.Core.TimeHelpers.formatDuration(e.time,Panopto.GlobalResources.TimeSeparator)),!e.creationTime||p!==Panopto.API.EventType.Comment&&"Comments"!==e.type&&e.displayTime||(t=Panopto.Core.TimeHelpers.toLocalPanoptoTime(Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(e.creationTime),Panopto.timeZone),e.displayDate=Panopto.GlobalResources.ViewerPlus_CommentTimestamp.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LL"),Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LT"),e.userDisplayName)),e.isQuestionList?e.iconCode=Panopto.Core.Constants.QuestionListIconCode:e.url&&-1!==e.url.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)&&(e.iconClass=Panopto.Viewer.Constants.YouTubeIconClass),a.isActiveBroadcast()&&(e.createdDuringWebcast=!1),V&&(n=Panopto.Core.TextHelpers.urlsToLinks(n)),e.content=Panopto.Core.TextHelpers.displayLineBreaks(n)});var l=_.template(P.html());!o&&t?(d.length=0,_.each(e,function(e){d.push(e)}),g.html(l({events:e})),_.each(d,function(e){u.afterRenderItem(e,g.find("#"+e.id),!1)})):_.each(e,function(t){var e,n,o=l({events:[t]}),i=_.findIndex(d,function(e){return e.eventId===t.eventId}),a=!1;if(0<=i)a=(n=g.find("#"+t.id)).hasClass(Panopto.Core.Constants.HighlightedClass)&&!s,n.replaceWith(o),d[i]=t;else{d.push(t),d.sort(w),a=!s,e=d.indexOf(t);var r=$.parseHTML($.trim(o));0===e?g.prepend(r):e===d.length-1?g.append(r):g.find("#"+d[e-1].id).after(r),n=$(r)}u.afterRenderItem(t,n,a)})},u.afterRenderItem=function(e,t,n){e.displayTime&&Panopto.Core.UI.Handlers.button(g.find("#"+e.id),I),n&&y.highlight(e),t.find("a").unbind("click keydown").click(function(e){e.stopPropagation()}).keydown(function(e){e.stopPropagation()})},u.remove=function(e){_.each(e,function(e){var t=g.find("#"+e.id);t.slideUp(void 0,function(){t.remove()}),d.splice(d.indexOf(e),1)})},u.toggleLoading=function(e){h.toggle(e)},u.error=function(e,t){e?(T.find(".event-tab-error-message").text(e),Panopto.Core.UI.Handlers.button(T.find(".event-tab-error-retry"),t),Panopto.Core.UI.Handlers.button(T.find(".event-tab-error-cancel"),function(){u.error(!1)}),T.slideDown()):T.slideUp()},u.fetch=function(e,t,n,o,i){o=o||p,u.toggleLoading(!0),l.Delivery.search(r,o,e,t,n,s,!i,function(e){u.render(_.map(e,function(e){return new PanoptoTS.Viewer.Data.Event(e)}),!0,void 0,void 0,void 0),u.error(!1),u.toggleLoading(!1)},function(){u.fetchError(e,t,n,o)})},u.fetchError=function(e,t,n,o){u.error(Panopto.GlobalResources.ViewerPlus_EventTab_LoadError,function(){u.fetch(e,t,n,o)}),u.toggleLoading(!1)},u.events=function(){return d},u};



var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.NotesTab=function(e,n,o,t,a,l,i,r,s){var u,c,p,P=Panopto.API,g=Panopto.Viewer.Data,f=Panopto.Viewer.Constants,v=!1,h=PanoptoLegacy.Viewer.Tabs.EditableEventTab(e,n,o,t,[],P.EventType.Note,!0,a,Panopto.GlobalResources.ViewerPlus_AddNote,Panopto.GlobalResources.ViewerPlus_AddNote_None,Panopto.GlobalResources.ViewerPlus_Notes_SignIn,Panopto.Viewer.Analytics.Labels.Note,r,s),b=h,d=Panopto.Core.Extensions.base(h),w=[],V="public",C=n.find("#channelSingleLabel"),y=n.find("#channelSelect"),E=n.find("#channelInput"),m=n.find("#channelOptionTemplate"),T=n.find("#togglePublic"),k=n.find("#cancelChannel"),A=n.find(".event-input"),G=function(e){y.val(e.value),y.change()},I=function(e){y.toggle(e),T.toggle(i&&e&&l&&u===c),E.toggle(!e),k.toggle(!e)},L=function(e){T.text(e?Panopto.GlobalResources.ViewerPlus_MakePrivate:Panopto.GlobalResources.ViewerPlus_MakePublic),T.toggleClass(V,e)},N=function(){h.toggleLoading(!0),P.Delivery.toggleEventPrivacy(t,!T.hasClass(V),function(e){L(e.Public),h.error(!1),h.toggleLoading(!1)},function(){var e=T.hasClass(V)?Panopto.GlobalResources.ViewerPlus_EventTab_TogglePrivateError:Panopto.GlobalResources.ViewerPlus_EventTab_TogglePublicError;h.error(e,function(){N()}),h.toggleLoading(!1)})},R=Panopto.GlobalResources.ViewerPlus_YourNotes.format(a.key);if(C.text(R),c=g.Channel("",R),w.push(c),l&&_.each(l,function(e){e.value.toLowerCase()!==a.key&&w.push(e)}),Panopto.viewer.isCustomNotesChannelEnabled&&w.push(g.Channel(f.JoinChannelOptionValue,Panopto.GlobalResources.ViewerPlus_JoinChannel)),y.html(_.template(m.html())({channels:w})),p=y.find("option[value='"+f.JoinChannelOptionValue+"']"),y.change(function(){var n=y.val();n===f.JoinChannelOptionValue?(I(!1),E.focus()):(u=_.find(w,function(e){return e.value===n}),v&&h.fetch(),T.toggle(i&&l&&n===c.value))}),y.keydown(function(e){return e.stopPropagation()}),C.toggle(1===w.length),y.toggle(1<w.length),l){Panopto.Core.UI.Handlers.button(T,N);var J=_.find(l,function(e){return e.name.toLowerCase()===a.key});L(void 0!==J),T.toggle(i)}return E.keydown(function(e){var n,o,t=jQuery.trim(E.val());13===e.keyCode&&(e.preventDefault(),t&&t!==f.JoinChannelOptionValue&&((n=_.find(w,function(e){return e.value===t}))||(o=g.Channel(t),p.before(_.template(m.html())({channels:[o]})),w.splice(w.length-2,0,o),E.val(""),n=o),I(!0),G(n))),e.stopPropagation()}),Panopto.Core.UI.Handlers.button(k,function(){E.val(""),G(u),I(!0)}),h.render=function(e,n){v&&a.key&&A.show(),_.each(e,function(e){e.showUser=e.user!==a.key}),d.render(e,n)},h.fetch=function(){u===c?d.fetch():u.isUser?d.fetch("",u.value):d.fetch("","",u.value)},b.submitEvent=function(){var e=y.val();e===f.JoinChannelOptionValue&&(e=jQuery.trim(E.val())),e?d.submitEvent(e):d.submitEvent(u.value)},h.selected=function(e){return void 0!==e&&e&&!v&&(A.hide(),h.fetch(),v=!0),d.selected(e)},G(w[0]),b};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs.PlayerTabHeader=function(t,e,n,o,a){var r,s,i=t.find(".player-seek-text"),l=!1;return t.addClass(o?Panopto.Viewer.Constants.PrimaryTabHeaderClass:Panopto.Viewer.Constants.SecondaryTabHeaderClass),a&&t.find(".player-tab-wrapper > i").html(a),Panopto.Core.UI.Handlers.hoverableParent(t,i,function(e){t.hasClass(Panopto.Core.Constants.InactiveClass)&&!t.hasClass(Panopto.Core.Constants.DisabledClass)&&e?(i.show(),Panopto.viewer.allowMultipleSecondaryDisplay||i.css("left",(t.filter(":visible").width()-i.filter(":visible").outerWidth())/2)):i.hide()}),{available:function(o){var e=PanoptoTS.Viewer.Logic.TimelineLogic.isOnTimeline(n,o);t.toggleClass(Panopto.Core.Constants.InactiveClass,!e),!e&&s&&t.blur(),s=e;var a=_.find(n,function(e){return o<e});return r=e?void 0:a||n[0],i.text(Panopto.GlobalResources.ViewerPlus_SecondarySeekText.format(Panopto.Core.TimeHelpers.formatDuration(a||n[0],Panopto.GlobalResources.TimeSeparator))),e},selected:function(e){if(void 0===e)return l;t.toggleClass(Panopto.Core.Constants.SelectedClass,e),e&&!l&&i.hide(),t.attr("aria-pressed",e),l=e},owns:function(e){return 1===t.filter(function(){return this===e}).length},id:function(){return e},seekTime:function(){return r},timeline:function(e){n=e}}};
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},PanoptoLegacy.Viewer.Tabs.SearchTab=function(e,t,o,a,n,r){var s,l=Panopto.Viewer.Constants,c=[],i=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(e,t,o,a,c,"",!1,Panopto.Viewer.Analytics.Labels.Search,r),p=i,u=Panopto.Core.Extensions.base(i),h="placeholder",P="searchable",f=$("#searchRegion"),g=f.find("#searchInput"),d=f.find("#searchButton"),v=f.find(".clear-button"),y=t.find("#searchTypeSelect"),C=t.find("#searchSortSelect");f.toggle(!0),i.toggleHeader(!1);var m=[{value:"",name:Panopto.GlobalResources.ViewerPlus_Search_All}];return _.each(Panopto.API.EventType,function(e,o){m.push({value:e,name:Panopto.GlobalResources[l.SearchTypeResourceString.format(o)]})}),y.html(_.template($("#searchOptionTemplate").html())({searchOptions:m})),C.html(_.template($("#searchOptionTemplate").html())({searchOptions:l.SearchSortOrders})),g.keydown(function(e){e.keyCode===Panopto.Core.Key.Enter&&i.fetch(),e.stopPropagation()}),g.keyup(function(){f.toggleClass(P,""!==jQuery.trim(g.val()))}),g.focus(function(){f.toggleClass(P,!g.hasClass(h)&&""!==jQuery.trim(g.val())),o.fireFocused()}),p.setQueryText=function(e){g.val(e),g.toggleClass(h,!1)},y.change(function(){i.fetch()}),y.keydown(function(e){return e.stopPropagation()}),C.change(function(){var o=[];_.each(c,function(e){o.push(e)}),C.val()===l.SortTimeValue?i.render(o,void 0,void 0,void 0,void 0):i.fetch()}),C.keydown(function(e){return e.stopPropagation()}),Panopto.Core.UI.Handlers.button(d,function(){i.fetch()}),Panopto.Core.UI.Handlers.button(v,function(){g.val(""),f.removeClass(P),g.focus(),i.fetch()}),Panopto.Core.UI.Components.placeholder(g,Panopto.GlobalResources.ViewerPlus_SearchHeader,h),i.selected=function(e){if(void 0===e)return u.selected();u.selected(e),f.toggleClass(Panopto.Core.Constants.SelectedClass,e)},i.render=function(e){var o;_.each(e,function(e){e.iconClass=e.type,"Notes"===e.type&&(n&&n.key===e.user||(e.showUser=!0))}),u.render(e,!0,C.val()===l.SortRelevanceValue),(o=!!e.length)||t.find("#searchResultsMessage").html(PanoptoTS.StringHelpers.format(Panopto.GlobalResources.ViewerPlus_Search_NoResults,PanoptoTS.StringHelpers.format("<span class='match'>{0}</span>",Panopto.Core.TextHelpers.cleanTextWithHighlighting(s)))),t.find("#searchResultsMessage").toggle(!o)},i.fetch=function(){s=g.hasClass(h)?"":jQuery.trim(g.val()),f.toggleClass("search-active",!!s),i.toggleHeader(!!s),o.fireSearchStarted(s),u.fetch(s,"","",y.val())},p};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs.SecondaryTab=function(i,o,a,r){var s,l,n=Panopto.Viewer.Analytics,c=Panopto.Viewer.Constants,u=$(),t=!0,e=function(e){if(void 0===e)return t;t=e,s.toggleClass(Panopto.Core.Constants.DisabledClass,!t),u.attr("aria-disabled",String(!t))},d=function(e,t){if(void 0===e)return l.selected();o.toggle(e),e&&!l.selected()&&(i.setContentClass(a.tabClass),o.setContent(a,!1,null),i.setSelectedText(a.title),i.setSelectedIcon(r,a.iconClass),t&&n.sendEvent({action:n.Actions.SecondaryTab,label:a.tabClass})),l.selected(e),u.attr("aria-checked",String(!!e))},f=function(e,t,n,i){var a=o;return a.setSecondaryPosition?a.setSecondaryPosition(e,t,n,i):o.setPosition(e,i)},b=function(e){a=e,l.timeline(e.timeline),l.selected()&&o.setContent(e,!1,null)};return{getPlayer:function(){return o},render:function(){if(a.hiddenTab)s=$();else{var e=_.template($("#playerTabHeaderTemplate").html().trim()),t=$(e({content:a,type:"inline",tabindex:0})),n=$(e({content:a,type:"flyout",tabindex:0}));(u=t.add(n)).attr("role","menuitemradio").attr("aria-checked","false").attr("aria-label",_.escape(a.title)),i.addTab(t[0],n[0]),s=t.add(n)}l=Panopto.Viewer.Tabs.PlayerTabHeader(s,a.id,a.timeline,!1,r)},remove:function(){o.remove(),s.remove()},position:f,setPosition:f,playState:function(e){o.playState(e)},bitrate:function(e){o.bitrate(e)},numericBitrate:function(){return o.numericBitrate()},hasMBR:function(){return o.hasMBR()},bitrateLevelOffset:function(){return o.bitrateLevelOffset()},playSpeed:function(e){o.playSpeed(e)},content:function(e){if(void 0===e)return a;b(e)},setContent:b,resize:function(e,t){o.resize(e,t)},available:function(e){return l.available(e)},timeline:function(){return a.timeline},relativeStartTime:function(){return a.relativeStartTime},absoluteStartTime:function(){return a.absoluteStartTime},selected:d,setSelected:d,id:function(){return l.id()},owns:function(e){return l.owns(e)},seekTime:function(){return l.seekTime()},pauseWhenAvailable:function(){return a.pauseWhenAvailable},isSessionPlaybackBlocking:function(){return a.isSessionPlaybackBlocking},hiddenTab:function(){return a.hiddenTab},adjustTimeline:function(e){var t=e-c.TimedSyncRate/1e3*1.5;a.pauseWhenAvailable&&a.timeline[0]>t&&(a.timeline[0]=t)},enabled:e,setEnabled:e}};
var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.TranscriptTab=function(o,n,e,t,a){var i=Panopto.API,r=PanoptoLegacy.Viewer.Tabs.ViewerEventTab(o,n,e,t.id,[],Panopto.API.EventType.Transcript,!0,Panopto.Viewer.Analytics.Labels.Transcript,a);return r.fetch=function(){r.toggleLoading(!0),i.Delivery.getCaptions(t.id,a,function(o){t.captions=_.map(o,function(o){return new PanoptoTS.Viewer.Data.Event(o)}),r.render(t.captions,!0,void 0,void 0,void 0),r.error(!1),r.toggleLoading(!1)},function(){r.fetchError(void 0,void 0,void 0,void 0),r.toggleLoading(!1)})},r.fetch(),r};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},PanoptoLegacy.Viewer.Tabs.ViewerEventTab=function(e,n,o,r,t,a,i,p,P){var b=PanoptoLegacy.Viewer.Tabs.EventTab(e,n,o,r,t,a,i,p,P),s=Panopto.Core.Extensions.base(b);return b.render=function(e,n,o,r,t){e=_.filter(e,function(e){return!!jQuery.trim(e.text)}),s.render(e,n,o,r,t)},b};
var PanoptoTS;!function(e){var i,t,o;i=e.Viewer||(e.Viewer={}),t=i.Tabs||(i.Tabs={}),o=function(){function e(){}return e.create=function(t,e,i,o){return{userSeekEnabled:t.userSeekEnabled,setPosition:t.setPosition,resize:function(){t.resize&&t.resize()},isActiveBroadcast:t.isActiveBroadcast,fireFocused:e,isLive:t.isLive,position:t.position,getPosition:t.getPosition,activePrimary:t.activePrimary,activeSecondary:t.activeSecondary,hotkey:t.hotkey,toggleScreens:t.toggleScreens,setSecondaryCount:t.setSecondaryCount,reinitializeDelivery:t.reinitializeDelivery,synchronize:t.synchronize,viewMode:function(e){var i;return t.viewMode&&(i=t.viewMode(e)),i},fireTabSelected:i,fireSearchStarted:o}},e}(),t.ViewerEventTabHelpers=o}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,o,u,n,r;t=e.Viewer||(e.Viewer={}),o=t.Test||(t.Test={}),r=function(){function e(){}return e.toLogLine=function(e,t,o,u,n){return e+"\t"+t+"\t"+o+"\t"+u+(void 0!==n?"\t"+n:"")},e.fromLogLine=function(e){var t=e.split("\t");return{source:t[0].toLowerCase(),time:parseInt(t[1]),playerName:t[2],type:t[3].toLowerCase(),value:t[4]}},e}(),o.PlayerScriptEvent=r,(u=o.ViewerEventSource||(o.ViewerEventSource={}))[u.LogInput="loginput"]="LogInput",u[u.LogOutput="logoutput"]="LogOutput",u[u.LogDefer="logdefer"]="LogDefer",u[u.None="none"]="None",u[u.LogInputAndOutput="loginputandoutput"]="LogInputAndOutput",(n=o.ViewerEventType||(o.ViewerEventType={}))[n.Load="load"]="Load",n[n.Play="play"]="Play",n[n.Pause="pause"]="Pause",n[n.Stop="stop"]="Stop",n[n.Seek="seek"]="Seek",n[n.Speed="speed"]="Speed",n[n.Bitrate="bitrate"]="Bitrate",n[n.Fullscreen="fullscreen"]="Fullscreen",n[n.Volume="volume"]="Volume",n[n.Mute="mute"]="Mute"}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t;(function(o){var e=function(){function e(e){this.script=this.parseScriptBlob(e),this.playerNames=_.uniq(_.pluck(this.script,"playerName"))}return e.prototype.getPlayerNames=function(){return this.playerNames},e.prototype.start=function(e,t,o,i,p){var r={};_.each(t,function(e){var t=$.parseHTML("<div />");i.append(t),r[e]=new n(e,$(t),o)}),this.beginScript(e,r,p)},e.prototype.beginScript=function(e,o,t){var i,p,r=this,n=-1,a=function(){for(;++n<r.script.length&&(!o[r.script[n].playerName]||r.script[n].source!==e););n<r.script.length?s():t&&t()},s=function(){var e,t=r.script[n];i?e=t.time-i-((new Date).getTime()-p):(p=(new Date).getTime(),i=t.time,e=0),30<e?setTimeout(s,e-30):4<e?setTimeout(s):(o[t.playerName].runEvent(t,i-p),a())};a()},e.prototype.parseScriptBlob=function(e){return _.map(e.split("\n"),function(e){return o.PlayerScriptEvent.fromLogLine(e)})},e}();o.ScriptedViewer=e;var n=function(){function e(e,t,o){if("flowplayer"===o.toLowerCase())this.playerStub=new i(t);else if("video"===o.toLowerCase())this.playerStub=new p(t);else{if("panoptoflowplayer"!=o.toLowerCase())throw"Unknown player stub "+o;this.playerStub=new r(PanoptoLegacy.Viewer.Players.FlowPlayer("primary"==e.toLowerCase(),t,{resize:$.noop,togglePlaying:$.noop,writeLineToClientLog:$.noop}))}this.playerName=e}return e.prototype.runEvent=function(e,t){switch(o.PlayerScriptEvent.toLogLine(e.source,t+(new Date).getTime(),e.playerName,e.type,e.value),e.type){case o.ViewerEventType.Load:this.playerStub.load(e.value);break;case o.ViewerEventType.Play:this.playerStub.play();break;case o.ViewerEventType.Pause:this.playerStub.pause();break;case o.ViewerEventType.Stop:this.playerStub.stop();break;case o.ViewerEventType.Seek:this.playerStub.seek(parseFloat(e.value)||0);break;case o.ViewerEventType.Speed:this.playerStub.speed(parseFloat(e.value)||0);break;case o.ViewerEventType.Bitrate:this.playerStub.bitrate(parseFloat(e.value)||0);break;case o.ViewerEventType.Fullscreen:this.playerStub.fullscreen("true"==e.value.toLowerCase());break;case o.ViewerEventType.Volume:this.playerStub.volume(parseFloat(e.value));break;case o.ViewerEventType.Mute:this.playerStub.mute("true"==e.value.toLowerCase())}},e}(),i=function(){function o(e){this.$element=e,this.ensureInitialized()}return o.prototype.load=function(e){var t={sources:[{src:e,type:-1!==e.indexOf(".m3u8")?o.HLSMimeType:o.MP4MimeType}]};this.api?this.api.load(t):this.api=flowplayer(this.$element,{clip:t})},o.prototype.play=function(){this.api.resume()},o.prototype.pause=function(){this.api.pause()},o.prototype.stop=function(){this.api.stop()},o.prototype.seek=function(e){this.api.seek(e||0)},o.prototype.speed=function(e){this.api.speed(e)},o.prototype.bitrate=function(e){},o.prototype.fullscreen=function(e){e!=this.api.isFullscreen&&this.api.fullscreen()},o.prototype.volume=function(e){this.api.volume(e/100)},o.prototype.mute=function(){this.api.mute(!0)},o.prototype.ensureInitialized=function(){flowplayer.conf.hlsjs||(flowplayer.conf.hlsjs={startLevel:"auto",safari:!0})},o.MP4MimeType="video/mp4",o.HLSMimeType="application/x-mpegURL",o}(),p=function(){function e(e){this.video=$.parseHTML("<video />")[0],e.append(this.video),this.hls=new Hls,this.hls.attachMedia(this.video)}return e.prototype.load=function(e){e.indexOf(".m3u8")?this.hls.loadSource(e):this.video.src=e},e.prototype.play=function(){this.video.play()},e.prototype.pause=function(){this.video.pause()},e.prototype.stop=function(){this.hls.stopLoad()},e.prototype.seek=function(e){this.video.currentTime=e},e.prototype.speed=function(e){this.video.playbackRate=e},e.prototype.bitrate=function(e){},e.prototype.fullscreen=function(e){e?this.video.requestFullscreen():this.video.stopFullscreen()},e.prototype.volume=function(e){this.video.volume=e/100},e.prototype.mute=function(){this.video.muted=!0},e}(),r=function(){function e(e){this.panoptoPlayer=e}return e.prototype.load=function(e){this.panoptoPlayer.content({url:e,isBroadcast:!1,isAudioOnly:!1})},e.prototype.play=function(){this.panoptoPlayer.playState(1)},e.prototype.pause=function(){this.panoptoPlayer.playState(2)},e.prototype.stop=function(){this.panoptoPlayer.playState(3)},e.prototype.seek=function(e){this.panoptoPlayer.position(e)},e.prototype.speed=function(e){this.panoptoPlayer.playSpeed(e)},e.prototype.bitrate=function(e){this.panoptoPlayer.bitrate(e)},e.prototype.fullscreen=function(e){this.panoptoPlayer.isFullscreen(e)},e.prototype.volume=function(e){this.panoptoPlayer.volume(e)},e.prototype.mute=function(e){this.panoptoPlayer.muted(e)},e}()})((t=e.Viewer||(e.Viewer={})).Test||(t.Test={}))}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var o;(function(r){var e=function(){function t(){}return t.createLogger=function(e){if(!t.source){var o=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),!1,!0);t.source=o.scriptmode?o.scriptmode.toString().toLowerCase():r.ViewerEventSource.None}return t.source!==r.ViewerEventSource.None?new n(t.source,e):new i},t}();r.ViewerScriptLoggerFactory=e;var n=function(){function e(e,o){this.scriptMode=e,this.playerName=o}return e.prototype.log=function(e,o,t){e!==this.scriptMode&&(this.scriptMode!=r.ViewerEventSource.LogInputAndOutput||e!=r.ViewerEventSource.LogInput&&e!=r.ViewerEventSource.LogDefer&&e!=r.ViewerEventSource.LogOutput)||console.log(r.PlayerScriptEvent.toLogLine(e,(new Date).getTime(),this.playerName,o,t))},e}(),i=function(){function e(){}return e.prototype.log=function(e,o,t){},e}()})((o=e.Viewer||(e.Viewer={})).Test||(o.Test={}))}(PanoptoTS||(PanoptoTS={}));

var PanoptoTS,Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},function(e){var t,n,i;t=e.Viewer||(e.Viewer={}),n=t.Controls||(t.Controls={}),i=function(e,t,n){this.element=e,this.start=t,this.end=n,this.start=t/Panopto.Core.Constants.TimelineChunkMultiplier,this.end=n/Panopto.Core.Constants.TimelineChunkMultiplier},(n.Timeline||(n.Timeline={})).TimelineSegment=i}(PanoptoTS||(PanoptoTS={})),Panopto.Viewer.Controls.Timeline.TimelineConverter=function(u,e){var p,C,P,h=function(){_.each(e.secondaryStreams,function(n){n.segments.length=0,n.timeline.length=0,_.each(C,function(e){var t=e.element.getStreamById(n.id);t&&(n.segments.push({relativeStart:e.start,relativeEnd:e.end,streamOffset:t.offset/Panopto.Core.Constants.TimelineChunkMultiplier,timelineStart:e.start}),n.timeline.push(e.start,e.end))})})},i=function(){var e;P.length?e=P[P.length-1].end:e=p.duration()/Panopto.Core.Constants.TimelineChunkMultiplier;return e};return{timelinePosition:function(t){var e,n=t;return P&&(_.some(P,function(e){return e.start<=t&&e.end>=t})||(n=(e=_.find(P,function(e){return e.start>t}))?e.start:i())),n},timelineEndPosition:i,computeSegments:function(e,t){p=e;_.sortBy(p.streams(),"absoluteStart");var n,i,o=t?p.createTimeline(!0):p.timeline(),r=o.elements(),a=o.firstPrimaryIndex(),s=o.lastPrimaryIndex(),l=0,m=p.firstPrimaryOffset()/Panopto.Core.Constants.TimelineChunkMultiplier;for(C=[],P=[],n=0;n<=r.length-1;n++)a<=n&&n<=s&&(i=new PanoptoTS.Viewer.Controls.Timeline.TimelineSegment(r[n],l,l+r[n].length()),C.push(i),r[n].containsPrimary()&&P.push(i)),l+=r[n].length();_.each(C,function(e){e.start-=m,e.end-=m}),u.setPrimarySegments(C,P,p.duration()/Panopto.Core.Constants.TimelineChunkMultiplier,!t),h()},getSegments:function(){return C}}};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},Panopto.Viewer.Controls.Timeline.TimelineEditor=function(w,R,e,E,y,I){var V,u,k,D,O,A,U,L,M,C,t,G,n,j,o,x={},q=!0,N=[],F=!1,i=[],r=new Panopto.Core.JobQueue({maxDegreeOfParallelism:1,maxAttempts:1,autoStart:!0}),z=[],Q=!0,H=new PanoptoTS.Core.Logic.Time.TimeConverter,B=new PanoptoTS.Viewer.Tabs.Editor.EventService(H);B.eventAdded.add(function(e){ve(),U.events().push(e),U.refreshTimeline(),de()});var s,W=function(e){g(e.uploadId)},J=function(e){me()},a=new PanoptoTS.Models.TypedCallback,Y=$("#timelineContainer"),Z=$("#playControls"),l=$("#saveMessageText"),c=$("#saveRetryLink"),K=$("#undoButton"),X=$("#redoButton"),ee=$("#commitButton"),te=$("#revertButton"),ne=$("#closeButton"),oe=$("#advancedEditorLink"),ie=$("#toggleTimelineButton"),re=$("#slideStackExpandedView"),se=$("#slideStackExpandedViewTriangle"),ae=re.add(se),P=function(r){var e=$.Deferred(),t=$.Deferred(),n=$.Deferred(),o=$.Deferred(),i=$.Deferred(),s=$.Deferred(),a=[t,n,o,i,s];return y.getAllStreams(r.referencedSessionId,function(e){r.streams=e,t.resolve()},function(){t.reject()}),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCuts(r.referencedSessionId,function(e){r.cuts=e,n.resolve()},function(){n.reject()}),Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(r.referencedSessionId,{eventTypes:[Panopto.Core.EventType.Label],pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){r.events=e,o.resolve()},function(){o.reject()}),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideEvents(r.referencedSessionId,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){r.slideEvents=_.filter(e,function(e){return e.timelineTime}),i.resolve()},function(){i.reject()}),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCaptions(r.referencedSessionId,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){r.captions=e,s.resolve()},function(){s.reject()}),$.when.apply($,a).then(function(){var i=[].concat(r.events).concat(r.slideEvents).concat(r.captions);r.timelineState=new PanoptoTS.Core.UI.Components.Editor.TimelineState(r.streams,r.cuts,i,void 0,void 0,void 0,void 0),_.chain(r.cuts).each(function(n){var e=n.start/Panopto.Core.Constants.TimelineChunkMultiplier,o=(n.start+n.duration)/Panopto.Core.Constants.TimelineChunkMultiplier;if(n.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream){var t=(_.find(r.timelineState.streams(),function(e){return e.id===n.targetId}).absoluteStart-r.timelineState.absoluteStart())/Panopto.Core.Constants.TimelineChunkMultiplier;e+=t,o+=t}_.each(i,function(t){(n.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session||t.streamId===n.targetId)&&t.editorTime>=e&&t.editorTime<o&&(t.editorTime=-1,i.splice(_.findIndex(i,function(e){return e.id===t.id}),1))})}),r.events=_.filter(r.events,function(e){return-1!==e.editorTime}),r.slideEvents=_.filter(r.slideEvents,function(e){return-1!==e.editorTime}),r.captions=_.filter(r.captions,function(e){return-1!==e.editorTime}),_.chain(r.cuts).sortBy(function(e){return-e.start}).each(function(e){if(e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session){var t=e.start/Panopto.Core.Constants.TimelineChunkMultiplier,n=e.duration/Panopto.Core.Constants.TimelineChunkMultiplier;_.each(i,function(e){e.editorTime>=t&&(e.editorTime=e.editorTime-n)})}}),e.resolve(r)}).fail(function(){e.reject()}),e},le=function(e,n,o){var i=$.Deferred();return y.getOne(e,function(e){var t=new PanoptoTS.Core.ServiceInterface.Rest.Objects.SessionReference({id:_.uniqueId("newSessionReference"),referencedSessionId:e.id,referencedSessionDuration:e.duration,start:n,order:o,name:e.name,typeName:"SessionReference"});P(t).done(function(e){i.resolve(e)})}),i.promise()},d=function(t){return _.find(U.streams(),function(e){return e.id===t})},p=function(e){var t;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:t=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:t=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:t=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return t},ue=function(e,t,n,o){var i=(e=e||d(t)).name;return i||(i=p(e)),n?o?Panopto.GlobalResources.ViewerPlus_Edit_StreamNameAndType.format(i,e.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary.toLowerCase()+" "+o:Panopto.GlobalResources.ViewerPlus_Edit_Secondary.toLowerCase()+" "+o):Panopto.GlobalResources.ViewerPlus_Edit_StreamNameAndType.format(i,e.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary.toLowerCase():Panopto.GlobalResources.ViewerPlus_Edit_Secondary.toLowerCase()):i},f=function(){H.applyState(U),B.applyState(V.id,U),De.applyState(U),G.events(U.streams()),k.cuts(U.cuts()),t.events(U.cuts()),n&&n.events(U.questionLists()),U.events().sort(function(e,t){return e.timelineTime-t.timelineTime||e.id.localeCompare(t.id)}),_.each(i,function(e){e.events(U.events())}),j.thumbnails(U.events())},ce=function(e){var t,n,o,i;D.computeSegments(U,q),me(),e||(j.toggle(!Q),R.resize(),t=_.filter(U.getExpandedEvents(),function(e){return!e.isDefaultThumbnail}),n=_.filter(t,function(e){return e.link}),o=_.filter(t,function(e){return e.type===Panopto.Core.EventType.SlideChange}),i=_.filter(t,function(e){return e.type===Panopto.Core.EventType.Caption}),E.documents.length=0,_.each(U.questionLists(),function(e){var t=H.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks).seconds();E.documents.push({title:e.name,id:"urlTab"+e.id,timeline:[t,t+Panopto.Viewer.Constants.UrlEventDuration],url:Panopto.Viewer.Constants.QuizEditUrlTemplate.format(e.id),iconCode:Panopto.Core.Constants.QuestionListIconCode,pauseWhenAvailable:!0,hiddenTab:!0})}),_.each(n,function(e){var t=-1!==e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl),n=t&&e.sessionId===E.id?Panopto.Viewer.Constants.YouTubeEditUrlTemplate.format(e.id):e.link;E.documents.push({title:e.name||Panopto.GlobalResources.ViewerPlus_Website,id:"urlTab"+e.id,timeline:[e.viewerTime,e.viewerTime+Panopto.Viewer.Constants.UrlEventDuration],url:n,pauseWhenAvailable:!0,iconClass:t?Panopto.Viewer.Constants.YouTubeIconClass:void 0,iconCode:t?void 0:Panopto.Core.Constants.LinkIconCode})}),E.documents.sort(function(e,t){return e.timeline[0]-t.timeline[0]}),E.slideDecks.length=0,o.length&&E.slideDecks.push({title:Panopto.GlobalResources.ViewerPlus_SlidesTitle,id:Panopto.Viewer.Constants.SlideDeckId,timeline:[0],slides:_.map(o,function(e){return{time:e.viewerTime,url:e.slideUrl}}),iconCode:Panopto.Core.Constants.SlideIconCode,tabClass:Panopto.Viewer.Constants.SlideDeckTabClass}),E.hasCaptions=!!i.length,i.length&&(E.captions=[],_.each(i,function(e){E.captions.push({time:e.viewerTime,text:_.escape(e.name)})})),_.each(U.sessionReferences,function(e){_.chain(e.streams).filter(function(e){return!e.isPrimary}).each(function(n){var o=[],i=[];_.each(D.getSegments(),function(e){var t=e.element.getStreamById(n.id);t&&(o.push({relativeStart:e.start,relativeEnd:e.end,streamOffset:t.offset/Panopto.Core.Constants.TimelineChunkMultiplier,timelineStart:e.start}),i.push(e.start,e.end))});var e={title:ue(n,void 0),id:n.id,tabClass:n.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio||n.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen?Panopto.Viewer.Constants.ScreenCaptureClass:Panopto.Viewer.Constants.ObjectVideoTabClass,iconClass:void 0,iconCode:void 0,timeline:i,relativeStartTime:void 0,absoluteStartTime:n.absoluteStart,hiddenTab:!1,pauseWhenAvailable:!1,isSessionPlaybackBlocking:!1,isBroadcast:!1,isSecondaryPaneOnly:!1,interrupted:!1,isAudioOnly:!1,optimizationToken:void 0,url:n.url,httpUrl:n.httpUrl,fileType:void 0,type:n.type,relativeStart:void 0,relativeEnd:void 0,length:void 0,segments:o,vrType:n.vrType},t=_.findIndex(E.secondaryStreams,function(e){return e.id===n.id});-1<t?E.secondaryStreams.splice(t,1,e):E.secondaryStreams.push(e)})}),_.each(E.primaryStreams.concat(E.secondaryStreams),function(e){e.title=void 0!==e.title?e.title:ue(void 0,e.id),e.vrType=void 0!==e.vrType?e.vrType:d(e.id).vrType}),R.refreshPlayers()),R.synchronize(!e)},de=function(e){f(),e?O.applyStateWhenChangeIsTimelineViewTriggered(U):O.applyState(U),ce(e),h()},m=function(){f(),O.applyState(U),ce()},pe=function(){var e=N.indexOf(U);if(e){var t=R.getPosition(),n=H.toWin32EpochRelative(t);(U=N[e-1]).refreshTimeline(),de(),R.setPosition(U.calculateEditorTimeFromAbsolute(n.ticks()))}},fe=function(){var e=N.indexOf(U);if(e<N.length-1){var t=R.getPosition(),n=H.toWin32EpochRelative(t);(U=N[e+1]).refreshTimeline(),de(),R.setPosition(U.calculateEditorTimeFromAbsolute(n.ticks()))}},me=function(){var e=N.indexOf(U);K.toggleClass(Panopto.Core.Constants.DisabledClass,!e),X.toggleClass(Panopto.Core.Constants.DisabledClass,e===N.length-1);var t=U!==A&&u.id;te.toggleClass(Panopto.Core.Constants.DisabledClass,!t);var n=window.streamUploader&&window.streamUploader.hasActiveUploads();ee.toggleClass(Panopto.Core.Constants.DisabledClass,!t||n),ee.attr("title",n?Panopto.GlobalResources.ViewerPlus_Edit_PublishBlockedByNewStreams:Panopto.GlobalResources.ViewerPlus_Edit_PublishTitle)},ve=function(){var e=N.indexOf(U),t=U.copy();N.splice(e+1,N.length-1-e,t),U=t,f()},Ce=function(e){return _.each(e,function(e){e.sessionId=E.id}),_.filter(e,function(e){return e.timelineTime})},v=function(e){F=!0,clearTimeout(s),l.show(),l.text(e),l.removeClass(Panopto.Core.Constants.ErrorClass),ee.add(te).toggleClass(Panopto.Core.Constants.DisabledClass,!0),c.hide()},T=function(e,t,n){F=!1,me(),t?(l.text(e.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(Date.now(),Panopto.timeZone),"LT"))),s=setTimeout(function(){l.fadeOut()},2e4)):(l.text(e),l.addClass(Panopto.Core.Constants.ErrorClass),c.toggle(!!n),Panopto.Core.UI.Handlers.button(c,n))},S=function(e){"SessionChangeSet Update can't change the owner of the change set"!==e.responseJSON&&"Object not found"!==e.responseJSON&&"Session already has an uncommitted change set."!==e.responseJSON||(u.id=void 0,K.add(X).add(ee).add(te).toggleClass("disabled",!0),R.toggleMessage(Panopto.GlobalResources.ViewerPlus_Edit_ChangesLost))},h=function(){r.hasQueuedJobs()||r.queueJob({attempt:function(t){var n,o,i,r,s,a,l=function(){T(Panopto.GlobalResources.ViewerPlus_Edit_SavedAt,!0),t(!0)},e=function(e){T(Panopto.GlobalResources.ViewerPlus_Edit_SaveFailure,!1,h),S(e),t(!1)};U===A?Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(u.id,function(){u=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:E.id}),l()},e):(n=_.object(_.map(L,function(e){return e.id}),L),o=_.object(_.map(U.events(),function(e){return e.id}),U.events()),i=_.object(_.map(M,function(e){return e.id}),M),r=_.object(_.map(U.questionLists(),function(e){return e.id}),U.questionLists()),s=_.object(_.map(C,function(e){return e.id}),C),a=_.object(_.map(U.sessionReferences,function(e){return e.id}),U.sessionReferences),u.cutsToReplace=_.map(U.cuts(),function(e){return e.copy()}),u.streamsToUpdate=U.streams(),u.slideDecksToDelete=U.slideDecksToDelete(),u.eventsToAdd=_.filter(U.events(),function(e){return!n[e.id]}),u.eventsToUpdate=_.filter(U.events(),function(e){return n[e.id]&&e.edited}),u.eventsToDelete=_.filter(L,function(e){return!o[e.id]}),u.questionListRevisions=_.chain(U.questionLists()).filter(function(e){return!i[e.id]||e.isEdited}).map(function(e){return e.toClientModel()}).value(),u.questionListIdsToDelete=_.map(_.filter(M,function(e){return!r[e.id]}),function(e){return e.id}),u.sessionReferences.toAdd=_.chain(U.sessionReferences).filter(function(e){return!s[e.id]}).map(function(t){var n=new AutoClientModels.SessionReferenceCreate;return n.referencedSessionId=t.referencedSessionId,n.order=t.order,n.start=t.start,n.cuts=[],_.chain(U.cuts()).filter(function(e){return e.targetId===t.id}).each(function(e){var t=new AutoClientModels.SessionReferenceCreateCut;t.start=e.start/Panopto.Core.Constants.TimelineChunkMultiplier,t.duration=e.duration/Panopto.Core.Constants.TimelineChunkMultiplier,n.cuts.push(t)}),u.cutsToReplace=_.reject(u.cutsToReplace,function(e){return e.targetId===t.id}),n}).value(),u.sessionReferences.toUpdate=_.chain(U.sessionReferences).filter(function(e){return s[e.id]&&e.edited}).map(function(e){var t=new AutoClientModels.SessionReferenceUpdate;return t.id=e.id,t.order=e.order,t.start=e.start,t}).value(),u.sessionReferences.toDelete=_.chain(C).filter(function(e){return!a[e.id]}).map(function(e){return e.id}).value(),U.addedStreams.length&&(u.streamChanges=new AutoClientModels.StreamChanges,u.streamChanges.toAdd=_.map(U.addedStreams,function(e){var t=new AutoClientModels.StreamCreate;return t.copyFromStreamCreate(e),t})),v(Panopto.GlobalResources.ViewerPlus_Edit_Saving),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.save(u,function(e){u.id=e.id,l()},e))}})},Pe=function(){r.queueJob({attempt:function(t){U!==A&&u.id&&(v(Panopto.GlobalResources.ViewerPlus_Edit_Publishing),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.commitChanges(u,function(){T(Panopto.GlobalResources.ViewerPlus_Edit_PublishedAt,!0),u.id=void 0,t(!0),confirm(Panopto.GlobalResources.ViewerPlus_Edit_ContinueEditing)?ne.click():window.location.reload()},function(e){T(Panopto.GlobalResources.ViewerPlus_Edit_PublishFailure,!1,Pe),S(e),t(!1)}))}})},Te=function(){confirm(Panopto.GlobalResources.ViewerPlus_Edit_ConfirmRevert)&&(r.emptyQueue(),r.queueJob({attempt:function(n){U!==A&&u.id&&(v(Panopto.GlobalResources.ViewerPlus_Edit_Reverting),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(u.id,function(){T(Panopto.GlobalResources.ViewerPlus_Edit_RevertedAt,!0),u=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:E.id});var e=R.getPosition(),t=H.toWin32EpochRelative(e);N.length=0,(U=A).refreshTimeline(),N.push(U),m(),R.setPosition(U.calculateEditorTimeFromAbsolute(t.ticks())),n(!0)},function(e){T(Panopto.GlobalResources.ViewerPlus_Edit_RevertFailure,!1,Te),S(e),n(!1)}))}}))},Se=function(){var e=_.chain(U.streams()).sortBy(function(e){return e.absoluteStart}).filter(function(e){return e.isPrimary}).value(),t=_.pluck(e,"id"),n=_.filter(U.cuts(),function(e){return e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream&&_.contains(t,e.targetId)}),o=Panopto.Core.Logic.Timeline.Timeline(e,n);_.each(o.elements(),function(e){var t,n=e.streams();if(1<n.length)for(t=1;t<n.length;t++)k.addCut(n[t].offset,n[t].offset+e.length(),n[t].stream.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream,!1)})},he=function(e,t,n,o,i){var r;k.addCut(e,t,n||E.id,o,i),r=Panopto.Core.Logic.Timeline.Timeline(U.streams(),U.cuts()),o!==Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session||_.some(r.elements(),function(e){return e.containsPrimary()})||(k.removeAll(E.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session),O.applyState(U),alert(Panopto.GlobalResources.ViewerPlus_Edit_CutEntireSession))},ge=function(e,t,n){var o;switch(n){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:t=E.id,o=U.calculateRelativeTimeForCut(e,t);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:o=U.calculateRelativeTimeForCut(e,t);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:o=e}k.removeCut(o,t,n)},_e=function(e,t,n,o,i){ge(e,o,i),he(t,n,o,i,!1)},be=function(e){var t,n=R.position(),o=!0;if(U.isTimeInSessionReference(n)){var i=U.findNextTimeNotInSessionReference(n);if(i>=U.duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),o=!1;else confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)?t=i:o=!1}else t=n*Panopto.Core.Constants.TimelineChunkMultiplier;var r=Math.floor(U.duration()/Panopto.Core.Constants.TimelineChunkToMillisMultiplier)*Panopto.Core.Constants.TimelineChunkToMillisMultiplier;if(r<=t&&(t=r),o){ve();var s=R.getPosition(),a=new PanoptoTS.Models.Editor.EditableQuestionList;a.id=_.uniqueId("questionList"),a.name=e||Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultName,a.sessionId=V.id,a.firstStreamRelativeTicks=H.toFirstStreamRelative(s),a.isEdited=!0,a.isSessionPlaybackBlocking=!0,a.allowRetake=!0,a.showFinalGrade=!0,a.allowReview=!0,a.questions=[function(){var e=new AutoClientModels.QuestionOption;e.id=_.uniqueId("questionOption"),e.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption1,e.isCorrect=!0;var t=new AutoClientModels.QuestionOption;t.id=_.uniqueId("questionOption"),t.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption2,t.isCorrect=!1;var n=new AutoClientModels.Question;return n.id=_.uniqueId("question"),n.name=Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultQuestionName,n.questionType=AutoRestModels.QuestionType.MultipleChoice,n.options=[e,t],n}()],U.questionLists().push(a),U.refreshTimeline(),de(!1)}},g=function(e){ve();var t=new AutoClientModels.StreamCreate;t.uploadId=e,U.addedStreams.push(t),de()},we=function(e){var t=R.getPosition(),n=H.toWin32EpochRelative(t);ve();var o=_.find(U.events(),function(e){return e.isDefaultThumbnail});o&&U.events().splice(U.events().indexOf(o),1);var i=e?R.activePrimary():R.activeSecondary(),r=Panopto.Core.ServiceInterface.Rest.Objects.Event({sessionId:V.id,timelineTime:n.ticks(),isDefaultThumbnail:!0});if(_.find(U.streams(),function(e){return e.id===i.id}))r.type=Panopto.Core.EventType.Label,r.streamId=i.id;else if(i.id===Panopto.Viewer.Constants.SlideDeckId){r.type=Panopto.Core.EventType.SlideChange;var s=_.filter(U.events(),function(e){return e.type===Panopto.Core.EventType.SlideChange});s=_.sortBy(s,"timelineTime"),r.slideId=s[0].slideId,_.find(s,function(e){if(!(e.timelineTime<=n.ticks()))return!0;r.slideId=e.slideId})}U.events().push(r),de()},b=function(t){var e=_.find(U.events(),function(e){return e.id===t});return e.sessionRelativeTime=U.calculateEditorTimeTicksFromAbsolute(e.timelineTime),e},Re=function(n,e,t,o,i,r,s){var a,l=_.min(_.filter(n,function(e){return e.isPrimary}),function(e){return e.absoluteStart}),u=function(e,t){var n,o;switch(e.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:n=U.calculateRelativeTimeFromRelativeEditorTime(e.relativeEditorStart,e.targetId),o=U.calculateRelativeTimeFromRelativeEditorTime(e.relativeEditorEnd,e.targetId);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:n=e.relativeEditorStart,o=e.relativeEditorEnd}he(n,o,e.targetId,e.targetType,t)},c=function(e){var t=U.calculateEditorTimeFromRelativeEditorTime(e.relativeEditorStart,e.targetId);ge(t,e.targetId,e.targetType)};_.each(E.primaryStreams.concat(E.secondaryStreams),function(t){var e=_.find(n,function(e){return e.id===t.id});e&&(t.length=e.duration/Panopto.Core.Constants.TimelineChunkMultiplier,t.url=e.url,t.httpUrl=e.httpUrl)}),o=Ce(o).concat(Ce(i)).concat(Ce(r)),a=s,_.each(a,function(e){e.sessionId=E.id}),L=o,o=_.map(o,function(e){return e.copy()}),M=s;var d,p,f,m,v,C,P,T,S,h,g=_.map(s,function(e){var t=new PanoptoTS.Models.Editor.EditableQuestionList;return t.copyFromClientModel(e),t});if(d=l,p=n,f=e,m=o,v=Panopto.Core.Logic.Timeline.Timeline(p),C=[],P=d.absoluteStart,_.each(v.elements(),function(e){e.streams().length||C.push({start:P,end:P+e.length(),length:e.length()}),P+=e.length()}),C.reverse(),_.each(C,function(n){var o=[];_.each(p,function(e){e.absoluteStart>=n.end&&(e.absoluteStart-=n.length)}),_.each(f,function(e){e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&e.start+d.absoluteStart>=n.end&&(e.start-=n.length)}),_.each(m,function(t){var e;t.timelineTime>n.start&&t.timelineTime<n.end&&t.type===Panopto.Core.EventType.SlideChange?(e=_.find(m,function(e){return e.type===Panopto.Core.EventType.SlideChange&&e.timelineTime>t.timelineTime}))&&e.timelineTime<=n.end?o.push(t):(t.timelineTime=n.start,t.edited=!0):t.timelineTime>=n.end&&(t.timelineTime-=n.length,t.edited=!0)}),_.each(o,function(e){m.splice(m.indexOf(e),1)})}),_.some(n,function(e){return e.isPrimary})?(Z.show(),Y.show()):(Z.hide(),Y.hide()),k=Panopto.Core.Logic.Timeline.CutEditor(e),D=Panopto.Viewer.Controls.Timeline.TimelineConverter(R,E),O=Panopto.Core.UI.Components.Editor.TimelineView(E.id,E.folder.id,{positionChanged:function(e){R.setPosition(e/Panopto.Core.Constants.TimelineChunkMultiplier)},cutAdded:function(e,t){ve(),u(e,t),de(!0)},cutRemoved:function(e){ve(),c(e),de(!0)},cutResized:function(e,t){var n,o;switch(t.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:n=U.calculateRelativeTimeFromRelativeEditorTime(t.relativeEditorStart,t.targetId),o=U.calculateRelativeTimeFromRelativeEditorTime(t.relativeEditorEnd,t.targetId);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:n=t.relativeEditorStart,o=t.relativeEditorEnd}ve(),_e(e,n,o,t.targetId,t.targetType),de(!0)},focusAdded:function(e,t){ve(),_.each(e,c),_.each(t,function(e){u(e,!1)}),de(!0)},previewChanged:function(e){q=e,ce()},thumbnailChosen:we,uploadChosen:function(){R.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(V.name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:V.id})})},stackExpanded:function(e,t){var n,o,i,r="expanded-view";e.length===z.length&&_.every(z,function(t){return _.any(e,function(e){return t.id===e.id})})?(ae.hide(),z=[]):(z=e,n=Panopto.Viewer.Controls.ThumbnailStrip(re,e,R,x,!0),o=t.offset().left+t.outerWidth()/2,i=t.offset().top-10,re.empty(),n.render(function(){re.show().toggleClass("no-scroll",re[0].scrollWidth===re.innerWidth()).css({left:Math.clamp(o-re.outerWidth()/2,0,$(window).width()-re.outerWidth()),top:i-re.outerHeight()}),se.show().css({left:o,top:i}),$(document).on("mousedown."+r,function(e){re.is(e.target)||se.is(e.target)||0!==re.find(e.target).length||(ae.hide(),$(document).off("mousedown."+r))})}))},sessionReferenceAdded:function(e){var t=U.calculateRelativeTime(R.position()*Panopto.Core.Constants.TimelineChunkMultiplier);t>U.hostDuration()-.1*Panopto.Core.Constants.TimelineChunkMultiplier&&(t=U.hostDuration());var n=_.chain(U.sessionReferences).filter(function(e){return e.start===t}).size().value();le(e,t,n).done(function(e){var t=R.position();ve(),U.sessionReferences.push(e),U.refreshTimeline(),de(),R.setPosition(t)})},streamAddClicked:function(){G.showUploadOverlay(void 0)},questionListAddClicked:function(){be("")},youTubeAddClicked:function(){B.addYouTubeEvent("",R.position())},webpageAddClicked:function(){B.addUrlEvent("",R.position())},timelineExpansionToggled:function(e){R.expandTimeline(e)},addContentExpansionControlToggled:function(e){R.toggleScreens(!e)}},{previewCuts:Panopto.GlobalResources.ViewerPlus_Edit_PreviewCuts,timeSeparator:Panopto.GlobalResources.TimeSeparator,millisecondPrecision:Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision,ViewerPlus_Edit_Expand:Panopto.GlobalResources.ViewerPlus_Edit_Expand,ViewerPlus_Edit_Collapse:Panopto.GlobalResources.ViewerPlus_Edit_Collapse,pointerTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Pointer,cutTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Cut,quizTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Quiz,focusTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Focus,addContentButton:Panopto.GlobalResources.ViewerPlus_Edit_AddContent,thumbnailButton:Panopto.GlobalResources.ViewerPlus_Edit_SetDefaultThumbnail,setPrimaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetPrimaryAsDefaultThumbnail,setSecondaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetSecondaryAsDefaultThumbnail,uploadCustomDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_UploadCustomDefaultThumbnail,zoomIn:Panopto.GlobalResources.ViewerPlus_Edit_ZoomIn,zoomOut:Panopto.GlobalResources.ViewerPlus_Edit_ZoomOut,getStreamName:function(e,t){return ue(e,void 0,!0,t)},presentationName:Panopto.GlobalResources.ViewerPlus_Edit_PresentationViewTitle,noThumbnailUrl:Panopto.cacheRoot+"/Images/no_thumbnail.svg"}),A=U=new PanoptoTS.Core.UI.Components.Editor.TimelineState(n,e,o,[],g,V.referencedSessions,[]),N.push(U),Se(),T=U.cuts(),S=[],h=Panopto.Viewer.Constants.BoundaryCutTolerance*Panopto.Core.Constants.TimelineChunkMultiplier,_.each(T,function(t){var e=_.find(U.streams(),function(e){return e.id===t.targetId}),n=e?e.duration:U.duration();t.start>=n||t.end()<=0?S.push(t):(t.start<0&&(t.start=0),(t.end()>n||Math.abs(t.end()-n)<h)&&(t.duration=n-t.start))}),_.each(S,function(e){T.splice(T.indexOf(e),1)}),!window.slideUploader){var b=w.debug?PanoptoTS.Viewer.Controls.StreamUploaderDebug:PanoptoTS.Viewer.Controls.StreamUploader;window.slideUploader=new b({sessionId:E.id,supportedExtensions:[".ppt",".pptx"],supportedStreamTypes:[Panopto.Core.StreamType.SecondaryPresentation],showStartTime:!1},y,Panopto.Core.ServiceInterface.SessionUploadManagement,Panopto.Core.ServiceInterface.MultipartUploadManager)}if(!window.streamUploader){b=w.debug?PanoptoTS.Viewer.Controls.StreamUploaderDebug:PanoptoTS.Viewer.Controls.StreamUploader;window.streamUploader=new b({sessionId:E.id,supportedExtensions:Panopto.BatchUpload.fileExtensions,supportedStreamTypes:[1,2],showStartTime:!0},y,Panopto.Core.ServiceInterface.SessionUploadManagement,Panopto.Core.ServiceInterface.MultipartUploadManager)}window.streamUploader.onUploaded.add(W),window.streamUploader.onUpdate.add(J),Ee(t),j=Panopto.Viewer.Players.ThumbnailPlayer(o,R,x),Panopto.Core.UI.Handlers.button(K,pe),Panopto.Core.UI.Handlers.button(X,fe),Panopto.Core.UI.Handlers.button(ee,function(){ee.hasClass(Panopto.Core.Constants.DisabledClass)||Pe()}),Panopto.Core.UI.Handlers.button(te,function(){te.hasClass(Panopto.Core.Constants.DisabledClass)||Te()}),me(),$(document).keydown(function(e){if(e.ctrlKey)switch(e.keyCode){case Panopto.Core.Key.Y:fe(),e.preventDefault();break;case Panopto.Core.Key.Z:pe(),e.preventDefault()}}),Panopto.viewer.enableSilverlightEditor&&oe.show().find("a").attr("href",Panopto.Viewer.Constants.SilverlightEditorUrlTemplate.format(E.id)),ie.show(),Panopto.Core.UI.Handlers.button(ie,function(){Q=!Q,Y.toggle(Q),j.toggle(!Q),ie.text(Q?Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonText:Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonText).attr("title",Q?Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonTitle:Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonTitle).toggleClass("previewing",!Q),R.resize()}),$(window).on("beforeunload",function(){return F?Panopto.GlobalResources.ViewerPlus_Edit_UnsavedChanges:void 0}),Panopto.Core.UI.Handlers.button(ne,function(){window.location.search=window.location.search.replace("&edit=true","")}),H.applyState(U),B.applyState(E.id,U),I(),Ve(function(){ke(t)})},Ee=function(e){window.slidesTab?(e&&window.slidesTab.setSlideDecks(e),window.slidesTab.setTimelineEditor(x)):o=e,window.streamTab&&window.streamTab.setTimelineEditor(x)},ye=function(e){var t=[],n=[],o=[],i=[];if(U=U.copy(),(N[0]=U).cuts().length=0,_.each(u.streamsToUpdate,function(t){var e=_.find(U.streams(),function(e){return t.id===e.id});e?(e.name=t.name,e.absoluteStart=t.absoluteStart,e.vrType=t.vrType):(n.push(t),u.cutsToReplace=_.filter(u.cutsToReplace,function(e){return e.targetId!==t.id}),u.eventsToAdd=_.filter(u.eventsToAdd,function(e){return e.streamId!==t.id}),u.eventsToUpdate=_.filter(u.eventsToUpdate,function(e){return e.streamId!==t.id}),u.eventsToDelete=_.filter(u.eventsToDelete,function(e){return e.streamId!==t.id}))}),_.each(n,function(e){u.streamsToUpdate.splice(u.streamsToUpdate.indexOf(e),1)}),_.each(u.cutsToReplace,function(e){U.cuts().push(e)}),_.each(u.slideDecksToDelete,function(t){_.find(e,function(e){return t.id===e.id})?U.slideDecksToDelete().push(t):o.push(t)}),_.each(o,function(e){u.slideDecksToDelete.splice(u.slideDecksToDelete.indexOf(e),1)}),_.each(u.eventsToAdd,function(e){e.type===Panopto.Core.EventType.SpeechRecognition&&(e.forceShow=!0),U.events().push(e)}),_.each(u.eventsToUpdate,function(t){var e=U.events()[_.findIndex(U.events(),function(e){return t.id===e.id})];e?(e.edited=!0,e.name=t.name,e.metadata=t.metadata,e.timelineTime=t.timelineTime,e.link=t.link,e.isDefaultThumbnail=t.isDefaultThumbnail):i.push(t)}),_.each(i,function(e){u.eventsToUpdate.splice(u.eventsToUpdate.indexOf(e),1)}),i.length=0,_.each(u.eventsToDelete,function(t){var e=_.find(U.events(),function(e){return t.id===e.id});e?U.events().splice(U.events().indexOf(e),1):i.push(t)}),_.each(i,function(e){u.eventsToDelete.splice(u.eventsToDelete.indexOf(e),1)}),_.each(u.questionListRevisions,function(t){var e=_.findIndex(U.questionLists(),function(e){return t.id===e.id}),n=new PanoptoTS.Models.Editor.EditableQuestionList;n.copyFromClientModel(t),0<=e?(n.isEdited=!0,U.questionLists()[e]=n):(n.id=_.uniqueId("questionList"),U.questionLists().push(n))}),_.each(u.questionListIdsToDelete,function(t){U.questionLists().splice(_.findIndex(U.questionLists(),function(e){return t===e.id}),1)}),_.each(u.sessionReferences.toAdd,function(e){var n;t.push(le((n=e).referencedSessionId,n.start,n.order).done(function(t){U.sessionReferences.push(t),_.each(n.cuts,function(e){U.cuts().push(Panopto.Core.ServiceInterface.Rest.Objects.Cut({TargetType:Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference,TargetId:t.id,Start:e.start*Panopto.Core.Constants.TimelineChunkMultiplier,Duration:e.duration*Panopto.Core.Constants.TimelineChunkMultiplier}))})}))}),_.each(u.sessionReferences.toUpdate,function(t){var e=_.findIndex(U.sessionReferences,function(e){return t.id===e.id});if(-1<e){var n=U.sessionReferences[e].copy(!0,{order:t.order,start:t.start});U.sessionReferences.splice(e,1,n)}}),_.each(u.sessionReferences.toDelete,function(t){var e=_.findIndex(U.sessionReferences,function(e){return t===e.id});U.sessionReferences.splice(e,1)}),u.streamChanges&&u.streamChanges.toAdd)_.each(u.streamChanges.toAdd,function(e){var t=new AutoClientModels.StreamCreate;t.copyFromStreamCreate(e),U.addedStreams.push(t)});return $.when.apply($,t)},Ie=function(){R.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))},Ve=function(t){Panopto.Core.ServiceInterface.Rest.SessionReferences.get({referencedSessionId:E.id},function(e){e.results.length>Panopto.viewer.spliceHostReprocessLimit?R.toggleMessage(Panopto.Core.StringHelpers.format(Panopto.GlobalResources.ViewerPlus_Edit_MaxReferencedSessionsExceeded,Panopto.viewer.spliceHostReprocessLimit)):(e.results.length&&(alert(Panopto.Core.StringHelpers.format(1===e.results.length?Panopto.GlobalResources.ViewerPlus_Edit_HasReferencedSession:Panopto.GlobalResources.ViewerPlus_Edit_HasReferencedSessions,e.results.length)),O.setCanAddClip(!1)),t())},Ie)},ke=function(t){var n=function(){u=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:E.id}),m()},o=function(e){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.updateOwner(e.id,void 0,function(e){u=e,ye(t).done(function(){R.toggleMessage(void 0),U.refreshTimeline(),k.cuts(U.cuts()),Se(),m(),h()})},Ie)};Panopto.Core.ServiceInterface.Rest.SessionChangeSets.get(E.id,function(e){var t=e.results[0];t?t.ownerId!==Panopto.user.userId?(R.toggleMessage(_.template($("#pendingEditsMessageTemplate").html())({message:Panopto.GlobalResources.ViewerPlus_Edit_PendingChanges.format(t.ownerName,Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(t.updateDate,Panopto.timeZone),"LLL")),claim:Panopto.GlobalResources.ViewerPlus_Edit_TakeOver.format(t.ownerName),discard:Panopto.GlobalResources.ViewerPlus_Edit_Discard.format(t.ownerName)})),Panopto.Core.UI.Handlers.button($(".pending-edits-claim"),function(){o(t)}),Panopto.Core.UI.Handlers.button($(".pending-edits-discard"),function(){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(t.id,function(){R.toggleMessage(void 0),n()},Ie)})):o(t):n()},Ie)};e.eventPane.onTabSetChanged=function(e){i=e.editEventTabs,t=e.editCutTab,G=e.editStreamTab,n=e.editQuestionListTab,Ee(o),o=void 0},Panopto.Core.ServiceInterface.Rest.Sessions.getOne(E.id,function(e){var t,n=[];C=(V=e).referencedSessions,_.each(C,function(e){n.push(P(e))});var o,i=$.Deferred();n.push(i),y.getAllStreams(E.id,function(e){t=e,i.resolve()},function(){i.reject()});var r,s=$.Deferred();n.push(s),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCuts(E.id,function(e){o=e,s.resolve()},function(){s.reject()});var a,l=$.Deferred();n.push(l),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(E.id,function(e){r=e,l.resolve()},function(){l.reject()});var u,c=$.Deferred();n.push(c),Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(E.id,{eventTypes:[Panopto.Core.EventType.Label,Panopto.Core.EventType.SpeechRecognition],pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){a=e,c.resolve()},function(){c.reject()});var d,p=$.Deferred();n.push(p),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideEvents(E.id,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){u=e,p.resolve()},function(){p.reject()});var f,m=$.Deferred();n.push(m),Panopto.Core.ServiceInterface.Rest.Sessions.getAllCaptions(E.id,{pageSize:Panopto.viewer.timelineEditorEventsPageSize},function(e){d=e,m.resolve()},function(){m.reject()});var v=$.Deferred();n.push(v),Panopto.Core.ServiceInterface.Rest.Sessions.getAllQuestionLists(E.id,function(e){f=e,v.resolve()},function(){v.reject()}),$.when.apply($,n).then(function(){Re(t,o,r,a,u,d,f)}).fail(function(){Ie()})},Ie);var De=new PanoptoTS.Viewer.Controls.OverlayUploader(R,H);De.setAbsoluteSessionStart(E.date);var Oe=new PanoptoTS.Viewer.Controls.OverlayController(R.pageStructureElements(),De,Panopto.GlobalResources);return Oe.onShowOverlays.add(function(){R.forceLeftPlayerHeight=!0,R.resize()}),Oe.onCloseOverlays.add(function(){R.forceLeftPlayerHeight=!1,R.resize()}),x.resize=function(e){O.resize(e)},x.synchronize=function(e,t){var n=R.activePrimary(),o=R.activeSecondary(),i=o&&(_.find(U.streams(),function(e){return e.id===o.id})||o.id===Panopto.Viewer.Constants.SlideDeckId);O.synchronize(e*Panopto.Core.Constants.TimelineChunkMultiplier,{playing:t,primaryAudioOnly:n&&n.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,secondaryAvailable:i,canAddContent:B.isValidTimeForEvent(e),canAddEmbedEvent:B.isValidTimeForEmbeddedEvent(e)}),j.position(e),a.fire({canAddContent:B.isValidTimeForEvent(e),canAddEmbedEvent:B.isValidTimeForEmbeddedEvent(e)})},x.timelinePosition=function(e){return D&&q?D.timelinePosition(e):e},x.timelineEndPosition=function(){return D&&q?D.timelineEndPosition():U.duration()/Panopto.Core.Constants.TimelineChunkMultiplier},x.pushEdit=ve,x.applyState=de,x.openEventDialog=function(t){var n=_.find(U.events(),function(e){return e.id===t});_.find(i,function(e){return e.ownsEvent(n)}).openEditDialog(n),ae.hide()},x.removeEvent=function(t){ve(),U.events().splice(_.findIndex(U.events(),function(e){return e.id===t}),1),de(),ae.hide()},x.resizeCut=_e,x.addQuestionList=be,x.applyPrimaryHeuristicCuts=Se,x.validateEventTime=function(e){var t=e/Panopto.Core.Constants.TimelineChunkMultiplier;return U.isTimeInSessionReference(t)?{valid:!1,nextValidTime:U.findNextTimeNotInSessionReference(t)/Panopto.Core.Constants.TimelineChunkMultiplier}:{valid:!0,nextValidTime:void 0}},x.getQuestionList=function(t){var e=_.find(U.questionLists(),function(e){return e.id===t}),n=e.toClientModel();return n.sessionRelativeTime=H.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks).ticks(),n},x.updateQuestionList=function(e){ve();var t=new AutoClientModels.QuestionList;t.copyFromQuestionList(e);var n=new PanoptoTS.Models.Editor.EditableQuestionList;n.copyFromClientModel(t),n.isEdited=!0;var o=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(t.sessionRelativeTime);n.firstStreamRelativeTicks=H.toFirstStreamRelative(o);var i=_.find(U.questionLists(),function(e){return e.id===n.id});U.questionLists().splice(U.questionLists().indexOf(i),1,n);var r=i.firstStreamRelativeTicks.ticks()!==n.firstStreamRelativeTicks.ticks();return U.refreshTimeline(),de(i.name===n.name&&!r),r&&R.setPosition(o.seconds()),t},x.removeQuestionList=function(t){ve();var e=U.questionLists(),n=_.find(e,function(e){return t.id===e.id});e.splice(e.indexOf(n),1),de()},x.getEvent=b,x.updateEvent=function(e){ve();var t=Panopto.Core.ServiceInterface.Rest.Objects.Event(e);t.edited=!0;var n=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(e.sessionRelativeTime);t.timelineTime=H.toWin32EpochRelative(n).ticks();var o=b(t.id);U.events().splice(U.events().indexOf(o),1,t);var i=o.timelineTime!==t.timelineTime;return U.refreshTimeline(),de(o.name===t.name&&!i),i&&R.setPosition(U.calculateEditorTimeFromAbsolute(t.timelineTime)),t.sessionRelativeTime=e.sessionRelativeTime,t},x.getStreamFriendlyType=p,x.getStream=d,x.getStreamName=ue,x.getStreamIconClass=function(e,t){var n;switch((e=e||d(t)).type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:n=Panopto.Viewer.Constants.ScreenCaptureClass;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:n=Panopto.Viewer.Constants.ObjectVideoTabClass}return n},x.activeState=function(){return U},x.streamTab=function(){return G},x.session=function(){return V},x.deregisterCallbacks=function(){window.streamUploader.onUploaded.remove(W),window.streamUploader.onUpdate.remove(J)},x.toggleSecondaryPlaceholder=function(e){Oe.toggleSecondaryPlaceholder(e)},x.onAddContentRequirementChanged=a,x.overlayController=Oe,x.eventService=B,x.timeConverter=H,x};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Channel=function(a,e,o){return{value:a,name:e||a,isUser:o}};
var PanoptoTS,Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},function(a){var e,t,n;e=a.Viewer||(a.Viewer={}),t=e.Data||(e.Data={}),n=function(){function a(){}return a.createBaseContent=function(a,e,t,n,o,i,r,s,p,P,l,c){var u=(n=n||[])[0];return{title:a,id:e,tabClass:t,iconClass:i,iconCode:r,timeline:n,relativeStartTime:u,absoluteStartTime:o=o||u,hiddenTab:s,pauseWhenAvailable:p,isSessionPlaybackBlocking:P,isBroadcast:l,isSecondaryPaneOnly:c}},a}(),t.ContentHelpers=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(c){var o,t,e;o=c.Viewer||(c.Viewer={}),t=o.Data||(o.Data={}),e=function(){function o(o){var t=o.Url||o.URL;t&&(t=window.location.protocol+"//"+t.replace(/^.*?:\/\//,""));var e="number"!=typeof o.Time,n=this.constructBaseObject(o,t,e);_.extend(this,n),this.url=t,this.isPdf=e,this.isQuiz=o.IsQuestionList}return o.prototype.constructBaseObject=function(o,t,e){var n=o.Caption||(o.FileName?decodeURIComponent(o.FileName):Panopto.GlobalResources.ViewerPlus_Website),s=o.ID||o.PublicId||o.PublicID,a=[];e?a.push(0):(a.push(o.Time),a.push(o.Time+Panopto.Viewer.Constants.UrlEventDuration));var i=-1!==t.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl),r=e?Panopto.Core.Constants.DocumentIconCode:o.IsQuestionList?Panopto.Core.Constants.QuestionListIconCode:i?void 0:Panopto.Core.Constants.LinkIconCode,u=i?Panopto.Viewer.Constants.YouTubeIconClass:void 0;return c.Viewer.Data.ContentHelpers.createBaseContent(n,s,e?"pdf":Panopto.Viewer.Constants.UrlTabClass,a,void 0,u,r,o.IsQuestionList,!e,o.IsSessionPlaybackBlocking,!1,!0)},o}(),t.Document=e}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(t){var e,i;e=t.Viewer||(t.Viewer={}),i=function(t){var e=t.EventTargetType||"UserCreatedTranscript",i=t.ID||t.EventID,s=i||t.PublicId!==Panopto.Core.Constants.EmptyGuid&&t.PublicId,a=s?"event"+s:(e+"-"+t.Time).replace(/\./gi,""),n=_.contains(["Transcript","UserCreatedTranscript"],e),r=_.contains(["ObjectVideo","Primary","PowerPoint"],e),o=n?t.Data||t.Caption:r?t.Caption:t.Caption||t.Data,c=(t.UserName||"").toLowerCase(),p=e.replace(" ","");"Questions"===p&&(p="Comments"),this.id=a,this.eventId=i,this.eventPublicId=t.PublicId,this.sessionId=t.SessionID,this.time=t.Time,this.creationTime=t.CreationTime,this.text=o,this.user=c,this.userDisplayName=t.UserDisplayName||c,this.type=p,this.isQuestionList=t.IsQuestionList,this.saved=!0,this.createdDuringWebcast="Comments"===p&&t.CreatedDuringWebcast,this.url=t.Url},(e.Data||(e.Data={})).Event=i}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Slide=function(e){return{time:e.Time,absoluteTime:e.AbsoluteTime,queryParams:{id:e.ObjectIdentifier,number:e.ObjectSequenceNumber,x:void 0}}};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data.SlideDeck=function(e){var a=_.map(e,Panopto.Viewer.Data.Slide);a[0].time=0;var o=[a[0].time],t=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(Panopto.GlobalResources.ViewerPlus_SlidesTitle,Panopto.Viewer.Constants.SlideDeckId,Panopto.Viewer.Constants.SlideDeckTabClass,o,a[0].absoluteTime,"","",!1,!1,!1,!1,!1);return t.slides=a,t};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data.Thumbnail=function(e,t){var a,o="PowerPoint"===e.EventTargetType;return e.ObjectStreamID!==Panopto.Core.Constants.EmptyGuid?a=e.ObjectStreamID:o&&(a=t?t.id:Panopto.Viewer.Constants.SlideDeckId),{time:e.Time,queryParams:{eventTargetPID:e.ObjectPublicIdentifier,sessionPID:e.SessionID,number:e.ObjectSequenceNumber,isPrimary:"Primary"===e.EventTargetType,absoluteTime:e.AbsoluteTime},tabId:a,isSlide:o,text:e.Caption}};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.Hive=Panopto.Viewer.Hive||{},Panopto.Viewer.KollectiveFP=Panopto.Viewer.KollectiveFP||{},PanoptoLegacy.Viewer.Players.FlowPlayer=function(f,g,v){var h,o,y,i,n,t,r,a,w,l,s,P,L,m,S,T,V=Panopto.Viewer.Constants,u=Panopto.Viewer.PlayState,O=Panopto.Viewer.Analytics,c=Panopto.Viewer.MBRBitrate,k=Panopto.Viewer.Hive,C=PanoptoTS.Viewer.Test.ViewerEventSource,b=PanoptoTS.Viewer.Test.ViewerEventType,e=f?"Primary":"Secondary",d=!f,H=!1,B=!1,p=!1,z=0,M=!1,F=1,x=!1,I=$.Deferred(),K=$("#"+(f?"primaryBuffering":"secondaryBuffering")),D=!1,A=Panopto.Viewer.KollectiveFP,R=$.Callbacks(),j=$.Callbacks(),E=$.Callbacks(),J=$.Callbacks(),Q=$.Callbacks(),W=PanoptoTS.Viewer.Test.ViewerScriptLoggerFactory.createLogger(e),N=function(){K.hide(),J.fire(),clearTimeout(l)},U=function(e){e&&N(),l=setTimeout(function(){K.show(),K.css({top:g.offset().top+(g.height()-K.height())/2,left:g.offset().left+(g.width()-K.width())/2}),E.fire(g,K)},V.BufferingTimeoutThreshold)},X=function(){w&&w.flushQualityReport(o&&M,h.video.time,z,o&&o.levels&&o.levels.length,o&&o.levels&&o.levels.length&&o.levels[z].bitrate,o&&o.autoLevelEnabled)},Y=function(e,o,t){var i;if(A.isKollectiveOptimized(e.optimizationToken)){var n=o;o={sources:[{src:e.optimizationToken,type:V.HLSMimeType}]},f&&Panopto.viewer.enableLoadingProgressIndicatorForKollective&&(R.fire(),U(!0));var r=function(){j.fire(100),e.url=o.sources[0].src;q(o,function(){Q.fire(),t(),M||Z(u.Playing)},null),T=V.Kollective},a=function(){e.url=n.sources[0].src,q(n,t,null),T=null,Q.fire()},l=function(e,o){j.fire(o),D=!e};i={optimizedClip:o,loadOptimizedStream:function(){A.tryLoadOptimizedStream(e.optimizationToken,h,r,a,l),T=V.Kollective}}}return i},q=function(e,o,t){P=e.sources[0].src;var i=function(){M=H=!1,z=0,1!==F&&(W.log(C.LogOutput,b.Speed,1),h.speed(1)),h.one("stop",function(){T!=V.Hive||null==t?(W.log(C.LogOutput,b.Load,e.sources[0].src),h.load(e,o)):(W.log(C.LogOutput,b.Load,t[0].ticket),T=null,k.loadHiveTicket(h,t,o,e,q))}),W.log(C.LogOutput,b.Stop),h.stop()};B=!1,H?(X(),i()):(W.log(C.LogDefer,b.Load,e.sources[0].src),h.one("ready",function(){P===e.sources[0].src&&i()}))},G=function(e,o){var t=x?S.getDuration()-3*m:h.video.duration;s=Math.min(e,t),W.log(C.LogOutput,b.Seek,s),h.seek(s,function(){var e=function(){X(),o&&o()};Math.abs(s-h.video.time)>V.BadSeekThreshold&&Panopto.Core.Browser.isChrome?h.seek(s,e):e()}),i=void 0,B=!1},Z=function(e){var o=!1,t=function(){M?(W.log(C.LogOutput,b.Play),h.resume()):(W.log(C.LogOutput,b.Pause),h.pause()),X()};switch(e){case u.Playing:o=!M,U(M=!0);break;case u.Paused:o=M,M=!1,N()}o&&(h.seeking&&h.one("seek",t),t()),n=void 0},ee=function(e){F=e,W.log(C.LogOutput,b.Speed,e),h.speed(e),t=void 0},oe=function(e){if(W.log(C.LogOutput,b.Bitrate,e),o)switch(e){case c.Auto:o.nextLevel=-1;break;case c.Medium:o.nextLevel=Math.max(0,o.levels.length-2);break;case c.High:o.nextLevel=o.levels.length-1}},te=function(e){f&&(W.log(C.LogOutput,b.Volume,e),h.volume(e/100)),a=void 0},ie=function(e){var o=!f||e;W.log(C.LogOutput,b.Mute,o),h.mute(o),d=void 0},ne=function(){o=h.engine.hlsjs||h.engine.hls;var i=function(e){z!==e&&(z=e,v.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[f?"Primary":"Secondary",z,o.levels.length,o.levels[z].bitrate]),X())};h.engine.hlsjs?h.on("hlsLevelSwitch",function(e,o,t){return i(t.level)}):h.engine.hls&&h.engine.hls.on("hlsLevelSwitched",function(e,o){return i(o.level)})},re=function(){void 0!==i&&G(i,void 0),void 0!==n&&Z(n),void 0!==t&&ee(t),void 0!==r&&oe(r),setTimeout(function(){void 0!==a&&te(a),void 0!==d&&ie(d)}),H=!0,_.each(y.textTracks,function(e){e.mode="disabled"}),1!==F&&ee(F),h.video.width&&h.video.height?v.resize():h.one("progress",function(){v.resize()})};if(!flowplayer.conf.hlsjs){flowplayer.conf.fullscreen=!0,flowplayer.conf.hlsjs={listeners:["hlsLevelSwitch","hlsMediaAttached","hlsFragLoaded","hlsManifestLoaded","hlsLevelLoaded"],startLevel:-1,safari:!0},Panopto.Core.Browser.isFirefox&&(flowplayer.conf.hlsjs.maxBufferHole=.8);var ae={};try{ae=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(e){window.console&&console.log("Error parsing HlsJsConfig setting, ignored.")}_.extend(flowplayer.conf.hlsjs,ae)}return{content:function(e,o,t){!function(e,o,t){W.log(C.LogInput,b.Load,e.url);var i=-1!==e.url.indexOf(".m3u8"),n={sources:[{src:e.url,type:i?V.HLSMimeType:V.MP4MimeType}],live:e.isBroadcast,dvr:e.isBroadcast,vr:e.vrType>Panopto.Core.MediaVRType.None},r=function(){P===e.url&&(w=O.QualityReporter({streamUrl:e.url,isBroadcast:e.isBroadcast,isAudioOnly:e.isAudioOnly,minDuration:V.QualityReportThreshold}),ne(),re()),t&&t()},a=Y(e,n,r);if(x=e.isBroadcast,m=e.broadcastSegmentDuration,h){var l=-1===P.indexOf("?")?P:P.substr(0,P.indexOf("?")),s=-1===e.url.indexOf("?")?e.url:e.url.substr(0,e.url.indexOf("?"));if(o||l!==s||L!==e.vrType){L=e.vrType;var u=null;a?(D=!1,n=a.optimizedClip,e.url=n.sources[0].src,a.loadOptimizedStream()):k.isHiveOptimized(e.optimizationToken)&&(u=k.getHiveSourceForReload(h,e),k.addCloseHiveSessionToStopAndFinish(h),T=V.Hive),q(n,r,u)}}else{W.log(C.LogOutput,b.Load,e.url),P=e.url,L=e.vrType,a&&(n=a.optimizedClip);var c,d,p={key:Panopto.viewer.flowplayerKey,clip:n,vrvideo:{mode:e.vrType===Panopto.Core.MediaVRType.Full?"full":e.vrType===Panopto.Core.MediaVRType.Half?"half":void 0,renderOnPause:!0},hlsjs:_.extend({},flowplayer.conf.hlsjs),keyboard:!1};k.isHiveOptimized(e.optimizationToken)&&(p.hive=k.createFlowplayerPlugin(e,f),k.attachFlowplayerHlsJsConfig(e,p.hlsjs),T=V.Hive),h=flowplayer(g[0],p,function(){I.resolve(),r()}),x&&(S=new PanoptoTS.Viewer.Logic.HlsJsWebcastDurationEstimator(h,Panopto.viewer.enableWebcastServerAgeFactor)),k.isHiveOptimized(e.optimizationToken)&&k.addCloseHiveSessionToStopAndFinish(h),y=g.find("video")[0],g.find(".fp-ui").click(function(){return!1}).mousedown(function(e){c=e.pageX,d=e.pageY}).mouseup(function(e){1===e.which&&c===e.pageX&&d===e.pageY&&v.togglePlaying()}),h.on("finish",function(){H&&(B=!0)}),h.on("progress",function(){!M||a&&!D||U(!0)}),a&&a.loadOptimizedStream()}}(e,o,t)},position:function(e,o){if(void 0===e){var t=H?h.seeking?s:h.video.time:i;return isFinite(t)?t:0}W.log(C.LogInput,b.Seek,e),H?G(e,o):(W.log(C.LogDefer,b.Seek,e),i=e)},playState:function(e){var o=e==u.Playing?b.Play:b.Pause;W.log(C.LogInput,o),H?Z(e):(W.log(C.LogDefer,o),n=e)},playSpeed:function(e){W.log(C.LogInput,b.Speed,e),H?ee(e):(W.log(C.LogDefer,b.Speed,e),t=e)},bitrate:function(e){W.log(C.LogInput,b.Bitrate,e),H?oe(e):(W.log(C.LogDefer,b.Bitrate,e),r=e)},volume:function(e){W.log(C.LogInput,b.Volume,e),H?te(e):(W.log(C.LogDefer,b.Volume,e),a=e)},muted:function(e){W.log(C.LogInput,b.Mute,e),H?ie(e):(W.log(C.LogDefer,b.Mute,e),d=e)},isFullscreen:function(e){if(void 0===e)return p;W.log(C.LogInput,b.Fullscreen,e),h&&(W.log(C.LogOutput,b.Fullscreen,e),e!==p&&(h.disabled=!1,h.fullscreen()),p=e)},width:function(){return H?h.video.width||y.videoWidth:16},height:function(){return H?h.video.height||y.videoHeight:9},ended:function(){return B},streamLength:function(){return H?h.video.duration:0},numericBitrate:function(){return H&&o?o.levels[z].bitrate:0},bitrateOptions:function(){return H&&o?_.map(o.levels,function(e){return e.bitrate}):[]},optimizationProvider:function(){return T},canMoveAudioPlayerOffscreen:function(){return!0},syncPlayState:function(){},syncTimes:function(){},setCaptionText:function(){},setCaptionStyles:function(){},showShadow:function(){},onReady:I,onStartKollectiveLoadingIndicator:R,onUpdateKollectiveLoadingIndicator:j,onShowKollectiveLoadingIndicator:E,onHideKollectiveLoadingIndicator:J,onStopKollectiveLoadingIndicator:Q}};
var PanoptoTS,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.Hive=Panopto.Viewer.Hive||{},Panopto.Viewer.KollectiveFP=Panopto.Viewer.KollectiveFP||{},function(r){var t,a,h,e,s,i,o,n,p;t=r.Viewer||(r.Viewer={}),a=t.Players||(t.Players={}),h=Panopto.Viewer.Constants,e=Panopto.Viewer.PlayState,s=Panopto.Viewer.Analytics,i=Panopto.Viewer.MBRBitrate,o=Panopto.Viewer.Hive,n=function(){function o(t,e,i){var a=this;this.helpers=i,this.onReady=$.Deferred(),this.isMediaReady=!1,this.fullscreen=!1,this.currentLevel=0,this.requestedPosition=void 0,this.requestedStartPosition=void 0,this.requestedContentUri=void 0,this.requestedVrType=void 0,this.isBroadcast=!1,this.readyQueue={name:"ready"},this.kollectiveFP=Panopto.Viewer.KollectiveFP,this.isStreamOptimized=!1,this.playerEvents={ready:{name:"ready"},resumed:{name:"resume"},paused:{name:"pause"},stopped:{name:"stop"},finish:{name:"finish"},qualityChange:{name:"quality"},speedChange:{name:"speed"},volumeChange:{name:"volume"},muteChange:{name:"mute"}},this.triggers={load:{name:"load"},ready:{name:"ready"},play:{name:"play"},pause:{name:"pause"},stop:{name:"stop"},finish:{name:"finish"},updatePosition:{name:"updatePosition"},updateBitrate:{name:"updateBitrate"},updateSpeed:{name:"updateSpeed"},updateVolume:{name:"updateVolume"},updateMuted:{name:"updateMuted"}},this.states={uninitialized:{name:"uninitialized"},loaded:{name:"loaded",triggerOnEnter:this.triggers.ready},playing:{name:"playing"},paused:{name:"paused"},finished:{name:"finished"},stopping:{name:"stopping",triggerOnEnter:this.triggers.load},stopped:{name:"stopped",triggerOnEnter:this.triggers.load}},this.transitions={play:{trigger:this.triggers.play,toState:this.states.playing,action:function(t,e){a.component.playing?e():(a.component.play(),a.setBufferingTimeout(!0))},exitEvent:this.playerEvents.resumed},pause:{trigger:this.triggers.pause,toState:this.states.paused,action:function(t,e){a.component.playing?(a.component.pause(),a.clearBufferingTimeout()):e()},exitEvent:this.playerEvents.paused},ready:{trigger:this.triggers.ready,action:function(t,e){a.qualityReporter=s.QualityReporter({streamUrl:t.content.url,isBroadcast:t.content.isBroadcast,isAudioOnly:t.content.isAudioOnly,minDuration:h.QualityReportThreshold}),t.onLoad&&t.onLoad(),_.each(a.video.textTracks,function(t){t.mode="disabled"}),a.isPrimary||a.component.mute(!0),t.playSpeed&&a.component.speed(t.playSpeed),a.setHlsJsEngineEvents(),a.setPlayerAsReady(t,e)},releaseQueue:this.readyQueue},finish:{trigger:this.triggers.finish,triggerEvent:this.playerEvents.finish,toState:this.states.finished},initialLoad:{trigger:this.triggers.load,toState:this.states.loaded,action:function(t,e){var i,n,s=a.generatePlayerConfiguration(t);a.isBroadcast=t.content.isBroadcast,a.broadcastSegmentDuration=t.content.broadcastSegmentDuration,t.startPosition&&(s.hlsjs.startPosition=t.startPosition),a.component=a.initializeFlowplayerComponent(s,t,e),a.isBroadcast&&(a.webcastDurationEstimator=new r.Viewer.Logic.HlsJsWebcastDurationEstimator(a.component,Panopto.viewer.enableWebcastServerAgeFactor)),a.video=a.$container.find("video")[0],a.$container.find(".fp-ui").click(function(){return!1}).mousedown(function(t){i=t.pageX,n=t.pageY}).mouseup(function(t){1===t.which&&i===t.pageX&&n===t.pageY&&a.helpers.togglePlaying()}),a.component.on("progress",function(){a.component.playing&&a.setBufferingTimeout(!0)}),setInterval(function(){return a.checkForBuffering},h.MaxPositionInterpolation)}},load:{trigger:this.triggers.load,toState:this.states.loaded,action:function(t,e){t.clip.sources[0].src!==a.component.video.sources[0].src||t.clip.vr!==a.component.video.vr?(a.hlsjs&&(a.hlsjs.config.startPosition=t.startPosition||-1),a.loadClipIntoComponent(t)):e()},exitEvent:this.playerEvents.ready},stop:{trigger:this.triggers.load,action:function(t,e){a.flushQualityReport(),a.component.stop()},exitEvent:this.playerEvents.stopped,toState:this.states.stopped},inactiveSet:[{trigger:this.triggers.play,delayToQueue:this.readyQueue},{trigger:this.triggers.pause,delayToQueue:this.readyQueue},{trigger:this.triggers.updatePosition,delayToQueue:this.readyQueue},{trigger:this.triggers.updateBitrate,delayToQueue:this.readyQueue},{trigger:this.triggers.updateSpeed,delayToQueue:this.readyQueue},{trigger:this.triggers.updateVolume,delayToQueue:this.readyQueue},{trigger:this.triggers.updateMuted,delayToQueue:this.readyQueue}],activeSet:[{trigger:this.triggers.updatePosition,action:function(t,e){if(t===a.requestedPosition){var i=a.clampPosition(t);a.requestedPosition=i;var n=function(){a.requestedPosition===i&&(a.requestedPosition=void 0),e()};if(!Panopto.Core.Browser.isChrome&&a.component.video.time!==i||Math.abs(i-a.component.video.time)>r.Viewer.Constants.BadSeekThreshold){var s=n;if("html5"===a.component.engine.engineName){var o=!(s=function(){return setTimeout(n,0)});$(a.video).one("progress",function(){o||t!==a.requestedPosition||a.component.seek(i,s)}),$(a.video).one("seeking",function(){o=!0})}a.component.seek(i,function(){"html5"===a.component.engine.engineName?setTimeout(s,0):s()})}else n()}else e()}},{trigger:this.triggers.updateBitrate,action:function(t,e){var i=a.getHlsJsQualityLevel(t);i!=(a.hlsjs&&a.hlsjs.autoLevelEnabled?-1:a.hlsjs.currentLevel)?a.component.quality(i):e()},exitEvent:this.playerEvents.qualityChange},{trigger:this.triggers.updateSpeed,action:function(t,e){a.component.currentSpeed!==t?a.component.speed(t):e()},exitEvent:this.playerEvents.speedChange},{trigger:this.triggers.updateVolume,action:function(t,e){a.component.volumeLevel!=t?a.component.volume(t):e()},exitEvent:this.playerEvents.volumeChange},{trigger:this.triggers.updateMuted,action:function(t,e){a.component.muted!==t?a.component.mute(t):e()},exitEvent:this.playerEvents.muteChange},{trigger:this.triggers.load,toState:this.states.stopping}]},this.isPrimary=t,this.$container=e,this.initialize(),this.initializeTransitions();var n=t?"Primary":"Secondary_"+o.secondaryPlayerCount;this.machine=new r.Logic.StateMachine.Machine(n,this.states.uninitialized),this.machine.attachEvent=function(t,e,i){return a.attachEvent(t,e,i)},this.machine.detachEvent=function(t){return a.detachEvent(t)},this.$bufferingIndicator=$("#"+(t?"primaryBuffering":"secondaryBuffering")),t||o.secondaryPlayerCount++}return o.prototype.attachEvent=function(t,e,i){var n=t?t.name:o.eventNamespace,s=e?e.name:"";this.component.on(s+"."+n,i)},o.prototype.detachEvent=function(t){var e=t?t.name:o.eventNamespace;this.component.off("."+e)},o.prototype.initializeTransitions=function(){this.states.uninitialized.transitions=this.transitions.inactiveSet.slice(),this.states.uninitialized.transitions.push(this.transitions.initialLoad),this.states.loaded.transitions=this.transitions.activeSet.slice(),this.states.loaded.transitions.push(this.transitions.ready),this.states.loaded.transitions.push(this.transitions.play),this.states.loaded.transitions.push(this.transitions.pause),this.states.playing.transitions=this.transitions.activeSet.slice(),this.states.playing.transitions.push(this.transitions.pause),this.states.playing.transitions.push(this.transitions.finish),this.states.playing.ignoreTriggers=[this.triggers.play],this.states.paused.transitions=this.transitions.activeSet.slice(),this.states.paused.transitions.push(this.transitions.play),this.states.paused.ignoreTriggers=[this.triggers.pause],this.states.stopping.transitions=this.transitions.inactiveSet.slice(),this.states.stopping.transitions.push(this.transitions.stop),this.states.stopped.transitions=this.transitions.inactiveSet.slice(),this.states.stopped.transitions.push(this.transitions.load),this.states.finished.transitions=this.transitions.activeSet.slice(),this.states.finished.transitions.push(this.transitions.play),this.states.finished.transitions.push(this.transitions.pause),this.states.finished.transitions.push(this.transitions.load)},o.prototype.clearBufferingTimeout=function(){this.$bufferingIndicator.hide(),clearTimeout(this.bufferingTimeout)},o.prototype.setBufferingTimeout=function(t){var e=this;t&&this.clearBufferingTimeout(),this.bufferingTimeout=setTimeout(function(){e.component.playing&&(e.$bufferingIndicator.show(),e.$bufferingIndicator.css({top:e.$container.offset().top+(e.$container.height()-e.$bufferingIndicator.height())/2,left:e.$container.offset().left+(e.$container.width()-e.$bufferingIndicator.width())/2}))},h.MaxPositionInterpolation)},o.prototype.checkForBuffering=function(){this.machine.getCurrentState()!==this.states.paused?this.component&&this.component.video&&this.lastBufferingCheckPosition!==this.component.video.time?(this.$bufferingIndicator.hide(),this.lastBufferingCheckPosition=this.component.video.time):(this.$bufferingIndicator.show(),this.$bufferingIndicator.css({top:this.$container.offset().top+(this.$container.height()-this.$bufferingIndicator.height())/2,left:this.$container.offset().left+(this.$container.width()-this.$bufferingIndicator.width())/2})):(this.lastBufferingCheckPosition=void 0,this.$bufferingIndicator.hide())},o.prototype.flushQualityReport=function(){this.qualityReporter&&this.qualityReporter.flushQualityReport(this.hlsjs&&this.component.playing,this.component.video.time,this.currentLevel,this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels.length,this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels.length&&this.hlsjs.levels[this.currentLevel].bitrate,this.hlsjs&&this.hlsjs.autoLevelEnabled)},o.prototype.equalsLoadedContent=function(t){var e=!0;return t.vrType!==this.requestedVrType?e=!1:this.requestedContentUri&&t.url!==this.requestedContentUri&&this.requestedContentUri.split("?")[0]!==t.url.split("?")[0]&&(e=!1),e},o.prototype.setContent=function(t,e,i){var n=this;if(!this.equalsLoadedContent(t)){this.requestedContentUri=t.url,this.requestedVrType=t.vrType;var s=this.generatePlayerLoadData(t,i);if(this.machine.getCurrentState()==this.states.uninitialized&&this.kollectiveFP.isKollectiveOptimized(t.optimizationToken)){var o=s;(s=new a.FlowplayerMachineLoadData).content=o.content,s.clip={sources:[{src:t.optimizationToken,type:h.HLSMimeType}],live:t.isBroadcast,dvr:t.isBroadcast,vr:!1},s.onLoad=o.onLoad,s.startPosition=this.requestedStartPosition,this.isStreamOptimized=!0,this.kollectiveFP.tryLoadOptimizedStream(t.optimizationToken,null,function(){n.machine.handleTrigger(n.triggers.load,s)},function(){n.machine.handleTrigger(n.triggers.load,o)},function(t){t?n.setBufferingTimeout(!1):n.clearBufferingTimeout()})}this.machine.handleTrigger(this.triggers.load,s)}},o.prototype.initialize=function(){if(!flowplayer.conf.hlsjs){flowplayer.conf.fullscreen=!0,flowplayer.conf.hlsjs={listeners:["hlsLevelSwitch","hlsLevelLoaded","hlsMediaAttached","hlsFragLoaded","hlsManifestLoaded"],safari:!0,smoothSwitching:!1,livePositionOffset:0},Panopto.Core.Browser.isFirefox&&(flowplayer.conf.hlsjs.maxBufferHole=.8);var t={};try{t=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(t){window.console&&console.log("Error parsing HlsJsConfig setting, ignored.")}_.extend(flowplayer.conf.hlsjs,t)}},o.prototype.clampPosition=function(t){var e=0,i=this.machine.getCurrentState();if((i===this.states.finished||i===this.states.loaded||i===this.states.paused||i===this.states.playing)&&this.component&&this.component.video&&this.component.video.duration){var n=this.isBroadcast&&this.webcastDurationEstimator?this.webcastDurationEstimator.getDuration()-3*this.broadcastSegmentDuration:this.component.video.duration;e=Math.min(t,n)}return e},o.prototype.getHlsJsQualityLevel=function(t){var e;switch(t){case i.Auto:e=-1;break;case i.Medium:e=this.hlsjs.levels?Math.max(0,this.hlsjs.levels.length-2):-1;break;case i.High:e=this.hlsjs.levels?this.hlsjs.levels.length-1:-1}return e},o.prototype.generatePlayerConfiguration=function(t){return{key:Panopto.viewer.flowplayerKey,clip:t.clip,vrvideo:{mode:t.content.vrType===Panopto.Core.MediaVRType.Full?"full":t.content.vrType===Panopto.Core.MediaVRType.Half?"half":void 0,renderOnPause:!0},hlsjs:_.extend({},flowplayer.conf.hlsjs)}},o.prototype.generatePlayerLoadData=function(t,e){var i=new a.FlowplayerMachineLoadData;return i.content=t,i.clip={sources:[{src:t.url,type:-1!==t.url.indexOf(".m3u8")?h.HLSMimeType:h.MP4MimeType}],live:t.isBroadcast,dvr:t.isBroadcast,vr:t.vrType>Panopto.Core.MediaVRType.None},i.onLoad=e,i.playSpeed=this.component?this.component.currentSpeed:void 0,i.startPosition=this.requestedStartPosition,i},o.prototype.initializeFlowplayerComponent=function(t,e,i){var n=this;return flowplayer(this.$container[0],t,function(){n.onReady.resolve(),i&&i()})},o.prototype.loadClipIntoComponent=function(t){this.component.load(t.clip)},o.prototype.setPlayerAsReady=function(t,e){var i=this;this.isMediaReady=!0,this.component.video.width&&this.component.video.height?this.helpers.resize():this.component.one("progress",function(){i.helpers.resize()}),e()},o.prototype.setHlsJsEngineEvents=function(){var i=this;if(!this.hlsjs){this.hlsjs=this.component.engine.hlsjs||this.component.engine.hls;var t=function(){var t=r.Viewer.Logic.InitialStateLogic.getBitrate(!1),e=i.getHlsJsQualityLevel(t);i.hlsjs.currentLevel=e},n=function(t){i.currentLevel!==t&&(i.currentLevel=t,i.helpers.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[i.isPrimary?"Primary":"Secondary",i.currentLevel,i.hlsjs.levels.length,i.hlsjs.levels[i.currentLevel].bitrate]),i.flushQualityReport())};this.component.engine.hlsjs?(this.component.on("hlsManifestLoaded",t),this.component.on("hlsLevelSwitch",function(t,e,i){return n(i.level)})):this.component.engine.hls&&(this.component.engine.hls.on("hlsManifestLoaded",t),this.component.engine.hls.on("hlsLevelSwitched",function(t,e){return n(e.level)}))}},o.prototype.content=function(t,e,i){this.setContent(t,e,i)},o.prototype.position=function(t,e){if(void 0===t){var i=this.requestedPosition||this.requestedStartPosition;return void 0===i&&(this.component&&this.component.video?(i=this.component.video.time,!this.video||0!==i&&i!==this.video.duration||(i=this.video.currentTime)):i=0),isFinite(i)?i:this.clampPosition(i)}this.requestedPosition!==t&&(this.requestedPosition=t,this.machine.handleTrigger(this.triggers.updatePosition,this.requestedPosition,e))},o.prototype.setStartPosition=function(t){this.requestedStartPosition=t},o.prototype.playState=function(t){t==e.Playing?this.machine.handleTrigger(this.triggers.play):this.machine.handleTrigger(this.triggers.pause)},o.prototype.playSpeed=function(t){this.machine.handleTrigger(this.triggers.updateSpeed,t)},o.prototype.bitrate=function(t){this.machine.handleTrigger(this.triggers.updateBitrate,t)},o.prototype.volume=function(t){this.isPrimary&&this.machine.handleTrigger(this.triggers.updateVolume,t/100)},o.prototype.muted=function(t){this.isPrimary&&this.machine.handleTrigger(this.triggers.updateMuted,t)},o.prototype.isFullscreen=function(t){if(void 0===t)return this.fullscreen;this.component&&(t!==this.fullscreen&&(this.component.disabled=!1,this.component.fullscreen()),this.fullscreen=t)},o.prototype.width=function(){return this.isMediaReady?this.component.video.width||this.video.videoWidth:16},o.prototype.height=function(){return this.isMediaReady?this.component.video.height||this.video.videoHeight:9},o.prototype.ended=function(){return this.machine.getCurrentState()===this.states.finished&&void 0===this.machine.getCurrentTransition()},o.prototype.streamLength=function(){return this.isMediaReady?this.component.video.duration:0},o.prototype.numericBitrate=function(){return this.isMediaReady&&this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels[this.currentLevel]?this.hlsjs.levels[this.currentLevel].bitrate:0},o.prototype.bitrateOptions=function(){return this.isMediaReady&&this.hlsjs&&this.hlsjs.levels&&this.hlsjs.levels[this.currentLevel]?_.map(this.hlsjs.levels,function(t){return t.bitrate}):[]},o.prototype.syncPlayState=function(){},o.prototype.syncTimes=function(){},o.prototype.setCaptionText=function(){},o.prototype.setCaptionStyles=function(){},o.prototype.showShadow=function(){},o.prototype.canMoveAudioPlayerOffscreen=function(){return!0},o.eventNamespace="machine",o.secondaryPlayerCount=0,o}(),p=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return __extends(t,s),t.prototype.generatePlayerConfiguration=function(t){var e=s.prototype.generatePlayerConfiguration.call(this,t);return o.isHiveOptimized(t.content.optimizationToken)&&(e.hive=o.createFlowplayerPlugin(t.content,this.isPrimary),o.attachFlowplayerHlsJsConfig(t.content,e.hlsjs),this.isStreamOptimized=!0),e},t.prototype.generatePlayerLoadData=function(t,e){var i=s.prototype.generatePlayerLoadData.call(this,t,e);return this.machine.getCurrentState()==this.states.uninitialized&&o.isHiveOptimized(t.optimizationToken)&&(i.optimizationToken=t.optimizationToken),i},t.prototype.initializeFlowplayerComponent=function(t,e,i){var n=s.prototype.initializeFlowplayerComponent.call(this,t,e,i);return o.isHiveOptimized(e.content.optimizationToken)&&o.addCloseHiveSessionToStopAndFinish(n),n},t.prototype.loadClipIntoComponent=function(t){o.isHiveOptimized(t.optimizationToken)?this.loadHiveTicketIntoPlayer(t,null):s.prototype.loadClipIntoComponent.call(this,t)},t.prototype.setPlayerAsReady=function(t,e){var i=this;o.isHiveOptimized(t.optimizationToken)?this.loadHiveTicketIntoPlayer(t,function(){return s.prototype.setPlayerAsReady.call(i,t,e)}):s.prototype.setPlayerAsReady.call(this,t,e)},t.prototype.loadHiveTicketIntoPlayer=function(t,e){var i=this,n=o.getHiveSourceForReload(this.component,t);o.addCloseHiveSessionToStopAndFinish(this.component),o.loadHiveTicket(this.component,n,e,t,function(t,e){s.prototype.loadClipIntoComponent.call(i,t)})},t}(a.FlowplayerMachine=n),a.HiveFlowplayerMachine=p}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(o){var t,n,r;t=o.Viewer||(o.Viewer={}),n=t.Players||(t.Players={}),r=function(){function o(){}return o.prototype.toString=function(){return"Load "+this.clip.sources[0].src+" at position "+this.startPosition},o}(),n.FlowplayerMachineLoadData=r}(PanoptoTS||(PanoptoTS={}));


var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},PanoptoLegacy.Viewer.Players.SilverlightPlayer=function(n,o){var r,i,a,c,l,u,s=Panopto.Viewer.Constants,e=Panopto.Viewer.PlayState,P=0,h=function(t,e){r.Position=t,P=void 0,e&&e()},y=function(t){switch(t){case e.Playing:r.Play();break;case e.Paused:r.Pause()}i=void 0},p=function(t){r.Bitrate=t},f=function(t){r.PlaySpeed=t,a=void 0},d=function(t){r.Volume=t,l=void 0},S=function(t){r.IsMuted=t,u=void 0};return Silverlight.Silverlight(),{content:function(e){try{r.ContentUrl=e.url}catch(t){Silverlight.createObjectEx({source:Panopto.viewer.xapLocation,parentElement:o[0],id:"silverlightPlayer"+(n?"Primary":"Secondary"),properties:{width:"100%",height:"100%",version:s.SilverlightVersion},alt:"",events:{onLoad:function(t){(r=t.getHost().content.SilverlightPlayer).ContentUrl=e.url,e.httpUrl&&(r.HttpUrl=e.httpUrl),P&&h(P,void 0),i&&y(i),a&&f(a),void 0!==l&&d(l),u&&S(u),p(c)}},initParams:Panopto.Core.StringHelpers.serializeObjectToInitParams({isPrimary:n,wmodBase:Panopto.viewer.wmodBase,fullScreenControlInterval:s.FullScreenControlInterval,serviceScheme:Panopto.uriScheme,authCookieTimeout:Panopto.authCookieTimeoutMinutes,accentColor:Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).toHex(),safetyAccent:Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).getSafety().toHex(),exitFullScreenText:Panopto.GlobalResources.ViewerPlus_ExitFullScreen})})}},playState:function(e){try{y(e)}catch(t){i=e}},position:function(e,t){if(void 0!==e)try{h(e,t)}catch(t){P=e}else try{return r.Position}catch(t){return P}},ended:function(){try{return r.IsEnded}catch(t){return!1}},bitrate:function(e){try{p(e)}catch(t){c=e}},numericBitrate:function(){try{return r.NumericBitrate}catch(t){return 0}},bitrateOptions:function(){try{return r.BitrateOptions}catch(t){return[]}},playSpeed:function(e){try{f(e)}catch(t){a=e}},volume:function(e){try{d(e)}catch(t){l=e}},muted:function(e){try{S(e)}catch(t){u=e}},width:function(){return r.ContentWidth},height:function(){return r.ContentHeight},showShadow:function(t){try{r.ShowShadow=t}catch(t){}},streamLength:function(){try{return r.StreamLength}catch(t){return 0}},syncPlayState:function(t){try{r.SyncPlayState(t===e.Playing)}catch(t){}},syncTimes:function(t,e){try{r.SyncTimes(t,e)}catch(t){}},isFullscreen:function(t){if(void 0!==t)if(t);else try{r.Minimize()}catch(t){}else try{return r.IsFullscreen}catch(t){return!1}},setCaptionText:function(){},setCaptionStyles:function(){}}};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.KollectiveFP=Panopto.Viewer.KollectiveFP||{},PanoptoLegacy.Viewer.Players.VideoJsPlayer=function(n,i,a){var r,l,o,c,t,s,u,d,f,p,h,m,y=Panopto.Viewer.Constants,v=Panopto.Viewer.PlayState,P=Panopto.Viewer.Analytics,g=i.find(".video-js")[0].id,w=0,T=!n,C=!1,F=!1,b=!1,S=!1,H=!1,V=Panopto.Core.Browser.isSafari?"loadeddata":"loadedmetadata",k=16,B=9,N=[],O=Panopto.Viewer.KollectiveFP,x="disabled"!==Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),!0,!0).p2poptimization,L=$("#"+(n?"primaryBuffering":"secondaryBuffering")),z=function(e){return e?"loadedmetadata":V},E=function(e){h&&h.flushQualityReport("Flash"===r.techName&&e,r.currentTime(),"Flash"===r.techName&&r.level(),"Flash"===r.techName&&r.numberOfLevels(),"Flash"===r.techName&&N[r.level()],"Flash"===r.techName&&r.autoLevelEnabled())},R=function(e){r.one("timeupdate",function(){E(c===v.Playing)}),r.currentTime(e),C?(C=!1,w=e):void 0!==w&&(w=e)},M=function(e){switch(e){case v.Playing:r.play(),t&&K(t),E(!0);break;case v.Paused:r.pause(),E(!1)}o=void 0,c=e},A=function(e){var o=0,t=r.currentTime();if(N.length){switch(e){case Panopto.Viewer.MBRBitrate.Auto:o=-1;break;case Panopto.Viewer.MBRBitrate.Medium:o=Math.max(0,r.numberOfLevels()-2);break;case Panopto.Viewer.MBRBitrate.High:o=r.numberOfLevels()-1}1===r.numberOfLevels()&&(o=-1),r.level(o),r.currentTime(t),E(c===v.Playing)}},I=function(){return!("Flash"===r.techName&&-1!==r.currentSrc().indexOf(".m3u8"))},K=function(e){var o,t=r.volume(),n=r.muted();(d&&_.some(d,function(e){return"video/mp4"==e.type})||I())&&(1===(I()?r.playbackRate():1)&&1!==e?"Flash"===r.techName&&(o=[d[1]],r.options({techOrder:["html5","flash"]}),E(!(b=!0))):1===e&&b&&(o=d,r.options({techOrder:["flash","html5"]}),b=!1,r.one("loadedmetadata",function(){s&&A(s)})),o?(l=r.currentTime(),r.src(o).one(z(!b),function(){c===v.Playing?r.play():w=l,r.currentTime(l),l=void 0,r.volume(t),r.muted(n)}).one("loadeddata",function(){I()&&r.playbackRate(e)})):I()&&r.playbackRate(e))},U=function(e){n&&r.volume(e/Panopto.Viewer.Constants.MaxVolume),u=void 0},j=function(e){(n||e)&&r.muted(e),T=void 0},W=function(){S=!0,r.play(),"number"==typeof w&&(R(w),w=void 0),r.pause(),o&&M(o),void 0!==u&&U(u),T&&j(T),s&&A(s)},D=function(){var e=_.find(Panopto.Captions.ColorOptions,function(e){return e.key===f.colorSchemeKey}),o="transparent"!==e.backgroundColor;r.setCaptionOptions(e.color,o?e.backgroundColor:"#000000",f.textSize,e.overlayOpacity,o,"none"!==e.textShadow)},Q=function(){"Flash"===r.techName&&(r.brandingColors(Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).toHex(),Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).getSafety().toHex()),r.localizedStrings(Panopto.GlobalResources.ViewerPlus_ExitFullScreen),f&&D())},q=function(e,o){r.off("loadeddata"),r.off("loadedmetadata"),r.one(z("Flash"===r.techName),W),e?(r.options({techOrder:["html5"]}),r.one("loadedmetadata",function(){var e=$("#"+g).find("video")[0];k=e.videoWidth,B=e.videoHeight,N=[],a.resize()})):r.on("loadedmetadata",Q),o&&r.one("loadeddata",o),(Panopto.Core.Browser.isIE||Panopto.Core.Browser.isIE11)&&"Html5"===r.techName&&r.isFullscreen()&&(r.exitFullscreen(),r.one("loadeddata",function(){r.requestFullscreen()}));var t=d[0];x&&Panopto.viewer.isKollectiveEnabled&&t.optimizationToken?(r.toggleBuffering(!0),O.tryLoadOptimizedStream(t.optimizationToken,r,function(){r.src([{src:t.optimizationToken,type:y.HLSMimeType}]),m=y.Kollective,r.on("loadstart",function(){r.play()})},function(){r.src(d),m="",console.log("Fallback to Panopto source stream from Kollective optimized stream."),r.on("loadstart",function(){r.play()})},function(e,o){r.toggleBuffering(Boolean(e))})):x&&Panopto.viewer.isHiveEnabled&&t.optimizationToken?r.initSession(t.optimizationToken,function(e,o){r.src([{src:e,type:y.HLSMimeType}]),m=y.Hive},function(){r.src(d)}):r.src(d),n&&p.deliveryTitle&&Panopto.viewer.ooyalaProviderCode&&Ooyala.Analytics.VideojsReporter(Panopto.viewer.ooyalaProviderCode,r,{mediaId:PanoptoTS.StringHelpers.format("{0} ({1})",p.deliveryTitle,p.id),contentType:Ooyala.Analytics.MediaContentType.EXTERNAL_CONTENT})},J=function(o){if(r)o();else if(!F){F=!0,Panopto.viewer.detectFlashCrashAndFallBackToHTML&&setTimeout(Z,1e3);var e={};Panopto.viewer.isHiveEnabled&&(e={hive:{hiveTechOrder:["HiveJava","StatsJS"]}}),videojs(g,{techOrder:Panopto.Core.Browser.flashEnabled()?["flash","html5"]:["html5","flash"],controls:!1,preload:"auto",autoplay:!1,flash:{swf:Panopto.viewer.swfLocation},plugins:e},function(){var t,e;(r=videojs(g)).on("levelswitch",function(){E(c===v.Playing),a.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[n?"Primary":"Secondary",r.level(),r.numberOfLevels(),N[r.level()]])}),r.on("ended",function(){C=!0}),t=Panopto.Core.Browser.isWebkit,r.on("rewind",function(){a.rewind()}).on("forward",function(){a.forward()}).on("togglePlaying",function(){a.togglePlaying()}).on("hotkey",function(e,o){!H&&t||a.hotkey(o)}).on("fullscreenModeChanged",function(){H=!H,a.synchronize()}).on("waiting",function(){"Flash"===r.techName&&r.toggleBuffering(!0),Panopto.viewer.isHiveEnabled&&r.trigger("hiveWaiting")}).on("canplay",function(){"Flash"===r.techName&&r.toggleBuffering(!1)}),e=G(),r.on("waiting",function(){Y(e).show()}).on("canplay",function(){L.hide()}).on("seeked",function(){L.hide()}),o()})}},e=!1,X=function(){e||(window.location.search+=PanoptoTS.StringHelpers.format("&{0}=true",Panopto.Core.Constants.IgnoreFlashParamKey),e=!0)},G=function(){L.show();var e=L.outerWidth(!0),o=L.outerHeight(!0);return L.hide(),{bufferingWidth:e,bufferingHeight:o}},Y=function(e){var o=PanoptoTS.StringHelpers.format("#{0} video",i.attr("id")),t=$(o);return L.css({top:t.offset().top+(t.height()-e.bufferingHeight)/2,left:t.offset().left+(t.width()-e.bufferingWidth)/2})},Z=function(){var e=$("#"+g).find("object");if(n&&e.length)try{(!e[0]).exitFullscreen&&X()}catch(e){X()}};return videojs.options.flash.flashVars={hls_debug:!1,hls_debug2:!1},{content:function(n,e,o){d&&!e&&d[0].src===n.url||(p=n,E(C=S=!1),h=P.QualityReporter({streamUrl:n.url,isBroadcast:n.isBroadcast,isAudioOnly:n.isAudioOnly,minDuration:y.QualityReportThreshold}),d=[],Panopto.Core.Browser.isEdge&&0<=n.url.indexOf(".m3u8")&&n.httpUrl&&(n.url=""),_.each(_.filter([n.url,n.httpUrl],function(e){return e}),function(o){var e=0<=o.indexOf(".m3u8"),t={src:o,type:e?y.HLSMimeType:y.MP4MimeType,optimizationToken:void 0};e&&n.optimizationToken&&(t.optimizationToken=n.optimizationToken),_.find(d,function(e){return e.src===o})||d.push(t)}),_.some(d,function(e){return e.type===y.HLSMimeType})?function(e,i){var o=function(e){var o=new RegExp("RESOLUTION=(\\d*)x(\\d*)","i"),t=new RegExp("BANDWIDTH=(\\d*)","i"),n=o.exec(e);for(n&&3===n.length?(k=parseFloat(n[1]),B=parseFloat(n[2])):B=k=0,N.length=0;(n=t.exec(e))&&(N.push(parseFloat(n[1])),e=e.slice(n.index+n[0].length)),n;);N.sort(function(e,o){return e-o}),i&&i(),a.resize()};if(!window.XDomainRequest||window.location.protocol===Panopto.Core.UrlHelpers.getProtocol(e.url)&&window.location.hostname===Panopto.Core.UrlHelpers.getHost(e.url))$.ajax({url:e.url,success:o});else{var t=new XDomainRequest;t.open("get",e.url),t.onload=function(){o(t.responseText)},t.onerror=function(){},t.onprogress=function(){},t.ontimeout=function(){},t.send()}}(n,function(){J(function(){q(!1,o)})}):J(function(){q(!0,o)}))},playState:function(e){S?M(e):o=e},position:function(e,o){if(void 0===e)return e=S?l||r.currentTime():w,Panopto.viewer.detectFlashCrashAndFallBackToHTML&&r&&"Flash"===r.techName&&Z(),e===1/0?0:e;S?(o&&r.on("timeupdate",function(){r.currentTime()!==1/0&&(o(),r.off("timeupdate"))}),R(e)):w=e},ended:function(){return C},bitrate:function(e){S&&A(e),s=e},numericBitrate:function(){return S&&"Flash"===r.techName?N[r.level()]:0},bitrateOptions:function(){return r&&"Flash"===r.techName?N:[]},playSpeed:function(e){S&&K(e),t=e},volume:function(e){S?U(e):u=e},muted:function(e){S?j(e):T=e},width:function(){return k},height:function(){return B},showShadow:function(e){r&&"Flash"===r.techName&&r.showShadow(e)},streamLength:function(){return S?r.duration():0},syncPlayState:function(e){r&&"Flash"===r.techName&&r.syncPlayState(e===v.Playing)},syncTimes:function(e,o){r&&"Flash"===r.techName&&r.syncTimes(e,o)},isFullscreen:function(e){if(void 0===e)return!!S&&(r.isFullscreen()||H);S&&(e?r.requestFullscreen():r.exitFullscreen())},setCaptionText:function(e){r&&"Flash"===r.techName&&r.setCaptionText(e)},optimizationProvider:function(){return m},setCaptionStyles:function(e){f=e,r&&"Flash"===r.techName&&D()}}};
var PanoptoTS;!function(e){var t,n,a,i;t=e.Viewer||(e.Viewer={}),n=t.Tabs||(t.Tabs={}),a=n.Discussion||(n.Discussion={}),i=function(){function l(e){this.params=e,this.isTopLevelComment=!1,this.animationSpeed=void 0!==e.animationSpeed?e.animationSpeed:"fast",this.setEventData(e.commentEvent)}return l.prototype.setAsTopLevelComment=function(e){this.isTopLevelComment=e},l.prototype.isForEvent=function(e){return a.DiscussionUtils.eventsMatchById(this,e)},l.prototype.updateEvent=function(e){this.eventDataChanged(e)&&(this.setEventData(e),this.render(this.element,!0))},l.prototype.eventDataChanged=function(e){return this.id!==e.id||this.eventId!==e.eventId||this.text!==e.text||this.editable!==e.editable||this.deletable!==e.deletable},l.prototype.setEventData=function(e){this.commentEvent=_.clone(e),this.userDisplayName=e.userDisplayName,this.creationTimeInMillis=e.creationTime,this.sessionTime=a.DiscussionUtils.roundSessionTime(e.time),this.text=e.text,this.id=e.id,this.eventId=e.eventId,this.editable=e.editable,this.deletable=e.deletable,this.replyable=e.replyable;var t=this.params.panoptoGlobal.Core.TimeHelpers.toLocalPanoptoTime(this.params.panoptoGlobal.Core.TimeHelpers.formatWin32EpochTimeToDate(this.creationTimeInMillis),this.params.panoptoGlobal.timeZone),n=this.params.panoptoGlobal.GlobalResources.ViewerPlus_CommentTimestamp;this.commentTimestamp=n.format(this.params.panoptoGlobal.Util.displayDate(t,{format:"friendly",local:!0}),this.params.panoptoGlobal.Util.displayDate(t,{format:"time",local:!0})),this.creationDateString=this.params.panoptoGlobal.Util.displayDate(t,{format:"long",local:!0}),this.sessionTimestampString=this.params.panoptoGlobal.Core.TimeHelpers.formatDuration(this.sessionTime,this.params.panoptoGlobal.GlobalResources.TimeSeparator)},l.prototype.render=function(e,t){var n=this;void 0===t&&(t=!1);var a=$(l.template({comment:this,resx:this.params.panoptoGlobal.GlobalResources}));if(a.keydown(function(e){return n.params.handleKeys(e)}),a.mousedown(function(){return a.addClass("clicked")}),a.blur(function(){return a.removeClass("clicked")}),this.replyable){var i=a.find(".reply-link");i.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(i,function(){n.params.replyCallback(n.commentEvent)})}if(this.editable){var s=a.find(".edit-link");s.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(s,function(){n.params.editClickedCallback(n.commentEvent)})}if(this.deletable){var o=a.find(".delete-link");o.show(),this.params.panoptoGlobal.Core.UI.Handlers.button(o,function(){n.params.deleteClickedCallback(n.commentEvent)})}this.isTopLevelComment&&this.params.panoptoGlobal.Core.UI.Handlers.button(a,function(){n.params.eventClickedCallback(n.commentEvent)}),t?e.replaceWith(a):e.append(a),this.element=a},l.prototype.remove=function(){var e=this;this.element.slideUp(this.animationSpeed,function(){e.element.remove()})},l.template=_.template('\n<li class="comment-block"\n    id="<@= comment.id @>"\n    tabindex="0">\n    <div class="comment-header">\n        <span class="username"><@- comment.userDisplayName @></span>\n        <@ if (comment.isTopLevelComment) { @>\n            <span class="session-time">\n                <@= comment.sessionTimestampString @>\n            </span>\n        <@ } @>\n    </div>\n    <div class="comment-body">\n        <@- comment.text @>\n    </div>\n    <div class="comment-footer">\n        <span class="comment-time" title="<@= comment.creationDateString @>">\n            <@= comment.commentTimestamp @>\n        </span>\n        <a class="reply-link"\n            href="#"\n            aria-label="<@- comment.replyToString @>"\n            style="display: none">\x3c!--\n            --\x3e<@- resx.ViewerPlus_Reply @>\x3c!--\n        --\x3e</a>\n        <a class="edit-link"\n            href="#"\n            aria-label="<@= comment.ViewerPlus_Discussion_EditCommentArialabel @>"\n            style="display: none">\x3c!--\n            --\x3e<@- resx.ViewerPlus_EventEdit @>\x3c!--\n        --\x3e</a>\n        <a class="delete-link"\n            href="#"\n            aria-label="<@= comment.ViewerPlus_Discussion_DeleteCommentArialabel @>"\n            style="display: none">\x3c!--\n            --\x3e<@- resx.ViewerPlus_EventDelete @>\x3c!--\n        --\x3e</a>\n    </div>\n</li>\n        '),l}(),a.CommentViewModel=i}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,o,i,n;t=e.Viewer||(e.Viewer={}),o=t.Tabs||(t.Tabs={}),i=o.Discussion||(o.Discussion={}),n=function(){function o(e){var n=this;this.params=e,this.handleKeys=function(e){var t=$(e.target),o=!0;switch(e.which){case n.params.panoptoGlobal.Core.Key.UpArrow:n.focusPrevComment(t);break;case n.params.panoptoGlobal.Core.Key.DownArrow:n.focusNextComment(t);break;case n.params.panoptoGlobal.Core.Key.LeftArrow:n.findTopLevelComment(t).collapseComments();break;case n.params.panoptoGlobal.Core.Key.RightArrow:n.findTopLevelComment(t).expandComments();break;default:o=!1}o&&(e.preventDefault(),e.stopPropagation())},this.target=e.target,this.events=e.events.slice(0),this.animationSpeed=void 0!==e.animationSpeed?e.animationSpeed:"fast",this.groupedComments=this.transformEventsToGroupedModel(e.events)}return o.prototype.render=function(){this.container=$(o.template({resx:this.params.panoptoGlobal.GlobalResources}));for(var e=0,t=this.groupedCommentsToSortedArray(this.groupedComments);e<t.length;e++)t[e].render(this.container);this.target.append(this.container),$("#commentsTabPane").find(".event-input").wrap("<div class='reply-to-hook'></div>")},o.prototype.syncComments=function(e,t){var o=this;if(void 0===t&&(t=!1),t){var n=_.filter(this.events,function(t){return!_.find(e,function(e){return i.DiscussionUtils.eventsMatchById(t,e)})});_.each(n,function(e){o.removeComment(e)})}_.each(e,function(e){o.addComment(e)}),this.events=e.slice(0)},o.prototype.addComment=function(e){var t=i.DiscussionUtils.roundSessionTime(e.time),o=this.groupedComments[t];o?o.addComment(e):this.addNewThread([e])},o.prototype.addNewThread=function(e){var t=new i.ThreadViewModel({commentEvents:e,animationSpeed:this.animationSpeed,handleKeys:this.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,submitNewEventCallback:this.params.submitNewEventCallback,panoptoGlobal:this.params.panoptoGlobal});t.render(this.container),this.groupedComments[t.comment.sessionTime]=t},o.prototype.removeComment=function(e){this.container.find("#"+e.id);var t=i.DiscussionUtils.roundSessionTime(e.time),o=this.groupedComments[t];o.removeComment(e)&&delete o[e.time.toFixed(2)]},o.prototype.scrollCommentIntoView=function(e){var t=i.DiscussionUtils.roundSessionTime(e.time),o=this.groupedComments[t];if(o){o.expandComments(0);var n=this.container.find("#"+e.id);0<n.length&&(n[0].scrollIntoView(),n.addClass("highlight-comment"),n.animate({backgroundColor:"transparent"},"slow"))}},o.prototype.transformEventsToGroupedModel=function(e){var o=this,n=_.groupBy(e,function(e){return i.DiscussionUtils.roundSessionTime(e.time)}),a={};return Object.keys(n).forEach(function(e){n[e]=_.sortBy(n[e],function(e){return e.creationTime});var t=new i.ThreadViewModel({commentEvents:n[e],animationSpeed:o.animationSpeed,handleKeys:o.handleKeys,eventClickedCallback:o.params.eventClickedCallback,editClickedCallback:o.params.editClickedCallback,deleteClickedCallback:o.params.deleteClickedCallback,submitNewEventCallback:o.params.submitNewEventCallback,panoptoGlobal:o.params.panoptoGlobal});a[e]=t}),a},o.prototype.groupedCommentsToSortedArray=function(e){var t=_.values(e);return t=_.sortBy(t,function(e){return e.comment.creationTimeInMillis})},o.prototype.focusNextComment=function(e){var t=$(".threaded-discussion").find(".comment-block:visible"),o=t.index(e);o+1<t.length&&t[o+1].focus()},o.prototype.focusPrevComment=function(e){var t=$(".threaded-discussion").find(".comment-block:visible"),o=t.index(e);0<o&&t[o-1].focus()},o.prototype.findTopLevelComment=function(e){var t=e.closest(".thread-wrapper").attr("data-timestamp");return this.groupedComments[t]},o.template=_.template("\n        <ul\n            class='threaded-discussion'\n            aria-label=\"<@- resx.ViewerPlus_Discussion_OuterListArialabel @>\">\n        </ul>\n        "),o}(),i.Discussion=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,n,o,i;t=e.Viewer||(e.Viewer={}),n=t.Tabs||(t.Tabs={}),o=n.Discussion||(n.Discussion={}),i=function(){function e(e){this.params=e}return e.prototype.render=function(){var n=this;$(".discussion-input-wrapper").remove(),this.element=$(e.template({resx:this.params.panoptoGlobal.GlobalResources}));var o=this.element.find(".discussion-textarea");o.on("paste input",function(){n.resizeInput(o)}),o.keydown(function(e){if(!e.ctrlKey||e.keyCode!==Panopto.Core.Key.UpArrow)if(e.stopPropagation(),e.keyCode!==Panopto.Core.Key.Enter||e.shiftKey)e.keyCode===Panopto.Core.Key.Esc&&n.remove();else{var t=jQuery.trim(o.val());t&&(n.params.onSubmit(t,n.params.event.time),n.remove())}}),this.params.panoptoGlobal.Core.UI.Handlers.button(this.element.find(".cancel-link"),function(){n.remove()}),this.params.target.append(this.element),o.focus(),o[0].scrollIntoView()},e.prototype.resizeInput=function(e){var t=e.innerHeight()-e.height();e.height(1);var n=e[0].scrollHeight-t;e.height(n)},e.prototype.remove=function(){this.element.remove()},e.template=_.template('\n        <div class="discussion-input-wrapper">\n            <textarea class="discussion-textarea" />\n            <a href="#" class="cancel-link">\n                <@- resx.ViewerPlus_EventTab_Cancel @>\n            </a>\n        </div>\n        '),e}(),o.DiscussionInputControl=i}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(n){var i,e,t,o;i=n.Viewer||(n.Viewer={}),e=i.Tabs||(i.Tabs={}),t=e.Discussion||(e.Discussion={}),o=function(){function n(){}return n.eventsMatchById=function(n,i){var e=!1;return(n.id||i.id)&&n.id===i.id&&(e=!0),(n.eventId||i.eventId)&&n.eventId===i.eventId&&(e=!0),e},n.roundSessionTime=function(n){return+n.toFixed(2)},n}(),t.DiscussionUtils=o}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var t,n,i,s;t=e.Viewer||(e.Viewer={}),n=t.Tabs||(t.Tabs={}),i=n.Discussion||(n.Discussion={}),s=function(){function o(e){var t=this;this.params=e,this.replyClickedCallback=function(e){new i.DiscussionInputControl({event:e,target:t.element,onSubmit:t.params.submitNewEventCallback,panoptoGlobal:t.params.panoptoGlobal}).render()},this.animationSpeed=void 0!==e.animationSpeed?e.animationSpeed:"fast";var n=_.map(e.commentEvents,function(e){return new i.CommentViewModel({animationSpeed:t.animationSpeed,commentEvent:e,replyCallback:t.replyClickedCallback,handleKeys:t.params.handleKeys,eventClickedCallback:t.params.eventClickedCallback,editClickedCallback:t.params.editClickedCallback,deleteClickedCallback:t.params.deleteClickedCallback,panoptoGlobal:t.params.panoptoGlobal})});this.comment=n[0],this.nestedComments=[],1<n.length&&(this.nestedComments=n.slice(1,n.length),this.nestedComments=_.sortBy(this.nestedComments,"creationTimeInMillis"))}return o.prototype.render=function(e,t){void 0===t&&(t=!1);var n=$(o.template({sessionTime:this.comment.sessionTime,resx:this.params.panoptoGlobal.GlobalResources}));this.comment.setAsTopLevelComment(!0),this.comment.render(n.find(".top-level-comment"));var s=this.params.panoptoGlobal.Core.StringHelpers.format(this.params.panoptoGlobal.GlobalResources.ViewerPlus_Discussion_ReplyCountArialabel,this.nestedComments.length),i=o.screenreaderOnlyReplyCountTemplate({replyString:s});n.find(".top-level-comment .comment-block").append(i);var a=n.find(".threaded-comments");_.each(this.nestedComments,function(e){e.render(a)}),0<this.nestedComments.length&&n.find(".reply-expander").show(),this.attachToggleHandlers(n),t?e.replaceWith(n):e.append(n),this.element=n,this.updateReplyCountString()},o.prototype.addComment=function(t){if(this.comment.isForEvent(t))this.comment.updateEvent(t);else{var e=_.find(this.nestedComments,function(e){return e.isForEvent(t)});if(e)e.updateEvent(t);else{var n=new i.CommentViewModel({animationSpeed:this.animationSpeed,commentEvent:t,replyCallback:this.replyClickedCallback,handleKeys:this.params.handleKeys,eventClickedCallback:this.params.eventClickedCallback,editClickedCallback:this.params.editClickedCallback,deleteClickedCallback:this.params.deleteClickedCallback,panoptoGlobal:this.params.panoptoGlobal}),s=this.element.find(".threaded-comments");n.render(s),this.nestedComments.push(n),this.updateReplyCountString(),this.element.find(".reply-expander").show()}}},o.prototype.removeComment=function(e){var t=this,n=!1;return this.comment.isForEvent(e)?0<this.nestedComments.length?(this.comment=this.nestedComments[0],1<this.nestedComments.length?this.nestedComments=this.nestedComments.slice(1,this.nestedComments.length):this.nestedComments=[],this.render(this.element,!0)):(this.element.slideUp(this.animationSpeed,function(){t.element.remove()}),n=!0):this.removeChildComment(e),n},o.prototype.removeChildComment=function(t){var e=_.findIndex(this.nestedComments,function(e){return e.isForEvent(t)});void 0!==e&&(this.nestedComments[e].remove(),this.nestedComments.splice(e,1),0===this.nestedComments.length&&this.element.find(".reply-expander").hide(),this.updateReplyCountString())},o.prototype.remove=function(){var e=this;this.element.slideUp(this.animationSpeed,function(){e.element.remove()})},o.prototype.expandComments=function(e){var t=void 0!==e?e:this.animationSpeed;0<this.nestedComments.length&&!this.element.find(".threaded-comments").is(":visible")&&(this.setToggleText(this.element,!0),this.element.find(".threaded-comments").slideToggle(t))},o.prototype.collapseComments=function(){0<this.nestedComments.length&&this.element.find(".threaded-comments").is(":visible")&&(this.setToggleText(this.element,!1),this.element.find(".threaded-comments").slideToggle("fast"),this.element.find(".top-level-comment .comment-block").focus())},o.prototype.updateReplyCountString=function(){var e=this.params.panoptoGlobal.Core.StringHelpers.format(this.params.panoptoGlobal.GlobalResources.ViewerPlus_ViewReplies,this.nestedComments.length);this.element.find(".expand-replies").text(e)},o.prototype.attachToggleHandlers=function(t){var n=this;this.params.panoptoGlobal.Core.UI.Handlers.button(t.find(".expandable"),function(){t.find(".threaded-comments").slideToggle("fast",function(){var e=t.find(".threaded-comments").is(":visible");n.setToggleText(t,e),(e?t.find(".hide-replies"):t.find(".expand-replies")).focus()})});var e=2<this.nestedComments.length;e&&t.find(".threaded-comments").hide(),this.setToggleText(t,!e)},o.prototype.setToggleText=function(e,t){e.find(".expand-replies").toggleClass("hidden",t),e.find(".hide-replies").toggleClass("hidden",!t)},o.template=_.template('\n        <li class="thread-wrapper" data-timestamp="<@= sessionTime @>">\n            <ul class="top-level-comment"></ul>\n            <div class="reply-expander">\n                <a href="#" class="expand-replies expandable right-arrow">\n                </a>\n                <a href="#" class="hide-replies expandable down-arrow">\n                    <@- resx.ViewerPlus_HideReplies @>\n                </a>\n                <ul class="threaded-comments">\n                </ul>\n            </div>\n        </li>\n        '),o.screenreaderOnlyReplyCountTemplate=_.template('\n        <span class="screenreader">\n            <@= replyString @>\n        </span>\n        '),o}(),i.ThreadViewModel=s}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditContentsTab=function(e,t,a,d,n,i,r){var o,s=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,a,Panopto.Viewer.Analytics.EditContents,d,r,[Panopto.Core.EventType.Label,Panopto.Core.EventType.SlideChange],Panopto.GlobalResources.ViewerPlus_Edit_AddTOC),c=Panopto.Core.Extensions.base(s),l=t.find(".event-input"),u=t.find("#editDescriptionInput"),p=t.find("#quizInputOption"),f=t.find("#youtubeInputOption"),v=$("#urlInputOption"),m=new PanoptoTS.Viewer.Controls.OrderedContainer;s.$eventList.append(m.element);var P={},C={},b={},E=function(){var e=l.hasClass(Panopto.Core.Constants.PlaceholderClass)?"":l.val();return $.trim(e)};i.eventAdded.add(function(e){var t=void 0!==e.link&&-1!==e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl);e.type!==Panopto.Core.EventType.Label||t||s.openEditDialog(e)}),s.addEvent=function(e){c.addEvent(e,Panopto.Core.EventType.Label,!0)},s.resize=function(e,t){o.resize(),c.resize(e,t)},s.position=function(e){p.add(f).toggleClass(Panopto.Core.Constants.DisabledClass,!i.isValidTimeForEmbeddedEvent(e)),v.toggleClass(Panopto.Core.Constants.DisabledClass,!i.isValidTimeForEvent(e)),c.position(e)},s.render=function(){var e=d.activeState();T(e.sessionReferences),w(s.filterForRender()),V(e.questionLists())},s.openEditDialog=function(t){c.openEditDialog(_.find(s.events(),function(e){return e.id===t.id}))};var T=function(e){_.each(e,function(e){P.hasOwnProperty(e.id)||(P[e.id]=h());var t=P[e.id];t.render(e),m.insert(t.element,e.editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier)}),_.each(Object.keys(P),function(t){_.some(e,function(e){return e.id===t})||(m.remove(P[t].element),delete P[t])})},h=function(){var e=new PanoptoTS.Viewer.Tabs.Editor.SessionReferenceRow;return e.seekCallbacks.add(function(e){a.setPosition(e.editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier)}),e.editCallbacks.add(function(e){S(e)}),e.deleteCallbacks.add(function(t){var e=r.toWin32EpochRelative(a.getPosition());d.pushEdit();var n=d.activeState().sessionReferences,i=_.findIndex(n,function(e){return e.id===t.id});if(-1!==i){n.splice(i,1);var o=_.filter(d.activeState().cuts(),function(e){return e.targetId===t.id});_.each(o,function(e){d.activeState().cuts().splice(d.activeState().cuts().indexOf(e),1)})}d.activeState().refreshTimeline(),d.applyState(),a.setPosition(d.activeState().calculateEditorTimeFromAbsolute(e.ticks()))}),e.eventSeekCallbacks.add(function(e){a.setPosition(e.editorTime)}),e},S=function(r){var e=_.chain(d.activeState().sessionReferences).filter(function(e){return e!==r}).filter(function(e){return 0===e.start}).reduce(function(e,t){return e+t.getTimelineDuration()},0).value(),t=d.activeState().duration()-r.getTimelineDuration(),s=new PanoptoTS.Viewer.Dialogs.SessionReferenceEditorDialog(e,t,Panopto.GlobalResources,Panopto.ModalPopup.defaultInstance);s.saveCallbacks.add(function(){d.pushEdit();var e=d.activeState().sessionReferences,t=_.findIndex(e,function(e){return e.id===r.id});if(-1!==t){var n,i=s.createModifiedContent();n=i.start==-1/0?0:i.start==1/0?d.activeState().hostDuration():i.start-_.chain(e).filter(function(e){return e.id!==r.id}).filter(function(e){return e.editorStartTime<i.start}).reduce(function(e,t){return e+t.getTimelineDuration()},0).value();var o=Math.max.apply(Math,_.chain(e).filter(function(e){return e.id!==r.id}).filter(function(e){return e.start===n}).map(function(e){return e.order}).value()),a=Math.max(o+1,i.order);i=i.copy(!0,{start:n,order:a}),e.splice(t,1,i),d.activeState().refreshTimeline(),d.applyState()}}),a.toggleScreens(!1),s.showDialog(r)},w=function(e){_.each(e,function(e){C.hasOwnProperty(e.id)||(C[e.id]=k());var t=C[e.id];t.render(e),m.insert(t.element,e.editorTime)}),_.each(Object.keys(C),function(t){_.some(e,function(e){return e.id===t})||(m.remove(C[t].element),delete C[t])})},k=function(){var e=new PanoptoTS.Viewer.Tabs.Editor.EditableEventRow;return e.seekCallbacks.add(function(e){a.setPosition(e.editorTime)}),e.editCallbacks.add(function(e){s.openEditDialog(e)}),e.changedCallbacks.add(function(t){d.pushEdit();var e=_.find(d.activeState().events(),function(e){return t.event.id===e.id});e.name=t.name,e.edited=!0,d.activeState().refreshTimeline(),d.applyState()}),e.deleteCallbacks.add(function(t){d.pushEdit();var e=s.events(),n=_.find(e,function(e){return t.id===e.id});e.splice(e.indexOf(n),1),d.applyState()}),e},V=function(e){_.each(e,function(e){b.hasOwnProperty(e.id)||(b[e.id]=g());var t=b[e.id],n=r.toUneditedFirstPrimaryRelative(e.firstStreamRelativeTicks);t.render({name:e.name,editorTime:n.seconds()},{isQuestionList:!0}),m.insert(t.element,n.seconds())}),_.each(Object.keys(b),function(t){_.some(e,function(e){return e.id===t})||(m.remove(b[t].element),delete b[t])})},g=function(){var e=new PanoptoTS.Viewer.Tabs.Editor.EditableEventRow;return e.seekCallbacks.add(function(e){a.setPosition(e.editorTime)}),e.changedCallbacks.add(function(t){d.pushEdit();var e=_.find(d.activeState().questionLists(),function(e){return t.event.id===e.id});e.name=t.name,e.isEdited=!0,d.activeState().refreshTimeline(),d.applyState()}),e.deleteCallbacks.add(function(e){d.removeQuestionList(e)}),e};return u.attr(Panopto.Core.Constants.InitAttribute,d.session().description||""),o=Panopto.Core.UI.Components.editableLabel(u,function(e){var t=d.session();t.description=e,Panopto.Core.ServiceInterface.Rest.Sessions.update(t,function(){o.save()},function(){o.revert(),t.description=u.val(),Panopto.Core.UI.Components.placeholder(u,Panopto.GlobalResources.ViewerPlus_Edit_NoDescription)})},!0),Panopto.Core.UI.Components.placeholder(u,Panopto.GlobalResources.ViewerPlus_Edit_NoDescription),n&&(Panopto.Core.UI.Handlers.button(p,function(){var e=s.startTime();void 0===e&&(e=a.position()),i.isValidTimeForEmbeddedEvent(e)&&(d.addQuestionList(E()),s.clearInput())}),p.show()),Panopto.Core.UI.Handlers.button(f,function(){var e=E()||Panopto.GlobalResources.ViewerPlus_Edit_YouTubeDefaultName,t=s.startTime();void 0===t&&(t=a.position()),i.isValidTimeForEmbeddedEvent(t)&&(i.addYouTubeEvent(e,t),s.clearInput())}),Panopto.Core.UI.Handlers.button(v,function(){var e=E()||Panopto.GlobalResources.ViewerPlus_Edit_UrlEventDefaultName,t=s.startTime();void 0===t&&(t=a.position()),i.isValidTimeForEvent(t)&&(i.addUrlEvent(e,t),s.clearInput())}),s};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditCutTab=function(e,t,a,C){var T=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,a,Panopto.Viewer.Analytics.Labels.EditCut,C,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCutTitle),o=Panopto.Core.Extensions.base(T);return T.templateDialog=function(e,t){var a,o,r,i,n,s=C.activeState();switch(t.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:r=s.calculateEditorTimeForCut(t.start,void 0),i=s.calculateEditorTimeForCut(t.end(),void 0),n=Panopto.Core.Constants.SessionIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:var l=C.getStream(t.targetId),d=s.calculateEditorTimeFromAbsolute(l.absoluteStart),c=s.calculateEditorTimeFromAbsolute(l.absoluteEnd());a=C.getStreamName(l,l.id,!0),o=T.formatTime(d)+" - "+T.formatTime(c),r=s.calculateEditorTimeForCut(t.start,t.targetId),i=s.calculateEditorTimeForCut(t.end(),t.targetId),n=PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(l);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:var m=_.find(s.sessionReferences,function(e){return e.id===t.targetId}),u=s.calculateSessionReferenceEditorStartTime(m)/Panopto.Core.Constants.TimelineChunkMultiplier,p=u+m.referencedSessionDuration;a=m.name,o=T.formatTime(u)+" - "+T.formatTime(p),r=s.calculateEditorTimeForCutInClip(t.start,t.targetId),i=s.calculateEditorTimeForCutInClip(t.end(),t.targetId),n=Panopto.Core.Constants.SessionIconCode}e.html(_.template($("#editCutTemplate").html())({cut:{streamName:a,streamLength:o,startTime:T.formatTime(r/Panopto.Core.Constants.TimelineChunkMultiplier),endTime:T.formatTime(i/Panopto.Core.Constants.TimelineChunkMultiplier),streamIconCode:n}}))},T.hasChanges=function(e,t){var a=C.activeState(),o=a.calculateEditorTimeForCut(t.start,t.targetId)/Panopto.Core.Constants.TimelineChunkMultiplier,r=a.calculateEditorTimeForCut(t.end(),t.targetId)/Panopto.Core.Constants.TimelineChunkMultiplier;return e.find(".edit-cut-start-time").val()!==T.formatTime(o)||e.find(".edit-cut-end-time").val()!==T.formatTime(r)},T.validate=function(e,t){var a,o=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0,r=T.validateTime(e.find(".edit-cut-start-time").val(),o,void 0),i=T.validateTime(e.find(".edit-cut-end-time").val(),o,void 0);(e.find(".edit-cut-start-time-error").text(r||""),e.find(".edit-cut-end-time-error").text(i||""),a=!r&&!i)&&(a=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator)<Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator),e.find(".edit-cut-end-time-error").text(a?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_CutEndError));return a},T.populateEvent=function(e,t){var a=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0,o=C.activeState().calculateEditorTimeForCut(t.start,a),r=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator)*Panopto.Core.Constants.TimelineChunkMultiplier,i=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator)*Panopto.Core.Constants.TimelineChunkMultiplier,n=C.activeState(),s=n.calculateRelativeTimeForCut(r,t.targetId),l=n.calculateRelativeTimeForCut(i,t.targetId);C.resizeCut(o,s,l,a,t.targetType)},T.render=function(){var e=_.map(T.events(),function(t){var e,a,o,r,i,n,s=C.activeState();switch(t.targetType){case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session:e=s.calculateEditorTimeForCut(t.start,void 0),a=s.calculateEditorTimeForCut(t.end(),void 0),o=Panopto.GlobalResources.ViewerPlus_Edit_SessionCutName,i=r=!0,n=Panopto.Core.Constants.SessionIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:var l=C.getStream(t.targetId);e=s.calculateEditorTimeForCut(t.start,t.targetId),a=s.calculateEditorTimeForCut(t.end(),t.targetId),o=C.getStreamName(l,t.targetId,!0),r=!l.isPrimary,i=!l.isPrimary,n=PanoptoTS.Viewer.Controls.MaterialDesignIconHelpers.getStreamIconCode(l);break;case Panopto.Core.ServiceInterface.Rest.Objects.TypeName.SessionReference:var d=_.find(s.sessionReferences,function(e){return e.id===t.targetId});e=s.calculateEditorTimeForCutInClip(t.start,t.targetId),a=s.calculateEditorTimeForCutInClip(t.end(),t.targetId),o=d.name,i=!(r=!1),n=Panopto.Core.Constants.SessionIconCode}var c=e/Panopto.Core.Constants.TimelineChunkMultiplier,m=a/Panopto.Core.Constants.TimelineChunkMultiplier;return{id:t.id,eventId:t.id,time:c,displayTime:"\n                        "+Panopto.Core.TimeHelpers.formatDuration(c,Panopto.GlobalResources.TimeSeparator)+" -\n                        "+Panopto.Core.TimeHelpers.formatDuration(m,Panopto.GlobalResources.TimeSeparator),text:o,editable:r,deletable:i,iconCode:n}});o.render(e)},T};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab=function(e,t,n,i,m,f,o,r,a){var P,T,C,E=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,n,i,m,r),h=E,s=Panopto.Core.Extensions.base(E),d=t.find(".event-input"),l=t.find(".event-input-options"),u={},p=function(e){e.keyCode===Panopto.Core.Key.Space&&e.shiftKey&&(e.preventDefault(),n.hotkey(e.keyCode))},c=function(t,e){var n=e.find(".event-text-input"),i=e.find(".event-text-content");Panopto.Core.UI.Handlers.hoverableParent(e,n,function(e){e&&(n.show(),i.hide(),function(i,e,t){var o=u[i.id];o||(o=Panopto.Core.UI.Components.editableLabel(t,function(e){var t=$.trim(e);if(t){m.pushEdit();var n=_.find(m.activeState().events(),function(e){return i.id===e.id});h.updateName(n,t),n.edited=!0,m.applyState()}else o.revert()},!0),Panopto.Core.UI.Components.placeholder(t,Panopto.GlobalResources.ViewerPlus_EventTab_NoContent),t.keydown(p),u[i.id]=o);o.resize()}(t,0,n))},{preserveExisting:!0})},y=function(){P=n.position(),T=n.activePrimary().id;var t=n.activeSecondary();t&&_.find(m.activeState().streams(),function(e){return e.id===t.id})&&(C=t.id)},v=function(){var e=$.trim(d.val());e&&void 0===P?y():e||h.clearStartTime()};h.clearStartTime=function(){C=T=P=void 0},h.filterForRender=function(){return _.filter(E.events(),function(e){return _.contains(o,e.type)&&!e.isDefaultThumbnail})},E.render=function(){var e=h.filterForRender(),t=_.map(e,function(e){var t=e.link&&-1!==e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl);return{id:e.id,eventId:e.id,time:E.toTimelineRelativeTime(e.timelineTime),text:e.name,editable:!t,deletable:!0,inlineEditable:!0,iconClass:t?Panopto.Viewer.Constants.YouTubeIconClass:void 0}});s.render(t),u={}},E.afterRenderItem=function(e,t,n){s.afterRenderItem(e,t,n),c(e,t)},h.formatEventTime=function(e){return E.formatTime(E.toTimelineRelativeTime(e.timelineTime))},h.eventTimeFromFormattedString=function(e){var t=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator),n=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(t*Panopto.Core.Constants.TimelineChunkMultiplier);return f.toWin32EpochRelative(n).ticks()},h.ownsEvent=function(e){return _.contains(o,e.type)},h.clearInput=function(){d.val(""),h.clearStartTime(),Panopto.Core.UI.Components.placeholder(d,a)},h.addEvent=function(e,t,n,i){var o;void 0===P&&y();var r=!0;if(m.activeState().isTimeInSessionReference(P)){var a=m.activeState().findNextTimeNotInSessionReference(P);if(a>=m.activeState().duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),r=!1,h.clearStartTime();else if(confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)){o=a;var s=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(a),d=f.toWin32EpochRelative(s).ticks(),l=m.activeState().activeStreams(d),u=_.find(l,function(e){return!0===e.isPrimary});T=u?u.id:void 0;var p=_.find(l,function(e){return!0!==e.isPrimary});C=p?p.id:void 0}else r=!1}else o=P*Panopto.Core.Constants.TimelineChunkMultiplier;if(r){var c=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(o),v=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e,sessionId:m.session().id,timelineTime:f.toWin32EpochRelative(c).ticks(),type:t,streamId:n&&C?C:T});return i&&(v.link=i),m.pushEdit(),E.events().push(v),m.activeState().refreshTimeline(),m.applyState(),h.clearInput(),v}},E.resize=function(e,t){d.width(e-Panopto.Viewer.Constants.InputMargin),l.width(e-Panopto.Viewer.Constants.InputOptionsMargin),s.resize(e,t-(d.length?d.outerHeight(!0):0)-(l.length?l.outerHeight(!0):0))},h.updateName=function(e,t){e.name=t},h.toggleControlsRequiringPrimaryStream=function(){S?(d.show(),l.show()):(d.hide(),l.hide())},h.startTime=function(){return P},d.length&&(d.off(),Panopto.Core.UI.Components.placeholder(d,a),d.keyup(v),d.keydown(function(e){e.keyCode===Panopto.Core.Key.Enter&&(e.preventDefault(),v(),void 0!==P&&h.addEvent($.trim(d.val()),void 0,void 0,void 0)),e.stopPropagation()}),d.keydown(p)),E.setTimelineEditor=function(e){s.setTimelineEditor(e),m=e};var S=_.some(m.activeState().streams(),function(e){return e.isPrimary});return h.toggleControlsRequiringPrimaryStream(),h};
var PanoptoTS,__extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(o){var e,t,n,i,a;e=o.Viewer||(o.Viewer={}),t=e.Tabs||(e.Tabs={}),n=t.Editor||(t.Editor={}),i=function(){function e(){var e=this;this._seekCallbacks=new o.Models.TypedCallback,this.createElement(),this.eventIcon=this.element.find(".event-icon"),this.eventName=this.element.find(".event-name"),this.eventDisplayTime=this.element.find(".event-display-time"),Panopto.Core.UI.Handlers.button(this.element,function(){e._seekCallbacks.fire(e.event)})}return Object.defineProperty(e.prototype,"seekCallbacks",{get:function(){return this._seekCallbacks},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t){this.event=e;var n=Panopto.Core.TimeHelpers.formatDuration(e.editorTime,Panopto.GlobalResources.TimeSeparator);this.updateName(e.name),this.eventDisplayTime.text(n);var o=t&&t.isQuestionList?Panopto.Core.Constants.QuestionListIconCode:void 0,i=this.isYoutubeEvent(e)?Panopto.Viewer.Constants.YouTubeIconClass:void 0;this.eventIcon.attr("class","event-icon"),o&&this.eventIcon.addClass("material-icons"),i&&this.eventIcon.addClass(i),this.eventIcon.html(o||"")},e.prototype.createElement=function(){this.element=$(e.template())},e.prototype.updateName=function(e){this.eventName.text(e)},e.prototype.isYoutubeEvent=function(e){return e.link&&-1!==e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)},e.template=_.template('\n            <div class="editor-event-row" tabindex="0">\n                <div class="event-icon"></div>\n                <div class="event-name"></div>\n                <div class="event-display-time"></div>\n            </div>'),e}(),a=function(n){function e(){var t=n.call(this)||this;return t._editCallbacks=new o.Models.TypedCallback,t._changedCallbacks=new o.Models.TypedCallback,t._deleteCallbacks=new o.Models.TypedCallback,t.eventInput=Panopto.Core.UI.Components.editableLabel(t.eventName.find("input")),Panopto.Core.UI.Handlers.button(t.element,function(){t.element.addClass("focused"),t.eventInput.focus()},{preserveExisting:!0}),t.eventInput.onChanged.add(function(e){t._changedCallbacks.fire({event:t.event,name:e})}),t.eventInput.onBlur.add(function(){t.element.removeClass("focused")}),t.editEventMenu=new o.Viewer.Controls.EditEventMenu(t.element,t.element.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),t.editEventMenu.editCallbacks.add(function(e){t._editCallbacks.fire(e)}),t.editEventMenu.deleteCallbacks.add(function(e){t._deleteCallbacks.fire(e)}),t}return __extends(e,n),Object.defineProperty(e.prototype,"editCallbacks",{get:function(){return this._editCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changedCallbacks",{get:function(){return this._changedCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deleteCallbacks",{get:function(){return this._deleteCallbacks},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t){n.prototype.render.call(this,e,t),this.editEventMenu.setEvent(e,{canEdit:!(t&&t.isQuestionList||this.isYoutubeEvent(e)),canDelete:!0})},e.prototype.createElement=function(){this.element=$(e.editableTemplate())},e.prototype.updateName=function(e){this.eventInput.resetValue(e)},e.editableTemplate=_.template('\n            <div class="editor-event-row" tabindex="0">\n                <div class="event-icon"></div>\n                <div class="event-name"><input type="text" placeholder="<@= Panopto.GlobalResources.ViewerPlus_EventTab_NoContent @>" /></div>\n                <div class="event-edit-toggle material-icons" tabindex="0" title="<@= Panopto.GlobalResources.ViewerPlus_EventMore @>">&#xE5D4;</div>\n                <div class="event-display-time"></div>\n            </div>'),e}(n.EditorEventRow=i),n.EditableEventRow=a}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditorTab=function(e,o,t,n,s,i){var a=PanoptoLegacy.Viewer.Tabs.EventTab(e,o,t,void 0,[],void 0,!1,n,void 0),d=a,r=Panopto.Core.Extensions.base(a),l=o.find(".event-tab-pane-header"),u=[],p=o.find(".event-tab-list");return d.templateDialog=function(e,o){$.noop()},d.hasChanges=function(e,o){return!1},d.validate=function(e,o){return!0},d.populateEvent=function(e,o){$.noop()},d.formatTime=function(e){return Panopto.Core.TimeHelpers.formatDuration(e,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision)},d.validateTime=function(e,o,t){var n,a,i,r,l;return e?Panopto.Core.TimeHelpers.validateFormattedDuration(e,Panopto.GlobalResources.TimeSeparator,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision)?t||((i=o?_.find(s.activeState().streams(),function(e){return e.id===o}):void 0)?(r=s.activeState().calculateEditorTimeFromAbsolute(i.absoluteStart),l=s.activeState().calculateEditorTimeFromAbsolute(i.absoluteEnd())):(r=0,l=s.activeState().duration()/Panopto.Core.Constants.TimelineChunkMultiplier),r=Math.floor(r*Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier)/Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier,l=Math.floor(l*Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier)/Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier,((a=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator))<r||l<a)&&(n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_OutOfBounds.format(d.formatTime(r),d.formatTime(l)))):n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_InvalidTime:n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoTime,n},d.openEditDialog=function(n,e){var a;t.toggleScreens(!1),Panopto.ModalPopup.defaultInstance.show("#editorDialog",e||i,""),$("#editorDialog").show(),a=$("#editorDialogContent"),d.templateDialog(a,n),Panopto.ModalPopup.defaultInstance.closeCriteria.push(function(){return!d.hasChanges(a,n)||confirm(Panopto.GlobalResources.ViewerPlus_Edit_Modal_Confirm)}),Panopto.Core.UI.Handlers.button($("#editorDialogSave"),function(){var o=n.copy();if(d.validate(a,o)){var e=_.find(u,function(e){return e.id===o.id}),t=u.indexOf(e);(d.hasChanges(a,o)||-1===t)&&(s.pushEdit(),-1!==t?u.splice(t,1,o):u.push(o),d.populateEvent(a,o),s.activeState().refreshTimeline(),s.applyState()),Panopto.ModalPopup.defaultInstance.closeCriteria.length=0,Panopto.ModalPopup.defaultInstance.close()}}),Panopto.Core.UI.Handlers.button($("#editorDialogCancel"),function(){Panopto.ModalPopup.defaultInstance.close()}),a.keydown(function(e){e.stopPropagation()}),a.find("textarea, input").first().focus()},d.render=function(e){var o=!1,t=!0;0===r.events().length&&(t=!(o=!0)),r.render(e,o,!1,t,!0)},d.afterRenderItem=function(e,o,t){r.afterRenderItem(e,o,t);var n=new PanoptoTS.Viewer.Controls.EditEventMenu(o,o.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});n.editCallbacks.add(function(o){d.openEditDialog(_.find(a.events(),function(e){return o.id===e.id}))}),n.deleteCallbacks.add(function(o){var e;s.pushEdit(),e=_.find(a.events(),function(e){return o.id===e.id}),a.events().splice(a.events().indexOf(e),1),s.applyState()}),n.setEvent(e,{canEdit:e.editable,canDelete:e.deletable})},d.events=function(e){if(void 0===e)return u;u=e,d.render(void 0,void 0,void 0,void 0,void 0)},d.valueChanged=function(e,o){var t=e.val();return e.val(o),o=e.val(),e.val(t),t!==o},d.toTimelineRelativeTime=function(e){return s.activeState().calculateEditorTimeFromAbsolute(e)},a.resize=function(e,o){r.resize(e,o-l.outerHeight())},d.setTimelineEditor=function(e){s=e},d.$eventList=p,d};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditQuestionListTab=function(o,e,t,i,n,a){var r=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(o,e,t,Panopto.Viewer.Analytics.Labels.EditQuestionList,i,void 0),s=r,d=Panopto.Core.Extensions.base(r),p=$("#addQuestionListButton");r.render=function(){var o=_.map(r.events(),function(o){var e=n.toUneditedFirstPrimaryRelative(o.firstStreamRelativeTicks);return{id:o.id,eventId:o.id,time:e.seconds(),displayTime:Panopto.Core.TimeHelpers.formatDuration(e.seconds(),Panopto.GlobalResources.TimeSeparator),text:o.name,deletable:!0,iconCode:Panopto.Core.Constants.QuestionListIconCode}});d.render(o)},r.position=function(o){s.toggleControlsRequiringPrimaryStreamOrEvent(o),d.position(o)},s.toggleControlsRequiringPrimaryStreamOrEvent=function(o){p.toggleClass(Panopto.Core.Constants.DisabledClass,!l||!a.isValidTimeForEmbeddedEvent(o))},Panopto.Core.UI.Handlers.button(p,function(){p.hasClass(Panopto.Core.Constants.DisabledClass)||i.addQuestionList(void 0)});var l=_.some(i.activeState().streams(),function(o){return o.isPrimary});return s};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditSlidesTab=function(e,t,r,l,n,i,s){var o,a=Panopto.Viewer.Analytics.EditSlides,c=PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab(e,t,r,a,l,s,[Panopto.Core.EventType.SlideChange],void 0),d=c,u=Panopto.Core.Extensions.base(c),p={},v={},f={},S=function(e){var t=$.Deferred(),n=[];return _.each(e,function(e){n.push(P(e))}),$.when.apply($,n).then(function(){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},P=function(t){var n=$.Deferred();return Panopto.Core.ServiceInterface.Rest.SlideDecks.getAllSlides(t.id,function(e){p[t.id]=e,n.resolve(e)},function(){n.reject()}),n.promise()},T=function(n){var e=new PanoptoTS.Viewer.Tabs.Editor.SlideDeckRow(c.$eventList);return e.slideDeckDeletedCallbacks.add(function(){var t,e;l.pushEdit(),t=l.activeState().events(),e=_.filter(t,function(t){return _.some(p[n.id],function(e){return e.id===t.slideId})}),_.each(e,function(e){t.splice(t.indexOf(e),1)}),l.activeState().slideDecksToDelete().push(n),l.applyState()}),e.slideEventAddCallbacks.add(function(e){var t,n=r.position(),i=!0;if(l.activeState().isTimeInSessionReference(n)){var o=l.activeState().findNextTimeNotInSessionReference(n);if(o>=l.activeState().duration())alert(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClipAtEnd),i=!1,c.clearStartTime();else confirm(Panopto.GlobalResources.ViewerPlus_EventTab_EventDuringClip)?t=o:i=!1}else t=n*Panopto.Core.Constants.TimelineChunkMultiplier;if(i){var a=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(t),d=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e.name,metadata:e.content,timelineTime:s.toWin32EpochRelative(a).ticks(),type:Panopto.Core.EventType.SlideChange,slideId:e.id,slideUrl:e.imageUrl,thumbnailUrl:e.imageUrl,slideDeckId:e.slideDeckId,sessionId:l.session().id});l.pushEdit(),c.events().push(d),l.activeState().refreshTimeline(),l.applyState()}}),e.slideEventSelectedCallbacks.add(function(e,t){r.setPosition(t.editorTime),Panopto.Viewer.Analytics.sendEvent({action:Panopto.Viewer.Analytics.Actions.Navigate,label:a})}),e.slideEventEditCallbacks.add(function(e,t){c.openEditDialog(_.find(c.events(),function(e){return e.id===t.id}))}),e.slideEventDeleteCallbacks.add(function(e,t){l.pushEdit();var n=c.events(),i=_.find(n,function(e){return t.id===e.id});n.splice(n.indexOf(i),1),l.applyState()}),e},m=function(t){var e=_.filter(c.events(),function(e){return e.type===Panopto.Core.EventType.SlideChange&&e.slideId===t.id});return _.each(e,function(e){e.slideDeckId||(e.slideDeckId=t.slideDeckId),e.displayTime=Panopto.Core.TimeHelpers.formatDuration(e.editorTime,Panopto.GlobalResources.TimeSeparator)}),e};i.onReady.add(function(e){_.each(e,function(e){E(e)}),d.setReadyStreamUploader(),d.hasAnyUploadingRow()&&r.fireTabSelected(c)}),d.setReadyStreamUploader=function(){l.overlayController.setEditSlidesTabAddButton($("#addSlideDeckButton")),l.overlayController.setOverlaysSlideUploader(i)},i.onBeforeUpload.add(function(){r.fireTabSelected(c)}),i.onUpdate.add(function(e){E(e)}),i.onComplete.add(function(e){var t;b(e),t=$.Deferred(),Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(l.session().id,function(e){S(e).then(function(){t.resolve(e)}).fail(function(){t.reject()})},function(){t.reject()}),o=t.promise(),c.render(void 0,void 0,void 0,void 0,void 0)}),i.onDelete.add(function(e){b(e)}),i.getCurrentUploads();var E=function(e){if(!f.hasOwnProperty(e.uploadId)){var t=new(n.debug?PanoptoTS.Viewer.Tabs.Editor.PendingUploadRowDebug:PanoptoTS.Viewer.Tabs.Editor.PendingUploadRow)(Panopto.GlobalResources.ViewerPlus_Edit_InvalidSlideDeck,Panopto.GlobalResources);t.onPendingUploadDeleting.add(function(e){i.cancelUpload(e)}),f[e.uploadId]=t,c.$eventList.append(t.element)}f[e.uploadId].render(l.activeState(),e)},b=function(e){var t=f[e.uploadId];t&&(t.element.remove(),delete f[e.uploadId])};return c.render=function(){o.then(function(e){var t;t=e,_.each(t,function(e){v.hasOwnProperty(e.id)||(v[e.id]=T(e));var n=v[e.id];n.render(e),_.each(p[e.id],function(e){var t=m(e);n.renderSlide(e,t)})}),_.each(v,function(e,t){_.some(l.activeState().slideDecksToDelete(),function(e){return e.id===t})&&e.hide();var n=_.some(l.activeState().streams(),function(e){return e.isPrimary});e.setCanAddSlide(n)})})},d.hasAnyUploadingRow=function(){return 0<Object.keys(f).length},c.setTimelineEditor=function(e){u.setTimelineEditor(e),l=e},d.setSlideDecks=function(e){o=S(e),c.render(void 0,void 0,void 0,void 0,void 0)},d};
var PanoptoTS;!function(n){var e,t,o,r;e=n.Viewer||(n.Viewer={}),t=e.Tabs||(e.Tabs={}),o=t.Editor||(t.Editor={}),r=function(){function t(e){this.element=$(t.template({label:e})),this.element.hide(),this.orderedContainer=new n.Viewer.Controls.OrderedContainer,this.element.append(this.orderedContainer.element)}return t.prototype.addStreamRow=function(e,t){this.orderedContainer.insert(e.element,t),this.element.show()},t.prototype.addPendingUploadRow=function(e,t){this.orderedContainer.insert(e.element,t),this.element.show()},t.prototype.removeStreamRow=function(e){this.orderedContainer.remove(e.element),0===this.orderedContainer.rowCount()&&this.element.hide()},t.prototype.removePendingUploadRow=function(e){this.orderedContainer.remove(e.element),0===this.orderedContainer.rowCount()&&this.element.hide()},t.template=_.template('\n            <div class="edit-stream-list">\n                <div class="edit-stream-list-label"><@= label @></div>\n            </div>'),t}(),o.EditStreamList=r}(PanoptoTS||(PanoptoTS={}));
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditStreamTab=function(e,t,i,u,o,n,a,p){var r=$(".add-streams"),s=PanoptoLegacy.Viewer.Tabs.Editor.EditorTab(e,t,i,Panopto.Viewer.Analytics.Labels.EditStream,u,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditStreamTitle),d=s,l=Panopto.Core.Extensions.base(s),c=new PanoptoTS.Viewer.Tabs.Editor.EditStreamList(Panopto.GlobalResources.ViewerPlus_Edit_Primary),m=new PanoptoTS.Viewer.Tabs.Editor.EditStreamList(Panopto.GlobalResources.ViewerPlus_Edit_Secondary);s.$eventList.append(c.element).append(m.element);var v=_.template($("#editStreamTemplate").html()),f=$.Deferred(),y=!1,P={},T={};Panopto.Core.UI.Handlers.button(r,function(){r.hasClass(Panopto.Core.Constants.DisabledClass)||u.streamTab().showUploadOverlay({secondaryOnly:!1})});var S=function(e){if(!T.hasOwnProperty(e.uploadId)){var t=E(e.streamType),a=new(o.debug?PanoptoTS.Viewer.Tabs.Editor.PendingUploadRowDebug:PanoptoTS.Viewer.Tabs.Editor.PendingUploadRow)(Panopto.GlobalResources.ViewerPlus_Edit_InvalidStreamFile,Panopto.GlobalResources);a.onPendingUploadDeleting.add(function(e){n.cancelUpload(e)}),T[e.uploadId]=a,t.addPendingUploadRow(a,Panopto.Core.TimeHelpers.dateToWin32EpochTime(e.startTime))}T[e.uploadId].render(u.activeState(),e)},w=function(e){var t=T[e.uploadId];if(t){var a=E(e.streamType);delete T[e.uploadId],a.removePendingUploadRow(t)}},h=function(){return _.some(s.events(),function(e){return e.isPrimary})},b=function(){var e=_.some(s.events(),function(e){return!e.isPrimary}),t=_.some(u.activeState().events(),function(e){return e.slideId});return e||t},C=function(){u.overlayController.updateOverlayProcessing(_.map(_.values(T),function(e){return e.pendingUpload}))},g=function(e){var t=h(),a=b(),o=!a&&d.hasPendingSecondaryUploads();i.synchronize(!0),!t||o||e?d.showUploadOverlay({secondaryOnly:t&&o}):(u.overlayController.forceCloseOverlays(),(i.viewMode()===Panopto.Viewer.ViewMode.Primary||a)&&u.overlayController.toggleSecondaryPlaceholder(!1)),d.hasAnyUploadingRow()&&(i.fireTabSelected(s),C())},E=function(e){var t;switch(e){case 1:t=c;break;case 2:t=m}return t};return s.templateDialog=function(e,t){var a=[];_.each(Panopto.Core.MediaVRType,function(e,t){a.push({value:e,name:Panopto.GlobalResources["ViewerPlus_Edit_Modal_VRType_"+t]})}),e.html(v({stream:{name:t.name,streamType:u.getStreamFriendlyType(t),displayType:t.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary:Panopto.GlobalResources.ViewerPlus_Edit_Secondary,length:Panopto.Core.TimeHelpers.formatDuration(t.duration/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!1,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision),startTime:s.formatTime(s.toTimelineRelativeTime(t.absoluteStart)),iconCode:t.iconCode,vrType:t.vrType},vrTypes:a}))},s.hasChanges=function(e,t){var a=s.valueChanged(e.find(".edit-stream-name"),t.name);return a=(a=a||e.find(".edit-stream-time").val()!==s.formatTime(s.toTimelineRelativeTime(t.absoluteStart)))||parseInt(e.find(".edit-stream-vr-type").val(),10)!==t.vrType},s.validate=function(e,t){var a=s.validateTime(e.find(".edit-stream-time").val(),t.id,!0);return e.find(".edit-stream-time-error").text(a||""),!a},s.populateEvent=function(e,t){var a,o=u.activeState().absoluteStart(),n=u.activeState().firstPrimaryOffset(),i=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-stream-time").val(),Panopto.GlobalResources.TimeSeparator),r=new PanoptoTS.Core.Logic.Time.UneditedFirstPrimaryRelative(i*Panopto.Core.Constants.TimelineChunkMultiplier),s=p.toWin32EpochRelative(r),d=s.ticks()-t.absoluteStart,l=function(t){var a=[];t&&(_.each(u.activeState().cuts(),function(e){e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&(e.end()+t<=u.activeState().firstPrimaryOffset()||e.start+t>=u.activeState().hostDuration()?a.push(e):(e.start=Math.max(e.start+t,u.activeState().firstPrimaryOffset()),e.duration=Math.min(e.duration,u.activeState().hostDuration()-e.start)))}),_.each(a,function(e){u.activeState().cuts().splice(u.activeState().cuts().indexOf(e),1)}))};if(t.name=e.find(".edit-stream-name").val(),t.absoluteStart=s.ticks(),t.vrType=parseInt(e.find(".edit-stream-vr-type").val(),10),u.activeState().refreshTimeline(),d){_.each(u.activeState().events(),function(e){e.streamId===t.id&&(e.timelineTime+=d,e.edited=!0)});var c=u.activeState().absoluteStart()-o;l(c||u.activeState().firstPrimaryOffset()-n),t.isPrimary&&(a=_.filter(u.activeState().cuts(),function(e){return e.targetId===t.id}),_.each(a,function(e){u.activeState().cuts().splice(u.activeState().cuts().indexOf(e),1)}),u.applyPrimaryHeuristicCuts())}},s.render=function(){_.each(s.events(),function(e){var t,a=PanoptoTS.Viewer.Data.Stream.convertFromApiModel(e),o=E(a.streamType);if(!P.hasOwnProperty(a.id)){var n=((t=new PanoptoTS.Viewer.Tabs.Editor.StreamRow).streamSeekCallbacks.add(function(e){i.setPosition(s.toTimelineRelativeTime(e.absoluteStart))}),t.streamEditCallbacks.add(function(t){s.openEditDialog(_.find(s.events(),function(e){return e.id===t.id}))}),t);P[a.id]=n}o.addStreamRow(P[a.id],a.absoluteStart),P[a.id].render(u.activeState(),a)}),_.each(P,function(e,t){_.some(s.events(),function(e){return e.id===t})||(E(e.getStream().streamType).removeStreamRow(e),delete P[t])}),f.resolve()},d.hasAnyUploadingRow=function(){return 0<Object.keys(T).length},d.hasPendingSecondaryUploads=function(){return _.some(_.values(T),function(e){return 2===e.pendingUpload.streamType})},d.showUploadOverlay=function(e){var t=(void 0===e?{}:e).secondaryOnly,a=void 0!==t&&t;u.overlayController.showOverlays(h(),b(),_.map(_.values(T),function(e){return e.pendingUpload}),i.viewMode(),{secondaryOnly:a})},f.then(function(){n.getCurrentUploads()}),n.onReady.add(function(e){_.each(e,function(e){S(e)}),d.setReadyStreamUploader(),g(!(y=!0))}),d.setReadyStreamUploader=function(){u.overlayController.setOverlaysStreamUploader(n)},n.onBeforeUpload.add(function(){g(!0)}),n.onUpdate.add(function(e){var t=!T[e.uploadId];S(e),y&&(t?g(!0):C())}),n.onComplete.add(function(e){w(e),a.getAllStreams(u.session().id,function(e){u.pushEdit(),u.activeState().streams().length=0,_.each(e,function(e){u.activeState().streams().push(e)}),u.activeState().refreshTimeline(),g(!1),i.setSecondaryCount(0),i.reinitializeDelivery()})}),n.onDelete.add(function(e){w(e),g(!1)}),s.setTimelineEditor=function(e){l.setTimelineEditor(e),(u=e).onAddContentRequirementChanged.add(function(e){r.toggleClass(Panopto.Core.Constants.DisabledClass,!e.canAddContent)})},d};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditTOCEventTab=function(e,t,i,n,d,a,o,r){var m=PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab(e,t,i,n,d,a,o,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditTOCTitle,r),l=Panopto.Core.Extensions.base(m),s=window.location.protocol+"//",c=/^.*?:\/\//;return m.templateDialog=function(n,a){var e=function(){var e,t=[];if(m.validateTime(n.find(".edit-contents-time").val(),void 0,void 0))t.push(_.find(d.activeState().streams(),function(e){return e.id===a.streamId}));else{var i=m.valueChanged(n.find(".edit-contents-time"),m.formatEventTime(a))?m.eventTimeFromFormattedString(n.find(".edit-contents-time").val()):a.timelineTime;t=d.activeState().activeStreams(i)}n.find(".edit-contents-stream").html(_.template($("#editStreamOptionTemplate").html())({streams:_.map(t,function(e){return{id:e.id,displayName:d.getStreamName(e,e.id,!0)}})})),e=_.find(t,function(e){return e.id===a.streamId})||t[0],n.find(".edit-contents-stream").val(e.id)};n.html(_.template($("#editContentsTemplate").html())({event:{name:a.name,formattedTime:m.formatEventTime(a),thumbnailSrc:a.thumbnailUrl||Panopto.cacheRoot+"/Images/no_thumbnail.svg",thumbnailGenerated:!a.thumbnailUrl,metadata:a.metadata,scheme:s,link:a.link?a.link.replace(c,""):"",streamId:a.streamId}})),a.streamId&&(e(),n.find(".edit-contents-time").blur(e)),n.find(".edit-contents-link").width(n.find(".edit-contents-link").width()-n.find(".edit-contents-link-scheme").width()-5)},m.hasChanges=function(e,t){var i=m.valueChanged(e.find(".edit-contents-title"),t.name);return i=(i=(i=(i=i||m.valueChanged(e.find(".edit-contents-time"),m.formatEventTime(t)))||t.streamId&&t.streamId!==e.find(".edit-contents-stream").val())||m.valueChanged(e.find(".edit-contents-metadata"),t.metadata))||m.valueChanged(e.find(".edit-contents-link"),t.link?t.link.replace(c,""):"")},m.validate=function(e,t){var i=m.validateTime(e.find(".edit-contents-time").val(),e.find(".edit-contents-stream").val()||void 0,void 0);if(!i){var n=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-contents-time").val(),Panopto.GlobalResources.TimeSeparator);if(d.activeState().isTimeInSessionReference(n)){var a=d.activeState().findNextTimeNotInSessionReference(n),o=Panopto.Core.TimeHelpers.formatDuration(a/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision);i=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(o)}}return e.find(".edit-contents-time-error").text(i||""),!i},m.populateEvent=function(e,t){var i=e.find(".edit-contents-link").val(),n=e.find(".edit-contents-stream").val();t.name=e.find(".edit-contents-title").val(),t.timelineTime=m.eventTimeFromFormattedString(e.find(".edit-contents-time").val()),t.metadata=e.find(".edit-contents-metadata").val(),t.link=i?s+i.replace(c,""):void 0,t.streamId&&t.streamId!==n&&(t.id=_.uniqueId("event"),t.streamId=n,t.thumbnailUrl=void 0,t.slideUrl=void 0),t.edited=!0},m.setTimelineEditor=function(e){l.setTimelineEditor(e),d=e},m};
var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},PanoptoLegacy.Viewer.Tabs.Editor.EditTranscriptTab=function(e,t,n,p,o){var a="\n        <span class='max-length-notification'>\n            "+Panopto.GlobalResources.ViewerPlus_Edit_CaptionLengthNotification+"\n        </span>",i=[Panopto.Core.EventType.Caption],s=PanoptoLegacy.Viewer.Tabs.Editor.EditEventTab(e,t,n,Panopto.Viewer.Analytics.EditTranscript,p,o,i,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCaptionTitle,Panopto.GlobalResources.ViewerPlus_Edit_AddCaption),r=Panopto.Core.Extensions.base(s),d=t.find("#editTranscriptPaneHeader"),c=d.find("#importTranscriptButton"),l=d.find("#importTranscriptPopup"),u=d.find("#importMachineTranscriptButton"),f=d.find("#requestTranscriptButton"),m=t.find(".event-input-wrapper"),v=m.find(".event-input"),P=m.find(".max-length-notification");s.render=function(){var e=0<p.activeState().filterEvents(Panopto.Core.EventType.Caption).length;u.text(e?Panopto.GlobalResources.ViewerPlus_Edit_ReplaceWithMachineTranscript:Panopto.GlobalResources.ViewerPlus_Edit_ImportMachineTranscript),T(v,P),r.render()},s.templateDialog=function(e,t){e.html(_.template($("#editTranscriptTemplate").html())({event:{name:t.name,formattedTime:s.formatEventTime(t)}}))},s.hasChanges=function(e,t){var n=s.valueChanged(e.find(".edit-transcript-title"),t.name);return n=n||s.valueChanged(e.find(".edit-transcript-time"),s.formatEventTime(t))},s.validate=function(e,t){var n,o;if(n=!!$.trim(e.find(".edit-transcript-title").val()),e.find(".edit-transcript-title-error").text(n?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoCaption),!(o=s.validateTime(e.find(".edit-transcript-time").val(),t.streamId,void 0))){var i=Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-transcript-time").val(),Panopto.GlobalResources.TimeSeparator);if(p.activeState().isTimeInSessionReference(i)){var a=p.activeState().findNextTimeNotInSessionReference(i),r=Panopto.Core.TimeHelpers.formatDuration(a/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision);o=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_TimeInClip.format(r)}}return e.find(".edit-transcript-time-error").text(o||""),n=n&&!o},s.populateEvent=function(e,t){s.updateName(t,e.find(".edit-transcript-title").val()),t.timelineTime=s.eventTimeFromFormattedString(e.find(".edit-transcript-time").val()),t.edited=!0},s.updateName=function(e,t){r.updateName(e,t),e.metadata&&(e.metadata=t)},s.addEvent=function(e){r.addEvent(e,Panopto.Core.EventType.Caption),P.hide()},s.filterForRender=function(){return _.filter(s.events(),function(e){return _.contains(i,e.type)||e.forceShow&&e.type===Panopto.Core.EventType.SpeechRecognition})},Panopto.Core.UI.Components.popup(l,c,function(){l.show().css({top:d.outerHeight()+"px"}),u.toggle(0<p.activeState().filterEvents(Panopto.Core.EventType.SpeechRecognition).length)}),Panopto.Core.UI.Handlers.button(u,function(){var e;l.hide(),p.pushEdit();var t=_.filter(p.activeState().events(),function(e){return e.type===Panopto.Core.EventType.SpeechRecognition&&!e.forceShow});e=_.map(t,function(e){var t=e.copy();return t.forceShow=!0,t.id=_.uniqueId("event"),t});var n=_.filter(p.activeState().events(),function(e){return e.type===Panopto.Core.EventType.Caption||e.type===Panopto.Core.EventType.SpeechRecognition&&e.forceShow});_.each(n,function(e){s.events().splice(s.events().indexOf(e),1)}),_.each(e,function(e){s.events().push(e)}),p.activeState().refreshTimeline(),p.applyState()}),Panopto.Core.UI.Handlers.button(f,function(){l.hide(),n.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionTranscript",modalHeader:Panopto.Core.TextHelpers.innerText(p.session().name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:p.session().id})})}),s.afterRenderItem=function(e,t,n){r.afterRenderItem(e,t,n);var o=$(a);t.find(".event-text").append(o);var i=t.find(".event-text-input");T(i,o)};var T=function(t,n){t.attr("maxlength",PanoptoTS.Viewer.Constants.CaptionMaxLength),t.on("input focus",function(){var e=t.val().length>=PanoptoTS.Viewer.Constants.CaptionMaxLength;n.toggle(e)}),t.on("blur",function(){n.hide()})};return s};
var PanoptoTS;!function(e){var t,i,n,o,s,r;t=e.Viewer||(e.Viewer={}),i=t.Tabs||(t.Tabs={}),n=i.Editor||(i.Editor={}),o=e.Models.TypedCallback,s=e.Core.Logic.Time.UneditedFirstPrimaryRelative,r=function(){function e(e){this.timeConverter=e,this._eventAdded=new o}return Object.defineProperty(e.prototype,"eventAdded",{get:function(){return this._eventAdded},enumerable:!0,configurable:!0}),e.prototype.getActiveStreamIdAtTime=function(e,t){var i=this.timelineState.activeStreams(e),n=_.find(i,function(e){return!0===e.isPrimary}),o=_.find(i,function(e){return!0!==e.isPrimary}),r=void 0!==n?n.id:void 0,s=void 0!==o?o.id:void 0;return t&&void 0!==s?s:r},e.prototype.isCloseToAnotherEmbeddedEvent=function(n){var o=this,r=function(e,t,i){return e>t-Panopto.Viewer.Constants.UrlEventClosenessTolerance&&e<i+Panopto.Viewer.Constants.UrlEventClosenessTolerance},e=_.any(this.timelineState.questionLists(),function(e){var t=o.timeConverter.toFirstPrimaryRelative(e.firstStreamRelativeTicks).seconds(),i=t+Panopto.Viewer.Constants.UrlEventDuration;return r(n,t,i)}),t=_.any(this.timelineState.events(),function(e){if(e.link&&-1!==e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)){var t=o.timelineState.calculateEditorTimeTicksFromAbsolute(e.timelineTime)/Panopto.Core.Constants.TimelineChunkMultiplier,i=t+Panopto.Viewer.Constants.UrlEventDuration;return r(n,t,i)}});return e||t},e.prototype.addEvent=function(e,t,i,n,o){var r=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e,sessionId:this.sessionId,timelineTime:t,type:i,streamId:n,link:o});this._eventAdded.fire(r)},e.prototype.applyState=function(e,t){this.sessionId=e,this.timelineState=t},e.prototype.isValidTimeForEmbeddedEvent=function(e){return!this.isCloseToAnotherEmbeddedEvent(e)&&this.isValidTimeForEvent(e)},e.prototype.isValidTimeForEvent=function(e){return!this.timelineState.isTimeInSessionReference(e)},e.prototype.addYouTubeEvent=function(e,t){if(this.isValidTimeForEmbeddedEvent(t)){var i=new s(t*Panopto.Core.Constants.TimelineChunkMultiplier),n=this.timeConverter.toWin32EpochRelative(i),o=this.getActiveStreamIdAtTime(n.ticks(),!0);this.addEvent(e,n.ticks(),Panopto.Core.EventType.Label,o,Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)}},e.prototype.addUrlEvent=function(e,t){if(this.isValidTimeForEvent(t)){var i=new s(t*Panopto.Core.Constants.TimelineChunkMultiplier),n=this.timeConverter.toWin32EpochRelative(i),o=this.getActiveStreamIdAtTime(n.ticks(),!0),r=e.match(Panopto.Core.Constants.UrlMatcher)?e:void 0;this.addEvent(e,n.ticks(),Panopto.Core.EventType.Label,o,r)}},e}(),n.EventService=r}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(t){var e,o,s,r;e=t.Viewer||(t.Viewer={}),o=e.Tabs||(e.Tabs={}),s=o.Editor||(o.Editor={}),r=function(){function r(e,o){var s=this;this.invalidFileErrorLabel=e,this.resources=o,this._onPendingUploadDeleting=new t.Models.TypedCallback,this.element=$(r.template()),this.uploadIcon=this.element.find(".upload-icon"),this.uploadName=this.element.find(".upload-name"),this.uploadDelete=this.element.find(".upload-delete"),this.uploadEventTime=this.element.find(".upload-event-time"),this.uploadProgress=this.element.find(".upload-progress"),this.uploadProgressBar=this.element.find(".upload-progress-bar"),this.uploadBytes=this.element.find(".upload-bytes"),this.uploadProcessing=this.element.find(".upload-processing"),this.uploadError=this.element.find(".upload-error"),Panopto.Core.UI.Handlers.button(this.uploadDelete,function(){s._onPendingUploadDeleting.fire(s.pendingUpload)})}return Object.defineProperty(r.prototype,"onPendingUploadDeleting",{get:function(){return this._onPendingUploadDeleting},enumerable:!0,configurable:!0}),r.prototype.render=function(e,o){if((this.pendingUpload=o).startTime){var s=void 0;if(e.absoluteStart()===1/0)s=0;else{var r=Panopto.Core.TimeHelpers.dateToWin32EpochTime(o.startTime)*Panopto.Core.Constants.TimelineChunkMultiplier;s=e.calculateEditorTimeFromAbsolute(r)}var t=Panopto.Core.TimeHelpers.formatDuration(s,Panopto.GlobalResources.TimeSeparator);this.uploadEventTime.text(t+" - ...")}else this.uploadEventTime.text("");switch(this.uploadIcon.html(o.iconCode),this.uploadName.text(o.filename),o.state){case 1:this.renderUploadProgress(o.bytesUploaded,o.fileSize);break;case 2:this.renderProcessing();break;case 3:this.renderError(this.invalidFileErrorLabel);break;case 4:this.renderError(Panopto.Core.StringHelpers.format(this.resources.ViewerPlus_Edit_LargeFile,Panopto.Core.StringHelpers.readableByteCount(Panopto.features.uploadByteLimit,this.resources)));break;case 5:this.renderError(Panopto.GlobalResources.ViewerPlus_Edit_UploadError);break;case 6:this.renderError(o.errorMessage?o.errorMessage:Panopto.GlobalResources.ViewerPlus_Edit_UploadProcessingError);break;case 7:this.renderError(Panopto.GlobalResources.ViewerPlus_Edit_UploadDeleteError);break;default:$.noop()}this.element.show()},r.prototype.renderUploadProgress=function(e,o){this.setUploadProgress(e,o),this.uploadProgress.show(),this.uploadProcessing.hide(),this.uploadError.text("").hide()},r.prototype.renderError=function(e){this.unsetUploadProgress(),this.uploadProgress.hide(),this.uploadProcessing.hide(),this.uploadError.text(e).attr("title",e).show()},r.prototype.renderProcessing=function(){this.unsetUploadProgress(),this.uploadProgress.hide(),this.uploadProcessing.show(),this.uploadError.text("").hide()},r.prototype.setUploadProgress=function(e,o){var s=Panopto.Core.StringHelpers.readableUploadProgress(e,o,Panopto.GlobalResources,"ViewerPlus_Edit_UploadProgress");this.uploadBytes.text(s).show(),this.uploadProgressBar.css("width",e/o*100+"%").show(),this.uploadDelete.show()},r.prototype.unsetUploadProgress=function(){this.uploadBytes.text("").hide(),this.uploadProgressBar.hide(),this.uploadDelete.hide()},r.template=_.template('\n            <div class="upload-row">\n                <div class="upload-metadata">\n                    <div class="upload-icon material-icons"></div>\n                    <div class="upload-name ellipsis"></div>\n                    <div class="upload-delete material-icons">&#xE14C;</div>\n                    <div class="upload-event-time"></div>\n                </div>\n                <div class="upload-progress">\n                    <div class="upload-progress-bar"></div>\n                    <div class="upload-bytes"></div>\n                </div>\n                <div class="upload-processing">\n                    <span><@= Panopto.GlobalResources.ViewerPlus_Edit_UploadProcessing @></span>\n                    <span class="upload-spinner"></span>\n                </div>\n                <div class="upload-error error"></div>\n            </div>'),r}(),s.PendingUploadRow=r}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS,__extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])};return function(n,e){function t(){this.constructor=n}o(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}();!function(n){var u,e;u=n.Viewer||(n.Viewer={}),function(n){var r="PendingUploadRow_Uploading",i="PendingUploadRow_Processing",d="PendingUploadRow_Error",e=function(o){function n(n,e){var t=o.call(this,n,e)||this;return document.addEventListener(r,function(n){n instanceof CustomEvent&&t.renderUploadProgress(n.detail.bytesUploaded,n.detail.fileSize)}),document.addEventListener(i,function(n){n instanceof CustomEvent&&t.renderProcessing()}),document.addEventListener(d,function(n){n instanceof CustomEvent&&t.renderError(n.detail.error)}),t}return __extends(n,o),n}(n.PendingUploadRow);n.PendingUploadRowDebug=e;var t=function(o){function n(n,e){var t=o.call(this)||this;return t.bytesUploaded=n,t.fileSize=e,t}return __extends(n,o),n.prototype.typeArg=function(){return r},n}(u.DebugEventModel);n.PendingUploadRowUploadingModel=t;var o=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.typeArg=function(){return i},e}(u.DebugEventModel);n.PendingUploadRowProcessingModel=o;var a=function(t){function n(n){var e=t.call(this)||this;return e.error=n,e}return __extends(n,t),n.prototype.typeArg=function(){return d},n}(u.DebugEventModel);n.PendingUploadRowErrorModel=a}((e=u.Tabs||(u.Tabs={})).Editor||(e.Editor={}))}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(e){var n,s,t,i,o,r,a;n=e.Viewer||(e.Viewer={}),s=n.Tabs||(n.Tabs={}),t=s.Editor||(s.Editor={}),i=e.Models.TypedCallback,o=e.Viewer.Controls.EditEventMenu,r=e.Viewer.Controls.OrderedContainer,a=function(){function s(){var n=this;this._seekCallbacks=new i,this._editCallbacks=new i,this._deleteCallbacks=new i,this._eventSeekCallbacks=new i,this.orderedContainer=new r,this.expanded=!1,this.eventRows={},this.element=$(s.template()),this.sessionReferenceName=this.element.find(".session-reference-name"),this.sessionReferenceDisplayTime=this.element.find(".session-reference-display-time"),this.sessionReferenceToggle=this.element.find(".session-reference-toggle"),this.sessionReferenceExpandedToc=this.element.find(".session-reference-expanded-toc");var e=this.element.find(".session-reference-row");Panopto.Core.UI.Handlers.button(this.element,function(){n._seekCallbacks.fire(n.sessionReference)}),this.editMenu=new o(e,e.find(".session-reference-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),this.editMenu.editCallbacks.add(function(e){n._editCallbacks.fire(e)}),this.editMenu.deleteCallbacks.add(function(e){n._deleteCallbacks.fire(e)}),Panopto.Core.UI.Handlers.button(this.sessionReferenceToggle,function(){n.toggleExpandedToc()})}return Object.defineProperty(s.prototype,"seekCallbacks",{get:function(){return this._seekCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"editCallbacks",{get:function(){return this._editCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"deleteCallbacks",{get:function(){return this._deleteCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"eventSeekCallbacks",{get:function(){return this._eventSeekCallbacks},enumerable:!0,configurable:!0}),s.prototype.render=function(e){var n=(this.sessionReference=e).editorStartTime/Panopto.Core.Constants.TimelineChunkMultiplier,s=n+e.referencedSessionDuration,t=Panopto.Core.TimeHelpers.formatDuration(n,Panopto.GlobalResources.TimeSeparator)+" -\n                "+Panopto.Core.TimeHelpers.formatDuration(s,Panopto.GlobalResources.TimeSeparator);this.sessionReferenceName.text(e.name),this.sessionReferenceDisplayTime.text(t),this.editMenu.setEvent(e,{canEdit:!0,canDelete:!0}),this.renderToc()},s.prototype.toggleExpandedToc=function(){this.expanded=!this.expanded,this.sessionReferenceToggle.toggleClass("expanded",this.expanded),this.sessionReferenceExpandedToc.toggle(this.expanded)},s.prototype.renderToc=function(){var n=this;this.sessionReferenceExpandedToc.append(this.orderedContainer.element),_.each(this.sessionReference.events.concat(this.sessionReference.slideEvents),function(e){e.isDefaultThumbnail||(n.eventRows.hasOwnProperty(e.id)||n.createTocRow(e),n.eventRows[e.id].render({name:e.name,editorTime:e.viewerTime,link:e.link}))})},s.prototype.createTocRow=function(e){var n=this,s=new t.EditorEventRow;this.orderedContainer.insert(s.element,e.viewerTime),s.seekCallbacks.add(function(e){n._eventSeekCallbacks.fire(e)}),this.eventRows[e.id]=s},s.template=_.template('\n            <div class="session-reference-row-wrapper">\n                <div class="session-reference-row" tabindex="0">\n                    <div class="session-reference-toggle material-icons">&#xE5C5;</div>\n                    <div class="session-reference-icon-code material-icons">&#xE259;</div>\n                    <div class="session-reference-name ellipsis"></div>\n                    <div class="session-reference-edit-toggle material-icons" tabindex="0" title="<@= Panopto.GlobalResources.ViewerPlus_EventMore @>">&#xE5D4;</div>\n                    <div class="session-reference-display-time"></div>\n                </div>\n                <div class="session-reference-expanded-toc" style="display: none;"></div>\n            </div>'),s}(),t.SessionReferenceRow=a}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(s){var e,i,l,t;e=s.Viewer||(s.Viewer={}),i=e.Tabs||(e.Tabs={}),l=i.Editor||(i.Editor={}),t=function(){function e(e){var i=this;this.slideDeckTemplate=_.template('\n            <div class="slide-deck" style="display:none;">\n                <div class="slide-deck-row">\n                    <div class="slide-deck-expand expanded"></div>\n                    <div class="slide-deck-name ellipsis"></div>\n                    <div class="slide-deck-edit-toggle material-icons" tabindex="0" title="<@= Panopto.GlobalResources.ViewerPlus_EventMore @>">&#xE5D4;</div>\n                </div>\n                <div class="slide-list"></div>\n            </div>\n        '),this.slideEventSelectedCallbacks=$.Callbacks(),this.slideEventAddCallbacks=$.Callbacks(),this.slideEventEditCallbacks=$.Callbacks(),this.slideEventDeleteCallbacks=$.Callbacks(),this.slideDeckDeletedCallbacks=$.Callbacks(),this.slideRows={},this.element=$(this.slideDeckTemplate()),this.slideDeckExpand=this.element.find(".slide-deck-expand"),this.slideDeckName=this.element.find(".slide-deck-name"),this.slideList=this.element.find(".slide-list"),Panopto.Core.UI.Handlers.button(this.slideDeckExpand,function(){i.slideDeckExpand.toggleClass(Panopto.Core.Constants.ExpandedClass),i.slideList.toggle(i.slideDeckExpand.hasClass(Panopto.Core.Constants.ExpandedClass))}),this.editMenu=new s.Viewer.Controls.EditEventMenu(this.element,this.element.find(".slide-deck-edit-toggle"),Panopto.GlobalResources),this.editMenu.deleteCallbacks.add(function(e){i.slideDeckDeletedCallbacks.fire()}),e.append(this.element)}return e.prototype.render=function(e){this.slideDeckId=e.id,this.slideDeckName.html(e.name),this.editMenu.setEvent(e,{canEdit:!1,canDelete:!0}),this.element.show()},e.prototype.hide=function(){this.element.hide()},e.prototype.remove=function(){this.element.remove()},e.prototype.renderSlide=function(i,e){var s=this;if(!this.slideRows.hasOwnProperty(i.id)){var t=new l.SlideRow(this.slideList,i);t.slideEventSelectedCallbacks.add(function(e){s.slideEventSelectedCallbacks.fire(i,e)}),t.slideEventAddCallbacks.add(function(){s.slideEventAddCallbacks.fire(i)}),t.slideEventEditCallbacks.add(function(e){s.slideEventEditCallbacks.fire(i,e)}),t.slideEventDeleteCallbacks.add(function(e){s.slideEventDeleteCallbacks.fire(i,e)}),this.slideRows[i.id]=t}this.slideRows[i.id].renderEvents(e)},e.prototype.setCanAddSlide=function(i){_.each(this.slideRows,function(e){e.setCanAddSlide(i)})},e}(),l.SlideDeckRow=t}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(s){var e,t,i,n;e=s.Viewer||(s.Viewer={}),t=e.Tabs||(e.Tabs={}),i=t.Editor||(t.Editor={}),n=function(){function e(e,t){var i=this;this.container=e,this.slide=t,this.template=_.template('\n            <div class="slide">\n                <div class="slide-preview-wrapper">\n                    <div class="slide-preview">\n                        <img class="slide-image" src="<@= imageUrl @>" />\n                        <div class="slide-add">\n                            <i class="material-icons">&#xE145;</i>\n                        </div>\n                    </div>\n                </div>\n                <div class="slide-event-list"></div>\n            </div>\n        '),this.eventTemplate=_.template('\n            <div class="index-event" tabindex="0">\n                <div class="index-event-row">\n                    <div class="event-edit-toggle material-icons" tabindex="0" title="<@= Panopto.GlobalResources.ViewerPlus_EventMore @>">&#xE5D4;</div>\n                    <div class="event-time"></div>\n                </div>\n            </div>\n        '),this.slideEventSelectedCallbacks=$.Callbacks(),this.slideEventAddCallbacks=$.Callbacks(),this.slideEventEditCallbacks=$.Callbacks(),this.slideEventDeleteCallbacks=$.Callbacks(),this.eventElements={},this.eventEditMenus={},this.element=$(this.template(t)),this.eventList=this.element.find(".slide-event-list"),Panopto.Core.UI.Handlers.button(this.element.find(".slide-add"),function(){i.canAddSlide&&i.slideEventAddCallbacks.fire(t)}),this.eventListScrollingHighlight=Panopto.Core.UI.Components.scrollingHighlight(this.eventList,!0,Panopto.Viewer.Constants.EventScrollTimeout),e.append(this.element)}return e.prototype.renderEvents=function(i){var n=this;_.each(i,function(e){if(!n.eventElements.hasOwnProperty(e.id)){var t=$(n.eventTemplate(e));t.find(".event-edit-controls"),Panopto.Core.UI.Handlers.button(t,function(){n.eventListScrollingHighlight.highlight(e),n.slideEventSelectedCallbacks.fire(e)}),n.eventElements[e.id]=t;var i=new s.Viewer.Controls.EditEventMenu(t,t.find(".event-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0});i.editCallbacks.add(function(e){n.slideEventEditCallbacks.fire(e)}),i.deleteCallbacks.add(function(e){n.slideEventDeleteCallbacks.fire(e)}),n.eventEditMenus[e.id]=i}n.eventElements[e.id].find(".event-time").text(e.displayTime),n.eventList.append(n.eventElements[e.id]),n.eventEditMenus[e.id].setEvent(e,{canEdit:!0,canDelete:!0})}),_.each(this.eventElements,function(e,t){_.some(i,function(e){return e.id===t})||(e.remove(),delete n.eventElements[t])})},e.prototype.setCanAddSlide=function(e){this.canAddSlide=e},e}(),i.SlideRow=n}(PanoptoTS||(PanoptoTS={}));
var PanoptoTS;!function(a){var e,t,i,s;e=a.Viewer||(a.Viewer={}),t=e.Tabs||(e.Tabs={}),i=t.Editor||(t.Editor={}),s=function(){function e(){var t=this;this._streamSeekCallbacks=new a.Models.TypedCallback,this._streamEditCallbacks=new a.Models.TypedCallback,this.element=$(e.template()),this.streamIconCode=this.element.find(".stream-icon-code"),this.streamName=this.element.find(".stream-name"),this.streamDisplayTime=this.element.find(".stream-display-time"),Panopto.Core.UI.Handlers.button(this.element,function(){t._streamSeekCallbacks.fire(t.stream)}),this.editEventMenu=new a.Viewer.Controls.EditEventMenu(this.element,this.element.find(".stream-edit-toggle"),Panopto.GlobalResources,{toggleAppearsOnHover:!0}),this.editEventMenu.editCallbacks.add(function(e){t._streamEditCallbacks.fire(e)})}return Object.defineProperty(e.prototype,"streamSeekCallbacks",{get:function(){return this._streamSeekCallbacks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streamEditCallbacks",{get:function(){return this._streamEditCallbacks},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t){this.stream=t;var a=e.calculateEditorTimeFromAbsolute(t.absoluteStart),i=e.calculateEditorTimeFromAbsolute(t.absoluteEnd),s="\n            "+Panopto.Core.TimeHelpers.formatDuration(a,Panopto.GlobalResources.TimeSeparator)+" -\n            "+Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator);this.streamIconCode.html(t.iconCode),this.streamName.text(t.getStreamName()),this.streamDisplayTime.text(s),this.element.show(),this.editEventMenu.setEvent(t,{canEdit:!0})},e.prototype.getStream=function(){return this.stream},e.template=_.template('\n            <div class="stream-row" tabindex="0">\n                <div class="stream-icon-code material-icons"></div>\n                <div class="stream-name ellipsis"></div>\n                <div class="stream-edit-toggle material-icons" tabindex="0" title="<@= Panopto.GlobalResources.ViewerPlus_EventMore @>">&#xE5D4;</div>\n                <div class="stream-display-time"></div>\n            </div>'),e}(),i.StreamRow=s}(PanoptoTS||(PanoptoTS={}));